import{g as m,d as f,I as K,y as Y,c as H,o as i,w as q,b as N,a as e,i as A,m as G,f as u,h as _,t as l,e as P,q as T,j as p,n as O,F as R,K as D,B as J,l as W}from"./app-CicXSMAK.js";import{P as X}from"./P2PAppLayout-BdNAnacM.js";import{P as Q}from"./P2PSelect-C9DhHw33.js";import{g as j}from"./paymentMethods-stziNKzb.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Z=[{value:"CNY",label:"¥ CNY",symbol:"¥"},{value:"USD",label:"$ USD",symbol:"$"},{value:"GBP",label:"£ GBP",symbol:"£"},{value:"SGD",label:"S$ SGD",symbol:"S$"},{value:"HKD",label:"HK$ HKD",symbol:"HK$"},{value:"JPY",label:"¥ JPY",symbol:"¥"},{value:"KRW",label:"₩ KRW",symbol:"₩"},{value:"AUD",label:"A$ AUD",symbol:"A$"},{value:"CAD",label:"C$ CAD",symbol:"C$"},{value:"EUR",label:"€ EUR",symbol:"€"},{value:"INR",label:"₹ INR",symbol:"₹"},{value:"RUB",label:"₽ RUB",symbol:"₽"},{value:"BRL",label:"R$ BRL",symbol:"R$"},{value:"MXN",label:"$ MXN",symbol:"$"}],ee={class:"mx-auto max-w-5xl px-4 py-4 sm:px-6 lg:px-8"},te={key:0,class:"flex items-center justify-center py-12"},ae={key:1},se={class:"mb-4"},le={class:"text-2xl font-bold text-gray-900 dark:text-slate-100"},re={class:"mt-2 text-sm text-gray-600 dark:text-slate-400"},oe={key:0,class:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"},de={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},ie={class:"space-y-4"},ne={class:"bg-white dark:bg-slate-900 rounded-lg shadow-sm border border-gray-200 dark:border-slate-800 p-5"},ue={class:"text-lg font-semibold text-gray-900 dark:text-slate-100 mb-4"},ce={key:0,class:"mb-4 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg"},me={class:"mb-4 p-3 bg-gray-50 dark:bg-slate-800 rounded-lg"},ve={class:"flex items-center justify-between"},be={class:"flex items-center gap-2"},ye={class:"text-lg font-semibold text-gray-900 dark:text-slate-100"},xe={key:0,class:"text-xs px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded"},pe={key:1,class:"text-xs px-2 py-0.5 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded"},ge={class:"space-y-4"},fe={class:"relative"},_e=["min","max"],ke={class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 dark:text-slate-400 font-medium"},he={class:"relative"},we={class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 dark:text-slate-400 font-medium"},Ce={class:"space-y-2"},$e={class:"block text-sm font-medium text-gray-700 dark:text-slate-300"},Se={key:0,class:"p-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg"},Ae={key:1,class:"text-sm text-red-600 dark:text-red-400"},De={class:"text-sm text-gray-600 dark:text-slate-400"},Ue={key:0,class:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"},Be={class:"text-sm text-red-600 dark:text-red-400"},Fe=["disabled"],Ne={class:"bg-white dark:bg-slate-900 rounded-lg shadow-sm border border-gray-200 dark:border-slate-800 p-5"},Pe={class:"space-y-3"},Te={class:"flex justify-between py-2 border-b border-gray-100 dark:border-slate-800"},Re={class:"text-sm font-medium text-gray-900 dark:text-slate-100"},je={class:"flex justify-between py-2 border-b border-gray-100 dark:border-slate-800"},Ie={class:"text-sm font-medium text-gray-900 dark:text-slate-100"},Me={class:"flex justify-between py-2 border-b border-gray-100 dark:border-slate-800"},Le={class:"text-sm font-medium text-gray-900 dark:text-slate-100"},Ve={class:"flex justify-between py-2 border-b border-gray-100 dark:border-slate-800"},ze={class:"text-sm font-medium text-gray-900 dark:text-slate-100"},Ee={class:"flex justify-between py-2 border-b border-gray-100 dark:border-slate-800"},Ke={class:"text-sm font-medium text-gray-900 dark:text-slate-100"},Ye={class:"flex justify-between py-2"},He={class:"text-sm font-medium text-gray-900 dark:text-slate-100"},qe={class:"space-y-4"},Ge={class:"bg-white dark:bg-slate-900 rounded-lg shadow-sm border border-gray-200 dark:border-slate-800 p-5"},Oe={class:"flex items-start gap-4 mb-4"},Je={class:"relative"},We=["href"],Xe={class:"h-12 w-12 rounded-full bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center"},Qe={class:"text-white font-bold text-lg"},Ze={class:"flex-1"},et={class:"flex items-center gap-2"},tt=["href"],at={class:"flex items-center gap-4 mt-1"},st={class:"flex items-center gap-1"},lt={class:"text-sm font-medium text-gray-900 dark:text-slate-100"},rt={class:"text-sm text-green-600 dark:text-green-400"},ot={class:"font-medium"},dt={class:"bg-white dark:bg-slate-900 rounded-lg shadow-sm border border-gray-200 dark:border-slate-800 p-5"},it={class:"prose prose-sm dark:prose-invert max-w-none"},nt={class:"text-sm text-gray-700 dark:text-slate-300 whitespace-pre-wrap"},yt={__name:"CreateOrder",props:{adId:{type:String,required:!0},tradeType:{type:String,required:!0,validator:o=>["buy","sell"].includes(o)},userAddresses:{type:Array,default:()=>[]}},setup(o){const k=o,a=m(null),w=m(!1),g=m(!1),n=m(""),b=m(""),x=m(""),r=m(""),C=m(!1),h=m({crypto_prices_usd:{},exchange_rates:{},updated_at:null}),U=m(!1),B=s=>{if(!s)return"USDT";const t=s.split("-");return t[t.length-1].toUpperCase()},v=f(()=>{if(!a.value)return 0;if(a.value.price_model==="fixed")return Number(a.value.price)||0;{const s=B(a.value.cryptocurrency);let t=h.value.crypto_prices_usd?.[s];!t&&(s==="USDC"||s==="USDT")&&(t=1);let d=1;if(a.value.fiat_currency!=="USD"&&(d=h.value.exchange_rates?.[a.value.fiat_currency]||1),console.log("Dynamic price debug:",{baseSymbol:s,usdPrice:t,fiatCurrency:a.value.fiat_currency,exchangeRate:d,availableCryptos:Object.keys(h.value.crypto_prices_usd||{})}),!t)return Number(a.value.price)||0;const z=t*d,E=Number(a.value.margin)||0;return z*(1+E/100)}}),c=f(()=>{const s=a.value?.fiat_currency||"CNY";return Z.find(d=>d.value===s)||{value:"CNY",symbol:"¥",label:"CNY"}}),y=f(()=>{if(!a.value?.currency_key)return{symbol:"USDT",label:"USDT",network:""};if(a.value.crypto_info)return{symbol:a.value.crypto_info.currency,label:a.value.crypto_info.label,network:a.value.crypto_info.network};const s=B(a.value.currency_key);return{symbol:s,label:s,network:a.value.network||""}}),F=f(()=>!k.userAddresses||!a.value?[]:k.userAddresses.map(s=>{const t=s.currency_key===a.value.currency_key;return{...s,disabled:!t,label:s.label||`${s.currency} (${s.network}) - ${s.address}`}})),$=()=>{const s=v.value;if(!n.value||!s){b.value="";return}const t=parseFloat(n.value);a.value&&(t<a.value.min_limit?r.value=`最小金额为 ${c.value.symbol}${a.value.min_limit}`:t>a.value.max_limit?r.value=`最大金额为 ${c.value.symbol}${a.value.max_limit}`:r.value=""),b.value=(t/s).toFixed(6)},I=()=>{const s=v.value;if(!b.value||!s){n.value="";return}const t=parseFloat(b.value)*s;n.value=t.toFixed(2),a.value&&(t<a.value.min_limit?r.value=`最小金额为 ${c.value.symbol}${a.value.min_limit}`:t>a.value.max_limit?r.value=`最大金额为 ${c.value.symbol}${a.value.max_limit}`:r.value="")},S=f(()=>!(C.value||!n.value||!b.value||!x.value)),M=async()=>{try{U.value=!0;const s=await D.get("/web/api/market/prices");console.log("Fetched price data:",s.data),s.data&&(h.value=s.data,n.value&&$())}catch(s){console.error("Failed to fetch crypto prices:",s)}finally{U.value=!1}},L=async()=>{if(S.value)try{g.value=!0;const s={ad_id:k.adId,fiat_amount:parseFloat(n.value)};x.value&&(s.address_id=x.value);const t=await D.post("/web/api/orders",s);t.data.success?W.visit(`/trade/${t.data.data.order_no}/chat`):r.value=t.data.message||"创建订单失败"}catch(s){console.error("Error creating order:",s),s.response?.data?.message?r.value=s.response.data.message:r.value="创建订单失败，请稍后重试"}finally{g.value=!1}},V=async()=>{try{w.value=!0;const s=await D.get(`/web/api/ads/${k.adId}`);if(s.data.success){a.value=s.data.data.ad,console.log("Ad details loaded:",a.value);const t=J().props.auth?.user;t&&a.value.user_id===t.id&&(C.value=!0,r.value="您不能在自己的广告上创建订单"),a.value.price_model==="dynamic"&&await M()}else console.error("Failed to load ad:",s.data.message),r.value=s.data.message||"加载广告失败"}catch(s){console.error("Error fetching ad details:",s),r.value="加载广告失败，请稍后重试"}finally{w.value=!1}};return K(v,()=>{n.value&&$()}),Y(()=>{V()}),(s,t)=>(i(),H(X,null,{default:q(()=>[N(A(G),{title:`${o.tradeType==="buy"?"购买":"出售"} ${y.value.label}`},null,8,["title"]),e("div",ee,[w.value&&!a.value?(i(),u("div",te,[...t[3]||(t[3]=[e("div",{class:"text-center"},[e("svg",{class:"animate-spin h-8 w-8 text-emerald-500 mx-auto mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),e("p",{class:"text-gray-600 dark:text-slate-400"},"加载广告信息...")],-1)])])):(i(),u("div",ae,[e("div",se,[e("h1",le,l(o.tradeType==="buy"?"购买":"出售")+" "+l(y.value.label)+" 使用 "+l(A(j)(a.value?.payment_method)?.label||a.value?.payment_method||"银行转账")+" 来自 "+l(a.value?.user?.name||"商家"),1),e("p",re,l(o.tradeType==="buy"?"购买":"出售")+" "+l(y.value.label)+" 价格 "+l(c.value.symbol)+l(v.value?a.value?.price_model==="dynamic"?v.value.toFixed(6):v.value.toFixed(2):"0.00")+" 使用 "+l(A(j)(a.value?.payment_method)?.label||a.value?.payment_method||"银行转账"),1)]),C.value?(i(),u("div",oe,[...t[4]||(t[4]=[e("div",{class:"flex items-start gap-3"},[e("svg",{class:"w-6 h-6 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("div",null,[e("h3",{class:"font-semibold text-red-800 dark:text-red-200"},"无法创建订单"),e("p",{class:"text-sm text-red-600 dark:text-red-400 mt-1"},"您不能在自己发布的广告上创建订单。请选择其他商家的广告进行交易。")])],-1)])])):_("",!0),e("div",de,[e("div",ie,[e("div",ne,[e("h2",ue," 输入要"+l(o.tradeType==="buy"?"购买":"出售")+"的金额 ",1),a.value?.price_model==="dynamic"?(i(),u("div",ce,[...t[5]||(t[5]=[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("div",{class:"flex-1"},[e("p",{class:"text-sm text-amber-800 dark:text-amber-200 font-medium"},"动态价格提示"),e("p",{class:"text-xs text-amber-700 dark:text-amber-300 mt-1"}," 当前显示的是估算价格。实际交易价格将在订单创建时确定，可能会因市场波动而有所不同。 ")])],-1)])])):_("",!0),e("div",me,[e("div",ve,[e("div",be,[t[6]||(t[6]=e("span",{class:"text-sm text-gray-600 dark:text-slate-400"},"当前价格:",-1)),e("span",ye,l(c.value.symbol)+l(v.value?a.value?.price_model==="dynamic"?v.value.toFixed(6):v.value.toFixed(2):"0.00"),1),a.value?.price_model==="dynamic"?(i(),u("span",xe," 动态价格 ")):(i(),u("span",pe," 固定价格 "))])])]),e("div",ge,[e("div",null,[e("div",fe,[P(e("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>n.value=d),type:"number",min:a.value?.min_limit,max:a.value?.max_limit,placeholder:"0",class:"w-full px-4 py-3 pr-12 text-lg border-2 border-gray-300 dark:border-slate-600 rounded-lg bg-gray-50 dark:bg-slate-800 text-gray-900 dark:text-slate-100 placeholder-gray-400 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",onInput:$},null,40,_e),[[T,n.value]]),e("span",ke,l(c.value.value),1)])]),e("div",null,[e("div",he,[P(e("input",{"onUpdate:modelValue":t[1]||(t[1]=d=>b.value=d),type:"number",placeholder:"0",step:"0.000001",class:"w-full px-4 py-3 pr-12 text-lg border-2 border-gray-300 dark:border-slate-600 rounded-lg bg-gray-50 dark:bg-slate-800 text-gray-900 dark:text-slate-100 placeholder-gray-400 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",onInput:I},null,544),[[T,b.value]]),e("span",we,l(y.value.symbol),1)])]),e("div",Ce,[e("label",$e,[p(l(o.tradeType==="sell"?"发款地址":"收款地址")+" ",1),t[7]||(t[7]=e("span",{class:"text-red-500"},"*",-1))]),N(Q,{modelValue:x.value,"onUpdate:modelValue":t[2]||(t[2]=d=>x.value=d),options:F.value,placeholder:`选择${o.tradeType==="sell"?"发款":"收款"}地址`},null,8,["modelValue","options","placeholder"]),F.value.length===0?(i(),u("div",Se,[...t[8]||(t[8]=[e("p",{class:"text-sm text-amber-700 dark:text-amber-300"},[p(" 您还没有添加任何地址。 "),e("a",{href:"/wallet/address-verification",class:"underline hover:text-amber-800 dark:hover:text-amber-200"}," 前往添加地址 → ")],-1)])])):_("",!0),!x.value&&n.value?(i(),u("div",Ae," 请选择"+l(o.tradeType==="sell"?"发款":"收款")+"地址 ",1)):_("",!0)]),e("div",De," 限额: "+l(c.value.symbol)+l(a.value?.min_limit?.toLocaleString()||"100")+" - "+l(c.value.symbol)+l(a.value?.max_limit?.toLocaleString()||"50,000")+" "+l(c.value.value),1),r.value?(i(),u("div",Ue,[e("p",Be,l(r.value),1)])):_("",!0),e("button",{onClick:L,disabled:!S.value||g.value,class:O(["w-full py-3 px-6 rounded-lg font-semibold text-white transition-all",S.value&&!g.value?o.tradeType==="buy"?"bg-orange-500 hover:bg-orange-600 cursor-pointer":"bg-blue-600 hover:bg-blue-700 cursor-pointer":"bg-gray-300 dark:bg-slate-700 cursor-not-allowed"])},l(g.value?"处理中...":(o.tradeType==="buy"?"购买":"出售")+" "+y.value.symbol),11,Fe)])]),e("div",Ne,[t[15]||(t[15]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-slate-100 mb-4"},"广告详情",-1)),e("div",Pe,[e("div",Te,[t[9]||(t[9]=e("span",{class:"text-sm text-gray-600 dark:text-slate-400"},"国家",-1)),e("span",Re,l(a.value?.country_name||a.value?.country||"中国"),1)]),e("div",je,[t[10]||(t[10]=e("span",{class:"text-sm text-gray-600 dark:text-slate-400"},"网络",-1)),e("span",Ie,l(y.value.network||a.value?.network||"ERC-20"),1)]),e("div",Me,[t[11]||(t[11]=e("span",{class:"text-sm text-gray-600 dark:text-slate-400"},"加密货币",-1)),e("span",Le,l(y.value.label),1)]),e("div",Ve,[t[12]||(t[12]=e("span",{class:"text-sm text-gray-600 dark:text-slate-400"},"支付方式",-1)),e("span",ze,l(a.value?.payment_method_name||a.value?.payment_method||"银行转账"),1)]),e("div",Ee,[t[13]||(t[13]=e("span",{class:"text-sm text-gray-600 dark:text-slate-400"},"价格模型",-1)),e("span",Ke,[a.value?.price_model==="fixed"?(i(),u(R,{key:0},[p(" 固定价格 ")],64)):(i(),u(R,{key:1},[p(l(a.value?.margin||"0")+"% "+l(a.value?.margin>=0?"高于":"低于")+"市场 ",1)],64))])]),e("div",Ye,[t[14]||(t[14]=e("span",{class:"text-sm text-gray-600 dark:text-slate-400"},"交易类型",-1)),e("span",He,l(a.value?.trade_type==="buy"?"客户购买":"客户出售"),1)])])])]),e("div",qe,[e("div",Ge,[t[18]||(t[18]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-slate-100 mb-4"},"商家信息",-1)),e("div",Oe,[e("div",Je,[e("a",{href:`/trader/profile/${a.value?.user?.id}`,target:"_blank",class:"block cursor-pointer hover:opacity-80 transition-opacity"},[e("div",Xe,[e("span",Qe,l(a.value?.user?.name?.[0]?.toUpperCase()||"C"),1)])],8,We)]),e("div",Ze,[e("div",et,[e("a",{href:`/trader/profile/${a.value?.user?.id}`,target:"_blank",class:"font-semibold text-gray-900 dark:text-slate-100 hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors cursor-pointer"},l(a.value?.user?.name||"cryptocoop"),9,tt)]),e("div",at,[e("div",st,[t[16]||(t[16]=e("svg",{class:"w-4 h-4 text-yellow-500",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})],-1)),e("span",lt,l(a.value?.user?.rating||0),1)]),e("div",rt,[e("span",ot,l(a.value?.user?.trades_count||0),1),t[17]||(t[17]=p(" 笔交易 ",-1))])])])])]),e("div",dt,[t[19]||(t[19]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-slate-100 mb-4"},"交易条款和条件",-1)),e("div",it,[e("p",nt,l(a.value?.vendor_toc||a.value?.welcome_message||"快速安全的交易，专业服务。"),1)])]),t[20]||(t[20]=e("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 dark:from-slate-800 dark:to-slate-900 rounded-lg p-5 text-white shadow-lg"},[e("h3",{class:"text-base font-semibold mb-3 flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),p(" 交易提示 ")]),e("p",{class:"text-sm mb-4 leading-relaxed text-gray-200"}," 请仔细检查价格并认真阅读条款。汇率和价格波动可能会改变最终金额。您输入的法币金额很重要，加密货币金额将在请求时计算。如果线下交易，请选择安全的公共场所进行交易。 "),e("div",{class:"space-y-3"},[e("div",{class:"bg-white/10 backdrop-blur rounded-lg p-3"},[e("h4",{class:"font-medium mb-1.5 text-blue-300"},"如何联系交易者？"),e("p",{class:"text-xs leading-relaxed text-gray-300"}," 一旦您进入交易，您将能够通过私人消息框与此交易者自由聊天。 ")]),e("div",{class:"bg-white/10 backdrop-blur rounded-lg p-3"},[e("h4",{class:"font-medium mb-1.5 text-amber-300"},"如何取消交易？"),e("p",{class:"text-xs leading-relaxed text-gray-300"}," 一旦您进入交易，您不能自动取消交易，因为这可能会导致对方损失。如果出现错误，请提交支持工单或发起争议。 ")])])],-1))])])]))])]),_:1}))}};export{yt as default};
