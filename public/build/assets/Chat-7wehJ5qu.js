import{d as I,g as fe,h as he,i as Fe,c as ne,o as a,b as $,w as M,f as o,l as u,T as ke,n as x,a as e,k as de,J as Ze,t as n,I as Re,x as H,r as z,C as ae,F as E,s as W,e as N,A as te,j as K,L as ye,q as w,v as re,M as pe,K as J,E as Ye,p as Be,B as et}from"./app-D0797LZw.js";import{P as tt}from"./P2PAppLayout-C2g2CPz-.js";import{_ as R}from"./P2PButton-CJ4hgcVh.js";import{_ as se}from"./P2PDialog-D6x08B88.js";import"./useConfig-AWQibc7G.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const rt={class:"flex-shrink-0 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 px-4 py-3"},st={class:"flex items-center justify-between"},at={key:0,class:"absolute top-2 left-1/2 -translate-x-1/2 w-12 h-1 bg-gray-300 dark:bg-gray-600 rounded-full"},ot={class:"flex items-center gap-3"},lt={class:"text-lg font-bold text-gray-900 dark:text-gray-100"},dt={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},nt={key:0,class:"flex-shrink-0 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 p-4"},je={__name:"P2PMobileDrawer",props:{modelValue:{type:Boolean,default:!1},title:{type:String,default:"详情"},subtitle:{type:String,default:""},position:{type:String,default:"bottom",validator:r=>["bottom","right","left"].includes(r)},size:{type:String,default:"default",validator:r=>["small","default","large","full"].includes(r)},icon:{type:[Object,String],default:null},iconColor:{type:String,default:"blue",validator:r=>["blue","emerald","amber","red","purple"].includes(r)},persistent:{type:Boolean,default:!1},scrollable:{type:Boolean,default:!0}},emits:["update:modelValue","open","close"],setup(r,{emit:c}){const y=r,b=c,v=I(()=>({bottom:"bottom-0 left-0 right-0 rounded-t-2xl",right:"top-0 right-0 bottom-0 rounded-l-2xl",left:"top-0 left-0 bottom-0 rounded-r-2xl"})[y.position]),d=I(()=>y.position==="bottom"?{small:"max-h-[40vh]",default:"max-h-[70vh]",large:"max-h-[85vh]",full:"h-full"}[y.size]:{small:"w-64",default:"w-80",large:"w-96",full:"w-full"}[y.size]),m=I(()=>{let f=["flex-1","min-h-0"];return y.scrollable&&f.push("overflow-y-auto"),f.join(" ")}),C=I(()=>({bottom:{from:"translate-y-full",to:"translate-y-0"},right:{from:"translate-x-full",to:"translate-x-0"},left:{from:"-translate-x-full",to:"translate-x-0"}})[y.position]),L=I(()=>({blue:"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400",emerald:"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400",amber:"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400",red:"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400",purple:"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"})[y.iconColor]),B=()=>{y.persistent||(b("update:modelValue",!1),b("close"))},P=f=>{f.key==="Escape"&&y.modelValue&&!y.persistent&&B()},O=f=>{f?document.body.style.overflow="hidden":document.body.style.overflow=""};return fe(()=>y.modelValue,f=>{O(f),f&&b("open")}),he(()=>{document.addEventListener("keydown",P)}),Fe(()=>{document.removeEventListener("keydown",P),O(!1)}),(f,_)=>(a(),ne(Re,{to:"body"},[$(ke,{"enter-active-class":"transition-opacity ease-out duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity ease-in duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:M(()=>[r.modelValue?(a(),o("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] lg:hidden",onClick:B})):u("",!0)]),_:1}),$(ke,{"enter-active-class":"transition-transform ease-out duration-300","enter-from-class":C.value.from,"enter-to-class":C.value.to,"leave-active-class":"transition-transform ease-in duration-200","leave-from-class":C.value.to,"leave-to-class":C.value.from},{default:M(()=>[r.modelValue?(a(),o("div",{key:0,class:x(["fixed z-[70] bg-white dark:bg-gray-900 shadow-2xl lg:hidden flex flex-col pt-safe",v.value,d.value])},[e("div",rt,[e("div",st,[r.position==="bottom"?(a(),o("div",at)):u("",!0),e("div",ot,[de(f.$slots,"header-icon",{},()=>[r.icon?(a(),o("div",{key:0,class:x(["p-2 rounded-lg",L.value])},[(a(),ne(Ze(r.icon),{class:"w-5 h-5"}))],2)):u("",!0)]),e("div",null,[e("h3",lt,n(r.title),1),r.subtitle?(a(),o("p",dt,n(r.subtitle),1)):u("",!0)])]),e("button",{onClick:B,class:"p-2 rounded text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},[..._[0]||(_[0]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",{class:x(m.value)},[de(f.$slots,"default")],2),f.$slots.footer?(a(),o("div",nt,[de(f.$slots,"footer")])):u("",!0)],2)):u("",!0)]),_:3},8,["enter-from-class","enter-to-class","leave-from-class","leave-to-class"])]))}},it={class:"md:hidden sticky top-0 z-50 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 pt-safe"},ut={class:"flex items-center justify-between h-14 px-4"},ct={class:"flex items-center gap-3 flex-1"},mt={class:"text-base font-semibold text-gray-900 dark:text-gray-100"},xt={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},vt={class:"flex items-center gap-1"},gt={__name:"P2PMobileHeader",props:{title:{type:String,required:!0},subtitle:{type:String,default:""},backUrl:{type:String,default:null}},setup(r){const c=r,y=()=>{c.backUrl?H.visit(c.backUrl):window.history.back()};return(b,v)=>(a(),o("div",it,[e("div",ut,[e("div",ct,[e("button",{onClick:y,class:"p-2 -ml-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},[...v[0]||(v[0]=[e("svg",{class:"w-5 h-5 text-gray-700 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),de(b.$slots,"custom",{},()=>[e("div",null,[e("h1",mt,n(r.title),1),r.subtitle?(a(),o("p",xt,n(r.subtitle),1)):u("",!0)])])]),e("div",vt,[de(b.$slots,"actions")])])]))}},bt={class:"space-y-3"},yt={class:"flex items-center gap-2"},ft={class:"text-sm font-medium text-gray-700 dark:text-slate-300"},kt={class:"flex gap-2 justify-center"},pt=["onUpdate:modelValue","onInput","onKeydown","disabled"],ht={key:0,class:"text-xs text-red-600 dark:text-red-400 text-center"},wt={key:1,class:"text-xs text-gray-500 dark:text-slate-400 text-center"},_t={key:2,class:"text-center"},De={__name:"P2PTwoFactorInput",props:{modelValue:{type:String,default:""},label:{type:String,default:"双重验证码"},error:{type:String,default:""},helpText:{type:String,default:"请输入您的验证器应用中显示的6位数字"},disabled:{type:Boolean,default:!1},showRecoveryOption:{type:Boolean,default:!1},autoFocus:{type:Boolean,default:!0}},emits:["update:modelValue","complete","use-recovery"],setup(r,{expose:c,emit:y}){const b=r,v=y,d=z(["","","","","",""]),m=z([]);fe(d,f=>{const _=f.join("");v("update:modelValue",_),_.length===6&&/^\d{6}$/.test(_)&&v("complete",_)},{deep:!0}),fe(()=>b.modelValue,f=>{if(f==="")d.value=["","","","","",""];else if(f.length<=6){const _=f.split("");for(let F=0;F<6;F++)d.value[F]=_[F]||""}});const C=(f,_)=>{const F=_.target.value;if(!/^\d*$/.test(F)){_.target.value=d.value[f];return}F&&f<5&&ae(()=>{m.value[f+1]?.focus(),m.value[f+1]?.select()})},L=(f,_)=>{_.key==="Backspace"?!d.value[f]&&f>0&&(_.preventDefault(),d.value[f-1]="",m.value[f-1]?.focus()):_.key==="ArrowLeft"&&f>0?(_.preventDefault(),m.value[f-1]?.focus()):_.key==="ArrowRight"&&f<5&&(_.preventDefault(),m.value[f+1]?.focus())},B=f=>{f.preventDefault();const F=f.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(F){const j=F.split("");for(let k=0;k<6;k++)d.value[k]=j[k]||"";const g=Math.min(j.length,5);m.value[g]?.focus()}},P=()=>{d.value=["","","","","",""],m.value[0]?.focus()},O=()=>{m.value[0]?.focus()};return he(()=>{b.autoFocus&&ae(()=>{m.value[0]?.focus()})}),c({clear:P,focus:O}),(f,_)=>(a(),o("div",bt,[e("div",yt,[_[2]||(_[2]=e("svg",{class:"w-5 h-5 text-emerald-600 dark:text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})],-1)),e("label",ft,n(r.label||"双重验证码"),1)]),e("div",kt,[(a(!0),o(E,null,W(d.value,(F,j)=>N((a(),o("input",{key:j,ref_for:!0,ref:g=>m.value[j]=g,"onUpdate:modelValue":g=>d.value[j]=g,type:"text",inputmode:"numeric",maxlength:"1",class:x(["w-12 h-12 text-center text-lg font-mono font-bold rounded-lg border-2 transition-all duration-200 focus:outline-none",[r.error?"border-red-500 bg-red-50 dark:bg-red-900/20 text-red-900 dark:text-red-200":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:border-emerald-500 dark:focus:border-emerald-400 focus:ring-2 focus:ring-emerald-500/20"]]),onInput:g=>C(j,g),onKeydown:g=>L(j,g),onPaste:_[0]||(_[0]=g=>B(g)),disabled:r.disabled},null,42,pt)),[[te,d.value[j]]])),128))]),r.error?(a(),o("p",ht,n(r.error),1)):u("",!0),r.helpText&&!r.error?(a(),o("p",wt,n(r.helpText),1)):u("",!0),r.showRecoveryOption?(a(),o("div",_t,[e("button",{type:"button",onClick:_[1]||(_[1]=F=>f.$emit("use-recovery")),class:"text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors"}," 使用恢复代码 ")])):u("",!0)]))}},Ct={class:"relative group"},$t={key:0,class:"relative"},Mt=["src","alt"],zt={class:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent md:opacity-0 md:group-hover:opacity-100 transition-opacity flex items-end justify-between p-2"},Bt={key:0,class:"mt-1"},jt={class:"flex gap-1"},Ft={class:"flex-1 min-w-0"},At={class:"relative max-w-[90vw] max-h-[90vh] flex flex-col"},St=["src","alt"],Lt={class:"flex justify-center gap-4 mt-4 md:hidden"},Vt=["href"],be={__name:"P2PAttachment",props:{attachment:{type:Object,required:!0,validator:r=>r.url&&r.name&&r.type},variant:{type:String,default:"default",validator:r=>["default","primary"].includes(r)},thumbnailSize:{type:String,default:"md",validator:r=>["sm","md","lg"].includes(r)},showInfo:{type:Boolean,default:!1}},setup(r){const c=r,y=z(!1);z(!1);const b=I(()=>/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)),v=I(()=>window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://")),d=I(()=>c.attachment.type&&c.attachment.type.startsWith("image/")),m=I(()=>c.attachment.type==="application/pdf"),C={sm:{width:"150px",height:"150px"},md:{width:"200px",height:"200px"},lg:{width:"250px",height:"250px"}},L=I(()=>C[c.thumbnailSize].width),B=I(()=>C[c.thumbnailSize].height),P=I(()=>c.variant==="primary"?"bg-emerald-500 hover:bg-emerald-400":"bg-white dark:bg-slate-700 hover:bg-gray-50 dark:hover:bg-slate-600"),O=I(()=>c.variant==="primary"?"text-white":"text-gray-900 dark:text-slate-200"),f=I(()=>c.variant==="primary"?"text-emerald-100":"text-gray-500 dark:text-slate-400"),_=I(()=>c.variant==="primary"?"text-white":"text-gray-600 dark:text-slate-400"),F=I(()=>c.variant==="primary"?"text-white/90":"text-gray-700 dark:text-slate-300"),j=I(()=>c.variant==="primary"?"text-white/70":"text-gray-500 dark:text-slate-400"),g=V=>{if(!V)return"0 B";const h=1024,we=["B","KB","MB","GB"],i=Math.floor(Math.log(V)/Math.log(h));return Math.round(V/Math.pow(h,i)*100)/100+" "+we[i]},k=V=>V&&{"application/zip":"ZIP","application/x-rar-compressed":"RAR","application/msword":"Word","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"Word","application/vnd.ms-excel":"Excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"Excel","text/plain":"文本","text/csv":"CSV"}[V]||"文件",S=()=>{d.value&&(y.value=!0)},U=()=>{y.value=!1},G=()=>{v.value&&b.value?alert("请长按图片保存或使用分享功能"):window.open(c.attachment.url,"_blank")},Q=()=>{if(v.value&&b.value)if(d.value)S();else{const V=document.createElement("iframe");V.style.display="none",V.src=c.attachment.url,document.body.appendChild(V),setTimeout(()=>{document.body.removeChild(V)},3e3),alert("文件下载已开始，请检查您的下载文件夹")}else{const V=document.createElement("a");V.href=c.attachment.url,V.download=c.attachment.name||"download",document.body.appendChild(V),V.click(),document.body.removeChild(V)}};return(V,h)=>(a(),o("div",Ct,[d.value?(a(),o("div",$t,[e("div",{onClick:S,class:"relative overflow-hidden rounded-lg cursor-pointer transition-all hover:opacity-90",style:ye(`width: ${L.value}; height: ${B.value};`)},[e("img",{src:r.attachment.url,alt:r.attachment.name,class:"w-full h-full object-cover"},null,8,Mt),e("div",zt,[e("button",{onClick:K(S,["stop"]),class:"p-1.5 md:p-2 bg-white/90 backdrop-blur-sm rounded-full text-gray-700 hover:bg-white transition-colors",title:"查看"},[...h[1]||(h[1]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])]),v.value?u("",!0):(a(),o("button",{key:0,onClick:K(Q,["stop"]),class:"p-1.5 md:p-2 bg-white/90 backdrop-blur-sm rounded-full text-gray-700 hover:bg-white transition-colors",title:"下载"},[...h[2]||(h[2]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])]))])],4),r.showInfo?(a(),o("div",Bt,[e("p",{class:x(["text-xs truncate",F.value])},n(r.attachment.name),3),e("p",{class:x(["text-xs",j.value])},n(g(r.attachment.size)),3)])):u("",!0)])):m.value?(a(),o("div",{key:1,class:x(["flex items-center gap-2 md:gap-3 p-2.5 md:p-3 rounded-lg transition-colors",P.value])},[e("div",{class:"flex-shrink-0",onClick:G},[...h[3]||(h[3]=[e("div",{class:"w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center cursor-pointer"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})])],-1)])]),e("div",{class:"flex-1 min-w-0",onClick:G},[e("p",{class:x(["text-xs md:text-sm font-medium truncate cursor-pointer",O.value])},n(r.attachment.name),3),e("p",{class:x(["text-xs",f.value])},"PDF · "+n(g(r.attachment.size)),3)]),e("div",jt,[e("button",{onClick:G,class:"p-1.5 rounded-lg bg-black/5 hover:bg-black/10 transition-colors md:hidden",title:"查看"},[(a(),o("svg",{class:x(["w-4 h-4",_.value]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...h[4]||(h[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])],2))]),v.value?u("",!0):(a(),o("button",{key:0,onClick:K(Q,["stop"]),class:"p-1.5 rounded-lg bg-black/5 hover:bg-black/10 transition-colors",title:"下载"},[(a(),o("svg",{class:x(["w-4 h-4",_.value]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...h[5]||(h[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)])],2))]))])],2)):(a(),o("div",{key:2,class:x(["flex items-center gap-2 md:gap-3 p-2.5 md:p-3 rounded-lg transition-colors",P.value])},[h[7]||(h[7]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-10 h-10 bg-gray-500 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])])],-1)),e("div",Ft,[e("p",{class:x(["text-xs md:text-sm font-medium truncate",O.value])},n(r.attachment.name),3),e("p",{class:x(["text-xs",f.value])},n(k(r.attachment.type))+" · "+n(g(r.attachment.size)),3)]),v.value?u("",!0):(a(),o("button",{key:0,onClick:K(Q,["stop"]),class:"flex-shrink-0 p-1.5 rounded-lg bg-black/5 hover:bg-black/10 transition-colors",title:"下载"},[(a(),o("svg",{class:x(["w-4 h-4",_.value]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...h[6]||(h[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)])],2))]))],2)),(a(),ne(Re,{to:"body"},[$(ke,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:M(()=>[y.value?(a(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm p-4",onClick:U},[e("div",At,[e("img",{src:r.attachment.url,alt:r.attachment.name,class:"max-w-full max-h-[80vh] md:max-h-[90vh] object-contain",onClick:h[0]||(h[0]=K(()=>{},["stop"]))},null,8,St),e("div",Lt,[e("button",{onClick:U,class:"p-3 bg-white/90 backdrop-blur-sm rounded-full text-gray-700 active:bg-white transition-colors",title:"关闭"},[...h[8]||(h[8]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),v.value?u("",!0):(a(),o("button",{key:0,onClick:Q,class:"p-3 bg-white/90 backdrop-blur-sm rounded-full text-gray-700 active:bg-white transition-colors",title:"下载原图"},[...h[9]||(h[9]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])]))]),e("button",{onClick:U,class:"hidden md:block absolute top-4 right-4 p-2 bg-black/50 hover:bg-black/70 rounded-full text-white transition-colors"},[...h[10]||(h[10]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),v.value?u("",!0):(a(),o("a",{key:0,href:r.attachment.url,download:"",class:"hidden md:block absolute bottom-4 right-4 p-3 bg-white/90 hover:bg-white rounded-full text-gray-700 transition-colors",title:"下载原图"},[...h[11]||(h[11]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,Vt))])])):u("",!0)]),_:1})]))]))}},Et={class:"relative"},It=["disabled"],Tt={key:0},Pt={class:"border-b border-gray-200 dark:border-gray-700 p-2"},Ut={class:"flex gap-1 overflow-x-auto"},Dt=["onClick"],qt={class:"p-2 max-h-64 overflow-y-auto"},Rt={class:"grid grid-cols-8 gap-1"},Ht=["onClick","title"],Wt={key:0,class:"border-t border-gray-200 dark:border-gray-700 p-2"},Ot={class:"flex gap-1 flex-wrap"},Nt=["onClick"],Kt={class:"flex flex-col h-full"},Xt={key:0,class:"px-4 pb-3 border-b border-gray-200 dark:border-gray-700"},Jt={class:"flex gap-2 flex-wrap"},Gt=["onClick"],Qt={class:"px-4 py-2 border-b border-gray-200 dark:border-gray-700"},Zt={class:"flex gap-2 overflow-x-auto pb-1"},Yt=["onClick"],er={class:"flex-1 overflow-y-auto px-4 py-3"},tr={class:"grid grid-cols-6 gap-2"},rr=["onClick"],qe={__name:"P2PEmojiPicker",props:{disabled:{type:Boolean,default:!1},placement:{type:String,default:"bottom",validator:r=>["top","bottom"].includes(r)}},emits:["select"],setup(r,{emit:c}){const y=r,b=c,v=z(!1),d=z("smileys"),m=z([]),C=z(!1),L=[{name:"smileys",label:"表情",emojis:["😀","😃","😄","😁","😅","😂","🤣","😊","😇","🙂","😉","😌","😍","🥰","😘","😗","😙","😚","😋","😛","😜","🤪","😝","🤑","🤗","🤭","🤫","🤔","🤐","🤨","😐","😑","😶","😏","😒","🙄","😬","🤥","😌","😔","😪","🤤","😴","😷","🤒","🤕","🤢","🤮","🤧","😵","🤯","🤠","😎","🤓","🧐","😕","😟","🙁","☹️","😮","😯","😲","😳","🥺","😦","😧","😨","😰","😥","😢","😭","😱","😖","😣","😞","😓","😩","😫","🥱","😤","😡","😠","🤬","😈","👿","💀","☠️","💩","🤡","👹","👺","👻","👽","👾","🤖"]},{name:"gestures",label:"手势",emojis:["👋","🤚","🖐️","✋","🖖","👌","🤌","🤏","✌️","🤞","🤟","🤘","🤙","👈","👉","👆","🖕","👇","☝️","👍","👎","✊","👊","🤛","🤜","👏","🙌","👐","🤲","🤝","🙏","✍️","💪","🦾","🦿","🦵","🦶","👂","🦻","👃","🧠","🫀","🫁","🦷","🦴","👀","👁️","👅","👄"]},{name:"hearts",label:"爱心",emojis:["❤️","🧡","💛","💚","💙","💜","🖤","🤍","🤎","💔","❣️","💕","💞","💓","💗","💖","💘","💝","💟","☮️","✝️","☪️","🕉️","☸️","✡️","🔯","🕎","☯️","☦️","🛐","⛎","♈","♉","♊","♋","♌","♍","♎","♏","♐","♑","♒","♓","🆔","⚛️"]},{name:"symbols",label:"符号",emojis:["✅","❌","❓","❗","❕","❔","⭕","🚫","💯","💢","♨️","🚷","🚯","🚳","🚱","🔞","📵","🚭","‼️","⁉️","🔅","🔆","〽️","⚠️","🚸","🔱","⚜️","🔰","♻️","✳️","❇️","💹","💲","💱","©️","®️","™️","#️⃣","*️⃣","0️⃣","1️⃣","2️⃣","3️⃣","4️⃣","5️⃣","6️⃣","7️⃣","8️⃣","9️⃣","🔟","🔠","🔡","🔤","🆒","🆕","🆖","🆗","🆙","🆚"]},{name:"objects",label:"物品",emojis:["📱","💻","⌨️","🖥️","🖨️","🖱️","🖲️","🕹️","🗜️","💾","💿","📀","📼","📷","📸","📹","🎥","📽️","🎞️","📞","☎️","📟","📠","📺","📻","🎙️","🎚️","🎛️","🧭","⏱️","⏲️","⏰","🕰️","⌛","⏳","📡","🔋","🔌","💡","🔦","🕯️","🧯","🛢️","💸","💵","💴","💶","💷","💰","💳","💎","⚖️","🧰","🔧","🔨","⚒️","🛠️","⛏️","🔩","⚙️","🧱","⛓️","🧲","🔫","💣","🧨","🪓","🔪","🗡️","⚔️","🛡️","🚬","⚰️","⚱️","🏺","🔮","📿","🧿","💈","⚗️","🔭","🔬","🕳️","🩹","🩺","💊","💉","🩸","🧬","🦠","🧫","🧪","🌡️","🧹","🧺","🧻","🚽","🚰","🚿","🛁","🛀","🧼","🪒","🧽","🧴","🛎️","🔑","🗝️","🚪","🪑","🛋️","🛏️","🛌","🧸","🖼️","🛍️","🛒","🎁","🎈","🎏","🎀","🎊","🎉","🎎","🏮","🎐","🧧","✉️","📩","📨","📧","💌","📥","📤","📦","🏷️","📪","📫","📬","📭","📮","📯","📜","📃","📄","📑","🧾","📊","📈","📉","🗒️","🗓️","📆","📅","🗑️","📇","🗃️","🗳️","🗄️","📋","📁","📂","🗂️","🗞️","📰","📓","📔","📒","📕","📗","📘","📙","📚","📖","🔖","🧷","🔗","📎","🖇️","📐","📏","🧮","📌","📍","✂️","🖊️","🖋️","✒️","🖌️","🖍️","📝","✏️","🔍","🔎","🔏","🔐","🔒","🔓"]}],B=I(()=>{const j=L.find(g=>g.name===d.value);return j?j.emojis:[]}),P=()=>{C.value=window.innerWidth<768},O=()=>{y.disabled||(v.value=!v.value)},f=()=>{v.value=!1},_=j=>{b("select",j);const g=m.value.indexOf(j);g>-1&&m.value.splice(g,1),m.value.unshift(j),m.value=m.value.slice(0,8),localStorage.setItem("recentEmojis",JSON.stringify(m.value)),f()},F=j=>{j.key==="Escape"&&v.value&&!C.value&&f()};return he(()=>{const j=localStorage.getItem("recentEmojis");if(j)try{m.value=JSON.parse(j)}catch(g){console.error("Failed to parse recent emojis:",g)}P(),window.addEventListener("resize",P),document.addEventListener("keydown",F)}),Fe(()=>{window.removeEventListener("resize",P),document.removeEventListener("keydown",F)}),(j,g)=>(a(),o("div",Et,[e("button",{type:"button",onClick:O,class:x(["p-2 rounded transition-colors",r.disabled?"text-gray-300 dark:text-gray-600 cursor-not-allowed":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer"]),disabled:r.disabled},[...g[1]||(g[1]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],10,It),C.value?u("",!0):(a(),o("div",Tt,[v.value?(a(),o("div",{key:0,class:"fixed inset-0 z-40",onClick:f})):u("",!0),$(ke,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:M(()=>[v.value?(a(),o("div",{key:0,class:x(["absolute z-50 bg-white dark:bg-gray-900 rounded border border-gray-200 dark:border-gray-700 shadow-lg",[r.placement==="top"?"bottom-full mb-2":"top-full mt-2","right-0 md:left-0"]]),style:{width:"320px"}},[e("div",Pt,[e("div",Ut,[(a(),o(E,null,W(L,k=>e("button",{key:k.name,type:"button",onClick:K(S=>d.value=k.name,["stop","prevent"]),class:x(["px-3 py-1.5 rounded text-xs font-medium transition-colors whitespace-nowrap",d.value===k.name?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"])},n(k.label),11,Dt)),64))])]),e("div",qt,[e("div",Rt,[(a(!0),o(E,null,W(B.value,k=>(a(),o("button",{key:k,type:"button",onClick:K(S=>_(k),["stop","prevent"]),class:"p-2 text-xl hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors",title:k},n(k),9,Ht))),128))])]),m.value.length>0?(a(),o("div",Wt,[g[2]||(g[2]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-1"},"最近使用",-1)),e("div",Ot,[(a(!0),o(E,null,W(m.value,k=>(a(),o("button",{key:k,type:"button",onClick:K(S=>_(k),["stop","prevent"]),class:"p-2 text-xl hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors"},n(k),9,Nt))),128))])])):u("",!0)],2)):u("",!0)]),_:1})])),C.value?(a(),ne(je,{key:1,modelValue:v.value,"onUpdate:modelValue":g[0]||(g[0]=k=>v.value=k),title:"选择表情",position:"bottom",size:"default",scrollable:!1},{"header-icon":M(()=>[...g[3]||(g[3]=[e("div",{class:"p-2 rounded bg-amber-100 dark:bg-amber-900/30"},[e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)])]),default:M(()=>[e("div",Kt,[m.value.length>0?(a(),o("div",Xt,[g[4]||(g[4]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-2"},"最近使用",-1)),e("div",Jt,[(a(!0),o(E,null,W(m.value,k=>(a(),o("button",{key:k,type:"button",onClick:K(S=>_(k),["stop","prevent"]),class:"p-2 text-2xl hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors"},n(k),9,Gt))),128))])])):u("",!0),e("div",Qt,[e("div",Zt,[(a(),o(E,null,W(L,k=>e("button",{key:k.name,type:"button",onClick:K(S=>d.value=k.name,["stop","prevent"]),class:x(["px-3 py-1.5 rounded text-sm font-medium transition-colors whitespace-nowrap",d.value===k.name?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"])},n(k.label),11,Yt)),64))])]),e("div",er,[e("div",tr,[(a(!0),o(E,null,W(B.value,k=>(a(),o("button",{key:k,type:"button",onClick:K(S=>_(k),["stop","prevent"]),class:"p-3 text-2xl hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors active:scale-95"},n(k),9,rr))),128))])])])]),_:1},8,["modelValue"])):u("",!0)]))}},sr={class:"space-y-4"},ar={class:"bg-gray-50 dark:bg-gray-800 rounded p-3"},or={class:"flex items-center justify-between"},lr={class:"text-xs md:text-sm font-medium text-gray-900 dark:text-gray-100"},dr={class:"flex items-center gap-1 md:gap-2"},nr=["onClick","onMouseenter"],ir={class:"ml-1 md:ml-2 text-sm md:text-lg font-medium text-gray-900 dark:text-gray-100"},ur={class:"block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},cr={class:"text-xs text-gray-500 dark:text-gray-400 ml-1 md:ml-2"},mr={class:"mt-2 flex flex-wrap gap-1.5 md:gap-2"},xr=["onClick"],vr={class:"flex items-start md:items-center"},gr={__name:"ReviewModal",props:{modelValue:Boolean,orderId:{type:Number,required:!0},orderNo:{type:String,required:!0},vendorName:{type:String,required:!0},fiatAmount:{type:[Number,String],required:!0},fiatCurrency:{type:String,required:!0},cryptoAmount:{type:[Number,String],required:!0},cryptoCurrency:{type:String,required:!0}},emits:["update:modelValue","success"],setup(r,{emit:c}){const y=r,b=c,v=I({get:()=>y.modelValue,set:g=>b("update:modelValue",g)}),d=z(!1),m=z(5),C=z(0),L=z(""),B=z(!1),P=["交易迅速","信誉良好","沟通顺畅","价格合理","服务专业","态度友好","值得信赖"],O=I(()=>["","非常差","较差","一般","满意","非常满意"][m.value]||""),f=I(()=>m.value>0),_=()=>{v.value=!1},F=g=>{L.value.includes(g)||(L.value.length>0?L.value+="，"+g:L.value=g)},j=async()=>{if(!f.value){pe.error("请选择评分");return}d.value=!0;try{const g=await J.post(`/web/api/orders/${y.orderId}/review`,{rating:m.value,comment:L.value,is_anonymous:B.value});g.data.success&&(b("success",g.data.review),_())}catch(g){console.error("提交评价失败:",g),pe.error(g.response?.data?.message||"提交评价失败，请稍后重试")}finally{d.value=!1}};return fe(v,g=>{g&&(m.value=5,L.value="",B.value=!1,C.value=0)}),(g,k)=>(a(),ne(se,{show:v.value,title:"评价交易",subtitle:`评价${r.vendorName}`,"icon-color":"amber","confirm-text":"提交评价","cancel-text":"取消",persistent:d.value,onConfirm:j,onClose:_},{default:M(()=>[e("div",sr,[e("div",ar,[e("div",or,[k[3]||(k[3]=e("span",{class:"text-xs md:text-sm text-gray-500 dark:text-gray-400"},"订单编号",-1)),e("span",lr,n(r.orderNo),1)])]),e("div",null,[k[5]||(k[5]=e("label",{class:"block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 md:mb-3"},[w(" 您的评分 "),e("span",{class:"text-red-500"},"*")],-1)),e("div",dr,[(a(),o(E,null,W(5,S=>e("button",{key:S,onClick:U=>m.value=S,onMouseenter:U=>C.value=S,onMouseleave:k[0]||(k[0]=U=>C.value=0),class:"focus:outline-none transition-transform hover:scale-110 cursor-pointer"},[(a(),o("svg",{class:x(["w-8 h-8 md:w-10 md:h-10 transition-colors",(C.value||m.value)>=S?"text-amber-500":"text-gray-300 dark:text-gray-600"]),fill:"currentColor",viewBox:"0 0 20 20"},[...k[4]||(k[4]=[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"},null,-1)])],2))],40,nr)),64)),e("span",ir,n(O.value),1)])]),e("div",null,[e("label",ur,[k[6]||(k[6]=w(" 评价内容 ",-1)),e("span",cr," ("+n(L.value.length)+"/500) ",1)]),N(e("textarea",{"onUpdate:modelValue":k[1]||(k[1]=S=>L.value=S),rows:"3",maxlength:"500",placeholder:"分享您的交易体验...",class:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 resize-none"},null,512),[[te,L.value]]),e("div",mr,[(a(),o(E,null,W(P,S=>e("button",{key:S,onClick:U=>F(S),class:"px-2 md:px-3 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors cursor-pointer"},n(S),9,xr)),64))])]),e("div",vr,[N(e("input",{id:"anonymous","onUpdate:modelValue":k[2]||(k[2]=S=>B.value=S),type:"checkbox",class:"w-4 h-4 mt-0.5 md:mt-0 text-emerald-600 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 rounded focus:ring-emerald-500 focus:ring-2 cursor-pointer"},null,512),[[re,B.value]]),k[7]||(k[7]=e("label",{for:"anonymous",class:"ml-2 text-xs md:text-sm text-gray-700 dark:text-gray-300 cursor-pointer"},[w(" 匿名评价 "),e("span",{class:"text-xs text-gray-500 dark:text-gray-400 block md:inline"},"（其他用户将看不到您的身份信息）")],-1))]),k[8]||(k[8]=e("div",{class:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded p-2 md:p-3"},[e("div",{class:"flex items-start gap-1.5 md:gap-2"},[e("svg",{class:"w-4 h-4 md:w-5 md:h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),e("div",{class:"text-xs text-amber-800 dark:text-amber-200"},[e("p",null,"评价提交后将无法修改或删除，请慎重评价。"),e("p",{class:"mt-0.5 md:mt-1"},"您的评价将帮助其他用户更好地了解商家。")])])],-1))])]),_:1},8,["show","subtitle","persistent"]))}};class br{constructor(c={}){this.defaultOptions={maxWidth:1920,maxHeight:1920,quality:.85,mimeType:"image/jpeg",maxSizeMB:2,...c}}async compressImage(c,y={}){const b={...this.defaultOptions,...y};if(!c.type.startsWith("image/")||c.size/1024/1024<=b.maxSizeMB&&!this.needsResize(c,b))return c;try{const d=await this.loadImage(c),m=this.resizeImage(d,b),C=await this.canvasToBlob(m,b);return C.size>=c.size?c:new File([C],c.name,{type:C.type,lastModified:Date.now()})}catch(d){return console.error("Image compression failed:",d),c}}async compressMultiple(c,y={}){const v=Array.from(c).map(d=>this.compressImage(d,y));return Promise.all(v)}loadImage(c){return new Promise((y,b)=>{const v=new FileReader;v.onload=d=>{const m=new Image;m.onload=()=>y(m),m.onerror=b,m.src=d.target.result},v.onerror=b,v.readAsDataURL(c)})}async needsResize(c,y){return new Promise(b=>{const v=new FileReader;v.onload=d=>{const m=new Image;m.onload=()=>{b(m.width>y.maxWidth||m.height>y.maxHeight)},m.onerror=()=>b(!1),m.src=d.target.result},v.onerror=()=>b(!1),v.readAsDataURL(c)})}resizeImage(c,y){const b=document.createElement("canvas"),v=b.getContext("2d");let{width:d,height:m}=this.calculateDimensions(c.width,c.height,y.maxWidth,y.maxHeight);return b.width=d,b.height=m,v.imageSmoothingEnabled=!0,v.imageSmoothingQuality="high",v.drawImage(c,0,0,d,m),b}calculateDimensions(c,y,b,v){if(c<=b&&y<=v)return{width:c,height:y};const d=c/y;let m=b,C=b/d;return C>v&&(C=v,m=v*d),{width:Math.round(m),height:Math.round(C)}}async canvasToBlob(c,y){let b=y.quality,v=await this.createBlob(c,y.mimeType,b);const d=y.maxSizeMB*1024*1024;for(;v.size>d&&b>.3;)b-=.1,v=await this.createBlob(c,y.mimeType,b);return v}createBlob(c,y,b){return new Promise(v=>{c.toBlob(d=>v(d),y,b)})}async getImageDimensions(c){return new Promise((y,b)=>{const v=new FileReader;v.onload=d=>{const m=new Image;m.onload=()=>{y({width:m.width,height:m.height})},m.onerror=b,m.src=d.target.result},v.onerror=b,v.readAsDataURL(c)})}estimateCompressedSize(c,y={}){const b={...this.defaultOptions,...y},v=c.size/1024/1024,d=b.quality*.7,m=Math.min(v*d,b.maxSizeMB);return m<1?`~${Math.round(m*1024)} KB`:`~${m.toFixed(1)} MB`}formatFileSize(c){return c<1024?c+" B":c<1024*1024?(c/1024).toFixed(1)+" KB":(c/(1024*1024)).toFixed(1)+" MB"}}const yr=new br,fr={class:"flex items-center gap-2 flex-1"},kr={class:"flex -space-x-2"},pr=["src","alt"],hr={class:"text-white text-xs font-bold"},wr={class:"flex-1 min-w-0"},_r={class:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate"},Cr={class:"text-xs text-gray-500 dark:text-gray-400"},$r={class:"lg:min-h-screen lg:bg-gray-50 lg:dark:bg-gray-950 h-screen lg:h-auto overflow-hidden lg:overflow-visible fixed lg:relative inset-0"},Mr={key:0,class:"relative z-10 bg-red-50 dark:bg-red-900/20 border-b border-red-200 dark:border-red-800"},zr={key:1,class:"relative z-10 bg-amber-50 dark:bg-amber-900/20 border-b border-amber-200 dark:border-amber-800"},Br={class:"max-w-7xl mx-auto px-4 py-3 sm:px-6 lg:px-8"},jr={class:"flex flex-col sm:flex-row sm:items-center gap-3"},Fr={class:"flex items-start gap-3 flex-1"},Ar={class:"flex-1"},Sr={key:0,class:"text-xs text-amber-700 dark:text-amber-300 mt-2"},Lr={key:0,class:"sm:ml-auto"},Vr={key:2,class:"hidden md:block relative z-10 bg-blue-50 dark:bg-blue-900/20 border-b border-blue-200 dark:border-blue-800"},Er={class:"max-w-7xl mx-auto px-4 py-3 sm:px-6 lg:px-8"},Ir={class:"flex flex-col sm:flex-row sm:items-center gap-3"},Tr={class:"sm:ml-auto"},Pr={class:"p-4 space-y-4"},Ur={class:"space-y-4"},Dr={class:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-800"},qr={class:"flex items-center gap-2"},Rr={class:"text-sm font-semibold text-blue-700 dark:text-blue-300"},Hr={class:"text-xs text-blue-600 dark:text-blue-400"},Wr={class:"space-y-3"},Or={class:"flex gap-3"},Nr={class:"flex-1 pb-3"},Kr={class:"text-xs text-gray-500 dark:text-gray-400"},Xr={key:0,class:"mt-2"},Jr={class:"flex gap-3"},Gr={class:"flex flex-col items-center"},Qr={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Zr={key:1,class:"text-white text-xs font-bold"},Yr={class:"flex-1 pb-3"},es={class:"text-xs text-gray-500 dark:text-gray-400"},ts={class:"flex gap-3"},rs={class:"flex flex-col items-center"},ss={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},as={key:1,class:"text-white text-xs font-bold"},os={class:"flex-1 pb-3"},ls={class:"text-xs text-gray-500 dark:text-gray-400"},ds={key:0,class:"mt-2"},ns={class:"flex gap-3"},is={class:"flex flex-col items-center"},us={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},cs={key:1,class:"text-white text-xs font-bold"},ms={class:"flex-1 pb-3"},xs={class:"text-xs text-gray-500 dark:text-gray-400"},vs={key:0,class:"mt-2 space-y-2"},gs={class:"flex gap-2"},bs={class:"flex gap-3"},ys={class:"flex flex-col items-center"},fs={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ks={key:1,class:"text-white text-xs font-bold"},ps={class:"flex-1 pb-3"},hs={class:"text-xs text-gray-500 dark:text-gray-400"},ws={key:0,class:"mt-2"},_s={class:"flex gap-3"},Cs={class:"flex flex-col items-center"},$s={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ms={key:1,class:"text-white text-xs font-bold"},zs={class:"flex-1 pb-3"},Bs={class:"text-xs text-gray-500 dark:text-gray-400"},js={key:0,class:"mt-2"},Fs={class:"flex gap-3"},As={class:"flex flex-col items-center"},Ss={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ls={key:1,class:"text-white text-xs font-bold"},Vs={class:"flex-1 pb-3"},Es={class:"text-xs text-gray-500 dark:text-gray-400"},Is={key:0,class:"mt-2"},Ts={class:"flex gap-3"},Ps={class:"flex flex-col items-center"},Us={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ds={key:1,class:"text-white text-xs font-bold"},qs={class:"flex-1"},Rs={class:"text-xs text-gray-500 dark:text-gray-400"},Hs={class:"grid grid-cols-2 gap-3 text-sm"},Ws={class:"font-mono text-gray-900 dark:text-gray-200"},Os={class:"font-medium text-gray-900 dark:text-gray-200"},Ns={class:"font-medium text-gray-900 dark:text-gray-200"},Ks={class:"font-medium text-gray-900 dark:text-gray-200"},Xs={class:"font-medium text-gray-900 dark:text-gray-200"},Js={class:"font-medium text-gray-900 dark:text-gray-200"},Gs={class:"font-medium text-gray-900 dark:text-gray-200"},Qs={key:0,class:"text-xs text-amber-600 dark:text-amber-400 mt-0.5"},Zs={class:"font-medium text-gray-900 dark:text-gray-200"},Ys={class:"font-bold text-emerald-600 dark:text-emerald-400"},ea={key:0,class:"mt-3 pt-3 border-t border-gray-100 dark:border-gray-800"},ta={class:"font-mono text-sm text-gray-900 dark:text-gray-200 break-all"},ra={class:"mx-auto max-w-7xl"},sa={class:"hidden md:grid md:grid-cols-3 gap-4 p-4"},aa={class:"md:col-span-1 space-y-4"},oa={class:"bg-white dark:bg-gray-900 rounded border border-gray-200 dark:border-gray-800 p-6"},la={class:"flex items-center justify-between mb-4"},da={class:"mb-6"},na={class:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-2"},ia={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"},ua={class:"space-y-4 mb-6"},ca={class:"flex items-center gap-3"},ma={class:"flex-1"},xa={class:"text-xs text-gray-500 dark:text-gray-400"},va={class:"flex items-center gap-3"},ga={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ba={key:1,class:"text-white font-bold text-xs"},ya={class:"flex-1"},fa={key:0,class:"ml-11 mt-2"},ka={class:"flex items-center gap-3"},pa={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ha={key:1,class:"text-white font-bold text-xs"},wa={class:"flex-1"},_a={key:0,class:"text-xs text-blue-600 dark:text-blue-400 font-mono break-all mt-1"},Ca={key:0,class:"ml-11 mt-2"},$a={class:"flex items-center gap-3"},Ma={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},za={key:1,class:"text-white font-bold text-xs"},Ba={class:"flex-1"},ja={key:0,class:"ml-11 mt-2 space-y-2"},Fa={class:"flex gap-2"},Aa={class:"flex items-center gap-3"},Sa={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},La={key:1,class:"text-white font-bold text-xs"},Va={class:"flex-1"},Ea={key:0,class:"ml-11 mt-2"},Ia={class:"flex items-center gap-3"},Ta={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pa={key:1,class:"text-white font-bold text-xs"},Ua={class:"flex-1"},Da={class:"text-xs text-gray-500 dark:text-gray-400"},qa={key:0,class:"ml-11 mt-2"},Ra={class:"flex items-center gap-3"},Ha={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Wa={key:1,class:"text-white font-bold text-xs"},Oa={class:"flex-1"},Na={key:0,class:"ml-11 mt-2"},Ka={class:"flex items-center gap-3"},Xa={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ja={key:1,class:"text-white font-bold text-xs"},Ga={class:"flex-1"},Qa={class:"space-y-3 border-t border-gray-200 dark:border-gray-800 pt-4"},Za={class:"flex justify-between"},Ya={class:"text-sm font-mono text-gray-900 dark:text-gray-200"},eo={class:"flex justify-between"},to={class:"text-sm font-medium text-gray-900 dark:text-gray-200"},ro={class:"flex justify-between"},so={class:"text-sm font-medium text-gray-900 dark:text-gray-200"},ao={class:"flex justify-between"},oo={class:"text-sm font-medium text-gray-900 dark:text-gray-200"},lo={class:"flex justify-between"},no={class:"text-sm font-medium text-gray-900 dark:text-gray-200"},io={class:"flex justify-between"},uo={class:"text-sm font-medium text-gray-900 dark:text-gray-200"},co={key:0,class:"flex justify-between"},mo={class:"text-sm text-amber-600 dark:text-amber-400"},xo={class:"flex justify-between"},vo={class:"text-sm font-medium text-gray-900 dark:text-gray-200"},go={class:"flex justify-between"},bo={class:"text-lg font-bold text-emerald-600 dark:text-emerald-400"},yo={key:1,class:"flex justify-between items-start pt-3 border-t border-gray-100 dark:border-gray-800"},fo={class:"text-sm font-medium text-gray-900 dark:text-gray-200 text-right break-all max-w-[180px]"},ko={class:"md:col-span-2"},po={class:"bg-white dark:bg-gray-900 rounded border border-gray-200 dark:border-gray-800 flex flex-col",style:{height:"650px","min-height":"600px"}},ho={class:"border-b border-gray-200 dark:border-gray-800"},wo={class:"px-6 py-4"},_o={class:"flex items-center justify-between"},Co={class:"flex items-center gap-3"},$o={class:"flex -space-x-2"},Mo=["href"],zo=["src","alt"],Bo={key:1,class:"h-10 w-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center ring-2 ring-white dark:ring-gray-900"},jo={class:"text-white font-bold"},Fo={key:2,class:"absolute -bottom-0.5 -right-0.5 h-2.5 w-2.5 bg-emerald-500 rounded-full ring-2 ring-white dark:ring-gray-900"},Ao={class:"flex-1"},So={class:"flex items-center gap-2"},Lo={class:"font-semibold text-gray-900 dark:text-gray-100"},Vo={class:"text-xs text-gray-500 dark:text-gray-400 ml-2"},Eo={class:"text-xs text-gray-500 dark:text-gray-400"},Io={key:0,class:"text-gray-400"},To={class:"flex flex-col items-center gap-1"},Po={class:"text-xs text-gray-400 dark:text-gray-500"},Uo={key:0,class:"mb-4 mx-4"},Do={class:"bg-blue-50 dark:bg-blue-900/20 rounded p-3 border border-blue-200 dark:border-blue-800"},qo={class:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},Ro={key:0,class:"mt-2 pt-2 border-t border-blue-200 dark:border-blue-700"},Ho={class:"flex items-center gap-2"},Wo={class:"text-xs text-gray-600 dark:text-gray-400"},Oo={class:"font-medium text-blue-600 dark:text-blue-400"},No={key:1,class:"mb-4 mx-4"},Ko={class:"bg-blue-50 dark:bg-blue-900/20 rounded p-3 border border-blue-200 dark:border-blue-800"},Xo={class:"flex items-center gap-2"},Jo={class:"text-xs text-gray-600 dark:text-gray-400"},Go={class:"font-medium text-blue-600 dark:text-blue-400"},Qo={key:0,class:"flex flex-col items-center gap-1"},Zo={class:"text-xs text-gray-400 dark:text-gray-500"},Yo={key:0},el={key:0},tl={key:0,class:"mt-3 p-3 bg-amber-50 dark:bg-amber-900/20 rounded border border-amber-200 dark:border-amber-800 max-w-sm"},rl={class:"flex flex-col items-center gap-2"},sl={key:1,class:"mt-3 p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded border border-emerald-200 dark:border-emerald-800 max-w-sm"},al=["href"],ol=["src","alt"],ll={key:1,class:"h-8 w-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center"},dl={class:"text-white text-sm font-bold"},nl={class:"max-w-lg"},il={class:"text-xs font-medium text-gray-600 dark:text-gray-400 mb-1 px-1"},ul={key:0,class:"text-purple-600 dark:text-purple-400 font-bold"},cl={class:"inline-block bg-gray-100 dark:bg-gray-800 rounded rounded-tl-none px-4 py-3"},ml={key:0,class:"mb-2"},xl={key:1,class:"text-sm text-gray-900 dark:text-gray-200 break-words"},vl={class:"text-xs text-gray-400 dark:text-gray-500 mt-1 px-1"},gl={class:"max-w-lg"},bl={class:"text-xs font-medium text-gray-600 dark:text-gray-400 mb-1 px-1 text-right"},yl={key:0,class:"text-purple-600 dark:text-purple-400 font-bold"},fl={class:"inline-block bg-emerald-600 text-white rounded rounded-tr-none px-4 py-3"},kl={key:0,class:"mb-2"},pl={key:1,class:"text-sm break-words"},hl={class:"text-xs text-gray-400 dark:text-gray-500 mt-1 px-1 text-right"},wl=["src","alt"],_l={key:1,class:"h-8 w-8 rounded-full bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center flex-shrink-0"},Cl={class:"text-white text-sm font-bold"},$l={class:"border-t border-gray-200 dark:border-gray-800 p-4"},Ml={key:0,class:"mb-3 p-3 bg-gray-50 dark:bg-gray-800 rounded"},zl={key:0,class:"flex items-center gap-3"},Bl={key:1,class:"flex items-start gap-3"},jl=["src","alt"],Fl={key:1,class:"w-16 h-20 bg-red-100 dark:bg-red-900/30 rounded flex items-center justify-center"},Al={class:"flex-1"},Sl={class:"text-sm font-medium text-gray-900 dark:text-gray-200"},Ll={class:"text-xs text-gray-500 dark:text-gray-400"},Vl=["disabled"],El=["placeholder","disabled"],Il=["disabled"],Tl={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},Pl={key:1},Ul={key:1,class:"flex mt-3 items-center justify-between"},Dl={class:"flex gap-2 items-center"},ql={key:0,class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Rl={key:1,class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24"},Hl={class:"mt-3 p-2 bg-gray-50 dark:bg-gray-800/50 rounded border border-gray-200 dark:border-gray-700"},Wl={class:"flex items-center justify-between"},Ol={class:"flex items-center gap-2"},Nl={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},Kl={class:"flex items-center gap-3 text-xs text-gray-500 dark:text-gray-400"},Xl={class:"text-emerald-600 dark:text-emerald-400 font-medium"},Jl={class:"space-y-4 mt-3"},Gl={key:0,class:"bg-white dark:bg-gray-900 rounded border border-gray-200 dark:border-gray-800 p-4"},Ql={class:"p-3 bg-gray-50 dark:bg-gray-800/50 rounded max-h-40 overflow-y-auto"},Zl={class:"text-xs text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},Yl={class:"md:hidden fixed inset-x-0 bottom-0 flex flex-col bg-white dark:bg-gray-950",style:"top: calc(3.5rem + env(safe-area-inset-top))"},ed={key:0,class:"sticky top-0 z-10 bg-amber-50 dark:bg-amber-900/20 border-b border-amber-200 dark:border-amber-800 p-2"},td={class:"p-4 space-y-4"},rd={class:"flex flex-col items-center gap-1"},sd={class:"text-xs text-gray-400 dark:text-gray-500"},ad={key:0,class:"mb-4 mx-4"},od={class:"bg-blue-50 dark:bg-blue-900/20 rounded p-3 border border-blue-200 dark:border-blue-800"},ld={class:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},dd={key:0,class:"mt-2 pt-2 border-t border-blue-200 dark:border-blue-700"},nd={class:"flex items-center gap-2"},id={class:"text-xs text-gray-600 dark:text-gray-400"},ud={class:"font-medium text-blue-600 dark:text-blue-400"},cd={key:1,class:"mb-4 mx-4"},md={class:"bg-blue-50 dark:bg-blue-900/20 rounded p-3 border border-blue-200 dark:border-blue-800"},xd={class:"flex items-center gap-2"},vd={class:"text-xs text-gray-600 dark:text-gray-400"},gd={class:"font-medium text-blue-600 dark:text-blue-400"},bd={key:0,class:"flex flex-col items-center gap-1"},yd={class:"text-xs text-gray-400 dark:text-gray-500"},fd={key:0},kd={key:0},pd={key:0,class:"mt-3 p-3 bg-amber-50 dark:bg-amber-900/20 rounded border border-amber-200 dark:border-amber-800 max-w-sm"},hd={class:"flex flex-col items-center gap-2"},wd={key:1,class:"mt-3 p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded border border-emerald-200 dark:border-emerald-800 max-w-sm"},_d=["href"],Cd=["src","alt"],$d={key:1,class:"h-7 w-7 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center"},Md={class:"text-white text-xs font-bold"},zd={class:"max-w-[85%]"},Bd={class:"text-xs font-medium text-gray-600 dark:text-gray-400 mb-0.5 px-1"},jd={key:0,class:"text-purple-600 dark:text-purple-400 font-bold"},Fd={class:"inline-block bg-gray-100 dark:bg-gray-800 rounded rounded-tl-none px-3 py-2"},Ad={key:0,class:"mb-2"},Sd={key:1,class:"text-sm text-gray-900 dark:text-gray-200 break-words"},Ld={class:"text-xs text-gray-400 dark:text-gray-500 mt-1 px-1"},Vd={class:"max-w-[85%]"},Ed={class:"text-xs font-medium text-gray-600 dark:text-gray-400 mb-0.5 px-1 text-right"},Id={key:0,class:"text-purple-600 dark:text-purple-400 font-bold"},Td={class:"inline-block bg-emerald-600 text-white rounded rounded-tr-none px-3 py-2"},Pd={key:0,class:"mb-2"},Ud={key:1,class:"text-sm break-words"},Dd={class:"text-xs text-gray-400 dark:text-gray-500 mt-1 px-1 text-right"},qd=["src","alt"],Rd={key:1,class:"h-7 w-7 rounded-full bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center flex-shrink-0"},Hd={class:"text-white text-xs font-bold"},Wd={class:"bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 pb-safe"},Od={class:"p-3"},Nd={key:0,class:"mb-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded"},Kd={key:0,class:"flex items-center gap-3"},Xd={key:1,class:"flex items-center gap-3"},Jd={class:"flex-shrink-0"},Gd=["src"],Qd={key:1,class:"w-12 h-12 bg-gray-200 dark:bg-gray-600 rounded flex items-center justify-center"},Zd={class:"flex-1 min-w-0"},Yd={class:"text-sm font-medium text-gray-900 dark:text-gray-200 truncate"},en={class:"text-xs text-gray-500 dark:text-gray-400"},tn={class:"flex items-center"},rn=["disabled"],sn=["placeholder","disabled"],an=["disabled"],on={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},ln={key:1},dn={key:1,class:"flex mt-2 justify-between items-center"},nn={class:"flex gap-2 overflow-x-auto pb-1"},un=["title"],cn={class:"flex items-center justify-between"},mn={class:"flex items-center gap-2"},xn={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},vn={class:"flex items-center gap-2"},gn={class:"text-xs text-gray-500 dark:text-gray-400"},bn={key:0,class:"text-gray-700 dark:text-gray-300"},yn={key:1,class:"mt-4"},fn={key:0,class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},kn=["placeholder","required"],pn={class:"space-y-3"},hn={class:"p-3 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded"},wn={class:"space-y-2"},_n={key:0},Cn={class:"font-mono text-xs text-gray-900 dark:text-gray-100 break-all mt-1"},$n={key:1},Mn={class:"font-mono text-xs text-gray-900 dark:text-gray-100 break-all mt-1"},zn={class:"text-lg font-bold text-emerald-600 dark:text-emerald-400"},Bn={key:2},jn={class:"font-mono text-xs text-blue-600 dark:text-blue-400 break-all mt-1"},Fn={class:"space-y-2"},An={class:"space-y-2"},Sn={class:"flex items-start"},Ln=["disabled"],Vn={class:"flex items-start"},En=["disabled"],In={class:"flex items-start"},Tn=["disabled"],Pn={class:"ml-2 text-sm text-gray-700 dark:text-gray-300"},Un={class:"block font-mono text-xs text-blue-600 dark:text-blue-400 break-all mt-1"},Dn={class:"flex items-start"},qn=["disabled"],Rn={class:"ml-2 text-sm text-gray-700 dark:text-gray-300"},Hn={class:"block font-mono text-xs text-blue-600 dark:text-blue-400 break-all mt-1"},Wn={class:"flex items-start"},On=["disabled"],Nn={class:"ml-2 text-sm text-gray-700 dark:text-gray-300"},Kn={class:"font-bold text-emerald-600 dark:text-emerald-400"},Xn={class:"space-y-3"},Jn=["disabled"],Gn={key:0,class:"p-3 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded"},Qn={class:"space-y-2"},Zn={class:"font-mono text-xs text-gray-900 dark:text-gray-100 break-all mt-1"},Yn={class:"text-lg font-bold text-emerald-600 dark:text-emerald-400"},ei={class:"space-y-3"},ti=["disabled"],ri={key:0},si={key:1,class:"p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded"},ai={key:2,class:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded"},oi={class:"space-y-3"},li={key:0},di={key:1,class:"p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded"},ni={key:2,class:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded"},ii={class:"p-4"},ui={key:0,class:"bg-gray-50 dark:bg-gray-800/50 rounded p-4 max-h-80 overflow-y-auto"},ci={class:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},mi={key:1,class:"bg-gray-50 dark:bg-gray-800/50 rounded p-4"},ki={__name:"Chat",props:{userHas2FA:{type:Boolean,default:!1},order:{type:Object,required:!0},otherUser:{type:Object,default:null},messages:{type:Array,default:()=>[]},currentUserId:{type:Number,required:!0},userRole:{type:String,required:!0},availableActions:{type:Array,default:()=>[]}},setup(r){Ye();const c=r,y=z(!1),b=z(!1),v=z(!1),d=z({...c.order}),m=z(c.messages),C=z(""),L=z(null),B=z(null),P=z(null),O=z(null),f=z(null),_=z(!1),F=z(!1),j=z(null),g=z(!1),k=z(!0);let S=null,U=null,G=null;const Q=z(!1),V=z([]),h=z([]),we=()=>{const l=[];d.value.vendor&&l.push({id:d.value.vendor.id,name:d.value.vendor.name,role:"商家",avatar:d.value.vendor.avatar,profile_photo_url:d.value.vendor.avatar,is_self:d.value.vendor.id===c.currentUserId,is_online:d.value.vendor.id===c.currentUserId,is_admin:!1}),d.value.client&&l.push({id:d.value.client.id,name:d.value.client.name,role:"客户",avatar:d.value.client.avatar,profile_photo_url:d.value.client.avatar,is_self:d.value.client.id===c.currentUserId,is_online:d.value.client.id===c.currentUserId,is_admin:!1}),h.value=l},i=z({show:!1,title:"",message:"",inputMode:!1,inputValue:"",inputLabel:"",inputPlaceholder:"",inputRequired:!1,danger:!1,confirmVariant:"primary",confirmText:"确认",cancelText:"取消",loading:!1,pendingAction:null,pendingData:{},require2FA:!1,twoFactorCode:"",twoFactorError:""}),Y=z(""),ee=z(""),D=z({txExists:!1,confirmations:!1,fromAddress:!1,toAddress:!1,amount:!1}),_e=I(()=>D.value.txExists&&D.value.confirmations&&D.value.fromAddress&&D.value.toAddress&&D.value.amount),X=I(()=>d.value.status==="completed"||d.value.status==="cancelled"||d.value.escrow_status==="escrow_released"),ie=z({orderId:d.value.order_no,type:c.userRole==="buyer"?"buy":"sell",cryptocurrency:d.value.currency_key||d.value.crypto_currency,amount:d.value.crypto_amount,price:d.value.price,total:d.value.fiat_amount,status:d.value.escrow_status,progress:ue(d.value.escrow_status),timeRemaining:765});function ue(l){return{order_initiated:12.5,vendor_confirmed:25,seller_paid:37.5,escrow_received:50,buyer_confirmed_escrow:62.5,buyer_paid:75,seller_received:87.5,escrow_released:100}[l]||0}function He(l){return{order_initiated:"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400",vendor_confirmed:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400",seller_paid:"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400",escrow_received:"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400",buyer_paid:"bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-400",seller_received:"bg-teal-100 dark:bg-teal-900/30 text-teal-700 dark:text-teal-400",escrow_released:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400"}[l]||"bg-gray-100 dark:bg-gray-900/30 text-gray-700 dark:text-gray-400"}function Ae(l){return{order_initiated:"等待确认",vendor_confirmed:"等待转币",seller_paid:"托管确认中",escrow_received:"托管保护中",buyer_paid:"等待收款确认",seller_received:"释放中",escrow_released:"已完成"}[l]||"处理中"}function Se(l){return{order_initiated:"等待商家确认",vendor_confirmed:"等待卖家转币",seller_paid:"等待托管确认",escrow_received:"托管保护中",buyer_confirmed_escrow:"等待买家付款",buyer_paid:"等待卖家确认收款",seller_received:"准备释放托管",escrow_released:"交易完成"}[l]||"处理中"}function Le(l){return{order_initiated:"bg-amber-500",vendor_confirmed:"bg-amber-500",seller_paid:"bg-blue-500",escrow_received:"bg-blue-500",buyer_confirmed_escrow:"bg-blue-500",buyer_paid:"bg-blue-500",seller_received:"bg-emerald-500",escrow_released:"bg-emerald-500"}[l]||"bg-gray-500"}const We=z("12:45");let ce=null;const Oe=()=>{ce=setInterval(()=>{if(ie.value.timeRemaining>0){ie.value.timeRemaining--;const l=Math.floor(ie.value.timeRemaining/60),t=ie.value.timeRemaining%60;We.value=`${l}:${t.toString().padStart(2,"0")}`}else clearInterval(ce)},1e3)},Z=()=>{ae(()=>{const l=()=>{L.value&&(L.value.scrollTop=L.value.scrollHeight),j.value&&(j.value.scrollTop=j.value.scrollHeight)};l();const t=L.value||j.value;if(t){const s=t.querySelectorAll("img");if(s.length>0){let p=0;s.forEach(q=>{q.complete?p++:(q.addEventListener("load",()=>{l()},{once:!0}),q.addEventListener("error",()=>{l()},{once:!0}))}),p===s.length&&setTimeout(l,100)}}})},T=l=>new Date(l).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),Ne=l=>{d.value.has_review=!0,d.value.review=l,d.value.status="completed",b.value=!1},Ve=l=>{if(l===0)return"0 Bytes";const t=1024,s=["Bytes","KB","MB","GB"],p=Math.floor(Math.log(l)/Math.log(t));return Math.round(l/Math.pow(t,p)*100)/100+" "+s[p]},Ee=async l=>{const t=l.target.files[0];if(!t)return;const s=2*1024*1024;let p=t;if(t.type.startsWith("image/")){F.value=!0;try{const q=(t.size/1024/1024).toFixed(2);console.log(`原始图片大小: ${q} MB`),p=await yr.compressImage(t,{maxWidth:1920,maxHeight:1920,maxSizeMB:2,quality:.85});const Me=(p.size/1024/1024).toFixed(2);if(console.log(`压缩后图片大小: ${Me} MB`),p.size<t.size*.8){const ze=Math.round((1-p.size/t.size)*100);console.log(`图片已压缩 ${ze}%`)}}catch(q){console.error("图片压缩失败:",q),p=t}finally{F.value=!1}}if(p.size>s){alert(`文件大小不能超过 ${s/1024/1024}MB，当前文件大小为 ${(p.size/1024/1024).toFixed(2)}MB`),l.target.value="";return}B.value=p,p.type.startsWith("image/")&&(P.value=URL.createObjectURL(p))},Ce=()=>{B.value=null,P.value&&(URL.revokeObjectURL(P.value),P.value=null),O.value&&(O.value.value=""),f.value&&(f.value.value="")},Ie=async()=>{if(!C.value.trim()&&!B.value||!g.value||_.value)return;const l=C.value,t=B.value;C.value="",_.value=!0;try{let s=null;if(t){const ge=new FormData;ge.append("file",t);const Ue=await J.post(`/web/api/orders/${d.value.order_no}/chat/upload`,ge,{headers:{"Content-Type":"multipart/form-data"}});Ue.data.success&&(s=Ue.data.file)}const p=d.value.vendor_id===c.currentUserId?d.value.client_id:d.value.vendor_id,q=h.value.find(ge=>ge.id===p),Me=q?q.is_online:!1,ze=await J.post(`/web/api/orders/${d.value.order_no}/chat/send`,{message:l,attachment:s,recipient_online:Me});m.value.push(ze.data),Ce(),ae(()=>{Z()})}catch(s){console.error("发送消息失败:",s),C.value=l,alert("发送失败，请重试")}finally{_.value=!1}},A=l=>{console.log("handleEscrowAction called with:",l);const t={vendor_confirm:{title:"确认接单",message:"确认接受此订单吗？接单后需要等待卖家转币到托管。",confirmVariant:"primary",confirmText:"确认接单"},mark_seller_paid:{title:"标记已转币",message:"请确认您已将币转入托管地址，并提供交易哈希作为凭证",inputMode:!0,inputLabel:"交易哈希 (TX ID)",inputPlaceholder:"请输入区块链交易哈希...",inputRequired:!0,confirmVariant:"primary",confirmText:"确认已转币"},confirm_escrow:{},mark_buyer_paid:{title:"标记已付款",message:"请确认您已向卖家付款",inputMode:!0,inputLabel:"付款说明（可选）",inputPlaceholder:"请输入付款凭证或说明...",inputRequired:!1,confirmVariant:"primary",confirmText:"确认已付款",require2FA:!0},mark_seller_received:{title:"确认收款",message:"请确认您已收到买家的付款。确认后，托管的币将释放给买家。",confirmVariant:"success",confirmText:"确认已收款",require2FA:!0},cancel:{},create_dispute:{title:"发起争议",message:"发起争议后，订单将被冻结，暂停所有交易操作，等待平台客服介入处理。请详细说明问题。",inputMode:!0,inputLabel:"争议原因",inputPlaceholder:"请详细描述您遇到的问题...",inputRequired:!0,confirmVariant:"warning",confirmText:"确认发起争议"},resolve_dispute:{title:"解除争议",message:"确定要解除争议吗？解除后订单将恢复正常，可以继续进行交易。",inputMode:!0,inputLabel:"解除原因（可选）",inputPlaceholder:"请输入解除争议的原因...",inputRequired:!1,confirmVariant:"success",confirmText:"确认解除"}};if(l==="cancel"){const p=d.value.escrow_status;let q={title:"取消订单",inputMode:!0,inputLabel:"取消原因",inputPlaceholder:"请输入取消原因...",inputRequired:!0,danger:!0,confirmVariant:"danger",confirmText:"确认取消"};["seller_paid","escrow_received","buyer_confirmed_escrow"].includes(p)?q.message=`⚠️ 警告：当前已进入托管阶段，取消订单将扣除您的信誉分 -1

确定要取消此订单吗？`:q.message="确定要取消此订单吗？",t[l]=q}const s=t[l];!s&&l!=="confirm_escrow"||(Object.assign(i.value,{show:!0,...s||{},cancelText:"返回",pendingAction:l,pendingData:{},loading:!1}),console.log("dialogState after setting:",i.value))},Ke=async l=>{const t=i.value.pendingAction;if(t)try{let s="",p={};switch(t){case"vendor_confirm":s=`/web/api/orders/${d.value.id}/vendor-confirm`;break;case"mark_seller_paid":if(s=`/web/api/orders/${d.value.id}/seller-paid`,!l||!l.trim()){i.value.loading=!1,i.value.show=!1;return}p.tx_hash=l.trim();break;case"confirm_escrow":s=`/web/api/orders/${d.value.id}/buyer-confirm-escrow`;break;case"mark_buyer_paid":s=`/web/api/orders/${d.value.id}/buyer-paid`,l&&(p.payment_proof=l),i.value.require2FA&&i.value.twoFactorCode&&(p.two_factor_code=i.value.twoFactorCode);break;case"mark_seller_received":s=`/web/api/orders/${d.value.id}/seller-received`,i.value.require2FA&&i.value.twoFactorCode&&(p.two_factor_code=i.value.twoFactorCode);break;case"cancel":s=`/web/api/orders/${d.value.id}/cancel`,p.reason=l;break;case"create_dispute":s=`/web/api/orders/${d.value.id}/dispute`,p.reason=l;break;case"resolve_dispute":s=`/web/api/orders/${d.value.id}/resolve-dispute`,l&&(p.reason=l);break}i.value.loading=!0,(await J.post(s,p)).data.success&&(i.value.show=!1,H.reload())}catch(s){console.error("操作失败:",s),i.value.loading=!1,i.value.show=!1}},oe=()=>{i.value={show:!1,title:"",message:"",inputMode:!1,inputValue:"",inputLabel:"",inputPlaceholder:"",inputRequired:!1,danger:!1,confirmVariant:"primary",confirmText:"确认",cancelText:"取消",loading:!1,pendingAction:null,pendingData:{},require2FA:!1,twoFactorCode:"",twoFactorError:""},Y.value="",ee.value="",D.value={txExists:!1,confirmations:!1,fromAddress:!1,toAddress:!1,amount:!1}},Te=l=>{i.value.twoFactorCode=l,i.value.twoFactorError=""},Xe=async()=>{if(!c.userHas2FA){alert("买家付款必须启用双重验证"),H.visit("/user/profile#tab-2fa");return}if(!i.value.twoFactorCode||i.value.twoFactorCode.length!==6){i.value.twoFactorError="请输入6位验证码";return}i.value.loading=!0,i.value.twoFactorError="";try{const l={two_factor_code:i.value.twoFactorCode};Y.value&&Y.value.trim()&&(l.payment_proof=Y.value.trim()),(await J.post(`/web/api/orders/${d.value.id}/buyer-paid`,l)).data.success&&(i.value.show=!1,Y.value="",i.value.twoFactorCode="",i.value.twoFactorError="",H.reload())}catch(l){i.value.loading=!1,l.response?.data?.errors?.two_factor_code?i.value.twoFactorError=l.response.data.errors.two_factor_code[0]:l.response?.data?.message?l.response.data.require_2fa?(i.value.show=!1,alert("为了您的资金安全，请先在个人设置中启用双重验证"),H.visit("/user/profile#tab-2fa")):i.value.twoFactorError=l.response.data.message:i.value.twoFactorError="验证失败，请重试"}},Je=async()=>{if(!_e.value){pe.error("请确认所有检查项");return}i.value.loading=!0;try{(await J.post(`/web/api/orders/${d.value.id}/buyer-confirm-escrow`)).data.success&&(i.value.show=!1,D.value={txExists:!1,confirmations:!1,fromAddress:!1,toAddress:!1,amount:!1},H.reload())}catch(l){i.value.loading=!1,console.error("确认托管失败:",l)}},Ge=async()=>{if(!ee.value||!ee.value.trim()){pe.error("请输入交易哈希");return}i.value.loading=!0;try{(await J.post(`/web/api/orders/${d.value.id}/seller-paid`,{tx_hash:ee.value.trim()})).data.success&&(i.value.show=!1,ee.value="",H.reload())}catch(l){i.value.loading=!1,console.error("标记转币失败:",l)}},Qe=async()=>{if(!c.userHas2FA){alert("卖家确认收款必须启用双重验证"),H.visit("/user/profile#tab-2fa");return}if(!i.value.twoFactorCode||i.value.twoFactorCode.length!==6){i.value.twoFactorError="请输入6位验证码";return}i.value.loading=!0,i.value.twoFactorError="";try{const l={two_factor_code:i.value.twoFactorCode};(await J.post(`/web/api/orders/${d.value.id}/seller-received`,l)).data.success&&(i.value.show=!1,i.value.twoFactorCode="",i.value.twoFactorError="",H.reload())}catch(l){i.value.loading=!1,l.response?.data?.errors?.two_factor_code?i.value.twoFactorError=l.response.data.errors.two_factor_code[0]:l.response?.data?.message?l.response.data.require_2fa?(i.value.show=!1,alert("为了您的资金安全，请先在个人设置中启用双重验证"),H.visit("/user/profile#tab-2fa")):i.value.twoFactorError=l.response.data.message:i.value.twoFactorError="验证失败，请重试"}},me=async l=>{try{if(l==="received"){if((await J.post(`/web/api/orders/${c.order.id}/mock-escrow-received`)).data.success){const s=await J.post(`/web/api/orders/${c.order.order_no}/chat/send`,{message:"✅ [测试模式] 托管已确认到账！买家现在可以付款了"});s.data&&(m.value.push({...s.data,type:"system"}),Z()),setTimeout(()=>{H.reload()},1e3)}}else l==="not_received"&&(await J.post(`/web/api/orders/${c.order.id}/mock-escrow-not-received`)).data.success&&setTimeout(()=>{H.reload()},1e3)}catch(t){console.error("模拟托管状态失败:",t)}},$e=()=>{console.log("[WebSocket] 断开连接"),U&&(U.stopListening(".MessageSent"),U.stopListening(".EscrowStatusUpdated"),U.stopListening(".OrderStatusUpdated"),U.stopListening(".dispute.resolved"),S.leave(`order.${d.value.id}`),U=null),g.value=!1},le=()=>{typeof window.Echo<"u"&&!U?(S=window.Echo,console.log("[WebSocket] 建立连接"),U=S.join(`order.${d.value.id}`).here(l=>{console.log("当前在线用户:",l),V.value=l,h.value.forEach(t=>{t.is_online=l.some(s=>s.id===t.id)}),l.forEach(t=>{[3].includes(t.id)&&(h.value.find(q=>q.id===t.id)||h.value.push({id:t.id,name:t.name,role:"仲裁员",avatar:null,is_self:t.id===c.currentUserId,is_online:!0,is_admin:!0}))}),Q.value=l.some(t=>t.id===c.otherUser?.id)}).joining(l=>{if(console.log("用户加入:",l),V.value.push(l),l.id!==c.currentUserId){const s=new Date;m.value.push({id:`join-${l.id}-${Date.now()}`,type:"system",content:`${l.name} 加入了聊天`,created_at:s.toISOString(),is_temporary:!0}),ae(()=>Z())}const t=h.value.find(s=>s.id===l.id);t?t.is_online=!0:[3].includes(l.id)&&h.value.push({id:l.id,name:l.name,role:"仲裁员",avatar:null,is_self:l.id===c.currentUserId,is_online:!0,is_admin:!0}),l.id===c.otherUser?.id&&(Q.value=!0)}).leaving(l=>{if(console.log("用户离开:",l),V.value=V.value.filter(s=>s.id!==l.id),l.id!==c.currentUserId){const s=new Date;m.value.push({id:`leave-${l.id}-${Date.now()}`,type:"system",content:`${l.name} 离开了聊天`,created_at:s.toISOString(),is_temporary:!0}),ae(()=>Z())}const t=h.value.find(s=>s.id===l.id);t&&(t.is_online=!1),l.id===c.otherUser?.id&&(Q.value=!1)}).error(l=>{console.error("Presence channel error:",l)}).listen("MessageSent",l=>{if(l.type==="admin"&&l.user){const t=h.value.find(s=>s.id===l.user.id);t?t&&!t.is_admin&&(t.role="仲裁员",t.is_admin=!0,t.is_online=!0):h.value.push({id:l.user.id,name:l.user.name,role:"仲裁员",avatar:null,is_self:l.user.id===c.currentUserId,is_online:!0,is_admin:!0})}(l.type==="system"||!l.user||l.user.id!==c.currentUserId)&&(m.value.push({id:l.id,message:l.message,type:l.type||"text",attachment:l.attachment,user:l.user,created_at:l.created_at}),Z())}).listen("EscrowStatusUpdated",l=>{console.log("托管状态更新:",l),d.value.escrow_status=l.escrow_status||l.new_status,d.value.status=l.status||d.value.status,d.value.is_disputed=l.is_disputed,d.value.disputed_by=l.disputed_by,l.escrow_status==="buyer_confirmed_escrow"&&(d.value.buyer_confirmed_escrow_at=l.updated_at);const t=`托管状态更新: ${l.message}`,s={id:Date.now(),message:t,type:"system",user:null,created_at:new Date().toISOString()};(l.escrow_status==="escrow_released"||l.new_status==="escrow_released")&&c.currentUserId===d.value.client_id&&(s.show_review_button=!0,d.value.has_review&&(s.message="托管已释放，交易完成，您已评价此交易")),m.value.push(s),Z(),setTimeout(()=>{H.reload()},2e3)}).listen("OrderStatusUpdated",l=>{console.log("订单状态更新:",l),l.status==="cancelled"&&setTimeout(()=>{H.reload()},1e3)}).listen(".dispute.resolved",l=>{console.log("争议已解除:",l),d.value.is_disputed=!1,d.value.disputed_by=null,l.escrow_status&&(d.value.escrow_status=l.escrow_status),l.status&&(d.value.status=l.status),setTimeout(()=>{H.reload({only:["availableActions","order"]})},1e3),showNotification("success",l.message||"争议已解除，订单恢复正常")}),g.value=!0,console.log("[WebSocket] 连接成功，加载最新消息"),xe()):(console.warn("Echo not available, retrying..."),setTimeout(le,1e3))},xe=async()=>{try{console.log("[WebSocket] 重新加载所有消息");const l=await J.get(`/web/api/orders/${d.value.order_no}/chat/messages`);l.data&&l.data.length>0?(console.log("[WebSocket] 加载消息成功:",l.data.length,"条"),m.value=l.data,Z()):console.log("[WebSocket] 没有消息")}catch(l){console.error("[WebSocket] 加载消息失败:",l)}},ve=()=>{if(k.value=!document.hidden,document.hidden){console.log("[WebSocket] 页面隐藏，准备断开");const t=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?1e4:3e4;G=setTimeout(()=>{$e()},t)}else{console.log("[WebSocket] 页面显示, 连接状态:",g.value,"频道:",!!U),G&&(clearTimeout(G),G=null);const l=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);!g.value&&!U?(console.log("[WebSocket] 检测到断开状态，重新连接..."),le()):!g.value||!U?(console.log("[WebSocket] 连接状态不一致，重新连接..."),le()):(console.log("[WebSocket] 已连接"),l&&(console.log("[WebSocket] 移动端恢复，重新加载消息"),xe()))}},Pe=()=>{/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)&&g.value&&(console.log("[WebSocket] 页面获得焦点，重新加载消息"),xe())};return he(()=>{if(we(),Oe(),d.value.escrow_status==="escrow_released"&&c.currentUserId===d.value.client_id&&!m.value.some(t=>t.show_review_button===!0)){const t={id:Date.now(),message:d.value.has_review?"交易已完成，您已评价此交易":"交易已完成！请对本次交易进行评价",type:"system",user:null,created_at:new Date().toISOString(),show_review_button:!0};console.log("Adding review message:",t),m.value.push(t)}Z(),le(),document.addEventListener("visibilitychange",ve),document.addEventListener("focusin",Pe),document.addEventListener("pause",()=>{console.log("[WebSocket] PWA进入后台"),$e()}),document.addEventListener("resume",()=>{console.log("[WebSocket] PWA恢复前台"),g.value?(console.log("[WebSocket] PWA恢复，重新加载消息"),xe()):le()})}),Fe(()=>{ce&&clearInterval(ce),G&&clearTimeout(G),$e(),document.removeEventListener("visibilitychange",ve),document.removeEventListener("focusin",Pe),document.removeEventListener("pause",ve),document.removeEventListener("resume",ve)}),(l,t)=>(a(),o(E,null,[$(tt,{"hide-nav":!0,"hide-footer":!0,"show-mobile-bottom-nav":!1,"show-breadcrumbs":!0,breadcrumbs:[{label:"订单",url:"/orders"},{label:`订单 #${r.order.order_no}`,url:null},{label:"交易聊天"}]},{default:M(()=>[$(gt,{title:`订单 #${r.order.order_no}`,"back-url":"/orders"},{custom:M(()=>[e("div",fr,[e("div",kr,[(a(!0),o(E,null,W(h.value,(s,p)=>(a(),o("div",{key:s.id,class:"relative",style:ye(`z-index: ${h.value.length-p}`)},[s.profile_photo_url?(a(),o("img",{key:0,src:s.profile_photo_url,alt:s.name,class:x(["h-8 w-8 rounded-full object-cover ring-2",s.is_online?"ring-emerald-500":"ring-gray-400 dark:ring-gray-600"])},null,10,pr)):(a(),o("div",{key:1,class:x(["h-8 w-8 rounded-full flex items-center justify-center ring-2 ring-white dark:ring-gray-950",s.is_online?"bg-gradient-to-br from-emerald-500 to-emerald-600":"bg-gray-400 dark:bg-gray-600"])},[e("span",hr,n(s.name?.[0]?.toUpperCase()||"U"),1)],2))],4))),128))]),e("div",wr,[e("p",_r," 订单 #"+n(r.order.order_no),1),e("p",Cr,n(h.value.filter(s=>s.is_online).length)+"/"+n(h.value.length)+" 在房间 ",1)])])]),actions:M(()=>[e("button",{onClick:t[0]||(t[0]=s=>v.value=!v.value),class:"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},[...t[58]||(t[58]=[e("svg",{class:"w-5 h-5 text-gray-700 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)])]),e("button",{onClick:t[1]||(t[1]=s=>y.value=!y.value),class:"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},[...t[59]||(t[59]=[e("svg",{class:"w-5 h-5 text-gray-700 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])])]),_:1},8,["title"]),e("div",$r,[r.order.status==="cancelled"?(a(),o("div",Mr,[...t[60]||(t[60]=[e("div",{class:"max-w-7xl mx-auto px-4 py-3 sm:px-6 lg:px-8"},[e("div",{class:"flex items-center gap-3"},[e("svg",{class:"w-5 h-5 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("p",{class:"text-sm font-medium text-red-800 dark:text-red-200"},"此订单已取消，无法进行任何操作")])],-1)])])):u("",!0),r.order.is_disputed&&r.order.status!=="cancelled"?(a(),o("div",zr,[e("div",Br,[e("div",jr,[e("div",Fr,[t[64]||(t[64]=e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("div",Ar,[t[62]||(t[62]=e("p",{class:"text-sm font-medium text-amber-800 dark:text-amber-200"},"该订单处于争议中",-1)),t[63]||(t[63]=e("p",{class:"text-xs text-amber-700 dark:text-amber-300 mt-1"},[w(" 请等待仲裁管理员加入聊天，管理员将在 "),e("span",{class:"font-semibold"},"24小时内"),w(" 加入处理。 在此期间，您可以与对方自行协商解决。 ")],-1)),r.order.dispute_reason?(a(),o("p",Sr,[t[61]||(t[61]=e("span",{class:"font-medium"},"争议原因：",-1)),w(n(r.order.dispute_reason),1)])):u("",!0)])]),r.availableActions.includes("resolve_dispute")?(a(),o("div",Lr,[$(R,{onClick:t[2]||(t[2]=s=>A("resolve_dispute")),variant:"outline",size:"sm"},{default:M(()=>[...t[65]||(t[65]=[w(" 解除争议 ",-1)])]),_:1})])):u("",!0)])])])):u("",!0),!l.$page.props.auth.user?.telegram_chat_id&&r.order.status!=="cancelled"&&r.order.status!=="completed"?(a(),o("div",Vr,[e("div",Er,[e("div",Ir,[t[67]||(t[67]=e("div",{class:"flex items-start gap-3 flex-1"},[e("svg",{class:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.56c-.21 2.27-1.13 7.75-1.6 10.29-.2 1.08-.59 1.44-.97 1.47-.82.07-1.45-.54-2.24-.99-1.24-.71-1.94-1.16-3.14-1.85-1.39-.8-.49-1.24.3-1.96.21-.19 3.85-3.52 3.91-3.82.01-.04.01-.19-.07-.27-.08-.08-.2-.05-.28-.03-.12.03-2.02.13-5.7 3.75-.54.54-1.03.8-1.48.78-.49-.02-1.42-.27-2.11-.5-.85-.28-1.53-.42-1.47-.89.03-.25.37-.51 1.02-.77 4-1.74 6.67-2.89 8.01-3.44 3.81-1.57 4.61-1.84 5.13-1.85.11 0 .37.03.53.18.14.12.18.28.2.45-.01.06-.01.24-.02.38z"})]),e("div",{class:"flex-1"},[e("p",{class:"text-sm font-medium text-blue-800 dark:text-blue-200"},"建议设置 Telegram 接收实时通知"),e("p",{class:"text-xs text-blue-700 dark:text-blue-300 mt-1"}," 连接 Telegram 后，您可以实时收到交易状态更新、对方消息提醒等重要通知，确保不错过任何关键信息。 ")])],-1)),e("div",Tr,[$(Be(et),{href:"/notifications/settings",class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm font-medium transition-colors"},{default:M(()=>[...t[66]||(t[66]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.56c-.21 2.27-1.13 7.75-1.6 10.29-.2 1.08-.59 1.44-.97 1.47-.82.07-1.45-.54-2.24-.99-1.24-.71-1.94-1.16-3.14-1.85-1.39-.8-.49-1.24.3-1.96.21-.19 3.85-3.52 3.91-3.82.01-.04.01-.19-.07-.27-.08-.08-.2-.05-.28-.03-.12.03-2.02.13-5.7 3.75-.54.54-1.03.8-1.48.78-.49-.02-1.42-.27-2.11-.5-.85-.28-1.53-.42-1.47-.89.03-.25.37-.51 1.02-.77 4-1.74 6.67-2.89 8.01-3.44 3.81-1.57 4.61-1.84 5.13-1.85.11 0 .37.03.53.18.14.12.18.28.2.45-.01.06-.01.24-.02.38z"})],-1),w(" 立即设置 ",-1)])]),_:1})])])])])):u("",!0),$(je,{modelValue:y.value,"onUpdate:modelValue":t[10]||(t[10]=s=>y.value=s),title:"交易详情",subtitle:`订单 #${r.order.order_no}`,position:"bottom",size:"default","icon-color":"blue"},{"header-icon":M(()=>[...t[68]||(t[68]=[e("div",{class:"p-2 rounded bg-blue-100 dark:bg-blue-900/30"},[e("svg",{class:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})])],-1)])]),default:M(()=>[e("div",Pr,[e("div",Ur,[e("div",Dr,[e("div",qr,[t[69]||(t[69]=e("svg",{class:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z","clip-rule":"evenodd"})],-1)),e("div",null,[e("p",Rr,n(Ae(r.order.escrow_status)),1),e("p",Hr,"当前进度: "+n(ue(r.order.escrow_status))+"%",1)])])]),e("div",null,[t[93]||(t[93]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-3"},"交易流程",-1)),e("div",Wr,[e("div",Or,[t[72]||(t[72]=e("div",{class:"flex flex-col items-center"},[e("div",{class:"w-8 h-8 rounded-full bg-emerald-600 text-white flex items-center justify-center"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])]),e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-gray-600"})],-1)),e("div",Nr,[t[71]||(t[71]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"订单创建",-1)),e("p",Kr,n(r.order.created_at?T(r.order.created_at):"已完成"),1),r.order.escrow_status==="order_initiated"&&r.availableActions.includes("vendor_confirm")?(a(),o("div",Xr,[$(R,{onClick:t[3]||(t[3]=s=>A("vendor_confirm")),variant:"primary",size:"sm"},{default:M(()=>[...t[70]||(t[70]=[w(" 确认接单 ",-1)])]),_:1})])):u("",!0)])]),e("div",Jr,[e("div",Gr,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="order_initiated"?"bg-amber-500 animate-pulse":["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-gray-700"])},[["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(a(),o("svg",Qr,[...t[73]||(t[73]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",Zr,"2"))],2),t[74]||(t[74]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-gray-600"},null,-1))]),e("div",Yr,[e("p",{class:x(["text-sm font-medium",["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-600 dark:text-gray-300"])}," 商家确认 ",2),e("p",es,n(r.order.vendor_confirmed_at?T(r.order.vendor_confirmed_at):"等待商家确认订单"),1)])]),e("div",ts,[e("div",rs,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="vendor_confirmed"?"bg-amber-500 animate-pulse":["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-gray-700"])},[["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(a(),o("svg",ss,[...t[75]||(t[75]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",as,"3"))],2),t[76]||(t[76]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-gray-600"},null,-1))]),e("div",os,[e("p",{class:x(["text-sm font-medium",["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-600 dark:text-gray-300"])}," 卖家转币到托管 ",2),e("p",ls,n(r.order.seller_paid_at?T(r.order.seller_paid_at):"等待卖家转币"),1),r.order.escrow_status==="vendor_confirmed"&&r.availableActions.includes("mark_seller_paid")?(a(),o("div",ds,[$(R,{onClick:t[4]||(t[4]=s=>A("mark_seller_paid")),variant:"primary",size:"sm"},{default:M(()=>[...t[77]||(t[77]=[w(" 我已转币 ",-1)])]),_:1})])):u("",!0)])]),e("div",ns,[e("div",is,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="seller_paid"?"bg-amber-500 animate-pulse":["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-gray-700"])},[["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(a(),o("svg",us,[...t[78]||(t[78]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",cs,"4"))],2),t[79]||(t[79]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-gray-600"},null,-1))]),e("div",ms,[e("p",{class:x(["text-sm font-medium",["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-600 dark:text-gray-300"])}," 托管确认到账 ",2),e("p",xs,n(r.order.escrow_received_at?T(r.order.escrow_received_at):"系统确认中"),1),r.order.escrow_status==="seller_paid"?(a(),o("div",vs,[e("div",gs,[$(R,{onClick:t[5]||(t[5]=s=>me("received")),variant:"success",size:"xs",fullWidth:""},{default:M(()=>[...t[80]||(t[80]=[w(" 模拟已收到 ",-1)])]),_:1}),$(R,{onClick:t[6]||(t[6]=s=>me("not_received")),variant:"danger",size:"xs",fullWidth:""},{default:M(()=>[...t[81]||(t[81]=[w(" 模拟未收到 ",-1)])]),_:1})]),t[82]||(t[82]=e("p",{class:"text-xs text-amber-600 dark:text-amber-400 text-center"}," 🧪 测试模式 ",-1))])):u("",!0)])]),e("div",bs,[e("div",ys,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="escrow_received"?"bg-amber-500 animate-pulse":["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-gray-700"])},[["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(a(),o("svg",fs,[...t[83]||(t[83]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",ks,"5"))],2),t[84]||(t[84]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-gray-600"},null,-1))]),e("div",ps,[e("p",{class:x(["text-sm font-medium",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-600 dark:text-gray-300"])}," 买家确认托管到账 ",2),e("p",hs,n(r.order.buyer_confirmed_escrow_at?T(r.order.buyer_confirmed_escrow_at):"等待买家确认"),1),r.order.escrow_status==="escrow_received"&&r.availableActions.includes("confirm_escrow")?(a(),o("div",ws,[$(R,{onClick:t[7]||(t[7]=s=>A("confirm_escrow")),variant:"primary",size:"sm"},{default:M(()=>[...t[85]||(t[85]=[w(" 确认托管到账 ",-1)])]),_:1})])):u("",!0)])]),e("div",_s,[e("div",Cs,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="buyer_confirmed_escrow"?"bg-amber-500 animate-pulse":["buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-gray-700"])},[["buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(a(),o("svg",$s,[...t[86]||(t[86]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",Ms,"6"))],2),t[87]||(t[87]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-gray-600"},null,-1))]),e("div",zs,[e("p",{class:x(["text-sm font-medium",["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-600 dark:text-gray-300"])}," 买家付款 ",2),e("p",Bs,n(r.order.buyer_paid_at?T(r.order.buyer_paid_at):"等待买家付款"),1),r.order.escrow_status==="buyer_confirmed_escrow"&&r.availableActions.includes("mark_buyer_paid")?(a(),o("div",js,[$(R,{onClick:t[8]||(t[8]=s=>A("mark_buyer_paid")),variant:"primary",size:"sm"},{default:M(()=>[...t[88]||(t[88]=[w(" 我已付款 ",-1)])]),_:1})])):u("",!0)])]),e("div",Fs,[e("div",As,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="buyer_paid"?"bg-amber-500 animate-pulse":["seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-gray-700"])},[["seller_received","escrow_released"].includes(r.order.escrow_status)?(a(),o("svg",Ss,[...t[89]||(t[89]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",Ls,"7"))],2),t[90]||(t[90]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-gray-600"},null,-1))]),e("div",Vs,[e("p",{class:x(["text-sm font-medium",["buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-600 dark:text-gray-300"])}," 卖家确认收款 ",2),e("p",Es,n(r.order.seller_received_at?T(r.order.seller_received_at):"等待卖家确认"),1),r.order.escrow_status==="buyer_paid"&&r.availableActions.includes("mark_seller_received")?(a(),o("div",Is,[$(R,{onClick:t[9]||(t[9]=s=>A("mark_seller_received")),variant:"success",size:"sm"},{default:M(()=>[...t[91]||(t[91]=[w(" 确认收款 ",-1)])]),_:1})])):u("",!0)])]),e("div",Ts,[e("div",Ps,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="seller_received"?"bg-amber-500 animate-pulse":r.order.escrow_status==="escrow_released"?"bg-emerald-600":"bg-gray-300 dark:bg-gray-700"])},[r.order.escrow_status==="escrow_released"?(a(),o("svg",Us,[...t[92]||(t[92]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",Ds,"8"))],2)]),e("div",qs,[e("p",{class:x(["text-sm font-medium",["seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-600 dark:text-gray-300"])}," 托管释放 ",2),e("p",Rs,n(r.order.escrow_released_at?T(r.order.escrow_released_at):"平台释放币给买家"),1)])])])]),e("div",null,[t[104]||(t[104]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-2"},"交易信息",-1)),e("div",Hs,[e("div",null,[t[94]||(t[94]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"订单编号",-1)),e("p",Ws,"#"+n(r.order.order_no),1)]),e("div",null,[t[95]||(t[95]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"商家",-1)),e("p",Os,n(r.order.vendor?.name||"加载中..."),1)]),e("div",null,[t[96]||(t[96]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"客户",-1)),e("p",Ns,n(r.order.client?.name||"加载中..."),1)]),e("div",null,[t[97]||(t[97]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"买家",-1)),e("p",Ks,n(r.order.buyer?.name||"加载中..."),1)]),e("div",null,[t[98]||(t[98]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"卖家",-1)),e("p",Xs,n(r.order.seller?.name||"加载中..."),1)]),e("div",null,[t[99]||(t[99]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"币种",-1)),e("p",Js,n(r.order.currency_label||r.order.currency_key||r.order.crypto_currency),1)]),e("div",null,[t[100]||(t[100]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"数量（含交易费）",-1)),e("p",Gs,n(parseFloat(r.order.crypto_amount).toFixed(4))+" "+n(r.order.currency_label||r.order.currency_key||r.order.crypto_currency),1),r.order.fee&&r.order.fee>0?(a(),o("p",Qs," 交易费（商家）: "+n(parseFloat(r.order.fee).toFixed(8))+" "+n(r.order.currency_label||r.order.currency_key||r.order.crypto_currency),1)):u("",!0)]),e("div",null,[t[101]||(t[101]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"单价",-1)),e("p",Zs,"¥"+n(parseFloat(r.order.price).toFixed(2)),1)]),e("div",null,[t[102]||(t[102]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"总金额",-1)),e("p",Ys,"¥"+n(parseFloat(r.order.fiat_amount).toFixed(2)),1)])]),r.order.seller_address?(a(),o("div",ea,[t[103]||(t[103]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400 block mb-1"},"卖家地址",-1)),e("p",ta,n(r.order.seller_address),1)])):u("",!0)])])])]),_:1},8,["modelValue","subtitle"]),e("div",ra,[e("div",sa,[e("div",aa,[e("div",oa,[e("div",la,[t[105]||(t[105]=e("h3",{class:"text-lg font-bold text-gray-900 dark:text-gray-100"},"交易详情",-1)),e("span",{class:x([He(r.order.escrow_status),"px-3 py-1 text-xs font-semibold rounded-full"])},n(Ae(r.order.escrow_status)),3)]),e("div",da,[e("div",na,[t[106]||(t[106]=e("span",null,"交易进度",-1)),e("span",null,n(ue(r.order.escrow_status))+"%",1)]),e("div",ia,[e("div",{class:"bg-gradient-to-r from-emerald-500 to-emerald-600 h-2 rounded-full",style:ye(`width: ${ue(r.order.escrow_status)}%`)},null,4)])]),e("div",ua,[e("div",null,[e("div",ca,[t[108]||(t[108]=e("div",{class:"w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center"},[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)),e("div",ma,[t[107]||(t[107]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"订单创建",-1)),e("p",xa,n(r.order.created_at?T(r.order.created_at):"已完成"),1)])])]),e("div",null,[e("div",va,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="order_initiated"?"bg-amber-500 animate-pulse":["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-gray-700"])},[["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(a(),o("svg",ga,[...t[109]||(t[109]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",ba,"2"))],2),e("div",ya,[e("p",{class:x(["text-sm font-medium",["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-400 dark:text-gray-500"])}," 商家确认 ",2),e("p",{class:x(["text-xs",["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-500 dark:text-gray-400":"text-gray-400 dark:text-gray-600"])},n(r.order.vendor_confirmed_at?T(r.order.vendor_confirmed_at):r.order.escrow_status==="order_initiated"?"等待中...":"待完成"),3)])]),r.order.escrow_status==="order_initiated"&&r.availableActions.includes("vendor_confirm")?(a(),o("div",fa,[$(R,{onClick:t[11]||(t[11]=s=>A("vendor_confirm")),variant:"primary",size:"sm",fullWidth:""},{default:M(()=>[...t[110]||(t[110]=[w(" 确认接单 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",ka,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="vendor_confirmed"?"bg-amber-500 animate-pulse":["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-gray-700"])},[["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(a(),o("svg",pa,[...t[111]||(t[111]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",ha,"3"))],2),e("div",wa,[e("p",{class:x(["text-sm font-medium",["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-400 dark:text-gray-500"])}," 卖家转币到托管 ",2),e("p",{class:x(["text-xs",["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-500 dark:text-gray-400":"text-gray-400 dark:text-gray-600"])},n(r.order.seller_paid_at?T(r.order.seller_paid_at):r.order.escrow_status==="vendor_confirmed"?"等待中...":"待完成"),3),r.order.escrow_tx_hash?(a(),o("p",_a," TX: "+n(r.order.escrow_tx_hash),1)):u("",!0)])]),r.order.escrow_status==="vendor_confirmed"&&r.availableActions.includes("mark_seller_paid")?(a(),o("div",Ca,[$(R,{onClick:t[12]||(t[12]=s=>A("mark_seller_paid")),variant:"primary",size:"sm"},{default:M(()=>[...t[112]||(t[112]=[w(" 我已转币到托管 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",$a,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="seller_paid"?"bg-amber-500 animate-pulse":["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-gray-700"])},[["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(a(),o("svg",Ma,[...t[113]||(t[113]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",za,"4"))],2),e("div",Ba,[e("p",{class:x(["text-sm font-medium",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-400 dark:text-gray-500"])}," 托管确认到账 ",2),e("p",{class:x(["text-xs",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-500 dark:text-gray-400":"text-gray-400 dark:text-gray-600"])},n(r.order.escrow_received_at?T(r.order.escrow_received_at):r.order.escrow_status==="seller_paid"?"系统确认中...":"待完成"),3)])]),r.order.escrow_status==="seller_paid"?(a(),o("div",ja,[e("div",Fa,[$(R,{onClick:t[13]||(t[13]=s=>me("received")),variant:"success",size:"sm",fullWidth:""},{default:M(()=>[...t[114]||(t[114]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),w(" 模拟已收到 ",-1)])]),_:1}),$(R,{onClick:t[14]||(t[14]=s=>me("not_received")),variant:"danger",size:"sm",fullWidth:""},{default:M(()=>[...t[115]||(t[115]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),w(" 模拟未收到 ",-1)])]),_:1})]),t[116]||(t[116]=e("p",{class:"text-xs text-amber-600 dark:text-amber-400 text-center"}," 🧪 测试模式：模拟区块链确认 ",-1))])):u("",!0)]),e("div",null,[e("div",Aa,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="escrow_received"?"bg-amber-500 animate-pulse":["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-gray-700"])},[["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(a(),o("svg",Sa,[...t[117]||(t[117]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",La,"5"))],2),e("div",Va,[e("p",{class:x(["text-sm font-medium",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-400 dark:text-gray-500"])}," 买家确认托管到账 ",2),e("p",{class:x(["text-xs",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-500 dark:text-gray-400":"text-gray-400 dark:text-gray-600"])},n(r.order.buyer_confirmed_escrow_at?T(r.order.buyer_confirmed_escrow_at):r.order.escrow_status==="escrow_received"?"等待确认...":"待完成"),3)])]),r.order.escrow_status==="escrow_received"&&r.availableActions.includes("confirm_escrow")?(a(),o("div",Ea,[$(R,{onClick:t[15]||(t[15]=s=>A("confirm_escrow")),variant:"primary",size:"sm",fullWidth:""},{default:M(()=>[...t[118]||(t[118]=[w(" 确认托管到账 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",Ia,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="buyer_confirmed_escrow"?"bg-amber-500 animate-pulse":["buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-gray-700"])},[["buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(a(),o("svg",Ta,[...t[119]||(t[119]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",Pa,"6"))],2),e("div",Ua,[e("p",{class:x(["text-sm font-medium",["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-400 dark:text-gray-500"])}," 买家付款 ",2),e("p",Da,n(r.order.buyer_paid_at?T(r.order.buyer_paid_at):r.order.escrow_status==="buyer_confirmed_escrow"?"等待中...":"待完成"),1)])]),r.order.escrow_status==="buyer_confirmed_escrow"&&r.availableActions.includes("mark_buyer_paid")?(a(),o("div",qa,[$(R,{onClick:t[16]||(t[16]=s=>A("mark_buyer_paid")),variant:"primary",size:"sm",fullWidth:""},{default:M(()=>[...t[120]||(t[120]=[w(" 我已付款 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",Ra,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="buyer_paid"?"bg-amber-500 animate-pulse":["seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-gray-700"])},[["seller_received","escrow_released"].includes(r.order.escrow_status)?(a(),o("svg",Ha,[...t[121]||(t[121]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",Wa,"7"))],2),e("div",Oa,[e("p",{class:x(["text-sm font-medium",["buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-400 dark:text-gray-500"])}," 卖家确认收款 ",2),e("p",{class:x(["text-xs",["buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-500 dark:text-gray-400":"text-gray-400 dark:text-gray-600"])},n(r.order.seller_received_at?T(r.order.seller_received_at):r.order.escrow_status==="buyer_paid"?"等待中...":"待完成"),3)])]),r.order.escrow_status==="buyer_paid"&&r.availableActions.includes("mark_seller_received")?(a(),o("div",Na,[$(R,{onClick:t[17]||(t[17]=s=>A("mark_seller_received")),variant:"success",size:"sm",fullWidth:""},{default:M(()=>[...t[122]||(t[122]=[w(" 确认收款 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",Ka,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="seller_received"?"bg-amber-500 animate-pulse":r.order.escrow_status==="escrow_released"?"bg-emerald-500":"bg-gray-300 dark:bg-gray-700"])},[r.order.escrow_status==="escrow_released"?(a(),o("svg",Xa,[...t[123]||(t[123]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",Ja,"8"))],2),e("div",Ga,[e("p",{class:x(["text-sm font-medium",["seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-400 dark:text-gray-500"])}," 托管释放 ",2),e("p",{class:x(["text-xs",["seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-500 dark:text-gray-400":"text-gray-400 dark:text-gray-600"])},n(r.order.escrow_released_at?T(r.order.escrow_released_at):r.order.escrow_status==="seller_received"?"处理中...":"待完成"),3)])])])]),e("div",Qa,[e("div",Za,[t[124]||(t[124]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"订单编号",-1)),e("span",Ya,"#"+n(r.order.order_no),1)]),e("div",eo,[t[125]||(t[125]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"商家",-1)),e("span",to,n(r.order.vendor?.name||"加载中..."),1)]),e("div",ro,[t[126]||(t[126]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"客户",-1)),e("span",so,n(r.order.client?.name||"加载中..."),1)]),e("div",ao,[t[127]||(t[127]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"买家",-1)),e("span",oo,n(r.order.buyer?.name||"加载中..."),1)]),e("div",lo,[t[128]||(t[128]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"卖家",-1)),e("span",no,n(r.order.seller?.name||"加载中..."),1)]),e("div",io,[t[129]||(t[129]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"数量（含交易费）",-1)),e("span",uo,n(parseFloat(r.order.crypto_amount).toFixed(4))+" "+n(r.order.currency_label||r.order.currency_key||r.order.crypto_currency),1)]),r.order.fee&&r.order.fee>0?(a(),o("div",co,[t[130]||(t[130]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"交易费（商家）",-1)),e("span",mo,n(parseFloat(r.order.fee).toFixed(8))+" "+n(r.order.currency_label||r.order.currency_key||r.order.crypto_currency),1)])):u("",!0),e("div",xo,[t[131]||(t[131]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"单价",-1)),e("span",vo,"¥"+n(parseFloat(r.order.price).toFixed(2)),1)]),e("div",go,[t[132]||(t[132]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"总金额",-1)),e("span",bo,"¥"+n(parseFloat(r.order.fiat_amount).toFixed(2)),1)]),r.order.seller_address?(a(),o("div",yo,[t[133]||(t[133]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"卖家地址",-1)),e("span",fo,n(r.order.seller_address),1)])):u("",!0)])])]),e("div",ko,[e("div",po,[e("div",ho,[e("div",wo,[e("div",_o,[e("div",Co,[e("div",$o,[(a(!0),o(E,null,W(h.value,(s,p)=>(a(),o("a",{key:s.id,href:`/trader/profile/${s.id}`,target:"_blank",class:"relative hover:opacity-80 transition-opacity cursor-pointer",style:ye(`z-index: ${h.value.length-p}`)},[s.profile_photo_url?(a(),o("img",{key:0,src:s.profile_photo_url,alt:s.name,class:"h-10 w-10 rounded-full object-cover ring-2 ring-white dark:ring-gray-900"},null,8,zo)):(a(),o("div",Bo,[e("span",jo,n(s.name?.[0]?.toUpperCase()||"U"),1)])),s.is_online?(a(),o("div",Fo)):u("",!0)],12,Mo))),128))]),e("div",Ao,[e("div",So,[e("p",Lo,[w(" 订单 #"+n(r.order.order_no)+" 聊天室 ",1),e("span",Vo,"("+n(h.value.length)+"人)",1)])]),e("p",Eo,[(a(!0),o(E,null,W(h.value,(s,p)=>(a(),o("span",{key:s.id},[e("span",{class:x([s.is_online?"text-emerald-600 dark:text-emerald-400":"text-gray-400 dark:text-gray-500",s.is_admin?"font-medium":""])},n(s.name),3),p<h.value.length-1?(a(),o("span",Io," · ")):u("",!0)]))),128))])])]),t[134]||(t[134]=e("div",{class:"flex items-center gap-2"},null,-1))])])]),e("div",{ref_key:"messageContainer",ref:L,class:"flex-1 overflow-y-auto p-6 space-y-4"},[e("div",To,[e("div",Po,n(new Date(r.order.created_at).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})),1),t[135]||(t[135]=e("div",{class:"px-3 py-1 bg-gray-100 dark:bg-gray-800 rounded text-xs text-gray-500 dark:text-gray-400"}," 订单已创建，等待商家确认 ",-1))]),t[147]||(t[147]=e("div",{class:"mb-4 mx-4"},[e("div",{class:"bg-amber-50 dark:bg-amber-900/20 rounded p-3 border border-amber-200 dark:border-amber-800"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("div",{class:"text-xs"},[e("p",{class:"font-medium text-amber-700 dark:text-amber-300 mb-1"},"安全提醒"),e("p",{class:"text-amber-600 dark:text-amber-400"},"请勿相信任何平台外的交易邀请，谨防诈骗。任何平台以外的交流都无法作为争议材料。")])])])],-1)),r.order.ad_snapshot?.welcome_message?(a(),o("div",Uo,[e("div",Do,[t[139]||(t[139]=e("div",{class:"flex items-center gap-2 mb-2"},[e("svg",{class:"w-4 h-4 text-blue-600 dark:text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 3a1 1 0 00-1.447-.894L8.763 6H5a3 3 0 000 6h.28l1.771 5.316A1 1 0 008 18h1a1 1 0 001-1v-4.382l6.553 3.276A1 1 0 0018 15V3z","clip-rule":"evenodd"})]),e("span",{class:"text-xs font-medium text-blue-700 dark:text-blue-300"},"商家公告")],-1)),e("p",qo,n(r.order.ad_snapshot.welcome_message),1),r.order.vendor?.response_time?(a(),o("div",Ro,[e("div",Ho,[t[138]||(t[138]=e("svg",{class:"w-3.5 h-3.5 text-blue-500 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",Wo,[t[136]||(t[136]=w(" 该商家的响应时间是 ",-1)),e("span",Oo,n(r.order.vendor.response_time)+" 分钟",1),t[137]||(t[137]=w("，请在该时间内等待商家加入聊天室。 ",-1))])])])):u("",!0)])])):u("",!0),r.order.vendor?.response_time&&!r.order.ad_snapshot?.welcome_message?(a(),o("div",No,[e("div",Ko,[e("div",Xo,[t[142]||(t[142]=e("svg",{class:"w-3.5 h-3.5 text-blue-500 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",Jo,[t[140]||(t[140]=w(" 该商家的响应时间是 ",-1)),e("span",Go,n(r.order.vendor.response_time)+" 分钟",1),t[141]||(t[141]=w("，请在该时间内等待商家加入聊天室。 ",-1))])])])])):u("",!0),(a(!0),o(E,null,W(m.value,s=>(a(),o("div",{key:s.id,class:x(["flex",s.type==="system"?"justify-center":"gap-3",s.type!=="system"&&s.user?.id===l.$page.props.auth.user?.id?"justify-end":""])},[s.type==="system"?(a(),o("div",Qo,[e("div",Zo,n(T(s.created_at)),1),e("div",{class:x(["px-3 py-1 rounded text-xs max-w-md",s.is_temporary?"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400":"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400"])},[s.user?(a(),o("span",Yo,n(s.user.name),1)):u("",!0),w(" "+n(s.message||s.content),1)],2),s.show_review_button?(a(),o("div",el,[d.value.has_review?(a(),o("div",sl,[...t[146]||(t[146]=[e("div",{class:"flex items-center justify-center gap-2"},[e("svg",{class:"w-5 h-5 text-emerald-600 dark:text-emerald-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})]),e("span",{class:"text-sm font-medium text-emerald-800 dark:text-emerald-300"},"您已评价此交易")],-1)])])):(a(),o("div",tl,[e("div",rl,[t[145]||(t[145]=e("div",{class:"flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})]),e("span",{class:"text-sm font-medium text-amber-800 dark:text-amber-300"},"请评价本次交易")],-1)),$(R,{onClick:t[18]||(t[18]=p=>b.value=!0),variant:"warning",size:"sm",fullWidth:""},{icon:M(()=>[...t[143]||(t[143]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})],-1)])]),default:M(()=>[t[144]||(t[144]=w(" 立即评价 ",-1))]),_:1})])]))])):u("",!0)])):s.user?.id!==l.$page.props.auth.user?.id?(a(),o(E,{key:1},[e("a",{href:`/trader/profile/${s.user.id}`,target:"_blank",class:"h-8 w-8 rounded-full flex-shrink-0 hover:opacity-80 transition-opacity cursor-pointer"},[s.user.profile_photo_url?(a(),o("img",{key:0,src:s.user.profile_photo_url,alt:s.user.name,class:"h-8 w-8 rounded-full object-cover border border-gray-200 dark:border-gray-700"},null,8,ol)):(a(),o("div",ll,[e("span",dl,n(s.user.name.charAt(0)),1)]))],8,al),e("div",nl,[e("p",il,[w(n(s.user.name)+" ",1),s.type==="admin"?(a(),o("span",ul,"(Admin)")):u("",!0)]),e("div",cl,[s.attachment?(a(),o("div",ml,[$(be,{attachment:s.attachment,variant:"default","thumbnail-size":"md"},null,8,["attachment"])])):u("",!0),s.message?(a(),o("p",xl,n(s.message),1)):u("",!0)]),e("p",vl,n(T(s.created_at)),1)])],64)):(a(),o(E,{key:2},[e("div",gl,[e("p",bl,[w(n(s.user.name)+" ",1),s.type==="admin"?(a(),o("span",yl,"(Admin)")):u("",!0)]),e("div",fl,[s.attachment?(a(),o("div",kl,[$(be,{attachment:s.attachment,variant:"primary","thumbnail-size":"md"},null,8,["attachment"])])):u("",!0),s.message?(a(),o("p",pl,n(s.message),1)):u("",!0)]),e("p",hl,n(T(s.created_at)),1)]),l.$page.props.auth.user?.profile_photo_url?(a(),o("img",{key:0,src:l.$page.props.auth.user.profile_photo_url,alt:l.$page.props.auth.user.name,class:"h-8 w-8 rounded-full object-cover border border-gray-200 dark:border-gray-700 flex-shrink-0"},null,8,wl)):(a(),o("div",_l,[e("span",Cl,n(l.$page.props.auth.user?.name?.charAt(0).toUpperCase()||"U"),1)]))],64))],2))),128))],512),e("div",$l,[B.value||F.value?(a(),o("div",Ml,[F.value?(a(),o("div",zl,[...t[148]||(t[148]=[e("div",{class:"animate-spin h-8 w-8 border-4 border-blue-600 border-t-transparent rounded-full"},null,-1),e("div",null,[e("p",{class:"text-sm font-medium text-gray-900 dark:text-gray-200"},"正在压缩图片..."),e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"优化图片大小以快速上传")],-1)])])):B.value?(a(),o("div",Bl,[B.value.type.startsWith("image/")?(a(),o("img",{key:0,src:P.value,alt:B.value.name,class:"max-h-32 rounded"},null,8,jl)):B.value.type==="application/pdf"?(a(),o("div",Fl,[...t[149]||(t[149]=[e("svg",{class:"w-8 h-8 text-red-600 dark:text-red-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-5L9 2H4z","clip-rule":"evenodd"})],-1)])])):u("",!0),e("div",Al,[e("p",Sl,n(B.value.name),1),e("p",Ll,n(Ve(B.value.size)),1)]),e("button",{onClick:Ce,type:"button",class:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"},[...t[150]||(t[150]=[e("svg",{class:"w-4 h-4 text-gray-500 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):u("",!0)])):u("",!0),e("form",{onSubmit:K(Ie,["prevent"]),class:"flex gap-2"},[e("input",{ref_key:"fileInput",ref:O,type:"file",onChange:Ee,accept:".pdf,image/*","data-max-size":"2097152",class:"hidden"},null,544),e("button",{type:"button",onClick:t[19]||(t[19]=s=>!X.value&&!F.value&&l.$refs.fileInput.click()),disabled:X.value||F.value,class:"p-2 rounded text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent"},[...t[151]||(t[151]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)])],8,Vl),$(qe,{onSelect:t[20]||(t[20]=s=>C.value+=s),disabled:X.value,placement:"top"},null,8,["disabled"]),N(e("input",{"onUpdate:modelValue":t[21]||(t[21]=s=>C.value=s),type:"text",placeholder:X.value?"交易已结束，无法发送消息":"输入消息...",class:"flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-800 border-0 rounded text-base md:text-sm text-gray-900 dark:text-gray-200 placeholder-gray-500 dark:placeholder-gray-400 focus:bg-white dark:focus:bg-gray-700 focus:ring-2 focus:ring-emerald-500 focus:outline-none disabled:opacity-50 transition-colors",disabled:!g.value||X.value},null,8,El),[[te,C.value]]),e("button",{type:"submit",disabled:!C.value.trim()&&!B.value||!g.value||_.value||X.value,class:"px-4 py-2 bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded font-medium text-sm transition-colors flex items-center gap-2"},[_.value?(a(),o("svg",Tl,[...t[152]||(t[152]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(a(),o("span",Pl,"发送"))],8,Il)],32),r.availableActions.length>0&&r.order.status!=="completed"&&r.order.status!=="cancelled"&&r.order.escrow_status!=="escrow_released"||r.order.status!=="cancelled"&&r.order.status!=="completed"?(a(),o("div",Ul,[e("div",Dl,[(a(!0),o(E,null,W(r.availableActions,s=>(a(),o(E,{key:s},[s==="vendor_confirm"?(a(),o("button",{key:0,onClick:t[22]||(t[22]=p=>A("vendor_confirm")),class:"px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-medium rounded transition-colors cursor-pointer"}," 确认订单 ")):u("",!0),s==="mark_seller_paid"?(a(),o("button",{key:1,onClick:t[23]||(t[23]=p=>A("mark_seller_paid")),class:"px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-medium rounded transition-colors cursor-pointer"}," 我已转币 ")):u("",!0),s==="confirm_escrow"?(a(),o("button",{key:2,onClick:t[24]||(t[24]=p=>A("confirm_escrow")),class:"px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-medium rounded transition-colors cursor-pointer"}," 确认托管 ")):u("",!0),s==="mark_buyer_paid"?(a(),o("button",{key:3,onClick:t[25]||(t[25]=p=>A("mark_buyer_paid")),class:"px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-medium rounded transition-colors cursor-pointer"}," 我已付款 ")):u("",!0),s==="mark_seller_received"?(a(),o("button",{key:4,onClick:t[26]||(t[26]=p=>A("mark_seller_received")),class:"px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-xs font-medium rounded transition-colors cursor-pointer"}," 确认收款 ")):u("",!0),s==="cancel"?(a(),o("button",{key:5,onClick:t[27]||(t[27]=p=>A("cancel")),class:"px-3 py-1.5 bg-gray-600 hover:bg-gray-700 text-white text-xs font-medium rounded transition-colors cursor-pointer"}," 取消订单 ")):u("",!0)],64))),128)),r.availableActions.includes("create_dispute")?(a(),o("button",{key:0,onClick:t[28]||(t[28]=s=>A("create_dispute")),class:"px-3 py-1.5 bg-amber-600 hover:bg-amber-700 text-white text-xs font-medium rounded transition-colors cursor-pointer"}," 发起争议 ")):u("",!0),r.availableActions.includes("resolve_dispute")?(a(),o("button",{key:1,onClick:t[29]||(t[29]=s=>A("resolve_dispute")),class:"px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-xs font-medium rounded transition-colors cursor-pointer"}," 解除争议 ")):u("",!0)]),r.order.status!=="cancelled"&&r.order.status!=="completed"?(a(),o("a",{key:0,href:"/notifications/settings",target:"_blank",class:x(["inline-flex items-center gap-1 px-3 py-1 text-xs rounded transition-colors cursor-pointer",l.$page.props.auth.user?.telegram_chat_id?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 hover:bg-emerald-200 dark:hover:bg-emerald-900/50":"bg-blue-500 hover:bg-blue-600 text-white"])},[l.$page.props.auth.user?.telegram_chat_id?(a(),o("svg",ql,[...t[153]||(t[153]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("svg",Rl,[...t[154]||(t[154]=[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.56c-.21 2.27-1.13 7.75-1.6 10.29-.2 1.08-.59 1.44-.97 1.47-.82.07-1.45-.54-2.24-.99-1.24-.71-1.94-1.16-3.14-1.85-1.39-.8-.49-1.24.3-1.96.21-.19 3.85-3.52 3.91-3.82.01-.04.01-.19-.07-.27-.08-.08-.2-.05-.28-.03-.12.03-2.02.13-5.7 3.75-.54.54-1.03.8-1.48.78-.49-.02-1.42-.27-2.11-.5-.85-.28-1.53-.42-1.47-.89.03-.25.37-.51 1.02-.77 4-1.74 6.67-2.89 8.01-3.44 3.81-1.57 4.61-1.84 5.13-1.85.11 0 .37.03.53.18.14.12.18.28.2.45-.01.06-.01.24-.02.38z"},null,-1)])])),w(" "+n(l.$page.props.auth.user?.telegram_chat_id?"已开启通知":"设置实时通知"),1)],2)):u("",!0)])):u("",!0),e("div",Hl,[e("div",Wl,[e("div",Ol,[e("div",{class:x([Le(r.order.escrow_status),"w-2 h-2 rounded-full animate-pulse"])},null,2),e("span",Nl,n(Se(r.order.escrow_status)),1)]),e("div",Kl,[e("span",null,"订单 #"+n(r.order.trade_id),1),e("span",null,n(r.order.crypto_amount)+" "+n(r.order.currency_label||r.order.currency_key),1),e("span",Xl,"¥"+n(r.order.fiat_amount),1)])])])])]),e("div",Jl,[r.order.ad_snapshot?.vendor_toc?(a(),o("div",Gl,[t[155]||(t[155]=e("div",{class:"flex items-center gap-2 mb-3"},[e("svg",{class:"w-5 h-5 text-purple-600 dark:text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),e("h3",{class:"text-sm font-bold text-gray-900 dark:text-gray-100"},"交易条款")],-1)),e("div",Ql,[e("p",Zl,n(r.order.ad_snapshot?.vendor_toc||"无交易条款"),1)]),t[156]||(t[156]=e("div",{class:"mt-3 p-2 bg-amber-50 dark:bg-amber-900/20 rounded border border-amber-200 dark:border-amber-800"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("p",{class:"text-xs text-amber-700 dark:text-amber-300"}," 请仔细阅读并遵守以上交易条款，违反条款可能导致交易取消 ")])],-1))])):u("",!0)])])]),e("div",Yl,[e("div",{ref_key:"mobileMessageContainer",ref:j,class:"flex-1 overflow-y-auto overscroll-contain bg-white dark:bg-gray-950"},[!g.value&&k.value?(a(),o("div",ed,[...t[157]||(t[157]=[e("div",{class:"flex items-center justify-center gap-2"},[e("svg",{class:"animate-spin h-4 w-4 text-amber-600 dark:text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),e("span",{class:"text-xs text-amber-700 dark:text-amber-300"},"重新连接中...")],-1)])])):u("",!0),e("div",td,[e("div",rd,[e("div",sd,n(new Date(r.order.created_at).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})),1),t[158]||(t[158]=e("div",{class:"px-3 py-1 bg-gray-100 dark:bg-gray-800 rounded text-xs text-gray-500 dark:text-gray-400"}," 订单已创建，等待商家确认 ",-1))]),t[170]||(t[170]=e("div",{class:"mb-4 mx-4"},[e("div",{class:"bg-amber-50 dark:bg-amber-900/20 rounded p-3 border border-amber-200 dark:border-amber-800"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("div",{class:"text-xs"},[e("p",{class:"font-medium text-amber-700 dark:text-amber-300 mb-1"},"安全提醒"),e("p",{class:"text-amber-600 dark:text-amber-400"},"请勿相信任何平台外的交易邀请，谨防诈骗。任何平台以外的交流都无法作为争议材料。")])])])],-1)),r.order.ad_snapshot?.welcome_message?(a(),o("div",ad,[e("div",od,[t[162]||(t[162]=e("div",{class:"flex items-center gap-2 mb-2"},[e("svg",{class:"w-4 h-4 text-blue-600 dark:text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 3a1 1 0 00-1.447-.894L8.763 6H5a3 3 0 000 6h.28l1.771 5.316A1 1 0 008 18h1a1 1 0 001-1v-4.382l6.553 3.276A1 1 0 0018 15V3z","clip-rule":"evenodd"})]),e("span",{class:"text-xs font-medium text-blue-700 dark:text-blue-300"},"商家公告")],-1)),e("p",ld,n(r.order.ad_snapshot.welcome_message),1),r.order.vendor?.response_time?(a(),o("div",dd,[e("div",nd,[t[161]||(t[161]=e("svg",{class:"w-3.5 h-3.5 text-blue-500 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",id,[t[159]||(t[159]=w(" 该商家的响应时间是 ",-1)),e("span",ud,n(r.order.vendor.response_time)+" 分钟",1),t[160]||(t[160]=w("，请在该时间内等待商家加入聊天室。 ",-1))])])])):u("",!0)])])):u("",!0),r.order.vendor?.response_time&&!r.order.ad_snapshot?.welcome_message?(a(),o("div",cd,[e("div",md,[e("div",xd,[t[165]||(t[165]=e("svg",{class:"w-3.5 h-3.5 text-blue-500 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",vd,[t[163]||(t[163]=w(" 该商家的响应时间是 ",-1)),e("span",gd,n(r.order.vendor.response_time)+" 分钟",1),t[164]||(t[164]=w("，请在该时间内等待商家加入聊天室。 ",-1))])])])])):u("",!0),(a(!0),o(E,null,W(m.value,s=>(a(),o("div",{key:s.id,class:x(["flex",s.type==="system"?"justify-center":"gap-2",s.type!=="system"&&s.user?.id===l.$page.props.auth.user?.id?"justify-end":""])},[s.type==="system"?(a(),o("div",bd,[e("div",yd,n(T(s.created_at)),1),e("div",{class:x(["px-3 py-1 rounded text-xs",s.is_temporary?"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400":"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400"])},[s.user?(a(),o("span",fd,n(s.user.name),1)):u("",!0),w(" "+n(s.message||s.content),1)],2),s.show_review_button?(a(),o("div",kd,[d.value.has_review?(a(),o("div",wd,[...t[169]||(t[169]=[e("div",{class:"flex items-center justify-center gap-2"},[e("svg",{class:"w-5 h-5 text-emerald-600 dark:text-emerald-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})]),e("span",{class:"text-sm font-medium text-emerald-800 dark:text-emerald-300"},"您已评价此交易")],-1)])])):(a(),o("div",pd,[e("div",hd,[t[168]||(t[168]=e("div",{class:"flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})]),e("span",{class:"text-sm font-medium text-amber-800 dark:text-amber-300"},"请评价本次交易")],-1)),$(R,{onClick:t[30]||(t[30]=p=>b.value=!0),variant:"warning",size:"sm",fullWidth:""},{icon:M(()=>[...t[166]||(t[166]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})],-1)])]),default:M(()=>[t[167]||(t[167]=w(" 立即评价 ",-1))]),_:1})])]))])):u("",!0)])):s.user?.id!==l.$page.props.auth.user?.id?(a(),o(E,{key:1},[e("a",{href:`/trader/profile/${s.user.id}`,target:"_blank",class:"h-7 w-7 rounded-full flex-shrink-0 hover:opacity-80 transition-opacity cursor-pointer"},[s.user.profile_photo_url?(a(),o("img",{key:0,src:s.user.profile_photo_url,alt:s.user.name,class:"h-7 w-7 rounded-full object-cover border border-gray-200 dark:border-gray-700"},null,8,Cd)):(a(),o("div",$d,[e("span",Md,n(s.user.name.charAt(0)),1)]))],8,_d),e("div",zd,[e("p",Bd,[w(n(s.user.name)+" ",1),s.type==="admin"?(a(),o("span",jd,"(Admin)")):u("",!0)]),e("div",Fd,[s.attachment?(a(),o("div",Ad,[$(be,{attachment:s.attachment,variant:"default","thumbnail-size":"sm"},null,8,["attachment"])])):u("",!0),s.message?(a(),o("p",Sd,n(s.message),1)):u("",!0)]),e("p",Ld,n(T(s.created_at)),1)])],64)):(a(),o(E,{key:2},[e("div",Vd,[e("p",Ed,[w(n(s.user.name)+" ",1),s.type==="admin"?(a(),o("span",Id,"(Admin)")):u("",!0)]),e("div",Td,[s.attachment?(a(),o("div",Pd,[$(be,{attachment:s.attachment,variant:"primary","thumbnail-size":"sm"},null,8,["attachment"])])):u("",!0),s.message?(a(),o("p",Ud,n(s.message),1)):u("",!0)]),e("p",Dd,n(T(s.created_at)),1)]),l.$page.props.auth.user?.profile_photo_url?(a(),o("img",{key:0,src:l.$page.props.auth.user.profile_photo_url,alt:l.$page.props.auth.user.name,class:"h-7 w-7 rounded-full object-cover border border-gray-200 dark:border-gray-700 flex-shrink-0"},null,8,qd)):(a(),o("div",Rd,[e("span",Hd,n(l.$page.props.auth.user?.name?.charAt(0).toUpperCase()||"U"),1)]))],64))],2))),128))])],512),e("div",Wd,[e("div",Od,[B.value||F.value?(a(),o("div",Nd,[F.value?(a(),o("div",Kd,[...t[171]||(t[171]=[e("div",{class:"flex-shrink-0"},[e("div",{class:"animate-spin h-12 w-12 border-4 border-blue-600 border-t-transparent rounded-full"})],-1),e("div",{class:"flex-1 min-w-0"},[e("p",{class:"text-sm font-medium text-gray-900 dark:text-gray-200"},"正在压缩图片..."),e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"优化中")],-1)])])):B.value?(a(),o("div",Xd,[e("div",Jd,[P.value&&B.value.type.startsWith("image/")?(a(),o("img",{key:0,src:P.value,class:"w-12 h-12 object-cover rounded border",alt:"预览"},null,8,Gd)):(a(),o("div",Qd,[...t[172]||(t[172]=[e("svg",{class:"w-6 h-6 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-5L9 2H4z","clip-rule":"evenodd"})],-1)])]))]),e("div",Zd,[e("p",Yd,n(B.value.name),1),e("p",en,n(Ve(B.value.size)),1)]),e("button",{onClick:Ce,type:"button",class:"flex-shrink-0 p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors"},[...t[173]||(t[173]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):u("",!0)])):u("",!0),e("form",{onSubmit:K(Ie,["prevent"]),class:"flex items-center gap-1"},[e("input",{ref_key:"mobileFileInput",ref:f,type:"file",onChange:Ee,accept:".pdf,image/*","data-max-size":"2097152",class:"hidden"},null,544),e("div",tn,[e("button",{type:"button",onClick:t[31]||(t[31]=s=>!X.value&&!F.value&&l.$refs.mobileFileInput.click()),disabled:X.value||F.value,class:"p-2 rounded text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[...t[174]||(t[174]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)])],8,rn),$(qe,{onSelect:t[32]||(t[32]=s=>C.value+=s),disabled:X.value,placement:"top"},null,8,["disabled"])]),N(e("input",{"onUpdate:modelValue":t[33]||(t[33]=s=>C.value=s),type:"text",placeholder:X.value?"交易已结束":"输入消息...",class:"flex-1 px-3 py-2 bg-gray-100 dark:bg-gray-800 border-0 rounded text-sm text-gray-900 dark:text-gray-200 placeholder-gray-500 dark:placeholder-gray-400 focus:bg-white dark:focus:bg-gray-700 focus:ring-2 focus:ring-emerald-500 focus:outline-none disabled:opacity-50 transition-colors",disabled:!g.value||X.value},null,8,sn),[[te,C.value]]),e("button",{type:"submit",disabled:!C.value.trim()&&!B.value||!g.value||_.value||X.value,class:"px-3 py-2 bg-emerald-600 disabled:bg-gray-400 text-white rounded font-medium text-sm transition-colors"},[_.value?(a(),o("svg",on,[...t[175]||(t[175]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(a(),o("span",ln,"发送"))],8,an)],32),r.availableActions.length>0&&r.order.status!=="completed"&&r.order.status!=="cancelled"&&r.order.escrow_status!=="escrow_released"||r.order.status!=="cancelled"&&r.order.status!=="completed"?(a(),o("div",dn,[e("div",nn,[(a(!0),o(E,null,W(r.availableActions,s=>(a(),o(E,{key:s},[s==="vendor_confirm"?(a(),o("button",{key:0,onClick:t[34]||(t[34]=p=>A("vendor_confirm")),class:"px-3 py-1.5 bg-emerald-600 text-white text-xs font-medium rounded whitespace-nowrap cursor-pointer"}," 确认订单 ")):u("",!0),s==="mark_seller_paid"?(a(),o("button",{key:1,onClick:t[35]||(t[35]=p=>A("mark_seller_paid")),class:"px-3 py-1.5 bg-emerald-600 text-white text-xs font-medium rounded whitespace-nowrap cursor-pointer"}," 我已转币 ")):u("",!0),s==="confirm_escrow"?(a(),o("button",{key:2,onClick:t[36]||(t[36]=p=>A("confirm_escrow")),class:"px-3 py-1.5 bg-emerald-600 text-white text-xs font-medium rounded whitespace-nowrap cursor-pointer"}," 确认托管 ")):u("",!0),s==="mark_buyer_paid"?(a(),o("button",{key:3,onClick:t[37]||(t[37]=p=>A("mark_buyer_paid")),class:"px-3 py-1.5 bg-emerald-600 text-white text-xs font-medium rounded whitespace-nowrap cursor-pointer"}," 我已付款 ")):u("",!0),s==="mark_seller_received"?(a(),o("button",{key:4,onClick:t[38]||(t[38]=p=>A("mark_seller_received")),class:"px-3 py-1.5 bg-green-600 text-white text-xs font-medium rounded whitespace-nowrap cursor-pointer"}," 确认收款 ")):u("",!0),s==="cancel"?(a(),o("button",{key:5,onClick:t[39]||(t[39]=p=>A("cancel")),class:"px-3 py-1.5 bg-gray-600 text-white text-xs font-medium rounded whitespace-nowrap cursor-pointer"}," 取消订单 ")):u("",!0)],64))),128)),r.availableActions.includes("create_dispute")?(a(),o("button",{key:0,onClick:t[40]||(t[40]=s=>A("create_dispute")),class:"px-3 py-1.5 bg-amber-600 text-white text-xs font-medium rounded whitespace-nowrap cursor-pointer"}," 发起争议 ")):u("",!0),r.availableActions.includes("resolve_dispute")?(a(),o("button",{key:1,onClick:t[41]||(t[41]=s=>A("resolve_dispute")),class:"px-3 py-1.5 bg-green-600 text-white text-xs font-medium rounded whitespace-nowrap cursor-pointer"}," 解除争议 ")):u("",!0)]),r.order.status!=="cancelled"&&r.order.status!=="completed"?(a(),o("a",{key:0,href:"/notifications/settings",target:"_blank",class:x(["px-3 py-1.5 rounded inline-flex items-center justify-center cursor-pointer",l.$page.props.auth.user?.telegram_chat_id?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"bg-blue-500 text-white"]),title:l.$page.props.auth.user?.telegram_chat_id?"Telegram 通知已开启":"设置 Telegram 通知"},[...t[176]||(t[176]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.56c-.21 2.27-1.13 7.75-1.6 10.29-.2 1.08-.59 1.44-.97 1.47-.82.07-1.45-.54-2.24-.99-1.24-.71-1.94-1.16-3.14-1.85-1.39-.8-.49-1.24.3-1.96.21-.19 3.85-3.52 3.91-3.82.01-.04.01-.19-.07-.27-.08-.08-.2-.05-.28-.03-.12.03-2.02.13-5.7 3.75-.54.54-1.03.8-1.48.78-.49-.02-1.42-.27-2.11-.5-.85-.28-1.53-.42-1.47-.89.03-.25.37-.51 1.02-.77 4-1.74 6.67-2.89 8.01-3.44 3.81-1.57 4.61-1.84 5.13-1.85.11 0 .37.03.53.18.14.12.18.28.2.45-.01.06-.01.24-.02.38z"})],-1)])],10,un)):u("",!0)])):u("",!0),e("div",{onClick:t[42]||(t[42]=s=>y.value=!0),class:"mt-2 p-2 bg-gray-50 dark:bg-gray-800/50 rounded border border-gray-200 dark:border-gray-700 cursor-pointer active:bg-gray-100 dark:active:bg-gray-800 transition-colors"},[e("div",cn,[e("div",mn,[e("div",{class:x([Le(r.order.escrow_status),"w-2 h-2 rounded-full animate-pulse"])},null,2),e("span",xn,n(Se(r.order.escrow_status)),1)]),e("div",vn,[e("span",gn,n(r.order.crypto_amount)+" "+n(r.order.currency_label||r.order.currency_key),1),t[177]||(t[177]=e("svg",{class:"w-4 h-4 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))])])])])])])])]),$(se,{show:i.value.show&&i.value.pendingAction!=="confirm_escrow"&&i.value.pendingAction!=="mark_buyer_paid"&&i.value.pendingAction!=="mark_seller_received"&&i.value.pendingAction!=="mark_seller_paid",title:i.value.title,"confirm-text":i.value.confirmText,"cancel-text":i.value.cancelText,onConfirm:t[44]||(t[44]=()=>Ke(i.value.inputValue)),onClose:oe},{default:M(()=>[i.value.message?(a(),o("div",bn,n(i.value.message),1)):u("",!0),i.value.inputMode?(a(),o("div",yn,[i.value.inputLabel?(a(),o("label",fn,n(i.value.inputLabel),1)):u("",!0),N(e("input",{"onUpdate:modelValue":t[43]||(t[43]=s=>i.value.inputValue=s),type:"text",placeholder:i.value.inputPlaceholder,required:i.value.inputRequired,class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"},null,8,kn),[[te,i.value.inputValue]])])):u("",!0)]),_:1},8,["show","title","confirm-text","cancel-text"]),$(se,{show:i.value.pendingAction==="confirm_escrow"&&i.value.show,title:"确认托管到账",subtitle:"请仔细核对托管交易信息","icon-color":"amber","requires-agreement":!0,"agreement-disabled":!_e.value,"agreement-text":_e.value?"我已核对所有信息无误，确认托管已到账":"请先勾选上方所有确认项","confirm-text":"确认托管到账","cancel-text":"返回检查",persistent:i.value.loading,onConfirm:Je,onClose:oe},{default:M(()=>[e("div",pn,[e("div",hn,[e("div",wn,[d.value.seller_address?(a(),o("div",_n,[t[178]||(t[178]=e("label",{class:"text-xs text-gray-500 dark:text-gray-400"},"来源地址（卖家）",-1)),e("p",Cn,n(d.value.seller_address),1)])):u("",!0),d.value.escrow_address?(a(),o("div",$n,[t[179]||(t[179]=e("label",{class:"text-xs text-gray-500 dark:text-gray-400"},"托管地址",-1)),e("p",Mn,n(d.value.escrow_address),1)])):u("",!0),e("div",null,[t[180]||(t[180]=e("label",{class:"text-xs text-gray-500 dark:text-gray-400"},"交易金额",-1)),e("p",zn,n(parseFloat(d.value.crypto_amount).toFixed(4))+" "+n(d.value.currency_label||d.value.currency_key||d.value.crypto_currency),1)]),d.value.escrow_tx_hash?(a(),o("div",Bn,[t[181]||(t[181]=e("label",{class:"text-xs text-gray-500 dark:text-gray-400"},"交易哈希",-1)),e("p",jn,n(d.value.escrow_tx_hash),1)])):u("",!0)])]),t[189]||(t[189]=e("div",{class:"p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-medium text-amber-800 dark:text-amber-300"},"请打开区块链浏览器仔细核对"),e("p",{class:"text-amber-700 dark:text-amber-400 mt-1"}," 确认前必须逐项检查以下所有信息 ")])])],-1)),e("div",Fn,[t[188]||(t[188]=e("p",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"请确认以下所有项目：",-1)),e("div",An,[e("div",Sn,[N(e("input",{"onUpdate:modelValue":t[45]||(t[45]=s=>D.value.txExists=s),type:"checkbox",class:"mt-0.5 h-4 w-4 text-emerald-600 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 rounded focus:ring-emerald-500 focus:ring-2",disabled:i.value.loading},null,8,Ln),[[re,D.value.txExists]]),t[182]||(t[182]=e("label",{class:"ml-2 text-sm text-gray-700 dark:text-gray-300"}," 我已打开区块链浏览器，确认交易记录存在 ",-1))]),e("div",Vn,[N(e("input",{"onUpdate:modelValue":t[46]||(t[46]=s=>D.value.confirmations=s),type:"checkbox",class:"mt-0.5 h-4 w-4 text-emerald-600 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 rounded focus:ring-emerald-500 focus:ring-2",disabled:i.value.loading},null,8,En),[[re,D.value.confirmations]]),t[183]||(t[183]=e("label",{class:"ml-2 text-sm text-gray-700 dark:text-gray-300"}," 交易已有足够的确认数（建议至少6个确认） ",-1))]),e("div",In,[N(e("input",{"onUpdate:modelValue":t[47]||(t[47]=s=>D.value.fromAddress=s),type:"checkbox",class:"mt-0.5 h-4 w-4 text-emerald-600 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 rounded focus:ring-emerald-500 focus:ring-2",disabled:i.value.loading},null,8,Tn),[[re,D.value.fromAddress]]),e("label",Pn,[t[184]||(t[184]=w(" 来源地址与卖家地址完全一致 ",-1)),e("span",Un,n(d.value.seller_address||"无卖家地址"),1)])]),e("div",Dn,[N(e("input",{"onUpdate:modelValue":t[48]||(t[48]=s=>D.value.toAddress=s),type:"checkbox",class:"mt-0.5 h-4 w-4 text-emerald-600 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 rounded focus:ring-emerald-500 focus:ring-2",disabled:i.value.loading},null,8,qn),[[re,D.value.toAddress]]),e("label",Rn,[t[185]||(t[185]=w(" 目标地址与托管地址完全一致 ",-1)),e("span",Hn,n(d.value.escrow_address||"托管地址待分配"),1)])]),e("div",Wn,[N(e("input",{"onUpdate:modelValue":t[49]||(t[49]=s=>D.value.amount=s),type:"checkbox",class:"mt-0.5 h-4 w-4 text-emerald-600 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 rounded focus:ring-emerald-500 focus:ring-2",disabled:i.value.loading},null,8,On),[[re,D.value.amount]]),e("label",Nn,[t[186]||(t[186]=w(" 交易金额为 ",-1)),e("span",Kn,n(parseFloat(d.value.crypto_amount).toFixed(4))+" "+n(d.value.currency_label||d.value.currency_key||d.value.crypto_currency),1),t[187]||(t[187]=w("，完全正确 ",-1))])])])]),t[190]||(t[190]=e("div",{class:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-bold text-red-800 dark:text-red-300"},"最终确认"),e("p",{class:"text-red-700 dark:text-red-400 mt-1"}," 确认后您将进入付款阶段，必须按时完成付款。如信息有误导致的损失，责任自负！ ")])])],-1))])]),_:1},8,["show","agreement-disabled","agreement-text","persistent"]),$(se,{show:i.value.pendingAction==="mark_seller_paid"&&i.value.show,title:"标记已转币到托管",subtitle:"请确认您已将币转入托管地址","icon-color":"blue","requires-agreement":!0,"agreement-text":"我已仔细核对金额和地址，确认转币信息无误","confirm-text":"确认已转币","cancel-text":"返回",persistent:i.value.loading,onConfirm:Ge,onClose:oe},{default:M(()=>[e("div",Xn,[e("div",null,[t[191]||(t[191]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[w(" 交易哈希 (TX ID) "),e("span",{class:"text-red-500"},"*")],-1)),N(e("input",{"onUpdate:modelValue":t[50]||(t[50]=s=>ee.value=s),type:"text",placeholder:"请输入区块链交易哈希...",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",disabled:i.value.loading},null,8,Jn),[[te,ee.value]]),t[192]||(t[192]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 转币后请提供交易哈希作为凭证 ",-1))]),d.value.seller_address?(a(),o("div",Gn,[e("div",Qn,[e("div",null,[t[193]||(t[193]=e("label",{class:"text-xs text-gray-500 dark:text-gray-400"},"您的地址",-1)),e("p",Zn,n(d.value.seller_address),1)]),e("div",null,[t[194]||(t[194]=e("label",{class:"text-xs text-gray-500 dark:text-gray-400"},"转币金额",-1)),e("p",Yn,n(parseFloat(d.value.crypto_amount).toFixed(4))+" "+n(d.value.currency_label||d.value.currency_key||d.value.crypto_currency),1)])])])):u("",!0),t[195]||(t[195]=e("div",{class:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-medium text-blue-800 dark:text-blue-300"},"托管地址提示"),e("p",{class:"text-blue-700 dark:text-blue-400 mt-1"}," 托管地址功能正在开发中，请先将币转到您自己的地址保管 ")])])],-1)),t[196]||(t[196]=e("div",{class:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-bold text-red-800 dark:text-red-300 text-sm"},"极其重要！请仔细核对！"),e("ul",{class:"mt-1 space-y-1 text-red-700 dark:text-red-400"},[e("li",null,"• 请确保转币地址完全正确"),e("li",null,[w("• "),e("span",{class:"font-bold"},"请一定要确保金额是一次性从您的地址转入，否则系统无法确认")]),e("li",null,"• 请确保转币金额准确无误"),e("li",null,[w("• "),e("span",{class:"font-bold"},"如果地址或金额错误，托管将无法确认！")]),e("li",null,[w("• "),e("span",{class:"font-bold text-red-800 dark:text-red-200"},"任何损失概不负责！")])])])])],-1))])]),_:1},8,["show","persistent"]),$(se,{show:i.value.pendingAction==="mark_buyer_paid"&&i.value.show,title:"标记已付款",subtitle:`请确认您已向卖家付款 ¥${parseFloat(r.order.fiat_amount).toFixed(2)}`,"icon-color":"emerald","requires-agreement":r.userHas2FA,"agreement-disabled":r.userHas2FA&&(!i.value.twoFactorCode||i.value.twoFactorCode.length!==6),"agreement-text":r.userHas2FA?i.value.twoFactorCode&&i.value.twoFactorCode.length===6?"我确认已完成付款，理解虚假付款将导致账户封禁":"请先输入6位验证码":"","confirm-text":r.userHas2FA?"确认已付款":"前往启用双重验证","cancel-text":"返回",persistent:i.value.loading,onConfirm:t[53]||(t[53]=s=>r.userHas2FA?Xe():Be(H).visit("/user/profile#tab-2fa")),onClose:oe},{default:M(()=>[e("div",ei,[e("div",null,[t[197]||(t[197]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 付款说明（可选） ",-1)),N(e("textarea",{"onUpdate:modelValue":t[51]||(t[51]=s=>Y.value=s),rows:"3",class:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"请输入付款凭证或说明，如转账单号...",disabled:i.value.loading},null,8,ti),[[te,Y.value]])]),r.userHas2FA?(a(),o("div",ri,[$(De,{modelValue:i.value.twoFactorCode,"onUpdate:modelValue":t[52]||(t[52]=s=>i.value.twoFactorCode=s),error:i.value.twoFactorError,disabled:i.value.loading,onComplete:Te},null,8,["modelValue","error","disabled"])])):(a(),o("div",si,[...t[198]||(t[198]=[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-medium text-amber-800 dark:text-amber-300"},"需要双重验证"),e("p",{class:"text-amber-700 dark:text-amber-400 mt-1"}," 为保护您的资金安全，买家付款必须启用双重验证 ")])],-1)])])),r.userHas2FA?(a(),o("div",ai,[...t[199]||(t[199]=[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-medium text-red-800 dark:text-red-300"},"注意事项"),e("p",{class:"text-red-700 dark:text-red-400 mt-1"}," 请确保已完成付款再点击确认，虚假付款将导致账户封禁 ")])],-1)])])):u("",!0)])]),_:1},8,["show","subtitle","requires-agreement","agreement-disabled","agreement-text","confirm-text","persistent"]),$(se,{show:i.value.pendingAction==="mark_seller_received"&&i.value.show,title:"确认收款",subtitle:`请确认您已收到买家付款 ¥${parseFloat(r.order.fiat_amount).toFixed(2)}`,"icon-color":"emerald","requires-agreement":r.userHas2FA,"agreement-disabled":r.userHas2FA&&(!i.value.twoFactorCode||i.value.twoFactorCode.length!==6),"agreement-text":r.userHas2FA?i.value.twoFactorCode&&i.value.twoFactorCode.length===6?"我确认已收到款项，同意释放托管的加密货币给买家":"请先输入6位验证码":"","confirm-text":r.userHas2FA?"确认收款":"前往启用双重验证","cancel-text":"返回",persistent:i.value.loading,onConfirm:t[55]||(t[55]=s=>r.userHas2FA?Qe():Be(H).visit("/user/profile#tab-2fa")),onClose:oe},{default:M(()=>[e("div",oi,[r.userHas2FA?(a(),o("div",li,[$(De,{modelValue:i.value.twoFactorCode,"onUpdate:modelValue":t[54]||(t[54]=s=>i.value.twoFactorCode=s),error:i.value.twoFactorError,disabled:i.value.loading,onComplete:Te},null,8,["modelValue","error","disabled"])])):(a(),o("div",di,[...t[200]||(t[200]=[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-medium text-amber-800 dark:text-amber-300"},"需要双重验证"),e("p",{class:"text-amber-700 dark:text-amber-400 mt-1"}," 为保护您的资金安全，卖家确认收款必须启用双重验证 ")])],-1)])])),r.userHas2FA?(a(),o("div",ni,[...t[201]||(t[201]=[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-medium text-red-800 dark:text-red-300"},"重要提醒"),e("p",{class:"text-red-700 dark:text-red-400 mt-1"}," 确认收款后，托管的加密货币将立即释放给买家，此操作不可撤销 ")])],-1)])])):u("",!0)])]),_:1},8,["show","subtitle","requires-agreement","agreement-disabled","agreement-text","confirm-text","persistent"]),$(je,{modelValue:v.value,"onUpdate:modelValue":t[56]||(t[56]=s=>v.value=s),title:"商家交易条款",subtitle:`订单 #${r.order.order_no}`,position:"bottom",size:"default","icon-color":"purple"},{"header-icon":M(()=>[...t[202]||(t[202]=[e("div",{class:"p-2 rounded bg-purple-100 dark:bg-purple-900/30"},[e("svg",{class:"w-5 h-5 text-purple-600 dark:text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)])]),default:M(()=>[e("div",ii,[r.order.ad_snapshot?.vendor_toc?(a(),o("div",ui,[e("p",ci,n(r.order.ad_snapshot?.vendor_toc),1)])):(a(),o("div",mi,[...t[203]||(t[203]=[e("p",{class:"text-sm text-gray-500 dark:text-gray-400 text-center"},"商家未设置交易条款",-1)])])),t[204]||(t[204]=e("div",{class:"mt-4 p-3 bg-amber-50 dark:bg-amber-900/20 rounded border border-amber-200 dark:border-amber-800"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("p",{class:"text-xs text-amber-700 dark:text-amber-300"}," 请仔细阅读并遵守以上交易条款，违反条款可能导致交易取消 ")])],-1))])]),_:1},8,["modelValue","subtitle"])]),_:1},8,["breadcrumbs"]),$(gr,{modelValue:b.value,"onUpdate:modelValue":t[57]||(t[57]=s=>b.value=s),"order-id":d.value.id,"order-no":d.value.order_no,"vendor-name":d.value.vendor?.name||"商家","fiat-amount":d.value.fiat_amount,"fiat-currency":d.value.fiat_currency,"crypto-amount":d.value.crypto_amount,"crypto-currency":d.value.currency_key||d.value.crypto_currency,onSuccess:Ne},null,8,["modelValue","order-id","order-no","vendor-name","fiat-amount","fiat-currency","crypto-amount","crypto-currency"])],64))}};export{ki as default};
