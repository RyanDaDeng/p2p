import{r as v,P as E,f as r,o,a as n,b as l,k as H,w as a,t as A,N as B,C as I,E as R,u as U,d as D,g as G,c as _,l as u,q as m,p as x,F as Q,s as j,x as P}from"./app-DbceyKiQ.js";import{_ as z}from"./ActionSection-DFJz7AvU.js";import{_ as J}from"./P2PDialog-CybDgnhH.js";import{_ as K}from"./InputError-DT2EIBKK.js";import{_ as q}from"./P2PTextInput-BRWFi5eh.js";import{_ as O}from"./InputLabel-CM_KWSD-.js";import{_ as w}from"./P2PButton-Bv53y3cD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"text-left"},X={class:"mb-4 text-gray-700 dark:text-gray-300"},k={__name:"P2PConfirmsPassword",props:{title:{type:String,default:"确认密码"},content:{type:String,default:"为了您的安全，请确认您的密码以继续。"},button:{type:String,default:"确认"}},emits:["confirmed"],setup(b,{emit:S}){const h=S,i=v(!1),e=E({password:"",error:"",processing:!1}),d=v(null),g=()=>{axios.get(route("password.confirmation")).then(s=>{s.data.confirmed?h("confirmed"):(i.value=!0,setTimeout(()=>d.value?.focus(),250))})},p=()=>{e.processing=!0,axios.post(route("password.confirm"),{password:e.password}).then(()=>{e.processing=!1,f(),I().then(()=>h("confirmed"))}).catch(s=>{e.processing=!1,e.error=s.response.data.errors.password[0],d.value?.focus()})},f=()=>{i.value=!1,e.password="",e.error=""};return(s,c)=>(o(),r("span",null,[n("span",{onClick:g},[H(s.$slots,"default")]),l(J,{show:i.value,title:b.title,"icon-color":"amber","confirm-text":b.button,"cancel-text":"取消",onConfirm:p,onClose:f},{default:a(()=>[n("div",W,[n("p",X,A(b.content),1),l(q,{ref_key:"passwordInput",ref:d,modelValue:e.password,"onUpdate:modelValue":c[0]||(c[0]=F=>e.password=F),type:"password",placeholder:"密码",autocomplete:"current-password",onKeyup:B(p,["enter"]),variant:e.error?"error":"default"},null,8,["modelValue","variant"]),l(K,{message:e.error,class:"mt-2"},null,8,["message"])])]),_:1},8,["show","title","confirm-text"])]))}},Y={key:0,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},Z={key:1,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},ee={key:2,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},te={key:3},oe={key:0},ae={class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},se={key:0,class:"font-semibold"},re={key:1},ne=["innerHTML"],le={key:0,class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},ie={class:"font-semibold"},de=["innerHTML"],ue={key:1,class:"mt-4"},ce={key:1},me={class:"grid gap-1 max-w-xl mt-4 px-4 py-4 font-mono text-sm bg-gray-100 dark:bg-gray-900 dark:text-gray-100 rounded-lg"},fe={class:"mt-5"},ve={key:0},pe={key:1},Ce={__name:"TwoFactorAuthenticationForm",props:{requiresConfirmation:Boolean},setup(b){const S=b,h=R(),i=v(!1),e=v(!1),d=v(!1),g=v(null),p=v(null),f=v([]),s=U({code:""}),c=D(()=>!i.value&&h.props.auth.user?.two_factor_enabled);G(c,()=>{c.value||(s.reset(),s.clearErrors())});const F=()=>{i.value=!0,P.post(route("two-factor.enable"),{},{preserveScroll:!0,onSuccess:()=>Promise.all([L(),M(),T()]),onFinish:()=>{i.value=!1,e.value=S.requiresConfirmation}})},L=()=>axios.get(route("two-factor.qr-code")).then(y=>{g.value=y.data.svg}),M=()=>axios.get(route("two-factor.secret-key")).then(y=>{p.value=y.data.secretKey}),T=()=>axios.get(route("two-factor.recovery-codes")).then(y=>{f.value=y.data}),V=()=>{s.post(route("two-factor.confirm"),{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{e.value=!1,g.value=null,p.value=null}})},N=()=>{axios.post(route("two-factor.recovery-codes")).then(()=>T())},$=()=>{d.value=!0,P.delete(route("two-factor.disable"),{preserveScroll:!0,onSuccess:()=>{d.value=!1,e.value=!1}})};return(y,t)=>(o(),_(z,null,{title:a(()=>[...t[1]||(t[1]=[m(" 双重验证 ",-1)])]),description:a(()=>[...t[2]||(t[2]=[m(" 使用双重验证为您的账户增加额外的安全保护 ",-1)])]),content:a(()=>[c.value&&!e.value?(o(),r("h3",Y," 您已启用双重验证 ")):c.value&&e.value?(o(),r("h3",Z," 完成双重验证设置 ")):(o(),r("h3",ee," 您尚未启用双重验证 ")),t[11]||(t[11]=n("div",{class:"mt-3 max-w-xl text-sm text-gray-600 dark:text-gray-400"},[n("p",null," 启用双重验证后，登录时需要输入手机验证器应用生成的安全令牌。您可以使用 Google Authenticator 或其他验证器应用获取此令牌。 ")],-1)),c.value?(o(),r("div",te,[g.value?(o(),r("div",oe,[n("div",ae,[e.value?(o(),r("p",se," 要完成双重验证设置，请使用手机验证器应用扫描下方二维码，或手动输入设置密钥，然后提供生成的验证码。 ")):(o(),r("p",re," 双重验证已启用。请使用手机验证器应用扫描下方二维码，或手动输入设置密钥。 "))]),n("div",{class:"mt-4 p-2 inline-block bg-white",innerHTML:g.value},null,8,ne),p.value?(o(),r("div",le,[n("p",ie,[t[3]||(t[3]=m(" 设置密钥：",-1)),n("span",{innerHTML:p.value},null,8,de)])])):u("",!0),e.value?(o(),r("div",ue,[l(O,{for:"code",value:"验证码"}),l(q,{id:"code",modelValue:x(s).code,"onUpdate:modelValue":t[0]||(t[0]=C=>x(s).code=C),type:"text",name:"code",inputmode:"numeric",placeholder:"输入6位验证码",autofocus:"",autocomplete:"one-time-code",onKeyup:B(V,["enter"]),variant:x(s).errors.code?"error":"default"},null,8,["modelValue","variant"]),l(K,{message:x(s).errors.code,class:"mt-2"},null,8,["message"])])):u("",!0)])):u("",!0),f.value.length>0&&!e.value?(o(),r("div",ce,[t[4]||(t[4]=n("div",{class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},[n("p",{class:"font-semibold"}," 请将这些恢复代码保存在安全的密码管理器中。如果您的双重验证设备丢失，可以使用这些代码恢复账户访问权限。 ")],-1)),n("div",me,[(o(!0),r(Q,null,j(f.value,C=>(o(),r("div",{key:C},A(C),1))),128))])])):u("",!0)])):u("",!0),n("div",fe,[c.value?(o(),r("div",pe,[l(k,{onConfirmed:V},{default:a(()=>[e.value?(o(),_(w,{key:0,variant:"primary",type:"button",class:"me-3",loading:i.value||x(s).processing,disabled:i.value||x(s).processing},{default:a(()=>[...t[6]||(t[6]=[m(" 确认 ",-1)])]),_:1},8,["loading","disabled"])):u("",!0)]),_:1}),l(k,{onConfirmed:N},{default:a(()=>[f.value.length>0&&!e.value?(o(),_(w,{key:0,variant:"secondary",class:"me-3"},{default:a(()=>[...t[7]||(t[7]=[m(" 重新生成恢复代码 ",-1)])]),_:1})):u("",!0)]),_:1}),l(k,{onConfirmed:T},{default:a(()=>[f.value.length===0&&!e.value?(o(),_(w,{key:0,variant:"secondary",class:"me-3"},{default:a(()=>[...t[8]||(t[8]=[m(" 显示恢复代码 ",-1)])]),_:1})):u("",!0)]),_:1}),l(k,{onConfirmed:$},{default:a(()=>[e.value?(o(),_(w,{key:0,variant:"ghost",loading:d.value,disabled:d.value},{default:a(()=>[...t[9]||(t[9]=[m(" 取消 ",-1)])]),_:1},8,["loading","disabled"])):u("",!0)]),_:1}),l(k,{onConfirmed:$},{default:a(()=>[e.value?u("",!0):(o(),_(w,{key:0,variant:"danger",loading:d.value,disabled:d.value},{default:a(()=>[...t[10]||(t[10]=[m(" 禁用 ",-1)])]),_:1},8,["loading","disabled"]))]),_:1})])):(o(),r("div",ve,[l(k,{onConfirmed:F},{default:a(()=>[l(w,{variant:"primary",type:"button",loading:i.value,disabled:i.value},{default:a(()=>[...t[5]||(t[5]=[m(" 启用 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]))])]),_:1}))}};export{Ce as default};
