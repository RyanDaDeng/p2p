import{d as D,I as le,y as be,D as Me,c as j,o as a,b,w as x,f as o,h as u,T as Ce,n as f,a as e,r as re,J as qe,t as d,H as We,l as U,g as C,j as c,N as Re,x as ce,F as E,k as X,e as R,q as te,v as Y,M as J,K as P,B as He,L as ve,i as fe,z as Pe,p as $e}from"./app-CicXSMAK.js";import{P as De}from"./P2PAppLayout-BdNAnacM.js";import{_ as v}from"./P2PButton-CF-FD2L-.js";import{_ as se}from"./Modal-CZi9litT.js";import{_ as Ne}from"./P2PTextInput-DS4gGTjw.js";import"./useConfig-oSxxd1UA.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Oe={class:"flex-shrink-0 bg-white dark:bg-slate-900 border-b border-gray-200 dark:border-slate-800 px-4 py-3"},Ke={class:"flex items-center justify-between"},Xe={key:0,class:"absolute top-2 left-1/2 -translate-x-1/2 w-12 h-1 bg-gray-300 dark:bg-slate-600 rounded-full"},Ge={class:"flex items-center gap-3"},Je={class:"text-lg font-bold text-gray-900 dark:text-slate-100"},Qe={key:0,class:"text-xs text-gray-500 dark:text-slate-400"},Ye={key:0,class:"flex-shrink-0 bg-white dark:bg-slate-900 border-t border-gray-200 dark:border-slate-800 p-4"},Ze={__name:"P2PMobileDrawer",props:{modelValue:{type:Boolean,default:!1},title:{type:String,default:"详情"},subtitle:{type:String,default:""},position:{type:String,default:"bottom",validator:s=>["bottom","right","left"].includes(s)},size:{type:String,default:"default",validator:s=>["small","default","large","full"].includes(s)},icon:{type:[Object,String],default:null},iconColor:{type:String,default:"blue",validator:s=>["blue","emerald","amber","red","purple"].includes(s)},persistent:{type:Boolean,default:!1},scrollable:{type:Boolean,default:!0}},emits:["update:modelValue","open","close"],setup(s,{emit:h}){const $=s,F=h,i=D(()=>({bottom:"bottom-0 left-0 right-0 rounded-t-2xl",right:"top-0 right-0 bottom-0 rounded-l-2xl",left:"top-0 left-0 bottom-0 rounded-r-2xl"})[$.position]),_=D(()=>$.position==="bottom"?{small:"max-h-[40vh]",default:"max-h-[70vh]",large:"max-h-[85vh]",full:"h-full"}[$.size]:{small:"w-64",default:"w-80",large:"w-96",full:"w-full"}[$.size]),w=D(()=>{let m=["flex-1","min-h-0"];return $.scrollable&&m.push("overflow-y-auto"),m.join(" ")}),B=D(()=>({bottom:{from:"translate-y-full",to:"translate-y-0"},right:{from:"translate-x-full",to:"translate-x-0"},left:{from:"-translate-x-full",to:"translate-x-0"}})[$.position]),y=D(()=>({blue:"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400",emerald:"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400",amber:"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400",red:"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400",purple:"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"})[$.iconColor]),A=()=>{$.persistent||(F("update:modelValue",!1),F("close"))},N=m=>{m.key==="Escape"&&$.modelValue&&!$.persistent&&A()},I=m=>{m?document.body.style.overflow="hidden":document.body.style.overflow=""};return le(()=>$.modelValue,m=>{I(m),m&&F("open")}),be(()=>{document.addEventListener("keydown",N)}),Me(()=>{document.removeEventListener("keydown",N),I(!1)}),(m,p)=>(a(),j(We,{to:"body"},[b(Ce,{"enter-active-class":"transition-opacity ease-out duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity ease-in duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:x(()=>[s.modelValue?(a(),o("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] lg:hidden",onClick:A})):u("",!0)]),_:1}),b(Ce,{"enter-active-class":"transition-transform ease-out duration-300","enter-from-class":B.value.from,"enter-to-class":B.value.to,"leave-active-class":"transition-transform ease-in duration-200","leave-from-class":B.value.to,"leave-to-class":B.value.from},{default:x(()=>[s.modelValue?(a(),o("div",{key:0,class:f(["fixed z-[70] bg-white dark:bg-slate-900 shadow-2xl lg:hidden flex flex-col",i.value,_.value])},[e("div",Oe,[e("div",Ke,[s.position==="bottom"?(a(),o("div",Xe)):u("",!0),e("div",Ge,[re(m.$slots,"header-icon",{},()=>[s.icon?(a(),o("div",{key:0,class:f(["p-2 rounded-lg",y.value])},[(a(),j(qe(s.icon),{class:"w-5 h-5"}))],2)):u("",!0)]),e("div",null,[e("h3",Je,d(s.title),1),s.subtitle?(a(),o("p",Qe,d(s.subtitle),1)):u("",!0)])]),e("button",{onClick:A,class:"p-2 rounded-lg text-gray-500 dark:text-slate-400 hover:text-gray-700 dark:hover:text-slate-200 hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors"},[...p[0]||(p[0]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",{class:f(w.value)},[re(m.$slots,"default")],2),m.$slots.footer?(a(),o("div",Ye,[re(m.$slots,"footer")])):u("",!0)],2)):u("",!0)]),_:3},8,["enter-from-class","enter-to-class","leave-from-class","leave-to-class"])]))}},et={class:"md:hidden sticky top-0 z-50 bg-white dark:bg-slate-900 border-b border-gray-200 dark:border-slate-800"},tt={class:"flex items-center justify-between h-14 px-4"},st={class:"flex items-center gap-3 flex-1"},rt={class:"text-base font-semibold text-gray-900 dark:text-slate-100"},at={key:0,class:"text-xs text-gray-500 dark:text-slate-400"},lt={class:"flex items-center gap-1"},ot={__name:"P2PMobileHeader",props:{title:{type:String,required:!0},subtitle:{type:String,default:""},backUrl:{type:String,default:null}},setup(s){const h=s,$=()=>{h.backUrl?U.visit(h.backUrl):window.history.back()};return(F,i)=>(a(),o("div",et,[e("div",tt,[e("div",st,[e("button",{onClick:$,class:"p-2 -ml-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors"},[...i[0]||(i[0]=[e("svg",{class:"w-5 h-5 text-gray-700 dark:text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),re(F.$slots,"custom",{},()=>[e("div",null,[e("h1",rt,d(s.title),1),s.subtitle?(a(),o("p",at,d(s.subtitle),1)):u("",!0)])])]),e("div",lt,[re(F.$slots,"actions")])])]))}},dt={class:"p-6"},it={key:0,class:"h-6 w-6 text-red-600 dark:text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},nt={key:1,class:"h-6 w-6 text-emerald-600 dark:text-emerald-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ut={class:"mt-3 text-center"},ct={class:"text-lg font-semibold text-slate-900 dark:text-slate-100"},xt={key:0,class:"mt-3 text-sm text-slate-600 dark:text-slate-400"},mt={key:1,class:"mt-4"},vt={key:0,class:"block text-sm font-medium text-slate-700 dark:text-slate-300 text-left mb-2"},ft={key:0,class:"text-red-500"},bt={key:2,class:"mt-3 text-sm text-slate-600 dark:text-slate-400"},gt={class:"px-6 py-4 bg-slate-50 dark:bg-slate-900/50 border-t border-slate-200 dark:border-slate-800 flex items-center justify-end space-x-3"},kt={__name:"P2PDialog",props:{show:{type:Boolean,default:!1},title:{type:String,default:"确认操作"},message:{type:String,default:""},confirmText:{type:String,default:"确认"},cancelText:{type:String,default:"取消"},confirmVariant:{type:String,default:"primary"},danger:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},inputMode:{type:Boolean,default:!1},inputLabel:{type:String,default:""},inputPlaceholder:{type:String,default:"请输入..."},inputRequired:{type:Boolean,default:!1},inputType:{type:String,default:"text"}},emits:["confirm","cancel","close"],setup(s,{emit:h}){const $=s,F=h,i=C("");le(()=>$.show,B=>{B&&(i.value="")});const _=()=>{if($.inputMode){if($.inputRequired&&!i.value.trim())return;F("confirm",i.value)}else F("confirm")},w=()=>{F("cancel"),F("close")};return(B,y)=>(a(),j(se,{show:s.show,closeable:!s.loading,"max-width":"md",onClose:w},{default:x(()=>[e("div",dt,[e("div",{class:f(["mx-auto flex items-center justify-center h-12 w-12 rounded-full",s.danger?"bg-red-100 dark:bg-red-900/30":"bg-emerald-100 dark:bg-emerald-900/30"])},[s.danger?(a(),o("svg",it,[...y[1]||(y[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"},null,-1)])])):(a(),o("svg",nt,[...y[2]||(y[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])]))],2),e("div",ut,[e("h3",ct,d(s.title),1),s.message?(a(),o("div",xt,[e("p",null,d(s.message),1)])):u("",!0),s.inputMode?(a(),o("div",mt,[s.inputLabel?(a(),o("label",vt,[c(d(s.inputLabel)+" ",1),s.inputRequired?(a(),o("span",ft,"*")):u("",!0)])):u("",!0),b(Ne,{modelValue:i.value,"onUpdate:modelValue":y[0]||(y[0]=A=>i.value=A),type:s.inputType,placeholder:s.inputPlaceholder,required:s.inputRequired,class:"w-full",onKeyup:Re(_,["enter"])},null,8,["modelValue","type","placeholder","required"])])):u("",!0),B.$slots.default?(a(),o("div",bt,[re(B.$slots,"default")])):u("",!0)])]),e("div",gt,[b(v,{variant:"ghost",disabled:s.loading,onClick:w},{default:x(()=>[c(d(s.cancelText),1)]),_:1},8,["disabled"]),b(v,{variant:s.danger?"danger":s.confirmVariant,loading:s.loading,disabled:s.loading||s.inputMode&&s.inputRequired&&!i.value.trim(),onClick:_},{default:x(()=>[c(d(s.confirmText),1)]),_:1},8,["variant","loading","disabled"])])]),_:3},8,["show","closeable"]))}},yt={class:"space-y-3"},pt={class:"flex items-center gap-2"},wt={class:"text-sm font-medium text-gray-700 dark:text-slate-300"},ht={class:"flex gap-2 justify-center"},_t=["onUpdate:modelValue","onInput","onKeydown","disabled"],Ct={key:0,class:"text-xs text-red-600 dark:text-red-400 text-center"},$t={key:1,class:"text-xs text-gray-500 dark:text-slate-400 text-center"},zt={key:2,class:"text-center"},ze={__name:"P2PTwoFactorInput",props:{modelValue:{type:String,default:""},label:{type:String,default:"双重验证码"},error:{type:String,default:""},helpText:{type:String,default:"请输入您的验证器应用中显示的6位数字"},disabled:{type:Boolean,default:!1},showRecoveryOption:{type:Boolean,default:!1},autoFocus:{type:Boolean,default:!0}},emits:["update:modelValue","complete","use-recovery"],setup(s,{expose:h,emit:$}){const F=s,i=$,_=C(["","","","","",""]),w=C([]);le(_,m=>{const p=m.join("");i("update:modelValue",p),p.length===6&&/^\d{6}$/.test(p)&&i("complete",p)},{deep:!0}),le(()=>F.modelValue,m=>{if(m==="")_.value=["","","","","",""];else if(m.length<=6){const p=m.split("");for(let S=0;S<6;S++)_.value[S]=p[S]||""}});const B=(m,p)=>{const S=p.target.value;if(!/^\d*$/.test(S)){p.target.value=_.value[m];return}S&&m<5&&ce(()=>{w.value[m+1]?.focus(),w.value[m+1]?.select()})},y=(m,p)=>{p.key==="Backspace"?!_.value[m]&&m>0&&(p.preventDefault(),_.value[m-1]="",w.value[m-1]?.focus()):p.key==="ArrowLeft"&&m>0?(p.preventDefault(),w.value[m-1]?.focus()):p.key==="ArrowRight"&&m<5&&(p.preventDefault(),w.value[m+1]?.focus())},A=m=>{m.preventDefault();const S=m.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(S){const q=S.split("");for(let k=0;k<6;k++)_.value[k]=q[k]||"";const L=Math.min(q.length,5);w.value[L]?.focus()}},N=()=>{_.value=["","","","","",""],w.value[0]?.focus()},I=()=>{w.value[0]?.focus()};return be(()=>{F.autoFocus&&ce(()=>{w.value[0]?.focus()})}),h({clear:N,focus:I}),(m,p)=>(a(),o("div",yt,[e("div",pt,[p[2]||(p[2]=e("svg",{class:"w-5 h-5 text-emerald-600 dark:text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})],-1)),e("label",wt,d(s.label||"双重验证码"),1)]),e("div",ht,[(a(!0),o(E,null,X(_.value,(S,q)=>R((a(),o("input",{key:q,ref_for:!0,ref:L=>w.value[q]=L,"onUpdate:modelValue":L=>_.value[q]=L,type:"text",inputmode:"numeric",maxlength:"1",class:f(["w-12 h-12 text-center text-lg font-mono font-bold rounded-lg border-2 transition-all duration-200",[s.error?"border-red-500 bg-red-50 dark:bg-red-900/20 text-red-900 dark:text-red-200":"border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-slate-100 focus:border-emerald-500 dark:focus:border-emerald-400"]]),onInput:L=>B(q,L),onKeydown:L=>y(q,L),onPaste:p[0]||(p[0]=L=>A(L)),disabled:s.disabled},null,42,_t)),[[te,_.value[q]]])),128))]),s.error?(a(),o("p",Ct,d(s.error),1)):u("",!0),s.helpText&&!s.error?(a(),o("p",$t,d(s.helpText),1)):u("",!0),s.showRecoveryOption?(a(),o("div",zt,[e("button",{type:"button",onClick:p[1]||(p[1]=S=>m.$emit("use-recovery")),class:"text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors"}," 使用恢复代码 ")])):u("",!0)]))}},Mt={class:"p-4 md:p-6"},jt={class:"flex items-center gap-3 mb-4 md:mb-6"},Ft={class:"text-base md:text-lg font-semibold text-gray-900 dark:text-slate-100"},Bt={class:"space-y-4 md:space-y-6"},At={class:"bg-gray-50 dark:bg-slate-800/50 rounded-lg p-3"},Lt={class:"flex items-center justify-between"},Vt={class:"text-xs md:text-sm font-medium text-gray-900 dark:text-slate-100"},St={class:"flex items-center gap-1 md:gap-2"},Tt=["onClick","onMouseenter"],Ut={class:"ml-1 md:ml-2 text-sm md:text-lg font-medium text-gray-900 dark:text-slate-100"},Et={class:"block text-xs md:text-sm font-medium text-gray-700 dark:text-slate-300 mb-2"},It={class:"text-xs text-gray-500 dark:text-slate-400 ml-1 md:ml-2"},qt={class:"mt-2 flex flex-wrap gap-1.5 md:gap-2"},Wt=["onClick"],Rt={class:"flex items-start md:items-center"},Ht={class:"px-4 py-3 md:px-6 md:py-4 bg-gray-50 dark:bg-slate-900/50 border-t border-gray-200 dark:border-slate-800 flex justify-end gap-2 md:gap-3"},Pt={__name:"ReviewModal",props:{modelValue:Boolean,orderId:{type:Number,required:!0},orderNo:{type:String,required:!0},vendorName:{type:String,required:!0},fiatAmount:{type:[Number,String],required:!0},fiatCurrency:{type:String,required:!0},cryptoAmount:{type:[Number,String],required:!0},cryptoCurrency:{type:String,required:!0}},emits:["update:modelValue","success"],setup(s,{emit:h}){const $=s,F=h,i=D({get:()=>$.modelValue,set:k=>F("update:modelValue",k)}),_=C(!1),w=C(5),B=C(0),y=C(""),A=C(!1),N=["交易迅速","信誉良好","沟通顺畅","价格合理","服务专业","值得信赖"],I={1:"非常差",2:"较差",3:"一般",4:"满意",5:"非常满意"},m=D(()=>I[w.value]||""),p=D(()=>w.value>0),S=k=>{y.value.length>0?y.value+="，"+k:y.value=k},q=async()=>{if(!p.value){J.error("请选择评分");return}_.value=!0;try{const k=await P.post(`/web/api/orders/${$.orderId}/review`,{rating:w.value,comment:y.value,is_anonymous:A.value});k.data.success?(J.success("评价提交成功"),F("success",k.data.data.review),L()):J.error(k.data.message||"评价提交失败")}catch(k){console.error("Submit review error:",k),J.error(k.response?.data?.message||"评价提交失败")}finally{_.value=!1}},L=()=>{i.value=!1,w.value=5,B.value=0,y.value="",A.value=!1};return le(i,k=>{k&&(w.value=5,B.value=0,y.value="",A.value=!1)}),(k,M)=>(a(),j(se,{show:i.value,"max-width":"2xl",onClose:L},{default:x(()=>[e("div",Mt,[e("div",jt,[M[4]||(M[4]=e("div",{class:"p-2 md:p-3 rounded-lg md:rounded-xl bg-amber-100 dark:bg-amber-900/30"},[e("svg",{class:"w-5 h-5 md:w-6 md:h-6 text-amber-600 dark:text-amber-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})])],-1)),e("div",null,[e("h3",Ft," 评价"+d(s.vendorName),1),M[3]||(M[3]=e("p",{class:"text-xs md:text-sm text-gray-500 dark:text-slate-400"}," 请对本次交易进行评价 ",-1))])]),e("div",Bt,[e("div",At,[e("div",Lt,[M[5]||(M[5]=e("span",{class:"text-xs md:text-sm text-gray-500 dark:text-slate-400"},"订单编号",-1)),e("span",Vt,d(s.orderNo),1)])]),e("div",null,[M[7]||(M[7]=e("label",{class:"block text-xs md:text-sm font-medium text-gray-700 dark:text-slate-300 mb-2 md:mb-3"},[c(" 您的评分 "),e("span",{class:"text-red-500"},"*")],-1)),e("div",St,[(a(),o(E,null,X(5,n=>e("button",{key:n,onClick:H=>w.value=n,onMouseenter:H=>B.value=n,onMouseleave:M[0]||(M[0]=H=>B.value=0),class:"focus:outline-none transition-transform hover:scale-110 cursor-pointer"},[(a(),o("svg",{class:f(["w-8 h-8 md:w-10 md:h-10 transition-colors",(B.value||w.value)>=n?"text-amber-500":"text-gray-300 dark:text-slate-600"]),fill:"currentColor",viewBox:"0 0 20 20"},[...M[6]||(M[6]=[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"},null,-1)])],2))],40,Tt)),64)),e("span",Ut,d(m.value),1)])]),e("div",null,[e("label",Et,[M[8]||(M[8]=c(" 评价内容 ",-1)),e("span",It," ("+d(y.value.length)+"/500) ",1)]),R(e("textarea",{"onUpdate:modelValue":M[1]||(M[1]=n=>y.value=n),rows:"3",maxlength:"500",placeholder:"分享您的交易体验...",class:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-slate-100 focus:ring-2 focus:ring-emerald-500 focus:border-transparent resize-none"},null,512),[[te,y.value]]),e("div",qt,[(a(),o(E,null,X(N,n=>e("button",{key:n,onClick:H=>S(n),class:"px-2 md:px-3 py-1 text-xs bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-slate-300 rounded-full hover:bg-gray-200 dark:hover:bg-slate-600 transition-colors cursor-pointer"},d(n),9,Wt)),64))])]),e("div",Rt,[R(e("input",{id:"anonymous","onUpdate:modelValue":M[2]||(M[2]=n=>A.value=n),type:"checkbox",class:"w-4 h-4 mt-0.5 md:mt-0 text-emerald-600 bg-gray-100 border-gray-300 rounded focus:ring-emerald-500 dark:focus:ring-emerald-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600 cursor-pointer"},null,512),[[Y,A.value]]),M[9]||(M[9]=e("label",{for:"anonymous",class:"ml-2 text-xs md:text-sm text-gray-700 dark:text-slate-300 cursor-pointer"},[c(" 匿名评价 "),e("span",{class:"text-xs text-gray-500 dark:text-slate-400 block md:inline"},"（其他用户将看不到您的身份信息）")],-1))]),M[10]||(M[10]=e("div",{class:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-2 md:p-3"},[e("div",{class:"flex items-start gap-1.5 md:gap-2"},[e("svg",{class:"w-4 h-4 md:w-5 md:h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),e("div",{class:"text-xs text-amber-800 dark:text-amber-200"},[e("p",null,"评价提交后将无法修改或删除，请慎重评价。"),e("p",{class:"mt-0.5 md:mt-1"},"您的评价将帮助其他用户更好地了解商家。")])])],-1))])]),e("div",Ht,[b(v,{variant:"ghost",size:"sm",disabled:_.value,onClick:L,class:"md:!text-sm"},{default:x(()=>[...M[11]||(M[11]=[c(" 取消 ",-1)])]),_:1},8,["disabled"]),b(v,{variant:"primary",size:"sm",loading:_.value,disabled:!p.value||_.value,onClick:q,class:"md:!text-sm"},{default:x(()=>[c(d(_.value?"提交中...":"提交评价"),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["show"]))}},Dt={class:"flex items-center gap-2 flex-1"},Nt={class:"flex -space-x-2"},Ot={class:"text-white text-xs font-bold"},Kt={class:"flex-1 min-w-0"},Xt={class:"text-sm font-semibold text-gray-900 dark:text-slate-100 truncate"},Gt={class:"text-xs text-gray-500 dark:text-slate-400"},Jt={class:"lg:min-h-screen lg:bg-gray-50 lg:dark:bg-slate-950 h-screen lg:h-auto overflow-hidden lg:overflow-visible"},Qt={key:0,class:"relative z-10 bg-red-50 dark:bg-red-900/20 border-b border-red-200 dark:border-red-800"},Yt={key:1,class:"relative z-10 bg-amber-50 dark:bg-amber-900/20 border-b border-amber-200 dark:border-amber-800"},Zt={class:"max-w-7xl mx-auto px-4 py-3 sm:px-6 lg:px-8"},es={class:"flex flex-col sm:flex-row sm:items-center gap-3"},ts={class:"flex items-start gap-3 flex-1"},ss={class:"flex-1"},rs={key:0,class:"text-xs text-amber-700 dark:text-amber-300 mt-2"},as={key:0,class:"sm:ml-auto"},ls={key:2,class:"hidden lg:block relative z-10 bg-blue-50 dark:bg-blue-900/20 border-b border-blue-200 dark:border-blue-800"},os={class:"max-w-7xl mx-auto px-4 py-3 sm:px-6 lg:px-8"},ds={class:"flex flex-col sm:flex-row sm:items-center gap-3"},is={class:"sm:ml-auto"},ns={class:"p-4 space-y-4"},us={class:"space-y-4"},cs={class:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800"},xs={class:"flex items-center gap-2"},ms={class:"text-sm font-semibold text-blue-700 dark:text-blue-300"},vs={class:"text-xs text-blue-600 dark:text-blue-400"},fs={class:"space-y-3"},bs={class:"flex gap-3"},gs={class:"flex-1 pb-3"},ks={class:"text-xs text-gray-500 dark:text-slate-400"},ys={key:0,class:"mt-2"},ps={class:"flex gap-3"},ws={class:"flex flex-col items-center"},hs={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},_s={key:1,class:"text-white text-xs font-bold"},Cs={class:"flex-1 pb-3"},$s={class:"text-xs text-gray-500 dark:text-slate-400"},zs={class:"flex gap-3"},Ms={class:"flex flex-col items-center"},js={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Fs={key:1,class:"text-white text-xs font-bold"},Bs={class:"flex-1 pb-3"},As={class:"text-xs text-gray-500 dark:text-slate-400"},Ls={key:0,class:"mt-2"},Vs={class:"flex gap-3"},Ss={class:"flex flex-col items-center"},Ts={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Us={key:1,class:"text-white text-xs font-bold"},Es={class:"flex-1 pb-3"},Is={class:"text-xs text-gray-500 dark:text-slate-400"},qs={key:0,class:"mt-2 space-y-2"},Ws={class:"flex gap-2"},Rs={class:"flex gap-3"},Hs={class:"flex flex-col items-center"},Ps={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ds={key:1,class:"text-white text-xs font-bold"},Ns={class:"flex-1 pb-3"},Os={class:"text-xs text-gray-500 dark:text-slate-400"},Ks={key:0,class:"mt-2"},Xs={class:"flex gap-3"},Gs={class:"flex flex-col items-center"},Js={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Qs={key:1,class:"text-white text-xs font-bold"},Ys={class:"flex-1 pb-3"},Zs={class:"text-xs text-gray-500 dark:text-slate-400"},er={key:0,class:"mt-2"},tr={class:"flex gap-3"},sr={class:"flex flex-col items-center"},rr={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ar={key:1,class:"text-white text-xs font-bold"},lr={class:"flex-1 pb-3"},or={class:"text-xs text-gray-500 dark:text-slate-400"},dr={key:0,class:"mt-2"},ir={class:"flex gap-3"},nr={class:"flex flex-col items-center"},ur={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},cr={key:1,class:"text-white text-xs font-bold"},xr={class:"flex-1"},mr={class:"text-xs text-gray-500 dark:text-slate-400"},vr={class:"grid grid-cols-2 gap-3 text-sm"},fr={class:"font-mono text-gray-900 dark:text-slate-200"},br={class:"font-medium text-gray-900 dark:text-slate-200"},gr={class:"font-medium text-gray-900 dark:text-slate-200"},kr={class:"font-medium text-gray-900 dark:text-slate-200"},yr={class:"font-medium text-gray-900 dark:text-slate-200"},pr={class:"font-medium text-gray-900 dark:text-slate-200"},wr={class:"font-medium text-gray-900 dark:text-slate-200"},hr={key:0,class:"text-xs text-amber-600 dark:text-amber-400 mt-0.5"},_r={class:"font-medium text-gray-900 dark:text-slate-200"},Cr={class:"font-bold text-emerald-600 dark:text-emerald-400"},$r={key:0,class:"mt-3 pt-3 border-t border-gray-100 dark:border-slate-800"},zr={class:"font-mono text-sm text-gray-900 dark:text-slate-200 break-all"},Mr={class:"mx-auto max-w-7xl"},jr={class:"hidden lg:grid lg:grid-cols-3 gap-4 p-4"},Fr={class:"lg:col-span-1 space-y-4"},Br={class:"bg-white dark:bg-slate-900 rounded-xl border border-gray-200 dark:border-slate-800 p-6"},Ar={class:"flex items-center justify-between mb-4"},Lr={key:0,class:"mb-4"},Vr={key:0,class:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800"},Sr={key:1,class:"p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg border border-emerald-200 dark:border-emerald-800"},Tr={class:"mb-6"},Ur={class:"flex items-center justify-between text-xs text-gray-500 dark:text-slate-400 mb-2"},Er={class:"w-full bg-gray-200 dark:bg-slate-700 rounded-full h-2"},Ir={class:"space-y-4 mb-6"},qr={class:"flex items-center gap-3"},Wr={class:"flex-1"},Rr={class:"text-xs text-gray-500 dark:text-slate-400"},Hr={class:"flex items-center gap-3"},Pr={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Dr={key:1,class:"text-white font-bold text-xs"},Nr={class:"flex-1"},Or={key:0,class:"ml-11 mt-2"},Kr={class:"flex items-center gap-3"},Xr={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Gr={key:1,class:"text-white font-bold text-xs"},Jr={class:"flex-1"},Qr={key:0,class:"text-xs text-blue-600 dark:text-blue-400 font-mono break-all mt-1"},Yr={key:0,class:"ml-11 mt-2"},Zr={class:"flex items-center gap-3"},ea={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ta={key:1,class:"text-white font-bold text-xs"},sa={class:"flex-1"},ra={key:0,class:"ml-11 mt-2 space-y-2"},aa={class:"flex gap-2"},la={class:"flex items-center gap-3"},oa={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},da={key:1,class:"text-white font-bold text-xs"},ia={class:"flex-1"},na={key:0,class:"ml-11 mt-2"},ua={class:"flex items-center gap-3"},ca={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},xa={key:1,class:"text-white font-bold text-xs"},ma={class:"flex-1"},va={class:"text-xs text-gray-500 dark:text-slate-400"},fa={key:0,class:"ml-11 mt-2"},ba={class:"flex items-center gap-3"},ga={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ka={key:1,class:"text-white font-bold text-xs"},ya={class:"flex-1"},pa={key:0,class:"ml-11 mt-2"},wa={class:"flex items-center gap-3"},ha={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},_a={key:1,class:"text-white font-bold text-xs"},Ca={class:"flex-1"},$a={class:"space-y-3 border-t border-gray-200 dark:border-slate-800 pt-4"},za={class:"flex justify-between"},Ma={class:"text-sm font-mono text-gray-900 dark:text-slate-200"},ja={class:"flex justify-between"},Fa={class:"text-sm font-medium text-gray-900 dark:text-slate-200"},Ba={class:"flex justify-between"},Aa={class:"text-sm font-medium text-gray-900 dark:text-slate-200"},La={class:"flex justify-between"},Va={class:"text-sm font-medium text-gray-900 dark:text-slate-200"},Sa={class:"flex justify-between"},Ta={class:"text-sm font-medium text-gray-900 dark:text-slate-200"},Ua={class:"flex justify-between"},Ea={class:"text-sm font-medium text-gray-900 dark:text-slate-200"},Ia={key:0,class:"flex justify-between"},qa={class:"text-sm text-amber-600 dark:text-amber-400"},Wa={class:"flex justify-between"},Ra={class:"text-sm font-medium text-gray-900 dark:text-slate-200"},Ha={class:"flex justify-between"},Pa={class:"text-lg font-bold text-emerald-600 dark:text-emerald-400"},Da={key:1,class:"flex justify-between items-start pt-3 border-t border-gray-100 dark:border-slate-800"},Na={class:"text-sm font-medium text-gray-900 dark:text-slate-200 text-right break-all max-w-[180px]"},Oa={class:"lg:col-span-2"},Ka={class:"bg-white dark:bg-slate-900 rounded-xl border border-gray-200 dark:border-slate-800 flex flex-col",style:{height:"650px","min-height":"600px"}},Xa={class:"border-b border-gray-200 dark:border-slate-800"},Ga={class:"px-6 py-4"},Ja={class:"flex items-center justify-between"},Qa={class:"flex items-center gap-3"},Ya={class:"flex -space-x-2"},Za=["href"],el={class:"h-10 w-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center ring-2 ring-white dark:ring-slate-900"},tl={class:"text-white font-bold"},sl={key:0,class:"absolute -bottom-0.5 -right-0.5 h-2.5 w-2.5 bg-emerald-500 rounded-full ring-2 ring-white dark:ring-slate-900"},rl={class:"flex-1"},al={class:"flex items-center gap-2"},ll={class:"font-semibold text-gray-900 dark:text-slate-100"},ol={class:"text-xs text-gray-500 dark:text-slate-400 ml-2"},dl={class:"text-xs text-gray-500 dark:text-slate-400"},il={key:0,class:"text-gray-400"},nl={key:0,class:"px-3 py-1 bg-blue-50 dark:bg-blue-900/20 rounded-full text-xs text-blue-600 dark:text-blue-400 max-w-md"},ul={key:0},cl=["href"],xl={class:"text-white text-sm font-bold"},ml={class:"max-w-md"},vl={class:"text-xs font-medium text-gray-600 dark:text-slate-400 mb-1 px-1"},fl={key:0,class:"text-purple-600 dark:text-purple-400 font-bold"},bl={class:"bg-gray-100 dark:bg-slate-800 rounded-2xl rounded-tl-none px-4 py-3"},gl={key:0,class:"mb-2"},kl=["src","alt","onClick"],yl=["href"],pl={class:"flex-1"},wl={class:"text-xs font-medium text-gray-900 dark:text-slate-200"},hl={class:"text-xs text-gray-500 dark:text-slate-400"},_l={key:1,class:"text-sm text-gray-900 dark:text-slate-200"},Cl={class:"text-xs text-gray-400 dark:text-slate-500 mt-1 px-1"},$l={class:"max-w-md"},zl={class:"text-xs font-medium text-gray-600 dark:text-slate-400 mb-1 px-1 text-right"},Ml={key:0,class:"text-purple-600 dark:text-purple-400 font-bold"},jl={class:"bg-emerald-600 text-white rounded-2xl rounded-tr-none px-4 py-3"},Fl={key:0,class:"mb-2"},Bl=["src","alt","onClick"],Al=["href"],Ll={class:"flex-1"},Vl={class:"text-xs font-medium text-white"},Sl={class:"text-xs text-emerald-100"},Tl={key:1,class:"text-sm"},Ul={class:"text-xs text-gray-400 dark:text-slate-500 mt-1 px-1 text-right"},El={class:"border-t border-gray-200 dark:border-slate-800 p-4"},Il={key:0,class:"mb-3 p-3 bg-gray-50 dark:bg-slate-800 rounded-lg"},ql={class:"flex items-start gap-3"},Wl=["src","alt"],Rl={key:1,class:"w-16 h-20 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center"},Hl={class:"flex-1"},Pl={class:"text-sm font-medium text-gray-900 dark:text-slate-200"},Dl={class:"text-xs text-gray-500 dark:text-slate-400"},Nl=["disabled"],Ol=["placeholder","disabled"],Kl=["disabled"],Xl={key:0,class:"animate-spin"},Gl={class:"flex gap-2 mt-3 items-center"},Jl={key:0,href:"/notifications/settings",target:"_blank",class:"ml-auto inline-flex items-center gap-1 px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white text-xs rounded-full transition-colors"},Ql={key:0,class:"border-t border-gray-200 dark:border-slate-800 p-3 bg-gray-50 dark:bg-slate-900/50 rounded-b-xl"},Yl={class:"flex gap-2"},Zl={class:"space-y-4 mt-6"},eo={key:0,class:"bg-white dark:bg-slate-900 rounded-xl border border-gray-200 dark:border-slate-800 p-4"},to={class:"p-3 bg-gray-50 dark:bg-slate-800/50 rounded-lg max-h-40 overflow-y-auto"},so={class:"text-xs text-gray-700 dark:text-slate-300 whitespace-pre-wrap"},ro={class:"lg:hidden fixed inset-x-0 top-14 bottom-16 flex flex-col bg-white dark:bg-slate-950"},ao={key:0,class:"bg-amber-50 dark:bg-amber-900/20 border-b border-amber-200 dark:border-amber-800 p-3"},lo={class:"flex items-center justify-between"},oo={class:"p-4 space-y-4"},io={key:0,class:"px-3 py-1 bg-blue-50 dark:bg-blue-900/20 rounded-full text-xs text-blue-600 dark:text-blue-400"},no={key:0},uo=["href"],co={class:"text-white text-xs font-bold"},xo={class:"max-w-[70%]"},mo={class:"text-xs font-medium text-gray-600 dark:text-slate-400 mb-0.5 px-1"},vo={key:0,class:"text-purple-600 dark:text-purple-400 font-bold"},fo={class:"bg-gray-100 dark:bg-slate-800 rounded-2xl rounded-tl-none px-3 py-2"},bo={key:0,class:"mb-2"},go=["src","alt","onClick"],ko=["href"],yo={class:"flex-1"},po={class:"text-xs font-medium text-gray-900 dark:text-slate-200"},wo={class:"text-xs text-gray-500 dark:text-slate-400"},ho={key:1,class:"text-sm text-gray-900 dark:text-slate-200"},_o={class:"text-xs text-gray-400 dark:text-slate-500 mt-1 px-1"},Co={class:"max-w-[70%]"},$o={class:"text-xs font-medium text-gray-600 dark:text-slate-400 mb-0.5 px-1 text-right"},zo={key:0,class:"text-purple-600 dark:text-purple-400 font-bold"},Mo={class:"bg-emerald-600 text-white rounded-2xl rounded-tr-none px-3 py-2"},jo={key:0,class:"mb-2"},Fo=["src","alt","onClick"],Bo=["href"],Ao={class:"flex-1"},Lo={class:"text-xs font-medium text-white"},Vo={class:"text-xs text-emerald-100"},So={key:1,class:"text-sm"},To={class:"text-xs text-gray-400 dark:text-slate-500 mt-1 px-1 text-right"},Uo={class:"px-3 pb-3"},Eo={class:"flex gap-2"},Io={class:"bg-white dark:bg-slate-900 border-t border-gray-200 dark:border-slate-800"},qo={class:"p-3"},Wo={key:0,class:"mb-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg"},Ro={class:"flex items-center gap-3"},Ho={class:"flex-shrink-0"},Po=["src"],Do={key:1,class:"w-12 h-12 bg-gray-200 dark:bg-slate-600 rounded-lg flex items-center justify-center"},No={class:"flex-1 min-w-0"},Oo={class:"text-sm font-medium text-gray-900 dark:text-slate-200 truncate"},Ko={class:"text-xs text-gray-500 dark:text-slate-400"},Xo=["disabled"],Go=["placeholder","disabled"],Jo=["disabled"],Qo={key:0,class:"animate-spin"},Yo={class:"flex gap-2 mt-2 overflow-x-auto"},Zo={key:0,href:"/notifications/settings",target:"_blank",class:"px-3 py-1 bg-blue-500 text-white text-xs rounded-full whitespace-nowrap inline-flex items-center gap-1"},ed={class:"bg-white dark:bg-slate-900 px-4 pt-4 pb-4 sm:p-5 sm:pb-4 max-h-[80vh] overflow-y-auto"},td={class:"mt-2 text-center"},sd={class:"mt-3 space-y-2.5 text-left"},rd={class:"p-2.5 bg-gray-50 dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg"},ad={class:"space-y-2"},ld={key:0},od={class:"font-mono text-xs text-gray-900 dark:text-slate-100 break-all mt-0.5"},dd={key:1},id={class:"font-mono text-xs text-gray-900 dark:text-slate-100 break-all mt-0.5"},nd={class:"text-base font-bold text-emerald-600 dark:text-emerald-400"},ud={key:2},cd={class:"font-mono text-xs text-blue-600 dark:text-blue-400 break-all mt-0.5"},xd={class:"space-y-2"},md={class:"space-y-1.5"},vd={class:"flex items-start"},fd=["disabled"],bd={class:"flex items-start"},gd=["disabled"],kd={class:"flex items-start"},yd=["disabled"],pd={class:"ml-2 text-xs text-gray-700 dark:text-slate-300"},wd={class:"block font-mono text-blue-600 dark:text-blue-400 break-all mt-0.5"},hd={class:"flex items-start"},_d=["disabled"],Cd={class:"ml-2 text-xs text-gray-700 dark:text-slate-300"},$d={class:"block font-mono text-blue-600 dark:text-blue-400 break-all mt-0.5"},zd={class:"flex items-start"},Md=["disabled"],jd={class:"ml-2 text-xs text-gray-700 dark:text-slate-300"},Fd={class:"font-bold text-emerald-600 dark:text-emerald-400"},Bd={class:"flex flex-row justify-end px-4 py-3 sm:px-5 sm:py-3 bg-gray-100 dark:bg-slate-800 text-end gap-2"},Ad={class:"bg-white dark:bg-slate-900 px-4 pt-4 pb-4 sm:p-5 sm:pb-4 max-h-[80vh] overflow-y-auto"},Ld={class:"mt-2 text-center"},Vd={class:"mt-3 space-y-2.5 text-left"},Sd={key:0,class:"p-2.5 bg-gray-50 dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg"},Td={class:"space-y-1.5"},Ud={class:"font-mono text-xs text-gray-900 dark:text-slate-100 break-all mt-0.5"},Ed={class:"text-base font-bold text-emerald-600 dark:text-emerald-400"},Id=["disabled"],qd={class:"flex items-start"},Wd=["disabled"],Rd={class:"ml-2 text-sm text-gray-700 dark:text-slate-300"},Hd={class:"font-bold text-emerald-600 dark:text-emerald-400"},Pd={class:"flex flex-row justify-end px-4 py-3 sm:px-5 sm:py-3 bg-gray-100 dark:bg-slate-800 text-end gap-2"},Dd={class:"bg-white dark:bg-slate-900 px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Nd={class:"mt-3 text-center"},Od={class:"mt-4 space-y-3 text-left"},Kd={class:"text-sm text-gray-600 dark:text-slate-400"},Xd={class:"font-semibold text-emerald-600 dark:text-emerald-400"},Gd={key:0},Jd={key:1,class:"p-2.5 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-md"},Qd={key:2,class:"p-2.5 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md"},Yd={class:"flex flex-row justify-end px-6 py-4 bg-gray-100 dark:bg-slate-800 text-end gap-3"},Zd={class:"bg-white dark:bg-slate-900 px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},e0={class:"mt-3 text-center"},t0={class:"mt-4 space-y-3 text-left"},s0={class:"text-sm text-gray-600 dark:text-slate-400"},r0={class:"font-semibold text-emerald-600 dark:text-emerald-400"},a0={key:0},l0={key:1,class:"p-2.5 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-md"},o0={key:2,class:"p-2.5 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md"},d0={class:"flex flex-row justify-end px-6 py-4 bg-gray-100 dark:bg-slate-800 text-end gap-3"},f0={__name:"Chat",props:{userHas2FA:{type:Boolean,default:!1},order:{type:Object,required:!0},otherUser:{type:Object,default:null},messages:{type:Array,default:()=>[]},currentUserId:{type:Number,required:!0},userRole:{type:String,required:!0},availableActions:{type:Array,default:()=>[]}},setup(s){He();const h=s,$=C(!1),F=C(!1),i=C({...h.order}),_=C(h.messages),w=C(""),B=C(null),y=C(null),A=C(null),N=C(null),I=C(!1),m=C(null),p=C(!1);let S=null;const q=C(!1),L=C([]),k=C([]),M=()=>{const l=[];i.value.vendor&&l.push({id:i.value.vendor.id,name:i.value.vendor.name,role:"商家",avatar:i.value.vendor.avatar,is_self:i.value.vendor.id===h.currentUserId,is_online:i.value.vendor.id===h.currentUserId,is_admin:!1}),i.value.client&&l.push({id:i.value.client.id,name:i.value.client.name,role:"客户",avatar:i.value.client.avatar,is_self:i.value.client.id===h.currentUserId,is_online:i.value.client.id===h.currentUserId,is_admin:!1}),k.value=l},n=C({show:!1,title:"",message:"",inputMode:!1,inputLabel:"",inputPlaceholder:"",inputRequired:!1,danger:!1,confirmVariant:"primary",confirmText:"确认",cancelText:"取消",loading:!1,pendingAction:null,pendingData:{},require2FA:!1,twoFactorCode:"",twoFactorError:""}),H=C(""),G=C(""),Z=C(!1),T=C({txExists:!1,confirmations:!1,fromAddress:!1,toAddress:!1,amount:!1}),ge=D(()=>T.value.txExists&&T.value.confirmations&&T.value.fromAddress&&T.value.toAddress&&T.value.amount),O=D(()=>i.value.status==="completed"||i.value.status==="cancelled"||i.value.escrow_status==="escrow_released"),oe=C({orderId:i.value.order_no,type:h.userRole==="buyer"?"buy":"sell",cryptocurrency:i.value.currency_key||i.value.crypto_currency,amount:i.value.crypto_amount,price:i.value.price,total:i.value.fiat_amount,status:i.value.escrow_status,progress:de(i.value.escrow_status),timeRemaining:765});function de(l){return{order_initiated:12.5,vendor_confirmed:25,seller_paid:37.5,escrow_received:50,buyer_confirmed_escrow:62.5,buyer_paid:75,seller_received:87.5,escrow_released:100}[l]||0}function je(l){return{order_initiated:"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400",vendor_confirmed:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400",seller_paid:"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400",escrow_received:"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400",buyer_paid:"bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-400",seller_received:"bg-teal-100 dark:bg-teal-900/30 text-teal-700 dark:text-teal-400",escrow_released:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400"}[l]||"bg-gray-100 dark:bg-gray-900/30 text-gray-700 dark:text-gray-400"}function ke(l){return{order_initiated:"等待确认",vendor_confirmed:"等待转币",seller_paid:"托管确认中",escrow_received:"托管保护中",buyer_paid:"等待收款确认",seller_received:"释放中",escrow_released:"已完成"}[l]||"处理中"}const xe=D(()=>{const l=[],t=h.currentUserId,r=i.value;switch(r.escrow_status){case"order_initiated":r.vendor_id===t&&l.push("vendor_confirm"),l.push("cancel");break;case"vendor_confirmed":r.seller_id===t&&l.push("mark_seller_paid"),l.push("cancel");break;case"seller_paid":r.buyer_id===t&&l.push("cancel");break;case"escrow_received":r.buyer_id===t&&(l.push("confirm_escrow"),l.push("cancel"));break;case"buyer_confirmed_escrow":r.buyer_id===t&&(l.push("mark_buyer_paid"),l.push("cancel"));break;case"buyer_paid":r.seller_id===t&&l.push("mark_seller_received");break}return r.status==="trading"&&(r.is_disputed&&r.disputed_by==t?l.push("resolve_dispute"):r.is_disputed||l.push("create_dispute")),l}),Fe=C("12:45");let ie=null;const Be=()=>{ie=setInterval(()=>{if(oe.value.timeRemaining>0){oe.value.timeRemaining--;const l=Math.floor(oe.value.timeRemaining/60),t=oe.value.timeRemaining%60;Fe.value=`${l}:${t.toString().padStart(2,"0")}`}else clearInterval(ie)},1e3)},ae=()=>{ce(()=>{const l=()=>{B.value&&(B.value.scrollTop=B.value.scrollHeight),m.value&&(m.value.scrollTop=m.value.scrollHeight)};l();const t=B.value||m.value;if(t){const r=t.querySelectorAll("img");if(r.length>0){let g=0;r.forEach(W=>{W.complete?g++:(W.addEventListener("load",()=>{l()},{once:!0}),W.addEventListener("error",()=>{l()},{once:!0}))}),g===r.length&&setTimeout(l,100)}}})},V=l=>new Date(l).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),Ae=l=>{i.value.has_review=!0,i.value.review=l,i.value.status="completed",F.value=!1,J.success("感谢您的评价！")},ee=l=>{if(l===0)return"0 Bytes";const t=1024,r=["Bytes","KB","MB","GB"],g=Math.floor(Math.log(l)/Math.log(t));return Math.round(l/Math.pow(t,g)*100)/100+" "+r[g]},ye=l=>{const t=l.target.files[0];if(t){if(t.size>10*1024*1024){alert("文件大小不能超过10MB"),l.target.value="";return}y.value=t,t.type.startsWith("image/")&&(A.value=URL.createObjectURL(t))}},pe=()=>{y.value=null,A.value&&(URL.revokeObjectURL(A.value),A.value=null),N.value&&(N.value.value="")},me=async()=>{if(!w.value.trim()&&!y.value||!p.value||I.value)return;const l=w.value,t=y.value;w.value="",I.value=!0;try{let r=null;if(t){const ue=new FormData;ue.append("file",t);const _e=await P.post(`/web/api/orders/${i.value.order_no}/chat/upload`,ue,{headers:{"Content-Type":"multipart/form-data"}});_e.data.success&&(r=_e.data.file)}const g=i.value.vendor_id===h.currentUserId?i.value.client_id:i.value.vendor_id,W=k.value.find(ue=>ue.id===g),Ee=W?W.is_online:!1,Ie=await P.post(`/web/api/orders/${i.value.order_no}/chat/send`,{message:l,attachment:r,recipient_online:Ee});_.value.push(Ie.data),pe(),ce(()=>{ae()})}catch(r){console.error("发送消息失败:",r),w.value=l,alert("发送失败，请重试")}finally{I.value=!1}},Q=l=>{w.value=l,me()},z=l=>{console.log("handleEscrowAction called with:",l);const t={vendor_confirm:{title:"确认接单",message:"确认接受此订单吗？接单后需要等待卖家转币到托管。",confirmVariant:"primary",confirmText:"确认接单"},mark_seller_paid:{title:"标记已转币",message:"请确认您已将币转入托管地址，并提供交易哈希作为凭证",inputMode:!0,inputLabel:"交易哈希 (TX ID)",inputPlaceholder:"请输入区块链交易哈希...",inputRequired:!0,confirmVariant:"primary",confirmText:"确认已转币"},confirm_escrow:{},mark_buyer_paid:{title:"标记已付款",message:"请确认您已向卖家付款",inputMode:!0,inputLabel:"付款说明（可选）",inputPlaceholder:"请输入付款凭证或说明...",inputRequired:!1,confirmVariant:"primary",confirmText:"确认已付款",require2FA:!0},mark_seller_received:{title:"确认收款",message:"请确认您已收到买家的付款。确认后，托管的币将释放给买家。",confirmVariant:"success",confirmText:"确认已收款",require2FA:!0},cancel:{},create_dispute:{title:"发起争议",message:"发起争议后，订单将被冻结，暂停所有交易操作，等待平台客服介入处理。请详细说明问题。",inputMode:!0,inputLabel:"争议原因",inputPlaceholder:"请详细描述您遇到的问题...",inputRequired:!0,confirmVariant:"warning",confirmText:"确认发起争议"},resolve_dispute:{title:"解除争议",message:"确定要解除争议吗？解除后订单将恢复正常，可以继续进行交易。",inputMode:!0,inputLabel:"解除原因（可选）",inputPlaceholder:"请输入解除争议的原因...",inputRequired:!1,confirmVariant:"success",confirmText:"确认解除"}};if(l==="cancel"){const g=i.value.escrow_status;let W={title:"取消订单",inputMode:!0,inputLabel:"取消原因",inputPlaceholder:"请输入取消原因...",inputRequired:!0,danger:!0,confirmVariant:"danger",confirmText:"确认取消"};["seller_paid","escrow_received","buyer_confirmed_escrow"].includes(g)?W.message=`⚠️ 警告：当前已进入托管阶段，取消订单将扣除您的信誉分 -1

确定要取消此订单吗？`:W.message="确定要取消此订单吗？",t[l]=W}const r=t[l];!r&&l!=="confirm_escrow"||(Object.assign(n.value,{show:!0,...r||{},cancelText:"返回",pendingAction:l,pendingData:{},loading:!1}),console.log("dialogState after setting:",n.value))},Le=async l=>{const t=n.value.pendingAction;if(t)try{let r="",g={};switch(t){case"vendor_confirm":r=`/web/api/orders/${i.value.id}/vendor-confirm`;break;case"mark_seller_paid":if(r=`/web/api/orders/${i.value.id}/seller-paid`,!l||!l.trim()){n.value.loading=!1,n.value.show=!1;return}g.tx_hash=l.trim();break;case"confirm_escrow":r=`/web/api/orders/${i.value.id}/buyer-confirm-escrow`;break;case"mark_buyer_paid":r=`/web/api/orders/${i.value.id}/buyer-paid`,l&&(g.payment_proof=l),n.value.require2FA&&n.value.twoFactorCode&&(g.two_factor_code=n.value.twoFactorCode);break;case"mark_seller_received":r=`/web/api/orders/${i.value.id}/seller-received`,n.value.require2FA&&n.value.twoFactorCode&&(g.two_factor_code=n.value.twoFactorCode);break;case"cancel":r=`/web/api/orders/${i.value.id}/cancel`,g.reason=l;break;case"create_dispute":r=`/web/api/orders/${i.value.id}/dispute`,g.reason=l;break;case"resolve_dispute":r=`/web/api/orders/${i.value.id}/resolve-dispute`,l&&(g.reason=l);break}n.value.loading=!0,(await P.post(r,g)).data.success&&(n.value.show=!1,U.reload())}catch(r){console.error("操作失败:",r),n.value.loading=!1,n.value.show=!1}},K=()=>{n.value={show:!1,title:"",message:"",inputMode:!1,inputLabel:"",inputPlaceholder:"",inputRequired:!1,danger:!1,confirmVariant:"primary",confirmText:"确认",cancelText:"取消",loading:!1,pendingAction:null,pendingData:{},require2FA:!1,twoFactorCode:"",twoFactorError:""},H.value="",G.value="",Z.value=!1,T.value={txExists:!1,confirmations:!1,fromAddress:!1,toAddress:!1,amount:!1}},we=l=>{n.value.twoFactorCode=l,n.value.twoFactorError=""},Ve=async()=>{if(!h.userHas2FA){alert("买家付款必须启用双重验证"),U.visit("/user/profile");return}if(!n.value.twoFactorCode||n.value.twoFactorCode.length!==6){n.value.twoFactorError="请输入6位验证码";return}n.value.loading=!0,n.value.twoFactorError="";try{const l={two_factor_code:n.value.twoFactorCode};H.value&&H.value.trim()&&(l.payment_proof=H.value.trim()),(await P.post(`/web/api/orders/${i.value.id}/buyer-paid`,l)).data.success&&(n.value.show=!1,H.value="",n.value.twoFactorCode="",n.value.twoFactorError="",U.reload())}catch(l){n.value.loading=!1,l.response?.data?.errors?.two_factor_code?n.value.twoFactorError=l.response.data.errors.two_factor_code[0]:l.response?.data?.message?l.response.data.require_2fa?(n.value.show=!1,alert("为了您的资金安全，请先在个人设置中启用双重验证"),U.visit("/user/profile")):n.value.twoFactorError=l.response.data.message:n.value.twoFactorError="验证失败，请重试"}},Se=async()=>{if(!ge.value){J.error("请确认所有检查项");return}n.value.loading=!0;try{(await P.post(`/web/api/orders/${i.value.id}/buyer-confirm-escrow`)).data.success&&(n.value.show=!1,T.value={txExists:!1,confirmations:!1,fromAddress:!1,toAddress:!1,amount:!1},U.reload())}catch(l){n.value.loading=!1,console.error("确认托管失败:",l)}},Te=async()=>{if(!G.value||!G.value.trim()){J.error("请输入交易哈希");return}if(!Z.value){J.error("请确认已核对地址和金额");return}n.value.loading=!0;try{(await P.post(`/web/api/orders/${i.value.id}/seller-paid`,{tx_hash:G.value.trim()})).data.success&&(n.value.show=!1,G.value="",Z.value=!1,U.reload())}catch(l){n.value.loading=!1,console.error("标记转币失败:",l)}},Ue=async()=>{if(!h.userHas2FA){alert("卖家确认收款必须启用双重验证"),U.visit("/user/profile");return}if(!n.value.twoFactorCode||n.value.twoFactorCode.length!==6){n.value.twoFactorError="请输入6位验证码";return}n.value.loading=!0,n.value.twoFactorError="";try{const l={two_factor_code:n.value.twoFactorCode};(await P.post(`/web/api/orders/${i.value.id}/seller-received`,l)).data.success&&(n.value.show=!1,n.value.twoFactorCode="",n.value.twoFactorError="",U.reload())}catch(l){n.value.loading=!1,l.response?.data?.errors?.two_factor_code?n.value.twoFactorError=l.response.data.errors.two_factor_code[0]:l.response?.data?.message?l.response.data.require_2fa?(n.value.show=!1,alert("为了您的资金安全，请先在个人设置中启用双重验证"),U.visit("/user/profile")):n.value.twoFactorError=l.response.data.message:n.value.twoFactorError="验证失败，请重试"}},ne=async l=>{try{if(l==="received"){if((await P.post(`/web/api/orders/${h.order.id}/mock-escrow-received`)).data.success){const r=await P.post(`/web/api/orders/${h.order.order_no}/chat/send`,{message:"✅ [测试模式] 托管已确认到账！买家现在可以付款了"});r.data&&(_.value.push({...r.data,type:"system"}),ae()),setTimeout(()=>{U.reload()},1e3)}}else l==="not_received"&&(await P.post(`/web/api/orders/${h.order.id}/mock-escrow-not-received`)).data.success&&setTimeout(()=>{U.reload()},1e3)}catch(t){console.error("模拟托管状态失败:",t)}},he=()=>{typeof window.Echo<"u"?(S=window.Echo,S.join(`order.${i.value.id}`).here(l=>{console.log("当前在线用户:",l),L.value=l,k.value.forEach(t=>{t.is_online=l.some(r=>r.id===t.id)}),l.forEach(t=>{[3].includes(t.id)&&(k.value.find(W=>W.id===t.id)||k.value.push({id:t.id,name:t.name,role:"仲裁员",avatar:null,is_self:t.id===h.currentUserId,is_online:!0,is_admin:!0}))}),q.value=l.some(t=>t.id===h.otherUser?.id)}).joining(l=>{console.log("用户加入:",l),L.value.push(l);const t=k.value.find(r=>r.id===l.id);t?t.is_online=!0:[3].includes(l.id)&&k.value.push({id:l.id,name:l.name,role:"仲裁员",avatar:null,is_self:l.id===h.currentUserId,is_online:!0,is_admin:!0}),l.id===h.otherUser?.id&&(q.value=!0)}).leaving(l=>{console.log("用户离开:",l),L.value=L.value.filter(r=>r.id!==l.id);const t=k.value.find(r=>r.id===l.id);t&&(t.is_online=!1),l.id===h.otherUser?.id&&(q.value=!1)}).error(l=>{console.error("Presence channel error:",l)}).listen("MessageSent",l=>{if(l.type==="admin"&&l.user){const t=k.value.find(r=>r.id===l.user.id);t?t&&!t.is_admin&&(t.role="仲裁员",t.is_admin=!0,t.is_online=!0):k.value.push({id:l.user.id,name:l.user.name,role:"仲裁员",avatar:null,is_self:l.user.id===h.currentUserId,is_online:!0,is_admin:!0})}(l.type==="system"||!l.user||l.user.id!==h.currentUserId)&&(_.value.push({id:l.id,message:l.message,type:l.type||"text",attachment:l.attachment,user:l.user,created_at:l.created_at}),ae())}).listen("EscrowStatusUpdated",l=>{console.log("托管状态更新:",l),i.value.escrow_status=l.escrow_status||l.new_status,i.value.status=l.status||i.value.status,i.value.is_disputed=l.is_disputed,i.value.disputed_by=l.disputed_by,l.escrow_status==="buyer_confirmed_escrow"&&(i.value.buyer_confirmed_escrow_at=l.updated_at);const t=`托管状态更新: ${l.message}`;_.value.push({id:Date.now(),message:t,type:"system",user:null,created_at:new Date().toISOString()}),ae(),setTimeout(()=>{U.reload()},2e3)}).listen("OrderStatusUpdated",l=>{console.log("订单状态更新:",l),l.status==="cancelled"&&setTimeout(()=>{U.reload()},1e3)}).listen(".dispute.resolved",l=>{console.log("争议已解除:",l),i.value.is_disputed=!1,i.value.disputed_by=null,l.escrow_status&&(i.value.escrow_status=l.escrow_status),l.status&&(i.value.status=l.status),setTimeout(()=>{U.reload({only:["availableActions","order"]})},1e3),showNotification("success",l.message||"争议已解除，订单恢复正常")}),p.value=!0):(console.warn("Echo not available, retrying..."),setTimeout(he,1e3))};return be(()=>{M(),Be(),ae(),he()}),Me(()=>{ie&&clearInterval(ie),S&&S.leave(`order.${i.value.id}`)}),(l,t)=>(a(),o(E,null,[b(De,{"hide-nav":!0,"hide-footer":!0,"show-breadcrumbs":!0,breadcrumbs:[{label:"订单",url:"/orders"},{label:`订单 #${s.order.order_no}`,url:null},{label:"交易聊天"}]},{default:x(()=>[b(ot,{"back-url":"/orders"},{custom:x(()=>[e("div",Dt,[e("div",Nt,[(a(!0),o(E,null,X(k.value,(r,g)=>(a(),o("div",{key:r.id,class:"relative",style:ve(`z-index: ${k.value.length-g}`)},[e("div",{class:f(["h-8 w-8 rounded-full flex items-center justify-center ring-2 ring-white dark:ring-slate-950",r.is_online?"bg-gradient-to-br from-emerald-500 to-emerald-600":"bg-gray-400 dark:bg-slate-600"])},[e("span",Ot,d(r.name?.[0]?.toUpperCase()||"U"),1)],2)],4))),128))]),e("div",Kt,[e("p",Xt," 订单 #"+d(s.order.order_no),1),e("p",Gt,d(k.value.filter(r=>r.is_online).length)+"/"+d(k.value.length)+" 在房间 ",1)])])]),actions:x(()=>[e("button",{onClick:t[0]||(t[0]=r=>$.value=!$.value),class:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors"},[...t[60]||(t[60]=[e("svg",{class:"w-5 h-5 text-gray-700 dark:text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])])]),_:1}),e("div",Jt,[s.order.status==="cancelled"?(a(),o("div",Qt,[...t[61]||(t[61]=[e("div",{class:"max-w-7xl mx-auto px-4 py-3 sm:px-6 lg:px-8"},[e("div",{class:"flex items-center gap-3"},[e("svg",{class:"w-5 h-5 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("p",{class:"text-sm font-medium text-red-800 dark:text-red-200"},"此订单已取消，无法进行任何操作")])],-1)])])):u("",!0),s.order.is_disputed&&s.order.status!=="cancelled"?(a(),o("div",Yt,[e("div",Zt,[e("div",es,[e("div",ts,[t[65]||(t[65]=e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("div",ss,[t[63]||(t[63]=e("p",{class:"text-sm font-medium text-amber-800 dark:text-amber-200"},"该订单处于争议中",-1)),t[64]||(t[64]=e("p",{class:"text-xs text-amber-700 dark:text-amber-300 mt-1"},[c(" 请等待仲裁管理员加入聊天，管理员将在 "),e("span",{class:"font-semibold"},"24小时内"),c(" 加入处理。 在此期间，您可以与对方自行协商解决。 ")],-1)),s.order.dispute_reason?(a(),o("p",rs,[t[62]||(t[62]=e("span",{class:"font-medium"},"争议原因：",-1)),c(d(s.order.dispute_reason),1)])):u("",!0)])]),s.availableActions.includes("resolve_dispute")?(a(),o("div",as,[b(v,{onClick:t[1]||(t[1]=r=>z("resolve_dispute")),variant:"outline",size:"sm"},{default:x(()=>[...t[66]||(t[66]=[c(" 解除争议 ",-1)])]),_:1})])):u("",!0)])])])):u("",!0),!l.$page.props.auth.user?.telegram_chat_id&&s.order.status!=="cancelled"&&s.order.status!=="completed"?(a(),o("div",ls,[e("div",os,[e("div",ds,[t[68]||(t[68]=e("div",{class:"flex items-start gap-3 flex-1"},[e("svg",{class:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.56c-.21 2.27-1.13 7.75-1.6 10.29-.2 1.08-.59 1.44-.97 1.47-.82.07-1.45-.54-2.24-.99-1.24-.71-1.94-1.16-3.14-1.85-1.39-.8-.49-1.24.3-1.96.21-.19 3.85-3.52 3.91-3.82.01-.04.01-.19-.07-.27-.08-.08-.2-.05-.28-.03-.12.03-2.02.13-5.7 3.75-.54.54-1.03.8-1.48.78-.49-.02-1.42-.27-2.11-.5-.85-.28-1.53-.42-1.47-.89.03-.25.37-.51 1.02-.77 4-1.74 6.67-2.89 8.01-3.44 3.81-1.57 4.61-1.84 5.13-1.85.11 0 .37.03.53.18.14.12.18.28.2.45-.01.06-.01.24-.02.38z"})]),e("div",{class:"flex-1"},[e("p",{class:"text-sm font-medium text-blue-800 dark:text-blue-200"},"建议连接 Telegram 接收实时通知"),e("p",{class:"text-xs text-blue-700 dark:text-blue-300 mt-1"}," 连接 Telegram 后，您可以实时收到交易状态更新、对方消息提醒等重要通知，确保不错过任何关键信息。 ")])],-1)),e("div",is,[b(fe(Pe),{href:"/notifications/settings",class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors"},{default:x(()=>[...t[67]||(t[67]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.56c-.21 2.27-1.13 7.75-1.6 10.29-.2 1.08-.59 1.44-.97 1.47-.82.07-1.45-.54-2.24-.99-1.24-.71-1.94-1.16-3.14-1.85-1.39-.8-.49-1.24.3-1.96.21-.19 3.85-3.52 3.91-3.82.01-.04.01-.19-.07-.27-.08-.08-.2-.05-.28-.03-.12.03-2.02.13-5.7 3.75-.54.54-1.03.8-1.48.78-.49-.02-1.42-.27-2.11-.5-.85-.28-1.53-.42-1.47-.89.03-.25.37-.51 1.02-.77 4-1.74 6.67-2.89 8.01-3.44 3.81-1.57 4.61-1.84 5.13-1.85.11 0 .37.03.53.18.14.12.18.28.2.45-.01.06-.01.24-.02.38z"})],-1),c(" 立即设置 ",-1)])]),_:1})])])])])):u("",!0),b(Ze,{modelValue:$.value,"onUpdate:modelValue":t[9]||(t[9]=r=>$.value=r),title:"交易详情",subtitle:`订单 #${s.order.order_no}`,position:"bottom",size:"default","icon-color":"blue"},{"header-icon":x(()=>[...t[69]||(t[69]=[e("div",{class:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30"},[e("svg",{class:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})])],-1)])]),default:x(()=>[e("div",ns,[e("div",us,[e("div",cs,[e("div",xs,[t[70]||(t[70]=e("svg",{class:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z","clip-rule":"evenodd"})],-1)),e("div",null,[e("p",ms,d(ke(s.order.escrow_status)),1),e("p",vs,"当前进度: "+d(de(s.order.escrow_status))+"%",1)])])]),e("div",null,[t[94]||(t[94]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-slate-100 mb-3"},"交易流程",-1)),e("div",fs,[e("div",bs,[t[73]||(t[73]=e("div",{class:"flex flex-col items-center"},[e("div",{class:"w-8 h-8 rounded-full bg-emerald-600 text-white flex items-center justify-center"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])]),e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-slate-600"})],-1)),e("div",gs,[t[72]||(t[72]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-slate-100"},"订单创建",-1)),e("p",ks,d(s.order.created_at?V(s.order.created_at):"已完成"),1),s.order.escrow_status==="order_initiated"&&s.availableActions.includes("vendor_confirm")?(a(),o("div",ys,[b(v,{onClick:t[2]||(t[2]=r=>z("vendor_confirm")),variant:"primary",size:"md",fullWidth:""},{default:x(()=>[...t[71]||(t[71]=[c(" 确认接单 ",-1)])]),_:1})])):u("",!0)])]),e("div",ps,[e("div",ws,[e("div",{class:f(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="order_initiated"?"bg-amber-500 animate-pulse":["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-slate-700"])},[["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),o("svg",hs,[...t[74]||(t[74]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",_s,"2"))],2),t[75]||(t[75]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-slate-600"},null,-1))]),e("div",Cs,[e("p",{class:f(["text-sm font-medium",["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-600 dark:text-slate-300"])}," 商家确认 ",2),e("p",$s,d(s.order.vendor_confirmed_at?V(s.order.vendor_confirmed_at):"等待商家确认订单"),1)])]),e("div",zs,[e("div",Ms,[e("div",{class:f(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="vendor_confirmed"?"bg-amber-500 animate-pulse":["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-slate-700"])},[["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),o("svg",js,[...t[76]||(t[76]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",Fs,"3"))],2),t[77]||(t[77]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-slate-600"},null,-1))]),e("div",Bs,[e("p",{class:f(["text-sm font-medium",["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-600 dark:text-slate-300"])}," 卖家转币到托管 ",2),e("p",As,d(s.order.seller_paid_at?V(s.order.seller_paid_at):"等待卖家转币"),1),s.order.escrow_status==="vendor_confirmed"&&s.availableActions.includes("mark_seller_paid")?(a(),o("div",Ls,[b(v,{onClick:t[3]||(t[3]=r=>z("mark_seller_paid")),variant:"primary",size:"md",fullWidth:""},{default:x(()=>[...t[78]||(t[78]=[c(" 我已转币 ",-1)])]),_:1})])):u("",!0)])]),e("div",Vs,[e("div",Ss,[e("div",{class:f(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="seller_paid"?"bg-amber-500 animate-pulse":["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-slate-700"])},[["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),o("svg",Ts,[...t[79]||(t[79]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",Us,"4"))],2),t[80]||(t[80]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-slate-600"},null,-1))]),e("div",Es,[e("p",{class:f(["text-sm font-medium",["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-600 dark:text-slate-300"])}," 托管确认到账 ",2),e("p",Is,d(s.order.escrow_received_at?V(s.order.escrow_received_at):"系统确认中"),1),s.order.escrow_status==="seller_paid"?(a(),o("div",qs,[e("div",Ws,[b(v,{onClick:t[4]||(t[4]=r=>ne("received")),variant:"success",size:"xs",fullWidth:""},{default:x(()=>[...t[81]||(t[81]=[c(" 模拟已收到 ",-1)])]),_:1}),b(v,{onClick:t[5]||(t[5]=r=>ne("not_received")),variant:"danger",size:"xs",fullWidth:""},{default:x(()=>[...t[82]||(t[82]=[c(" 模拟未收到 ",-1)])]),_:1})]),t[83]||(t[83]=e("p",{class:"text-xs text-amber-600 dark:text-amber-400 text-center"}," 🧪 测试模式 ",-1))])):u("",!0)])]),e("div",Rs,[e("div",Hs,[e("div",{class:f(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="escrow_received"?"bg-amber-500 animate-pulse":["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-slate-700"])},[["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),o("svg",Ps,[...t[84]||(t[84]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",Ds,"5"))],2),t[85]||(t[85]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-slate-600"},null,-1))]),e("div",Ns,[e("p",{class:f(["text-sm font-medium",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-600 dark:text-slate-300"])}," 买家确认托管到账 ",2),e("p",Os,d(s.order.buyer_confirmed_escrow_at?V(s.order.buyer_confirmed_escrow_at):"等待买家确认"),1),s.order.escrow_status==="escrow_received"&&s.availableActions.includes("confirm_escrow")?(a(),o("div",Ks,[b(v,{onClick:t[6]||(t[6]=r=>z("confirm_escrow")),variant:"primary",size:"md",fullWidth:""},{default:x(()=>[...t[86]||(t[86]=[c(" 确认托管到账 ",-1)])]),_:1})])):u("",!0)])]),e("div",Xs,[e("div",Gs,[e("div",{class:f(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="buyer_confirmed_escrow"?"bg-amber-500 animate-pulse":["buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-slate-700"])},[["buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),o("svg",Js,[...t[87]||(t[87]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",Qs,"6"))],2),t[88]||(t[88]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-slate-600"},null,-1))]),e("div",Ys,[e("p",{class:f(["text-sm font-medium",["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-600 dark:text-slate-300"])}," 买家付款 ",2),e("p",Zs,d(s.order.buyer_paid_at?V(s.order.buyer_paid_at):"等待买家付款"),1),s.order.escrow_status==="buyer_confirmed_escrow"&&s.availableActions.includes("mark_buyer_paid")?(a(),o("div",er,[b(v,{onClick:t[7]||(t[7]=r=>z("mark_buyer_paid")),variant:"primary",size:"md",fullWidth:""},{default:x(()=>[...t[89]||(t[89]=[c(" 我已付款 ",-1)])]),_:1})])):u("",!0)])]),e("div",tr,[e("div",sr,[e("div",{class:f(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="buyer_paid"?"bg-amber-500 animate-pulse":["seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-slate-700"])},[["seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),o("svg",rr,[...t[90]||(t[90]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",ar,"7"))],2),t[91]||(t[91]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-slate-600"},null,-1))]),e("div",lr,[e("p",{class:f(["text-sm font-medium",["buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-600 dark:text-slate-300"])}," 卖家确认收款 ",2),e("p",or,d(s.order.seller_received_at?V(s.order.seller_received_at):"等待卖家确认"),1),s.order.escrow_status==="buyer_paid"&&s.availableActions.includes("mark_seller_received")?(a(),o("div",dr,[b(v,{onClick:t[8]||(t[8]=r=>z("mark_seller_received")),variant:"success",size:"md",fullWidth:""},{default:x(()=>[...t[92]||(t[92]=[c(" 确认收款 ",-1)])]),_:1})])):u("",!0)])]),e("div",ir,[e("div",nr,[e("div",{class:f(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="seller_received"?"bg-amber-500 animate-pulse":s.order.escrow_status==="escrow_released"?"bg-emerald-600":"bg-gray-300 dark:bg-slate-700"])},[s.order.escrow_status==="escrow_released"?(a(),o("svg",ur,[...t[93]||(t[93]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",cr,"8"))],2)]),e("div",xr,[e("p",{class:f(["text-sm font-medium",["seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-600 dark:text-slate-300"])}," 托管释放 ",2),e("p",mr,d(s.order.escrow_released_at?V(s.order.escrow_released_at):"平台释放币给买家"),1)])])])]),e("div",null,[t[105]||(t[105]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-slate-100 mb-2"},"交易信息",-1)),e("div",vr,[e("div",null,[t[95]||(t[95]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400"},"订单编号",-1)),e("p",fr,"#"+d(s.order.order_no),1)]),e("div",null,[t[96]||(t[96]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400"},"商家",-1)),e("p",br,d(s.order.vendor?.name||"加载中..."),1)]),e("div",null,[t[97]||(t[97]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400"},"客户",-1)),e("p",gr,d(s.order.client?.name||"加载中..."),1)]),e("div",null,[t[98]||(t[98]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400"},"买家",-1)),e("p",kr,d(s.order.buyer?.name||"加载中..."),1)]),e("div",null,[t[99]||(t[99]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400"},"卖家",-1)),e("p",yr,d(s.order.seller?.name||"加载中..."),1)]),e("div",null,[t[100]||(t[100]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400"},"币种",-1)),e("p",pr,d(s.order.currency_label||s.order.currency_key||s.order.crypto_currency),1)]),e("div",null,[t[101]||(t[101]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400"},"数量（含交易费）",-1)),e("p",wr,d(parseFloat(s.order.crypto_amount).toFixed(4))+" "+d(s.order.currency_label||s.order.currency_key||s.order.crypto_currency),1),s.order.fee&&s.order.fee>0?(a(),o("p",hr," 交易费（商家）: "+d(parseFloat(s.order.fee).toFixed(8))+" "+d(s.order.currency_label||s.order.currency_key||s.order.crypto_currency),1)):u("",!0)]),e("div",null,[t[102]||(t[102]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400"},"单价",-1)),e("p",_r,"¥"+d(parseFloat(s.order.price).toFixed(2)),1)]),e("div",null,[t[103]||(t[103]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400"},"总金额",-1)),e("p",Cr,"¥"+d(parseFloat(s.order.fiat_amount).toFixed(2)),1)])]),s.order.seller_address?(a(),o("div",$r,[t[104]||(t[104]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400 block mb-1"},"卖家地址",-1)),e("p",zr,d(s.order.seller_address),1)])):u("",!0)])])])]),_:1},8,["modelValue","subtitle"]),e("div",Mr,[e("div",jr,[e("div",Fr,[e("div",Br,[e("div",Ar,[t[106]||(t[106]=e("h3",{class:"text-lg font-bold text-gray-900 dark:text-slate-100"},"交易详情",-1)),e("span",{class:f([je(s.order.escrow_status),"px-3 py-1 text-xs font-semibold rounded-full"])},d(ke(s.order.escrow_status)),3)]),i.value.escrow_status==="escrow_released"&&s.currentUserId===i.value.client_id?(a(),o("div",Lr,[i.value.has_review?(a(),o("div",Sr,[...t[110]||(t[110]=[e("div",{class:"flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-emerald-600 dark:text-emerald-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})]),e("span",{class:"text-sm font-medium text-emerald-800 dark:text-emerald-200"},"您已评价此交易")],-1)])])):(a(),o("div",Vr,[t[109]||(t[109]=e("div",{class:"flex items-center justify-between"},[e("div",{class:"flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})]),e("span",{class:"text-sm font-medium text-amber-800 dark:text-amber-200"},"交易已完成，请评价")])],-1)),b(v,{onClick:t[10]||(t[10]=r=>F.value=!0),variant:"primary",size:"sm",fullWidth:"",class:"mt-2"},{icon:x(()=>[...t[107]||(t[107]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})],-1)])]),default:x(()=>[t[108]||(t[108]=c(" 立即评价商家 ",-1))]),_:1})]))])):u("",!0),e("div",Tr,[e("div",Ur,[t[111]||(t[111]=e("span",null,"交易进度",-1)),e("span",null,d(de(s.order.escrow_status))+"%",1)]),e("div",Er,[e("div",{class:"bg-gradient-to-r from-emerald-500 to-emerald-600 h-2 rounded-full",style:ve(`width: ${de(s.order.escrow_status)}%`)},null,4)])]),e("div",Ir,[e("div",null,[e("div",qr,[t[113]||(t[113]=e("div",{class:"w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center"},[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)),e("div",Wr,[t[112]||(t[112]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-slate-100"},"订单创建",-1)),e("p",Rr,d(s.order.created_at?V(s.order.created_at):"已完成"),1)])])]),e("div",null,[e("div",Hr,[e("div",{class:f(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="order_initiated"?"bg-amber-500 animate-pulse":["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-slate-700"])},[["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),o("svg",Pr,[...t[114]||(t[114]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",Dr,"2"))],2),e("div",Nr,[e("p",{class:f(["text-sm font-medium",["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-400 dark:text-slate-500"])}," 商家确认 ",2),e("p",{class:f(["text-xs",["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-500 dark:text-slate-400":"text-gray-400 dark:text-slate-600"])},d(s.order.vendor_confirmed_at?V(s.order.vendor_confirmed_at):s.order.escrow_status==="order_initiated"?"等待中...":"待完成"),3)])]),s.order.escrow_status==="order_initiated"&&s.availableActions.includes("vendor_confirm")?(a(),o("div",Or,[b(v,{onClick:t[11]||(t[11]=r=>z("vendor_confirm")),variant:"primary",size:"sm",fullWidth:""},{default:x(()=>[...t[115]||(t[115]=[c(" 确认接单 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",Kr,[e("div",{class:f(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="vendor_confirmed"?"bg-amber-500 animate-pulse":["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-slate-700"])},[["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),o("svg",Xr,[...t[116]||(t[116]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",Gr,"3"))],2),e("div",Jr,[e("p",{class:f(["text-sm font-medium",["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-400 dark:text-slate-500"])}," 卖家转币到托管 ",2),e("p",{class:f(["text-xs",["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-500 dark:text-slate-400":"text-gray-400 dark:text-slate-600"])},d(s.order.seller_paid_at?V(s.order.seller_paid_at):s.order.escrow_status==="vendor_confirmed"?"等待中...":"待完成"),3),s.order.escrow_tx_hash?(a(),o("p",Qr," TX: "+d(s.order.escrow_tx_hash),1)):u("",!0)])]),s.order.escrow_status==="vendor_confirmed"&&s.availableActions.includes("mark_seller_paid")?(a(),o("div",Yr,[b(v,{onClick:t[12]||(t[12]=r=>z("mark_seller_paid")),variant:"primary",size:"sm",fullWidth:""},{default:x(()=>[...t[117]||(t[117]=[c(" 我已转币到托管 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",Zr,[e("div",{class:f(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="seller_paid"?"bg-amber-500 animate-pulse":["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-slate-700"])},[["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),o("svg",ea,[...t[118]||(t[118]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",ta,"4"))],2),e("div",sa,[e("p",{class:f(["text-sm font-medium",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-400 dark:text-slate-500"])}," 托管确认到账 ",2),e("p",{class:f(["text-xs",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-500 dark:text-slate-400":"text-gray-400 dark:text-slate-600"])},d(s.order.escrow_received_at?V(s.order.escrow_received_at):s.order.escrow_status==="seller_paid"?"系统确认中...":"待完成"),3)])]),s.order.escrow_status==="seller_paid"?(a(),o("div",ra,[e("div",aa,[b(v,{onClick:t[13]||(t[13]=r=>ne("received")),variant:"success",size:"sm",fullWidth:""},{default:x(()=>[...t[119]||(t[119]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),c(" 模拟已收到 ",-1)])]),_:1}),b(v,{onClick:t[14]||(t[14]=r=>ne("not_received")),variant:"danger",size:"sm",fullWidth:""},{default:x(()=>[...t[120]||(t[120]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),c(" 模拟未收到 ",-1)])]),_:1})]),t[121]||(t[121]=e("p",{class:"text-xs text-amber-600 dark:text-amber-400 text-center"}," 🧪 测试模式：模拟区块链确认 ",-1))])):u("",!0)]),e("div",null,[e("div",la,[e("div",{class:f(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="escrow_received"?"bg-amber-500 animate-pulse":["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-slate-700"])},[["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),o("svg",oa,[...t[122]||(t[122]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",da,"5"))],2),e("div",ia,[e("p",{class:f(["text-sm font-medium",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-400 dark:text-slate-500"])}," 买家确认托管到账 ",2),e("p",{class:f(["text-xs",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-500 dark:text-slate-400":"text-gray-400 dark:text-slate-600"])},d(s.order.buyer_confirmed_escrow_at?V(s.order.buyer_confirmed_escrow_at):s.order.escrow_status==="escrow_received"?"等待确认...":"待完成"),3)])]),s.order.escrow_status==="escrow_received"&&s.availableActions.includes("confirm_escrow")?(a(),o("div",na,[b(v,{onClick:t[15]||(t[15]=r=>z("confirm_escrow")),variant:"primary",size:"sm",fullWidth:""},{default:x(()=>[...t[123]||(t[123]=[c(" 确认托管到账 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",ua,[e("div",{class:f(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="buyer_confirmed_escrow"?"bg-amber-500 animate-pulse":["buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-slate-700"])},[["buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),o("svg",ca,[...t[124]||(t[124]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",xa,"6"))],2),e("div",ma,[e("p",{class:f(["text-sm font-medium",["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-400 dark:text-slate-500"])}," 买家付款 ",2),e("p",va,d(s.order.buyer_paid_at?V(s.order.buyer_paid_at):s.order.escrow_status==="buyer_confirmed_escrow"?"等待中...":"待完成"),1)])]),s.order.escrow_status==="buyer_confirmed_escrow"&&s.availableActions.includes("mark_buyer_paid")?(a(),o("div",fa,[b(v,{onClick:t[16]||(t[16]=r=>z("mark_buyer_paid")),variant:"primary",size:"sm",fullWidth:""},{default:x(()=>[...t[125]||(t[125]=[c(" 我已付款 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",ba,[e("div",{class:f(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="buyer_paid"?"bg-amber-500 animate-pulse":["seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-slate-700"])},[["seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),o("svg",ga,[...t[126]||(t[126]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",ka,"7"))],2),e("div",ya,[e("p",{class:f(["text-sm font-medium",["buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-400 dark:text-slate-500"])}," 卖家确认收款 ",2),e("p",{class:f(["text-xs",["buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-500 dark:text-slate-400":"text-gray-400 dark:text-slate-600"])},d(s.order.seller_received_at?V(s.order.seller_received_at):s.order.escrow_status==="buyer_paid"?"等待中...":"待完成"),3)])]),s.order.escrow_status==="buyer_paid"&&s.availableActions.includes("mark_seller_received")?(a(),o("div",pa,[b(v,{onClick:t[17]||(t[17]=r=>z("mark_seller_received")),variant:"success",size:"sm",fullWidth:""},{default:x(()=>[...t[127]||(t[127]=[c(" 确认收款 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",wa,[e("div",{class:f(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="seller_received"?"bg-amber-500 animate-pulse":s.order.escrow_status==="escrow_released"?"bg-emerald-500":"bg-gray-300 dark:bg-slate-700"])},[s.order.escrow_status==="escrow_released"?(a(),o("svg",ha,[...t[128]||(t[128]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),o("span",_a,"8"))],2),e("div",Ca,[e("p",{class:f(["text-sm font-medium",["seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-400 dark:text-slate-500"])}," 托管释放 ",2),e("p",{class:f(["text-xs",["seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-500 dark:text-slate-400":"text-gray-400 dark:text-slate-600"])},d(s.order.escrow_released_at?V(s.order.escrow_released_at):s.order.escrow_status==="seller_received"?"处理中...":"待完成"),3)])])])]),e("div",$a,[e("div",za,[t[129]||(t[129]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"订单编号",-1)),e("span",Ma,"#"+d(s.order.order_no),1)]),e("div",ja,[t[130]||(t[130]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"商家",-1)),e("span",Fa,d(s.order.vendor?.name||"加载中..."),1)]),e("div",Ba,[t[131]||(t[131]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"客户",-1)),e("span",Aa,d(s.order.client?.name||"加载中..."),1)]),e("div",La,[t[132]||(t[132]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"买家",-1)),e("span",Va,d(s.order.buyer?.name||"加载中..."),1)]),e("div",Sa,[t[133]||(t[133]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"卖家",-1)),e("span",Ta,d(s.order.seller?.name||"加载中..."),1)]),e("div",Ua,[t[134]||(t[134]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"数量（含交易费）",-1)),e("span",Ea,d(parseFloat(s.order.crypto_amount).toFixed(4))+" "+d(s.order.currency_label||s.order.currency_key||s.order.crypto_currency),1)]),s.order.fee&&s.order.fee>0?(a(),o("div",Ia,[t[135]||(t[135]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"交易费（商家）",-1)),e("span",qa,d(parseFloat(s.order.fee).toFixed(8))+" "+d(s.order.currency_label||s.order.currency_key||s.order.crypto_currency),1)])):u("",!0),e("div",Wa,[t[136]||(t[136]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"单价",-1)),e("span",Ra,"¥"+d(parseFloat(s.order.price).toFixed(2)),1)]),e("div",Ha,[t[137]||(t[137]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"总金额",-1)),e("span",Pa,"¥"+d(parseFloat(s.order.fiat_amount).toFixed(2)),1)]),s.order.seller_address?(a(),o("div",Da,[t[138]||(t[138]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"卖家地址",-1)),e("span",Na,d(s.order.seller_address),1)])):u("",!0)])])]),e("div",Oa,[e("div",Ka,[e("div",Xa,[e("div",Ga,[e("div",Ja,[e("div",Qa,[e("div",Ya,[(a(!0),o(E,null,X(k.value,(r,g)=>(a(),o("a",{key:r.id,href:`/trader/profile/${r.id}`,target:"_blank",class:"relative hover:opacity-80 transition-opacity cursor-pointer",style:ve(`z-index: ${k.value.length-g}`)},[e("div",el,[e("span",tl,d(r.name?.[0]?.toUpperCase()||"U"),1)]),r.is_online?(a(),o("div",sl)):u("",!0)],12,Za))),128))]),e("div",rl,[e("div",al,[e("p",ll,[c(" 订单 #"+d(s.order.order_no)+" 聊天室 ",1),e("span",ol,"("+d(k.value.length)+"人)",1)])]),e("p",dl,[(a(!0),o(E,null,X(k.value,(r,g)=>(a(),o("span",{key:r.id},[e("span",{class:f([r.is_online?"text-emerald-600 dark:text-emerald-400":"text-gray-400 dark:text-gray-500",r.is_admin?"font-medium":""])},d(r.name),3),g<k.value.length-1?(a(),o("span",il," · ")):u("",!0)]))),128))])])]),t[139]||(t[139]=e("div",{class:"flex items-center gap-2"},null,-1))])]),t[140]||(t[140]=e("div",{class:"px-6 pb-3"},[e("div",{class:"flex items-center gap-2 p-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("p",{class:"text-xs text-amber-800 dark:text-amber-300"},[e("span",{class:"font-semibold"},"安全提醒："),c("请勿相信任何平台外的交易邀请，谨防诈骗 ")])])],-1))]),e("div",{ref_key:"messageContainer",ref:B,class:"flex-1 overflow-y-auto p-6 space-y-4"},[t[144]||(t[144]=e("div",{class:"flex justify-center"},[e("div",{class:"px-3 py-1 bg-gray-100 dark:bg-slate-800 rounded-full text-xs text-gray-500 dark:text-slate-400"}," 订单已创建，等待商家确认 ")],-1)),(a(!0),o(E,null,X(_.value,r=>(a(),o("div",{key:r.id,class:f(["flex",r.type==="system"?"justify-center":"gap-3",r.type!=="system"&&r.user?.id===l.$page.props.auth.user?.id?"justify-end":""])},[r.type==="system"?(a(),o("div",nl,[r.user?(a(),o("span",ul,d(r.user.name),1)):u("",!0),c(" "+d(r.message),1)])):r.user?.id!==l.$page.props.auth.user?.id?(a(),o(E,{key:1},[e("a",{href:`/trader/profile/${r.user.id}`,target:"_blank",class:"h-8 w-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center flex-shrink-0 hover:opacity-80 transition-opacity cursor-pointer"},[e("span",xl,d(r.user.name.charAt(0)),1)],8,cl),e("div",ml,[e("p",vl,[c(d(r.user.name)+" ",1),r.type==="admin"?(a(),o("span",fl,"(Admin)")):u("",!0)]),e("div",bl,[r.attachment?(a(),o("div",gl,[r.attachment.type&&r.attachment.type.startsWith("image/")?(a(),o("img",{key:0,src:r.attachment.url,alt:r.attachment.name,class:"max-w-full rounded-lg cursor-pointer",onClick:g=>l.window.open(r.attachment.url,"_blank")},null,8,kl)):r.attachment.type==="application/pdf"?(a(),o("a",{key:1,href:r.attachment.url,target:"_blank",class:"flex items-center gap-2 p-2 bg-white dark:bg-slate-700 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-600 transition-colors"},[t[141]||(t[141]=e("div",{class:"w-10 h-12 bg-red-100 dark:bg-red-900/30 rounded flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-red-600 dark:text-red-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-5L9 2H4z","clip-rule":"evenodd"})])],-1)),e("div",pl,[e("p",wl,d(r.attachment.name),1),e("p",hl,d(ee(r.attachment.size)),1)])],8,yl)):u("",!0)])):u("",!0),r.message?(a(),o("p",_l,d(r.message),1)):u("",!0)]),e("p",Cl,d(V(r.created_at)),1)])],64)):(a(),o(E,{key:2},[e("div",$l,[e("p",zl,[c(d(r.user.name)+" ",1),r.type==="admin"?(a(),o("span",Ml,"(Admin)")):u("",!0)]),e("div",jl,[r.attachment?(a(),o("div",Fl,[r.attachment.type&&r.attachment.type.startsWith("image/")?(a(),o("img",{key:0,src:r.attachment.url,alt:r.attachment.name,class:"max-w-full rounded-lg cursor-pointer",onClick:g=>l.window.open(r.attachment.url,"_blank")},null,8,Bl)):r.attachment.type==="application/pdf"?(a(),o("a",{key:1,href:r.attachment.url,target:"_blank",class:"flex items-center gap-2 p-2 bg-emerald-500 rounded-lg hover:bg-emerald-400 transition-colors"},[t[142]||(t[142]=e("div",{class:"w-10 h-12 bg-white/20 rounded flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-5L9 2H4z","clip-rule":"evenodd"})])],-1)),e("div",Ll,[e("p",Vl,d(r.attachment.name),1),e("p",Sl,d(ee(r.attachment.size)),1)])],8,Al)):u("",!0)])):u("",!0),r.message?(a(),o("p",Tl,d(r.message),1)):u("",!0)]),e("p",Ul,d(V(r.created_at)),1)]),t[143]||(t[143]=e("div",{class:"h-8 w-8 rounded-full bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center flex-shrink-0"},[e("span",{class:"text-white text-sm font-bold"},"我")],-1))],64))],2))),128))],512),e("div",El,[y.value?(a(),o("div",Il,[e("div",ql,[y.value.type.startsWith("image/")?(a(),o("img",{key:0,src:A.value,alt:y.value.name,class:"max-h-32 rounded-lg"},null,8,Wl)):y.value.type==="application/pdf"?(a(),o("div",Rl,[...t[145]||(t[145]=[e("svg",{class:"w-8 h-8 text-red-600 dark:text-red-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-5L9 2H4z","clip-rule":"evenodd"})],-1)])])):u("",!0),e("div",Hl,[e("p",Pl,d(y.value.name),1),e("p",Dl,d(ee(y.value.size)),1)]),e("button",{onClick:pe,type:"button",class:"p-1 rounded hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors"},[...t[146]||(t[146]=[e("svg",{class:"w-4 h-4 text-gray-500 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])])):u("",!0),e("form",{onSubmit:$e(me,["prevent"]),class:"flex gap-2"},[e("input",{ref_key:"fileInput",ref:N,type:"file",onChange:ye,accept:".pdf,image/*",class:"hidden"},null,544),e("button",{type:"button",onClick:t[18]||(t[18]=r=>!O.value&&l.$refs.fileInput.click()),disabled:O.value,class:"p-2 rounded-lg text-gray-500 hover:text-gray-700 dark:text-slate-400 dark:hover:text-slate-200 hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent"},[...t[147]||(t[147]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)])],8,Nl),R(e("input",{"onUpdate:modelValue":t[19]||(t[19]=r=>w.value=r),type:"text",placeholder:O.value?"交易已结束，无法发送消息":"输入消息...",class:"flex-1 px-4 py-2 bg-gray-100 dark:bg-slate-800 border-0 rounded-lg text-sm text-gray-900 dark:text-slate-200 placeholder-gray-500 dark:placeholder-slate-400 focus:ring-2 focus:ring-emerald-500 disabled:opacity-50",disabled:!p.value||O.value},null,8,Ol),[[te,w.value]]),e("button",{type:"submit",disabled:!w.value.trim()&&!y.value||!p.value||I.value||O.value,class:"px-4 py-2 bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg font-medium text-sm transition-colors flex items-center gap-2"},[I.value?(a(),o("span",Xl,[...t[148]||(t[148]=[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):u("",!0),e("span",null,d(I.value?"发送中...":"发送"),1)],8,Kl)],32),e("div",Gl,[e("button",{onClick:t[20]||(t[20]=r=>Q("已付款")),class:"px-3 py-1 bg-gray-100 dark:bg-slate-800 hover:bg-gray-200 dark:hover:bg-slate-700 text-xs text-gray-700 dark:text-slate-300 rounded-full transition-colors"}," 已付款 "),e("button",{onClick:t[21]||(t[21]=r=>Q("请确认收款")),class:"px-3 py-1 bg-gray-100 dark:bg-slate-800 hover:bg-gray-200 dark:hover:bg-slate-700 text-xs text-gray-700 dark:text-slate-300 rounded-full transition-colors"}," 请确认收款 "),e("button",{onClick:t[22]||(t[22]=r=>Q("谢谢")),class:"px-3 py-1 bg-gray-100 dark:bg-slate-800 hover:bg-gray-200 dark:hover:bg-slate-700 text-xs text-gray-700 dark:text-slate-300 rounded-full transition-colors"}," 谢谢 "),!l.$page.props.auth.user?.telegram_chat_id&&s.order.status!=="cancelled"&&s.order.status!=="completed"?(a(),o("a",Jl,[...t[149]||(t[149]=[e("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.56c-.21 2.27-1.13 7.75-1.6 10.29-.2 1.08-.59 1.44-.97 1.47-.82.07-1.45-.54-2.24-.99-1.24-.71-1.94-1.16-3.14-1.85-1.39-.8-.49-1.24.3-1.96.21-.19 3.85-3.52 3.91-3.82.01-.04.01-.19-.07-.27-.08-.08-.2-.05-.28-.03-.12.03-2.02.13-5.7 3.75-.54.54-1.03.8-1.48.78-.49-.02-1.42-.27-2.11-.5-.85-.28-1.53-.42-1.47-.89.03-.25.37-.51 1.02-.77 4-1.74 6.67-2.89 8.01-3.44 3.81-1.57 4.61-1.84 5.13-1.85.11 0 .37.03.53.18.14.12.18.28.2.45-.01.06-.01.24-.02.38z"})],-1),c(" 实时通知 ",-1)])])):u("",!0)])]),s.order.status!=="completed"&&s.order.status!=="cancelled"&&s.order.escrow_status!=="escrow_released"?(a(),o("div",Ql,[e("div",Yl,[(a(!0),o(E,null,X(s.availableActions,r=>(a(),o(E,{key:r},[r==="vendor_confirm"?(a(),j(v,{key:0,onClick:t[23]||(t[23]=g=>z("vendor_confirm")),variant:"primary",size:"md",fullWidth:""},{default:x(()=>[...t[150]||(t[150]=[c(" 确认订单 ",-1)])]),_:1})):u("",!0),r==="mark_seller_paid"?(a(),j(v,{key:1,onClick:t[24]||(t[24]=g=>z("mark_seller_paid")),variant:"primary",size:"md",fullWidth:""},{default:x(()=>[...t[151]||(t[151]=[c(" 我已转币到托管 ",-1)])]),_:1})):u("",!0),r==="confirm_escrow"?(a(),j(v,{key:2,onClick:t[25]||(t[25]=g=>z("confirm_escrow")),variant:"primary",size:"md",fullWidth:""},{default:x(()=>[...t[152]||(t[152]=[c(" 确认托管到账 ",-1)])]),_:1})):u("",!0),r==="mark_buyer_paid"?(a(),j(v,{key:3,onClick:t[26]||(t[26]=g=>z("mark_buyer_paid")),variant:"primary",size:"md",fullWidth:""},{default:x(()=>[...t[153]||(t[153]=[c(" 我已付款 ",-1)])]),_:1})):u("",!0),r==="mark_seller_received"?(a(),j(v,{key:4,onClick:t[27]||(t[27]=g=>z("mark_seller_received")),variant:"success",size:"md",fullWidth:""},{default:x(()=>[...t[154]||(t[154]=[c(" 确认收款 ",-1)])]),_:1})):u("",!0),r==="cancel"?(a(),j(v,{key:5,onClick:t[28]||(t[28]=g=>z("cancel")),variant:"secondary",size:"md",fullWidth:""},{default:x(()=>[...t[155]||(t[155]=[c(" 取消订单 ",-1)])]),_:1})):u("",!0)],64))),128)),s.availableActions.includes("create_dispute")?(a(),j(v,{key:0,onClick:t[29]||(t[29]=r=>z("create_dispute")),variant:"warning",size:"md",fullWidth:""},{default:x(()=>[...t[156]||(t[156]=[c(" 发起争议 ",-1)])]),_:1})):u("",!0),s.availableActions.includes("resolve_dispute")?(a(),j(v,{key:1,onClick:t[30]||(t[30]=r=>z("resolve_dispute")),variant:"success",size:"md",fullWidth:""},{default:x(()=>[...t[157]||(t[157]=[c(" 解除争议 ",-1)])]),_:1})):u("",!0)])])):u("",!0)]),e("div",Zl,[s.order.ad_snapshot?.vendor_toc?(a(),o("div",eo,[t[158]||(t[158]=e("div",{class:"flex items-center gap-2 mb-3"},[e("svg",{class:"w-5 h-5 text-purple-600 dark:text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),e("h3",{class:"text-sm font-bold text-gray-900 dark:text-slate-100"},"交易条款")],-1)),e("div",to,[e("p",so,d(s.order.ad_snapshot?.vendor_toc||"无交易条款"),1)]),t[159]||(t[159]=e("div",{class:"mt-3 p-2 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("p",{class:"text-xs text-amber-700 dark:text-amber-300"}," 请仔细阅读并遵守以上交易条款，违反条款可能导致交易取消 ")])],-1))])):u("",!0)])])]),e("div",ro,[i.value.escrow_status==="escrow_released"&&s.currentUserId===i.value.client_id&&!i.value.has_review?(a(),o("div",ao,[e("div",lo,[t[161]||(t[161]=e("div",{class:"flex items-center gap-2 flex-1"},[e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})]),e("div",null,[e("p",{class:"text-sm font-medium text-amber-800 dark:text-amber-200"},"交易已完成"),e("p",{class:"text-xs text-amber-700 dark:text-amber-300"},"请对商家进行评价")])],-1)),b(v,{onClick:t[31]||(t[31]=r=>F.value=!0),variant:"primary",size:"sm"},{default:x(()=>[...t[160]||(t[160]=[c(" 立即评价 ",-1)])]),_:1})])])):u("",!0),e("div",{ref_key:"mobileMessageContainer",ref:m,class:"flex-1 overflow-y-auto bg-white dark:bg-slate-950"},[e("div",oo,[t[165]||(t[165]=e("div",{class:"flex justify-center"},[e("div",{class:"px-3 py-1 bg-gray-100 dark:bg-slate-800 rounded-full text-xs text-gray-500 dark:text-slate-400"}," 订单已创建，等待商家确认 ")],-1)),(a(!0),o(E,null,X(_.value,r=>(a(),o("div",{key:r.id,class:f(["flex",r.type==="system"?"justify-center":"gap-2",r.type!=="system"&&r.user?.id===l.$page.props.auth.user?.id?"justify-end":""])},[r.type==="system"?(a(),o("div",io,[r.user?(a(),o("span",no,d(r.user.name),1)):u("",!0),c(" "+d(r.message),1)])):r.user?.id!==l.$page.props.auth.user?.id?(a(),o(E,{key:1},[e("a",{href:`/trader/profile/${r.user.id}`,target:"_blank",class:"h-7 w-7 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center flex-shrink-0 hover:opacity-80 transition-opacity cursor-pointer"},[e("span",co,d(r.user.name.charAt(0)),1)],8,uo),e("div",xo,[e("p",mo,[c(d(r.user.name)+" ",1),r.type==="admin"?(a(),o("span",vo,"(Admin)")):u("",!0)]),e("div",fo,[r.attachment?(a(),o("div",bo,[r.attachment.type&&r.attachment.type.startsWith("image/")?(a(),o("img",{key:0,src:r.attachment.url,alt:r.attachment.name,class:"max-w-full rounded-lg cursor-pointer",onClick:g=>l.window.open(r.attachment.url,"_blank")},null,8,go)):r.attachment.type==="application/pdf"?(a(),o("a",{key:1,href:r.attachment.url,target:"_blank",class:"flex items-center gap-2 p-2 bg-white dark:bg-slate-700 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-600 transition-colors"},[t[162]||(t[162]=e("div",{class:"w-8 h-10 bg-red-100 dark:bg-red-900/30 rounded flex items-center justify-center"},[e("svg",{class:"w-4 h-4 text-red-600 dark:text-red-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-5L9 2H4z","clip-rule":"evenodd"})])],-1)),e("div",yo,[e("p",po,d(r.attachment.name),1),e("p",wo,d(ee(r.attachment.size)),1)])],8,ko)):u("",!0)])):u("",!0),r.message?(a(),o("p",ho,d(r.message),1)):u("",!0)]),e("p",_o,d(V(r.created_at)),1)])],64)):(a(),o(E,{key:2},[e("div",Co,[e("p",$o,[c(d(r.user.name)+" ",1),r.type==="admin"?(a(),o("span",zo,"(Admin)")):u("",!0)]),e("div",Mo,[r.attachment?(a(),o("div",jo,[r.attachment.type&&r.attachment.type.startsWith("image/")?(a(),o("img",{key:0,src:r.attachment.url,alt:r.attachment.name,class:"max-w-full rounded-lg cursor-pointer",onClick:g=>l.window.open(r.attachment.url,"_blank")},null,8,Fo)):r.attachment.type==="application/pdf"?(a(),o("a",{key:1,href:r.attachment.url,target:"_blank",class:"flex items-center gap-2 p-2 bg-emerald-500 rounded-lg hover:bg-emerald-400 transition-colors"},[t[163]||(t[163]=e("div",{class:"w-8 h-10 bg-white/20 rounded flex items-center justify-center"},[e("svg",{class:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-5L9 2H4z","clip-rule":"evenodd"})])],-1)),e("div",Ao,[e("p",Lo,d(r.attachment.name),1),e("p",Vo,d(ee(r.attachment.size)),1)])],8,Bo)):u("",!0)])):u("",!0),r.message?(a(),o("p",So,d(r.message),1)):u("",!0)]),e("p",To,d(V(r.created_at)),1)]),t[164]||(t[164]=e("div",{class:"h-7 w-7 rounded-full bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center flex-shrink-0"},[e("span",{class:"text-white text-xs font-bold"},"我")],-1))],64))],2))),128))])],512),e("div",Uo,[e("div",Eo,[(a(!0),o(E,null,X(xe.value,r=>(a(),o(E,{key:r},[r==="vendor_confirm"?(a(),j(v,{key:0,onClick:t[32]||(t[32]=g=>z("vendor_confirm")),variant:"primary",size:"sm",fullWidth:""},{default:x(()=>[...t[166]||(t[166]=[c(" 确认订单 ",-1)])]),_:1})):u("",!0),r==="mark_seller_paid"?(a(),j(v,{key:1,onClick:t[33]||(t[33]=g=>z("mark_seller_paid")),variant:"primary",size:"sm",fullWidth:""},{default:x(()=>[...t[167]||(t[167]=[c(" 我已转币 ",-1)])]),_:1})):u("",!0),r==="confirm_escrow"?(a(),j(v,{key:2,onClick:t[34]||(t[34]=g=>z("confirm_escrow")),variant:"primary",size:"sm",fullWidth:""},{default:x(()=>[...t[168]||(t[168]=[c(" 确认托管到账 ",-1)])]),_:1})):u("",!0),r==="mark_buyer_paid"?(a(),j(v,{key:3,onClick:t[35]||(t[35]=g=>z("mark_buyer_paid")),variant:"primary",size:"sm",fullWidth:""},{default:x(()=>[...t[169]||(t[169]=[c(" 我已付款 ",-1)])]),_:1})):u("",!0),r==="mark_seller_received"?(a(),j(v,{key:4,onClick:t[36]||(t[36]=g=>z("mark_seller_received")),variant:"success",size:"sm",fullWidth:""},{default:x(()=>[...t[170]||(t[170]=[c(" 确认收款 ",-1)])]),_:1})):u("",!0),r==="cancel"?(a(),j(v,{key:5,onClick:t[37]||(t[37]=g=>z("cancel")),variant:"secondary",size:"sm",fullWidth:""},{default:x(()=>[...t[171]||(t[171]=[c(" 取消订单 ",-1)])]),_:1})):u("",!0)],64))),128)),xe.value.includes("create_dispute")?(a(),j(v,{key:0,onClick:t[38]||(t[38]=r=>z("create_dispute")),variant:"warning",size:"sm",fullWidth:""},{default:x(()=>[...t[172]||(t[172]=[c(" 发起争议 ",-1)])]),_:1})):u("",!0),xe.value.includes("resolve_dispute")?(a(),j(v,{key:1,onClick:t[39]||(t[39]=r=>z("resolve_dispute")),variant:"success",size:"sm",fullWidth:""},{default:x(()=>[...t[173]||(t[173]=[c(" 解除争议 ",-1)])]),_:1})):u("",!0)])]),e("div",Io,[e("div",qo,[y.value?(a(),o("div",Wo,[e("div",Ro,[e("div",Ho,[A.value&&y.value.type.startsWith("image/")?(a(),o("img",{key:0,src:A.value,class:"w-12 h-12 object-cover rounded-lg border",alt:"预览"},null,8,Po)):(a(),o("div",Do,[...t[174]||(t[174]=[e("svg",{class:"w-6 h-6 text-gray-500 dark:text-slate-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-5L9 2H4z","clip-rule":"evenodd"})],-1)])]))]),e("div",No,[e("p",Oo,d(y.value.name),1),e("p",Ko,d(ee(y.value.size)),1)]),e("button",{onClick:t[40]||(t[40]=(...r)=>l.clearFileSelection&&l.clearFileSelection(...r)),class:"flex-shrink-0 p-1 text-gray-400 hover:text-gray-600 dark:hover:text-slate-300 transition-colors"},[...t[175]||(t[175]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])])):u("",!0),e("form",{onSubmit:$e(me,["prevent"]),class:"flex gap-2"},[e("input",{ref:"mobileFileInput",type:"file",onChange:ye,accept:".pdf,image/*",class:"hidden"},null,544),e("button",{type:"button",onClick:t[41]||(t[41]=r=>!O.value&&l.$refs.mobileFileInput.click()),disabled:O.value,class:"p-2 rounded-lg text-gray-500 hover:text-gray-700 dark:text-slate-400 dark:hover:text-slate-200 hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent"},[...t[176]||(t[176]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)])],8,Xo),R(e("input",{"onUpdate:modelValue":t[42]||(t[42]=r=>w.value=r),type:"text",placeholder:O.value?"交易已结束，无法发送消息":"输入消息...",class:"flex-1 px-3 py-2 bg-gray-100 dark:bg-slate-800 border-0 rounded-lg text-sm text-gray-900 dark:text-slate-200 placeholder-gray-500 dark:placeholder-slate-400 disabled:opacity-50",disabled:!p.value||O.value},null,8,Go),[[te,w.value]]),e("button",{type:"submit",disabled:!w.value.trim()&&!y.value||!p.value||I.value||O.value,class:"px-4 py-2 bg-emerald-600 disabled:bg-gray-400 text-white rounded-lg font-medium text-sm transition-colors flex items-center gap-2"},[I.value?(a(),o("span",Qo,[...t[177]||(t[177]=[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):u("",!0),e("span",null,d(I.value?"发送中...":"发送"),1)],8,Jo)],32),e("div",Yo,[e("button",{onClick:t[43]||(t[43]=r=>Q("已付款")),class:"px-3 py-1 bg-gray-100 dark:bg-slate-800 text-xs text-gray-700 dark:text-slate-300 rounded-full whitespace-nowrap"},"已付款"),e("button",{onClick:t[44]||(t[44]=r=>Q("请确认")),class:"px-3 py-1 bg-gray-100 dark:bg-slate-800 text-xs text-gray-700 dark:text-slate-300 rounded-full whitespace-nowrap"},"请确认"),e("button",{onClick:t[45]||(t[45]=r=>Q("谢谢")),class:"px-3 py-1 bg-gray-100 dark:bg-slate-800 text-xs text-gray-700 dark:text-slate-300 rounded-full whitespace-nowrap"},"谢谢"),e("button",{onClick:t[46]||(t[46]=r=>Q("稍等")),class:"px-3 py-1 bg-gray-100 dark:bg-slate-800 text-xs text-gray-700 dark:text-slate-300 rounded-full whitespace-nowrap"},"稍等"),!l.$page.props.auth.user?.telegram_chat_id&&s.order.status!=="cancelled"&&s.order.status!=="completed"?(a(),o("a",Zo,[...t[178]||(t[178]=[e("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.56c-.21 2.27-1.13 7.75-1.6 10.29-.2 1.08-.59 1.44-.97 1.47-.82.07-1.45-.54-2.24-.99-1.24-.71-1.94-1.16-3.14-1.85-1.39-.8-.49-1.24.3-1.96.21-.19 3.85-3.52 3.91-3.82.01-.04.01-.19-.07-.27-.08-.08-.2-.05-.28-.03-.12.03-2.02.13-5.7 3.75-.54.54-1.03.8-1.48.78-.49-.02-1.42-.27-2.11-.5-.85-.28-1.53-.42-1.47-.89.03-.25.37-.51 1.02-.77 4-1.74 6.67-2.89 8.01-3.44 3.81-1.57 4.61-1.84 5.13-1.85.11 0 .37.03.53.18.14.12.18.28.2.45-.01.06-.01.24-.02.38z"})],-1),c(" 实时通知 ",-1)])])):u("",!0)])])])])])]),b(kt,{show:n.value.show&&n.value.pendingAction!=="confirm_escrow"&&n.value.pendingAction!=="mark_buyer_paid"&&n.value.pendingAction!=="mark_seller_received"&&n.value.pendingAction!=="mark_seller_paid",title:n.value.title,message:n.value.message,"input-mode":n.value.inputMode,"input-label":n.value.inputLabel,"input-placeholder":n.value.inputPlaceholder,"input-required":n.value.inputRequired,danger:n.value.danger,"confirm-variant":n.value.confirmVariant,"confirm-text":n.value.confirmText,"cancel-text":n.value.cancelText,loading:n.value.loading,onConfirm:Le,onCancel:K,onClose:K},null,8,["show","title","message","input-mode","input-label","input-placeholder","input-required","danger","confirm-variant","confirm-text","cancel-text","loading"]),b(se,{show:n.value.pendingAction==="confirm_escrow"&&n.value.show,"max-width":"lg",closeable:!0,onClose:K},{default:x(()=>[e("div",ed,[t[193]||(t[193]=e("div",{class:"mx-auto flex items-center justify-center size-10 rounded-full bg-amber-100 dark:bg-amber-900/30"},[e("svg",{class:"size-5 text-amber-600 dark:text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",td,[t[192]||(t[192]=e("h3",{class:"text-base font-medium text-gray-900 dark:text-slate-100"}," 确认托管到账 ",-1)),e("div",sd,[e("div",rd,[e("div",ad,[i.value.seller_address?(a(),o("div",ld,[t[179]||(t[179]=e("label",{class:"text-xs text-gray-500 dark:text-slate-400"},"来源地址（卖家）",-1)),e("p",od,d(i.value.seller_address),1)])):u("",!0),i.value.escrow_address?(a(),o("div",dd,[t[180]||(t[180]=e("label",{class:"text-xs text-gray-500 dark:text-slate-400"},"托管地址",-1)),e("p",id,d(i.value.escrow_address),1)])):u("",!0),e("div",null,[t[181]||(t[181]=e("label",{class:"text-xs text-gray-500 dark:text-slate-400"},"交易金额",-1)),e("p",nd,d(parseFloat(i.value.crypto_amount).toFixed(4))+" "+d(i.value.currency_label||i.value.currency_key||i.value.crypto_currency),1)]),i.value.escrow_tx_hash?(a(),o("div",ud,[t[182]||(t[182]=e("label",{class:"text-xs text-gray-500 dark:text-slate-400"},"交易哈希",-1)),e("p",cd,d(i.value.escrow_tx_hash),1)])):u("",!0)])]),t[190]||(t[190]=e("div",{class:"p-2.5 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-medium text-amber-800 dark:text-amber-300"},"请打开区块链浏览器仔细核对"),e("p",{class:"text-amber-700 dark:text-amber-400 mt-0.5"}," 确认前必须逐项检查以下所有信息 ")])])],-1)),e("div",xd,[t[189]||(t[189]=e("p",{class:"text-xs font-medium text-gray-700 dark:text-slate-300"},"请确认以下所有项目：",-1)),e("div",md,[e("div",vd,[R(e("input",{"onUpdate:modelValue":t[47]||(t[47]=r=>T.value.txExists=r),type:"checkbox",class:"mt-0.5 h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded",disabled:n.value.loading},null,8,fd),[[Y,T.value.txExists]]),t[183]||(t[183]=e("label",{class:"ml-2 text-xs text-gray-700 dark:text-slate-300"}," 我已打开区块链浏览器，确认交易记录存在 ",-1))]),e("div",bd,[R(e("input",{"onUpdate:modelValue":t[48]||(t[48]=r=>T.value.confirmations=r),type:"checkbox",class:"mt-0.5 h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded",disabled:n.value.loading},null,8,gd),[[Y,T.value.confirmations]]),t[184]||(t[184]=e("label",{class:"ml-2 text-xs text-gray-700 dark:text-slate-300"}," 交易已有足够的确认数（建议至少6个确认） ",-1))]),e("div",kd,[R(e("input",{"onUpdate:modelValue":t[49]||(t[49]=r=>T.value.fromAddress=r),type:"checkbox",class:"mt-0.5 h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded",disabled:n.value.loading},null,8,yd),[[Y,T.value.fromAddress]]),e("label",pd,[t[185]||(t[185]=c(" 来源地址与卖家地址完全一致 ",-1)),e("span",wd,d(i.value.seller_address||"无卖家地址"),1)])]),e("div",hd,[R(e("input",{"onUpdate:modelValue":t[50]||(t[50]=r=>T.value.toAddress=r),type:"checkbox",class:"mt-0.5 h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded",disabled:n.value.loading},null,8,_d),[[Y,T.value.toAddress]]),e("label",Cd,[t[186]||(t[186]=c(" 目标地址与托管地址完全一致 ",-1)),e("span",$d,d(i.value.escrow_address||"托管地址待分配"),1)])]),e("div",zd,[R(e("input",{"onUpdate:modelValue":t[51]||(t[51]=r=>T.value.amount=r),type:"checkbox",class:"mt-0.5 h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded",disabled:n.value.loading},null,8,Md),[[Y,T.value.amount]]),e("label",jd,[t[187]||(t[187]=c(" 交易金额为 ",-1)),e("span",Fd,d(parseFloat(i.value.crypto_amount).toFixed(4))+" "+d(i.value.currency_label||i.value.currency_key||i.value.crypto_currency),1),t[188]||(t[188]=c("，完全正确 ",-1))])])])]),t[191]||(t[191]=e("div",{class:"p-2.5 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-bold text-red-800 dark:text-red-300"},"最终确认"),e("p",{class:"text-red-700 dark:text-red-400 mt-0.5"}," 确认后您将进入付款阶段，必须按时完成付款。如信息有误导致的损失，责任自负！ ")])])],-1))])])]),e("div",Bd,[b(v,{variant:"ghost",onClick:K,disabled:n.value.loading},{default:x(()=>[...t[194]||(t[194]=[c(" 返回检查 ",-1)])]),_:1},8,["disabled"]),b(v,{variant:"warning",loading:n.value.loading,disabled:!ge.value,onClick:Se},{default:x(()=>[...t[195]||(t[195]=[c(" 确认托管到账 ",-1)])]),_:1},8,["loading","disabled"])])]),_:1},8,["show"]),b(se,{show:n.value.pendingAction==="mark_seller_paid"&&n.value.show,"max-width":"lg",closeable:!0,onClose:K},{default:x(()=>[e("div",Ad,[t[205]||(t[205]=e("div",{class:"mx-auto flex items-center justify-center size-10 rounded-full bg-blue-100 dark:bg-blue-900/30"},[e("svg",{class:"size-5 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})])],-1)),e("div",Ld,[t[204]||(t[204]=e("h3",{class:"text-base font-medium text-gray-900 dark:text-slate-100"}," 标记已转币到托管 ",-1)),e("div",Vd,[i.value.seller_address?(a(),o("div",Sd,[e("div",Td,[e("div",null,[t[196]||(t[196]=e("label",{class:"text-xs text-gray-500 dark:text-slate-400"},"您的地址",-1)),e("p",Ud,d(i.value.seller_address),1)]),e("div",null,[t[197]||(t[197]=e("label",{class:"text-xs text-gray-500 dark:text-slate-400"},"转币金额",-1)),e("p",Ed,d(parseFloat(i.value.crypto_amount).toFixed(4))+" "+d(i.value.currency_label||i.value.currency_key||i.value.crypto_currency),1)])])])):u("",!0),t[202]||(t[202]=e("div",{class:"p-2.5 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-medium text-blue-800 dark:text-blue-300"},"托管地址提示"),e("p",{class:"text-blue-700 dark:text-blue-400 mt-0.5"}," 托管地址功能正在开发中，请先将币转到您自己的地址保管 ")])])],-1)),t[203]||(t[203]=e("div",{class:"p-2.5 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-bold text-red-800 dark:text-red-300 text-sm"},"极其重要！请仔细核对！"),e("ul",{class:"mt-1 space-y-0.5 text-red-700 dark:text-red-400"},[e("li",{class:"text-xs"},"• 请确保转币地址完全正确"),e("li",{class:"text-xs"},[c("• "),e("span",{class:"font-bold"},"请一定要确保金额是一次性从您的地址转入，否则系统无法确认")]),e("li",{class:"text-xs"},"• 请确保转币金额准确无误"),e("li",{class:"text-xs"},[c("• "),e("span",{class:"font-bold"},"如果地址或金额错误，托管将无法确认！")]),e("li",{class:"text-xs"},[c("• "),e("span",{class:"font-bold text-red-800 dark:text-red-200"},"任何损失概不负责！")])])])])],-1)),e("div",null,[t[198]||(t[198]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2"},[c(" 交易哈希 (TX ID) "),e("span",{class:"text-red-500"},"*")],-1)),R(e("input",{"onUpdate:modelValue":t[52]||(t[52]=r=>G.value=r),type:"text",placeholder:"请输入区块链交易哈希...",class:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:n.value.loading},null,8,Id),[[te,G.value]]),t[199]||(t[199]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-slate-400"}," 转币后请提供交易哈希作为凭证 ",-1))]),e("div",qd,[R(e("input",{"onUpdate:modelValue":t[53]||(t[53]=r=>Z.value=r),type:"checkbox",class:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",disabled:n.value.loading},null,8,Wd),[[Y,Z.value]]),e("label",Rd,[t[200]||(t[200]=c(" 我已仔细核对金额，确认已准备好 ",-1)),e("span",Hd,d(parseFloat(i.value.crypto_amount).toFixed(4))+" "+d(i.value.currency_label||i.value.currency_key||i.value.crypto_currency),1),t[201]||(t[201]=c(" 用于交易 ",-1))])])])])]),e("div",Pd,[b(v,{variant:"ghost",onClick:K,disabled:n.value.loading},{default:x(()=>[...t[206]||(t[206]=[c(" 返回 ",-1)])]),_:1},8,["disabled"]),b(v,{variant:"primary",loading:n.value.loading,disabled:!G.value||!G.value.trim()||!Z.value,onClick:Te},{default:x(()=>[...t[207]||(t[207]=[c(" 确认已转币 ",-1)])]),_:1},8,["loading","disabled"])])]),_:1},8,["show"]),b(se,{show:n.value.pendingAction==="mark_buyer_paid"&&n.value.show,"max-width":"md",closeable:!0,onClose:K},{default:x(()=>[e("div",Dd,[t[213]||(t[213]=e("div",{class:"mx-auto flex items-center justify-center size-12 rounded-full bg-emerald-100 dark:bg-emerald-900/30"},[e("svg",{class:"size-6 text-emerald-600 dark:text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",Nd,[t[212]||(t[212]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-slate-100"}," 标记已付款 ",-1)),e("div",Od,[e("p",Kd,[t[208]||(t[208]=c(" 请确认您已向卖家付款 ",-1)),e("span",Xd,"¥"+d(parseFloat(s.order.fiat_amount).toFixed(2)),1)]),e("div",null,[t[209]||(t[209]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2"}," 付款说明（可选） ",-1)),R(e("textarea",{"onUpdate:modelValue":t[54]||(t[54]=r=>H.value=r),rows:"3",class:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-slate-100 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors",placeholder:"请输入付款凭证或说明，如转账单号..."},null,512),[[te,H.value]])]),s.userHas2FA?(a(),o("div",Gd,[b(ze,{modelValue:n.value.twoFactorCode,"onUpdate:modelValue":t[55]||(t[55]=r=>n.value.twoFactorCode=r),error:n.value.twoFactorError,disabled:n.value.loading,onComplete:we},null,8,["modelValue","error","disabled"])])):(a(),o("div",Jd,[...t[210]||(t[210]=[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-sm"},[e("p",{class:"font-medium text-amber-800 dark:text-amber-300"},"需要双重验证"),e("p",{class:"text-amber-700 dark:text-amber-400 mt-0.5"},"为保护您的资金安全，买家付款必须启用双重验证")])],-1)])])),s.userHas2FA?(a(),o("div",Qd,[...t[211]||(t[211]=[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})]),e("div",{class:"text-sm"},[e("p",{class:"font-medium text-red-800 dark:text-red-300"},"注意事项"),e("p",{class:"text-red-700 dark:text-red-400 mt-0.5"},"请确保已完成付款再点击确认，虚假付款将导致账户封禁")])],-1)])])):u("",!0)])])]),e("div",Yd,[b(v,{variant:"ghost",onClick:K,disabled:n.value.loading},{default:x(()=>[...t[214]||(t[214]=[c(" 返回 ",-1)])]),_:1},8,["disabled"]),s.userHas2FA?(a(),j(v,{key:0,variant:"primary",loading:n.value.loading,disabled:!n.value.twoFactorCode||n.value.twoFactorCode.length!==6,onClick:Ve},{default:x(()=>[...t[215]||(t[215]=[c(" 确认已付款 ",-1)])]),_:1},8,["loading","disabled"])):(a(),j(v,{key:1,variant:"warning",onClick:t[56]||(t[56]=()=>fe(U).visit("/user/profile"))},{default:x(()=>[...t[216]||(t[216]=[c(" 前往启用双重验证 ",-1)])]),_:1}))])]),_:1},8,["show"]),b(se,{show:n.value.pendingAction==="mark_seller_received"&&n.value.show,"max-width":"md",closeable:!0,onClose:K},{default:x(()=>[e("div",Zd,[t[221]||(t[221]=e("div",{class:"mx-auto flex items-center justify-center size-12 rounded-full bg-emerald-100 dark:bg-emerald-900/30"},[e("svg",{class:"size-6 text-emerald-600 dark:text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",e0,[t[220]||(t[220]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-slate-100"}," 确认收款 ",-1)),e("div",t0,[e("p",s0,[t[217]||(t[217]=c(" 请确认您已收到买家付款 ",-1)),e("span",r0,"¥"+d(parseFloat(s.order.fiat_amount).toFixed(2)),1)]),s.userHas2FA?(a(),o("div",a0,[b(ze,{modelValue:n.value.twoFactorCode,"onUpdate:modelValue":t[57]||(t[57]=r=>n.value.twoFactorCode=r),error:n.value.twoFactorError,disabled:n.value.loading,onComplete:we},null,8,["modelValue","error","disabled"])])):(a(),o("div",l0,[...t[218]||(t[218]=[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-sm"},[e("p",{class:"font-medium text-amber-800 dark:text-amber-300"},"需要双重验证"),e("p",{class:"text-amber-700 dark:text-amber-400 mt-0.5"},"为保护您的资金安全，卖家确认收款必须启用双重验证")])],-1)])])),s.userHas2FA?(a(),o("div",o0,[...t[219]||(t[219]=[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})]),e("div",{class:"text-sm"},[e("p",{class:"font-medium text-red-800 dark:text-red-300"},"重要提醒"),e("p",{class:"text-red-700 dark:text-red-400 mt-0.5"},"确认收款后，托管的加密货币将立即释放给买家，此操作不可撤销")])],-1)])])):u("",!0)])])]),e("div",d0,[b(v,{variant:"ghost",onClick:K,disabled:n.value.loading},{default:x(()=>[...t[222]||(t[222]=[c(" 返回 ",-1)])]),_:1},8,["disabled"]),s.userHas2FA?(a(),j(v,{key:0,variant:"success",loading:n.value.loading,disabled:!n.value.twoFactorCode||n.value.twoFactorCode.length!==6,onClick:Ue},{default:x(()=>[...t[223]||(t[223]=[c(" 确认收款 ",-1)])]),_:1},8,["loading","disabled"])):(a(),j(v,{key:1,variant:"warning",onClick:t[58]||(t[58]=()=>fe(U).visit("/user/profile"))},{default:x(()=>[...t[224]||(t[224]=[c(" 前往启用双重验证 ",-1)])]),_:1}))])]),_:1},8,["show"])]),_:1},8,["breadcrumbs"]),b(Pt,{modelValue:F.value,"onUpdate:modelValue":t[59]||(t[59]=r=>F.value=r),"order-id":i.value.id,"order-no":i.value.order_no,"vendor-name":i.value.vendor?.name||"商家","fiat-amount":i.value.fiat_amount,"fiat-currency":i.value.fiat_currency,"crypto-amount":i.value.crypto_amount,"crypto-currency":i.value.currency_key||i.value.crypto_currency,onSuccess:Ae},null,8,["modelValue","order-id","order-no","vendor-name","fiat-amount","fiat-currency","crypto-amount","crypto-currency"])],64))}};export{f0 as default};
