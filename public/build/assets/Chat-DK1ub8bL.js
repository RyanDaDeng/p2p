import{d as I,I as we,h as _e,D as Fe,c as ee,o as s,b as _,w,f as o,i as u,T as he,n as v,a as e,r as ce,J as Ye,t as i,H as qe,m as H,g as z,z as ie,F as T,l as O,e as X,x as le,q as J,L as pe,k as g,v as oe,M as se,K as Q,B as et,j as je,y as tt}from"./app-DGCaAi__.js";import{P as rt}from"./P2PAppLayout-4r32C_YD.js";import{_ as A}from"./P2PButton-BDYX95ay.js";import{_ as st}from"./P2PDialog-DzQCIqpA.js";import{_ as ue}from"./Modal-C97TWKeg.js";import"./useConfig-LF_HoLwL.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const at={class:"flex-shrink-0 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 px-4 py-3"},ot={class:"flex items-center justify-between"},lt={key:0,class:"absolute top-2 left-1/2 -translate-x-1/2 w-12 h-1 bg-gray-300 dark:bg-gray-600 rounded-full"},dt={class:"flex items-center gap-3"},it={class:"text-lg font-bold text-gray-900 dark:text-gray-100"},nt={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},ut={key:0,class:"flex-shrink-0 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 p-4"},Be={__name:"P2PMobileDrawer",props:{modelValue:{type:Boolean,default:!1},title:{type:String,default:"详情"},subtitle:{type:String,default:""},position:{type:String,default:"bottom",validator:r=>["bottom","right","left"].includes(r)},size:{type:String,default:"default",validator:r=>["small","default","large","full"].includes(r)},icon:{type:[Object,String],default:null},iconColor:{type:String,default:"blue",validator:r=>["blue","emerald","amber","red","purple"].includes(r)},persistent:{type:Boolean,default:!1},scrollable:{type:Boolean,default:!0}},emits:["update:modelValue","open","close"],setup(r,{emit:c}){const y=r,b=c,x=I(()=>({bottom:"bottom-0 left-0 right-0 rounded-t-2xl",right:"top-0 right-0 bottom-0 rounded-l-2xl",left:"top-0 left-0 bottom-0 rounded-r-2xl"})[y.position]),d=I(()=>y.position==="bottom"?{small:"max-h-[40vh]",default:"max-h-[70vh]",large:"max-h-[85vh]",full:"h-full"}[y.size]:{small:"w-64",default:"w-80",large:"w-96",full:"w-full"}[y.size]),m=I(()=>{let f=["flex-1","min-h-0"];return y.scrollable&&f.push("overflow-y-auto"),f.join(" ")}),$=I(()=>({bottom:{from:"translate-y-full",to:"translate-y-0"},right:{from:"translate-x-full",to:"translate-x-0"},left:{from:"-translate-x-full",to:"translate-x-0"}})[y.position]),E=I(()=>({blue:"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400",emerald:"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400",amber:"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400",red:"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400",purple:"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"})[y.iconColor]),j=()=>{y.persistent||(b("update:modelValue",!1),b("close"))},D=f=>{f.key==="Escape"&&y.modelValue&&!y.persistent&&j()},N=f=>{f?document.body.style.overflow="hidden":document.body.style.overflow=""};return we(()=>y.modelValue,f=>{N(f),f&&b("open")}),_e(()=>{document.addEventListener("keydown",D)}),Fe(()=>{document.removeEventListener("keydown",D),N(!1)}),(f,C)=>(s(),ee(qe,{to:"body"},[_(he,{"enter-active-class":"transition-opacity ease-out duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity ease-in duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:w(()=>[r.modelValue?(s(),o("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] lg:hidden",onClick:j})):u("",!0)]),_:1}),_(he,{"enter-active-class":"transition-transform ease-out duration-300","enter-from-class":$.value.from,"enter-to-class":$.value.to,"leave-active-class":"transition-transform ease-in duration-200","leave-from-class":$.value.to,"leave-to-class":$.value.from},{default:w(()=>[r.modelValue?(s(),o("div",{key:0,class:v(["fixed z-[70] bg-white dark:bg-gray-900 shadow-2xl lg:hidden flex flex-col pt-safe",x.value,d.value])},[e("div",at,[e("div",ot,[r.position==="bottom"?(s(),o("div",lt)):u("",!0),e("div",dt,[ce(f.$slots,"header-icon",{},()=>[r.icon?(s(),o("div",{key:0,class:v(["p-2 rounded-lg",E.value])},[(s(),ee(Ye(r.icon),{class:"w-5 h-5"}))],2)):u("",!0)]),e("div",null,[e("h3",it,i(r.title),1),r.subtitle?(s(),o("p",nt,i(r.subtitle),1)):u("",!0)])]),e("button",{onClick:j,class:"p-2 rounded text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},[...C[0]||(C[0]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",{class:v(m.value)},[ce(f.$slots,"default")],2),f.$slots.footer?(s(),o("div",ut,[ce(f.$slots,"footer")])):u("",!0)],2)):u("",!0)]),_:3},8,["enter-from-class","enter-to-class","leave-from-class","leave-to-class"])]))}},ct={class:"md:hidden sticky top-0 z-50 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 pt-safe"},mt={class:"flex items-center justify-between h-14 px-4"},xt={class:"flex items-center gap-3 flex-1"},vt={class:"text-base font-semibold text-gray-900 dark:text-gray-100"},gt={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},bt={class:"flex items-center gap-1"},yt={__name:"P2PMobileHeader",props:{title:{type:String,required:!0},subtitle:{type:String,default:""},backUrl:{type:String,default:null}},setup(r){const c=r,y=()=>{c.backUrl?H.visit(c.backUrl):window.history.back()};return(b,x)=>(s(),o("div",ct,[e("div",mt,[e("div",xt,[e("button",{onClick:y,class:"p-2 -ml-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},[...x[0]||(x[0]=[e("svg",{class:"w-5 h-5 text-gray-700 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),ce(b.$slots,"custom",{},()=>[e("div",null,[e("h1",vt,i(r.title),1),r.subtitle?(s(),o("p",gt,i(r.subtitle),1)):u("",!0)])])]),e("div",bt,[ce(b.$slots,"actions")])])]))}},ft={class:"space-y-3"},kt={class:"flex items-center gap-2"},pt={class:"text-sm font-medium text-gray-700 dark:text-slate-300"},wt={class:"flex gap-2 justify-center"},ht=["onUpdate:modelValue","onInput","onKeydown","disabled"],_t={key:0,class:"text-xs text-red-600 dark:text-red-400 text-center"},Ct={key:1,class:"text-xs text-gray-500 dark:text-slate-400 text-center"},$t={key:2,class:"text-center"},De={__name:"P2PTwoFactorInput",props:{modelValue:{type:String,default:""},label:{type:String,default:"双重验证码"},error:{type:String,default:""},helpText:{type:String,default:"请输入您的验证器应用中显示的6位数字"},disabled:{type:Boolean,default:!1},showRecoveryOption:{type:Boolean,default:!1},autoFocus:{type:Boolean,default:!0}},emits:["update:modelValue","complete","use-recovery"],setup(r,{expose:c,emit:y}){const b=r,x=y,d=z(["","","","","",""]),m=z([]);we(d,f=>{const C=f.join("");x("update:modelValue",C),C.length===6&&/^\d{6}$/.test(C)&&x("complete",C)},{deep:!0}),we(()=>b.modelValue,f=>{if(f==="")d.value=["","","","","",""];else if(f.length<=6){const C=f.split("");for(let S=0;S<6;S++)d.value[S]=C[S]||""}});const $=(f,C)=>{const S=C.target.value;if(!/^\d*$/.test(S)){C.target.value=d.value[f];return}S&&f<5&&ie(()=>{m.value[f+1]?.focus(),m.value[f+1]?.select()})},E=(f,C)=>{C.key==="Backspace"?!d.value[f]&&f>0&&(C.preventDefault(),d.value[f-1]="",m.value[f-1]?.focus()):C.key==="ArrowLeft"&&f>0?(C.preventDefault(),m.value[f-1]?.focus()):C.key==="ArrowRight"&&f<5&&(C.preventDefault(),m.value[f+1]?.focus())},j=f=>{f.preventDefault();const S=f.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(S){const F=S.split("");for(let k=0;k<6;k++)d.value[k]=F[k]||"";const p=Math.min(F.length,5);m.value[p]?.focus()}},D=()=>{d.value=["","","","","",""],m.value[0]?.focus()},N=()=>{m.value[0]?.focus()};return _e(()=>{b.autoFocus&&ie(()=>{m.value[0]?.focus()})}),c({clear:D,focus:N}),(f,C)=>(s(),o("div",ft,[e("div",kt,[C[2]||(C[2]=e("svg",{class:"w-5 h-5 text-emerald-600 dark:text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})],-1)),e("label",pt,i(r.label||"双重验证码"),1)]),e("div",wt,[(s(!0),o(T,null,O(d.value,(S,F)=>X((s(),o("input",{key:F,ref_for:!0,ref:p=>m.value[F]=p,"onUpdate:modelValue":p=>d.value[F]=p,type:"text",inputmode:"numeric",maxlength:"1",class:v(["w-12 h-12 text-center text-lg font-mono font-bold rounded-lg border-2 transition-all duration-200",[r.error?"border-red-500 bg-red-50 dark:bg-red-900/20 text-red-900 dark:text-red-200":"border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-slate-100 focus:border-emerald-500 dark:focus:border-emerald-400"]]),onInput:p=>$(F,p),onKeydown:p=>E(F,p),onPaste:C[0]||(C[0]=p=>j(p)),disabled:r.disabled},null,42,ht)),[[le,d.value[F]]])),128))]),r.error?(s(),o("p",_t,i(r.error),1)):u("",!0),r.helpText&&!r.error?(s(),o("p",Ct,i(r.helpText),1)):u("",!0),r.showRecoveryOption?(s(),o("div",$t,[e("button",{type:"button",onClick:C[1]||(C[1]=S=>f.$emit("use-recovery")),class:"text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors"}," 使用恢复代码 ")])):u("",!0)]))}},zt={class:"relative group"},Mt={key:0,class:"relative"},jt=["src","alt"],Bt={class:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent md:opacity-0 md:group-hover:opacity-100 transition-opacity flex items-end justify-between p-2"},Ft={key:0,class:"mt-1"},St={class:"flex gap-1"},At={class:"flex-1 min-w-0"},Lt={class:"relative max-w-[90vw] max-h-[90vh] flex flex-col"},Vt=["src","alt"],Et={class:"flex justify-center gap-4 mt-4 md:hidden"},Tt=["href"],ke={__name:"P2PAttachment",props:{attachment:{type:Object,required:!0,validator:r=>r.url&&r.name&&r.type},variant:{type:String,default:"default",validator:r=>["default","primary"].includes(r)},thumbnailSize:{type:String,default:"md",validator:r=>["sm","md","lg"].includes(r)},showInfo:{type:Boolean,default:!1}},setup(r){const c=r,y=z(!1);z(!1);const b=I(()=>/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)),x=I(()=>window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://")),d=I(()=>c.attachment.type&&c.attachment.type.startsWith("image/")),m=I(()=>c.attachment.type==="application/pdf"),$={sm:{width:"150px",height:"150px"},md:{width:"200px",height:"200px"},lg:{width:"250px",height:"250px"}},E=I(()=>$[c.thumbnailSize].width),j=I(()=>$[c.thumbnailSize].height),D=I(()=>c.variant==="primary"?"bg-emerald-500 hover:bg-emerald-400":"bg-white dark:bg-slate-700 hover:bg-gray-50 dark:hover:bg-slate-600"),N=I(()=>c.variant==="primary"?"text-white":"text-gray-900 dark:text-slate-200"),f=I(()=>c.variant==="primary"?"text-emerald-100":"text-gray-500 dark:text-slate-400"),C=I(()=>c.variant==="primary"?"text-white":"text-gray-600 dark:text-slate-400"),S=I(()=>c.variant==="primary"?"text-white/90":"text-gray-700 dark:text-slate-300"),F=I(()=>c.variant==="primary"?"text-white/70":"text-gray-500 dark:text-slate-400"),p=U=>{if(!U)return"0 B";const B=1024,R=["B","KB","MB","GB"],me=Math.floor(Math.log(U)/Math.log(B));return Math.round(U/Math.pow(B,me)*100)/100+" "+R[me]},k=U=>U&&{"application/zip":"ZIP","application/x-rar-compressed":"RAR","application/msword":"Word","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"Word","application/vnd.ms-excel":"Excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"Excel","text/plain":"文本","text/csv":"CSV"}[U]||"文件",M=()=>{d.value&&(y.value=!0)},L=()=>{y.value=!1},K=()=>{x.value&&b.value?alert("请长按图片保存或使用分享功能"):window.open(c.attachment.url,"_blank")},te=()=>{if(x.value&&b.value)if(d.value)M();else{const U=document.createElement("iframe");U.style.display="none",U.src=c.attachment.url,document.body.appendChild(U),setTimeout(()=>{document.body.removeChild(U)},3e3),alert("文件下载已开始，请检查您的下载文件夹")}else{const U=document.createElement("a");U.href=c.attachment.url,U.download=c.attachment.name||"download",document.body.appendChild(U),U.click(),document.body.removeChild(U)}};return(U,B)=>(s(),o("div",zt,[d.value?(s(),o("div",Mt,[e("div",{onClick:M,class:"relative overflow-hidden rounded-lg cursor-pointer transition-all hover:opacity-90",style:pe(`width: ${E.value}; height: ${j.value};`)},[e("img",{src:r.attachment.url,alt:r.attachment.name,class:"w-full h-full object-cover"},null,8,jt),e("div",Bt,[e("button",{onClick:J(M,["stop"]),class:"p-1.5 md:p-2 bg-white/90 backdrop-blur-sm rounded-full text-gray-700 hover:bg-white transition-colors",title:"查看"},[...B[1]||(B[1]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])]),x.value?u("",!0):(s(),o("button",{key:0,onClick:J(te,["stop"]),class:"p-1.5 md:p-2 bg-white/90 backdrop-blur-sm rounded-full text-gray-700 hover:bg-white transition-colors",title:"下载"},[...B[2]||(B[2]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])]))])],4),r.showInfo?(s(),o("div",Ft,[e("p",{class:v(["text-xs truncate",S.value])},i(r.attachment.name),3),e("p",{class:v(["text-xs",F.value])},i(p(r.attachment.size)),3)])):u("",!0)])):m.value?(s(),o("div",{key:1,class:v(["flex items-center gap-2 md:gap-3 p-2.5 md:p-3 rounded-lg transition-colors",D.value])},[e("div",{class:"flex-shrink-0",onClick:K},[...B[3]||(B[3]=[e("div",{class:"w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center cursor-pointer"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})])],-1)])]),e("div",{class:"flex-1 min-w-0",onClick:K},[e("p",{class:v(["text-xs md:text-sm font-medium truncate cursor-pointer",N.value])},i(r.attachment.name),3),e("p",{class:v(["text-xs",f.value])},"PDF · "+i(p(r.attachment.size)),3)]),e("div",St,[e("button",{onClick:K,class:"p-1.5 rounded-lg bg-black/5 hover:bg-black/10 transition-colors md:hidden",title:"查看"},[(s(),o("svg",{class:v(["w-4 h-4",C.value]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...B[4]||(B[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])],2))]),x.value?u("",!0):(s(),o("button",{key:0,onClick:J(te,["stop"]),class:"p-1.5 rounded-lg bg-black/5 hover:bg-black/10 transition-colors",title:"下载"},[(s(),o("svg",{class:v(["w-4 h-4",C.value]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...B[5]||(B[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)])],2))]))])],2)):(s(),o("div",{key:2,class:v(["flex items-center gap-2 md:gap-3 p-2.5 md:p-3 rounded-lg transition-colors",D.value])},[B[7]||(B[7]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-10 h-10 bg-gray-500 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])])],-1)),e("div",At,[e("p",{class:v(["text-xs md:text-sm font-medium truncate",N.value])},i(r.attachment.name),3),e("p",{class:v(["text-xs",f.value])},i(k(r.attachment.type))+" · "+i(p(r.attachment.size)),3)]),x.value?u("",!0):(s(),o("button",{key:0,onClick:J(te,["stop"]),class:"flex-shrink-0 p-1.5 rounded-lg bg-black/5 hover:bg-black/10 transition-colors",title:"下载"},[(s(),o("svg",{class:v(["w-4 h-4",C.value]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...B[6]||(B[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)])],2))]))],2)),(s(),ee(qe,{to:"body"},[_(he,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:w(()=>[y.value?(s(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm p-4",onClick:L},[e("div",Lt,[e("img",{src:r.attachment.url,alt:r.attachment.name,class:"max-w-full max-h-[80vh] md:max-h-[90vh] object-contain",onClick:B[0]||(B[0]=J(()=>{},["stop"]))},null,8,Vt),e("div",Et,[e("button",{onClick:L,class:"p-3 bg-white/90 backdrop-blur-sm rounded-full text-gray-700 active:bg-white transition-colors",title:"关闭"},[...B[8]||(B[8]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),x.value?u("",!0):(s(),o("button",{key:0,onClick:te,class:"p-3 bg-white/90 backdrop-blur-sm rounded-full text-gray-700 active:bg-white transition-colors",title:"下载原图"},[...B[9]||(B[9]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])]))]),e("button",{onClick:L,class:"hidden md:block absolute top-4 right-4 p-2 bg-black/50 hover:bg-black/70 rounded-full text-white transition-colors"},[...B[10]||(B[10]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),x.value?u("",!0):(s(),o("a",{key:0,href:r.attachment.url,download:"",class:"hidden md:block absolute bottom-4 right-4 p-3 bg-white/90 hover:bg-white rounded-full text-gray-700 transition-colors",title:"下载原图"},[...B[11]||(B[11]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,Tt))])])):u("",!0)]),_:1})]))]))}},It={class:"relative"},Ut=["disabled"],Pt={key:0},Dt={class:"border-b border-gray-200 dark:border-gray-700 p-2"},Rt={class:"flex gap-1 overflow-x-auto"},qt=["onClick"],Wt={class:"p-2 max-h-64 overflow-y-auto"},Ht={class:"grid grid-cols-8 gap-1"},Ot=["onClick","title"],Nt={key:0,class:"border-t border-gray-200 dark:border-gray-700 p-2"},Kt={class:"flex gap-1 flex-wrap"},Xt=["onClick"],Jt={class:"flex flex-col h-full"},Gt={key:0,class:"px-4 pb-3 border-b border-gray-200 dark:border-gray-700"},Qt={class:"flex gap-2 flex-wrap"},Zt=["onClick"],Yt={class:"px-4 py-2 border-b border-gray-200 dark:border-gray-700"},er={class:"flex gap-2 overflow-x-auto pb-1"},tr=["onClick"],rr={class:"flex-1 overflow-y-auto px-4 py-3"},sr={class:"grid grid-cols-6 gap-2"},ar=["onClick"],Re={__name:"P2PEmojiPicker",props:{disabled:{type:Boolean,default:!1},placement:{type:String,default:"bottom",validator:r=>["top","bottom"].includes(r)}},emits:["select"],setup(r,{emit:c}){const y=r,b=c,x=z(!1),d=z("smileys"),m=z([]),$=z(!1),E=[{name:"smileys",label:"表情",emojis:["😀","😃","😄","😁","😅","😂","🤣","😊","😇","🙂","😉","😌","😍","🥰","😘","😗","😙","😚","😋","😛","😜","🤪","😝","🤑","🤗","🤭","🤫","🤔","🤐","🤨","😐","😑","😶","😏","😒","🙄","😬","🤥","😌","😔","😪","🤤","😴","😷","🤒","🤕","🤢","🤮","🤧","😵","🤯","🤠","😎","🤓","🧐","😕","😟","🙁","☹️","😮","😯","😲","😳","🥺","😦","😧","😨","😰","😥","😢","😭","😱","😖","😣","😞","😓","😩","😫","🥱","😤","😡","😠","🤬","😈","👿","💀","☠️","💩","🤡","👹","👺","👻","👽","👾","🤖"]},{name:"gestures",label:"手势",emojis:["👋","🤚","🖐️","✋","🖖","👌","🤌","🤏","✌️","🤞","🤟","🤘","🤙","👈","👉","👆","🖕","👇","☝️","👍","👎","✊","👊","🤛","🤜","👏","🙌","👐","🤲","🤝","🙏","✍️","💪","🦾","🦿","🦵","🦶","👂","🦻","👃","🧠","🫀","🫁","🦷","🦴","👀","👁️","👅","👄"]},{name:"hearts",label:"爱心",emojis:["❤️","🧡","💛","💚","💙","💜","🖤","🤍","🤎","💔","❣️","💕","💞","💓","💗","💖","💘","💝","💟","☮️","✝️","☪️","🕉️","☸️","✡️","🔯","🕎","☯️","☦️","🛐","⛎","♈","♉","♊","♋","♌","♍","♎","♏","♐","♑","♒","♓","🆔","⚛️"]},{name:"symbols",label:"符号",emojis:["✅","❌","❓","❗","❕","❔","⭕","🚫","💯","💢","♨️","🚷","🚯","🚳","🚱","🔞","📵","🚭","‼️","⁉️","🔅","🔆","〽️","⚠️","🚸","🔱","⚜️","🔰","♻️","✳️","❇️","💹","💲","💱","©️","®️","™️","#️⃣","*️⃣","0️⃣","1️⃣","2️⃣","3️⃣","4️⃣","5️⃣","6️⃣","7️⃣","8️⃣","9️⃣","🔟","🔠","🔡","🔤","🆒","🆕","🆖","🆗","🆙","🆚"]},{name:"objects",label:"物品",emojis:["📱","💻","⌨️","🖥️","🖨️","🖱️","🖲️","🕹️","🗜️","💾","💿","📀","📼","📷","📸","📹","🎥","📽️","🎞️","📞","☎️","📟","📠","📺","📻","🎙️","🎚️","🎛️","🧭","⏱️","⏲️","⏰","🕰️","⌛","⏳","📡","🔋","🔌","💡","🔦","🕯️","🧯","🛢️","💸","💵","💴","💶","💷","💰","💳","💎","⚖️","🧰","🔧","🔨","⚒️","🛠️","⛏️","🔩","⚙️","🧱","⛓️","🧲","🔫","💣","🧨","🪓","🔪","🗡️","⚔️","🛡️","🚬","⚰️","⚱️","🏺","🔮","📿","🧿","💈","⚗️","🔭","🔬","🕳️","🩹","🩺","💊","💉","🩸","🧬","🦠","🧫","🧪","🌡️","🧹","🧺","🧻","🚽","🚰","🚿","🛁","🛀","🧼","🪒","🧽","🧴","🛎️","🔑","🗝️","🚪","🪑","🛋️","🛏️","🛌","🧸","🖼️","🛍️","🛒","🎁","🎈","🎏","🎀","🎊","🎉","🎎","🏮","🎐","🧧","✉️","📩","📨","📧","💌","📥","📤","📦","🏷️","📪","📫","📬","📭","📮","📯","📜","📃","📄","📑","🧾","📊","📈","📉","🗒️","🗓️","📆","📅","🗑️","📇","🗃️","🗳️","🗄️","📋","📁","📂","🗂️","🗞️","📰","📓","📔","📒","📕","📗","📘","📙","📚","📖","🔖","🧷","🔗","📎","🖇️","📐","📏","🧮","📌","📍","✂️","🖊️","🖋️","✒️","🖌️","🖍️","📝","✏️","🔍","🔎","🔏","🔐","🔒","🔓"]}],j=I(()=>{const F=E.find(p=>p.name===d.value);return F?F.emojis:[]}),D=()=>{$.value=window.innerWidth<768},N=()=>{y.disabled||(x.value=!x.value)},f=()=>{x.value=!1},C=F=>{b("select",F);const p=m.value.indexOf(F);p>-1&&m.value.splice(p,1),m.value.unshift(F),m.value=m.value.slice(0,8),localStorage.setItem("recentEmojis",JSON.stringify(m.value)),f()},S=F=>{F.key==="Escape"&&x.value&&!$.value&&f()};return _e(()=>{const F=localStorage.getItem("recentEmojis");if(F)try{m.value=JSON.parse(F)}catch(p){console.error("Failed to parse recent emojis:",p)}D(),window.addEventListener("resize",D),document.addEventListener("keydown",S)}),Fe(()=>{window.removeEventListener("resize",D),document.removeEventListener("keydown",S)}),(F,p)=>(s(),o("div",It,[e("button",{type:"button",onClick:N,class:"p-2 rounded text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",disabled:r.disabled},[...p[1]||(p[1]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],8,Ut),$.value?u("",!0):(s(),o("div",Pt,[x.value?(s(),o("div",{key:0,class:"fixed inset-0 z-40",onClick:f})):u("",!0),_(he,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:w(()=>[x.value?(s(),o("div",{key:0,class:v(["absolute z-50 bg-white dark:bg-gray-900 rounded border border-gray-200 dark:border-gray-700 shadow-lg",[r.placement==="top"?"bottom-full mb-2":"top-full mt-2","right-0 md:left-0"]]),style:{width:"320px"}},[e("div",Dt,[e("div",Rt,[(s(),o(T,null,O(E,k=>e("button",{key:k.name,type:"button",onClick:J(M=>d.value=k.name,["stop","prevent"]),class:v(["px-3 py-1.5 rounded text-xs font-medium transition-colors whitespace-nowrap",d.value===k.name?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"])},i(k.label),11,qt)),64))])]),e("div",Wt,[e("div",Ht,[(s(!0),o(T,null,O(j.value,k=>(s(),o("button",{key:k,type:"button",onClick:J(M=>C(k),["stop","prevent"]),class:"p-2 text-xl hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors",title:k},i(k),9,Ot))),128))])]),m.value.length>0?(s(),o("div",Nt,[p[2]||(p[2]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-1"},"最近使用",-1)),e("div",Kt,[(s(!0),o(T,null,O(m.value,k=>(s(),o("button",{key:k,type:"button",onClick:J(M=>C(k),["stop","prevent"]),class:"p-2 text-xl hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors"},i(k),9,Xt))),128))])])):u("",!0)],2)):u("",!0)]),_:1})])),$.value?(s(),ee(Be,{key:1,modelValue:x.value,"onUpdate:modelValue":p[0]||(p[0]=k=>x.value=k),title:"选择表情",position:"bottom",size:"default",scrollable:!1},{"header-icon":w(()=>[...p[3]||(p[3]=[e("div",{class:"p-2 rounded bg-amber-100 dark:bg-amber-900/30"},[e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)])]),default:w(()=>[e("div",Jt,[m.value.length>0?(s(),o("div",Gt,[p[4]||(p[4]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-2"},"最近使用",-1)),e("div",Qt,[(s(!0),o(T,null,O(m.value,k=>(s(),o("button",{key:k,type:"button",onClick:J(M=>C(k),["stop","prevent"]),class:"p-2 text-2xl hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors"},i(k),9,Zt))),128))])])):u("",!0),e("div",Yt,[e("div",er,[(s(),o(T,null,O(E,k=>e("button",{key:k.name,type:"button",onClick:J(M=>d.value=k.name,["stop","prevent"]),class:v(["px-3 py-1.5 rounded text-sm font-medium transition-colors whitespace-nowrap",d.value===k.name?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"])},i(k.label),11,tr)),64))])]),e("div",rr,[e("div",sr,[(s(!0),o(T,null,O(j.value,k=>(s(),o("button",{key:k,type:"button",onClick:J(M=>C(k),["stop","prevent"]),class:"p-3 text-2xl hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors active:scale-95"},i(k),9,ar))),128))])])])]),_:1},8,["modelValue"])):u("",!0)]))}},or={class:"p-4 md:p-6"},lr={class:"flex items-center gap-3 mb-4 md:mb-6"},dr={class:"text-base md:text-lg font-semibold text-gray-900 dark:text-slate-100"},ir={class:"space-y-4 md:space-y-6"},nr={class:"bg-gray-50 dark:bg-slate-800/50 rounded-lg p-3"},ur={class:"flex items-center justify-between"},cr={class:"text-xs md:text-sm font-medium text-gray-900 dark:text-slate-100"},mr={class:"flex items-center gap-1 md:gap-2"},xr=["onClick","onMouseenter"],vr={class:"ml-1 md:ml-2 text-sm md:text-lg font-medium text-gray-900 dark:text-slate-100"},gr={class:"block text-xs md:text-sm font-medium text-gray-700 dark:text-slate-300 mb-2"},br={class:"text-xs text-gray-500 dark:text-slate-400 ml-1 md:ml-2"},yr={class:"mt-2 flex flex-wrap gap-1.5 md:gap-2"},fr=["onClick"],kr={class:"flex items-start md:items-center"},pr={class:"px-4 py-3 md:px-6 md:py-4 bg-gray-50 dark:bg-slate-900/50 border-t border-gray-200 dark:border-slate-800 flex justify-end gap-2 md:gap-3"},wr={__name:"ReviewModal",props:{modelValue:Boolean,orderId:{type:Number,required:!0},orderNo:{type:String,required:!0},vendorName:{type:String,required:!0},fiatAmount:{type:[Number,String],required:!0},fiatCurrency:{type:String,required:!0},cryptoAmount:{type:[Number,String],required:!0},cryptoCurrency:{type:String,required:!0}},emits:["update:modelValue","success"],setup(r,{emit:c}){const y=r,b=c,x=I({get:()=>y.modelValue,set:k=>b("update:modelValue",k)}),d=z(!1),m=z(5),$=z(0),E=z(""),j=z(!1),D=["交易迅速","信誉良好","沟通顺畅","价格合理","服务专业","值得信赖"],N={1:"非常差",2:"较差",3:"一般",4:"满意",5:"非常满意"},f=I(()=>N[m.value]||""),C=I(()=>m.value>0),S=k=>{E.value.length>0?E.value+="，"+k:E.value=k},F=async()=>{if(!C.value){se.error("请选择评分");return}d.value=!0;try{const k=await Q.post(`/web/api/orders/${y.orderId}/review`,{rating:m.value,comment:E.value,is_anonymous:j.value});k.data.success?(se.success("评价提交成功"),b("success",k.data.data.review),p()):se.error(k.data.message||"评价提交失败")}catch(k){console.error("Submit review error:",k),se.error(k.response?.data?.message||"评价提交失败")}finally{d.value=!1}},p=()=>{x.value=!1,m.value=5,$.value=0,E.value="",j.value=!1};return we(x,k=>{k&&(m.value=5,$.value=0,E.value="",j.value=!1)}),(k,M)=>(s(),ee(ue,{show:x.value,"max-width":"2xl",onClose:p},{default:w(()=>[e("div",or,[e("div",lr,[M[4]||(M[4]=e("div",{class:"p-2 md:p-3 rounded-lg md:rounded-xl bg-amber-100 dark:bg-amber-900/30"},[e("svg",{class:"w-5 h-5 md:w-6 md:h-6 text-amber-600 dark:text-amber-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})])],-1)),e("div",null,[e("h3",dr," 评价"+i(r.vendorName),1),M[3]||(M[3]=e("p",{class:"text-xs md:text-sm text-gray-500 dark:text-slate-400"}," 请对本次交易进行评价 ",-1))])]),e("div",ir,[e("div",nr,[e("div",ur,[M[5]||(M[5]=e("span",{class:"text-xs md:text-sm text-gray-500 dark:text-slate-400"},"订单编号",-1)),e("span",cr,i(r.orderNo),1)])]),e("div",null,[M[7]||(M[7]=e("label",{class:"block text-xs md:text-sm font-medium text-gray-700 dark:text-slate-300 mb-2 md:mb-3"},[g(" 您的评分 "),e("span",{class:"text-red-500"},"*")],-1)),e("div",mr,[(s(),o(T,null,O(5,L=>e("button",{key:L,onClick:K=>m.value=L,onMouseenter:K=>$.value=L,onMouseleave:M[0]||(M[0]=K=>$.value=0),class:"focus:outline-none transition-transform hover:scale-110 cursor-pointer"},[(s(),o("svg",{class:v(["w-8 h-8 md:w-10 md:h-10 transition-colors",($.value||m.value)>=L?"text-amber-500":"text-gray-300 dark:text-slate-600"]),fill:"currentColor",viewBox:"0 0 20 20"},[...M[6]||(M[6]=[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"},null,-1)])],2))],40,xr)),64)),e("span",vr,i(f.value),1)])]),e("div",null,[e("label",gr,[M[8]||(M[8]=g(" 评价内容 ",-1)),e("span",br," ("+i(E.value.length)+"/500) ",1)]),X(e("textarea",{"onUpdate:modelValue":M[1]||(M[1]=L=>E.value=L),rows:"3",maxlength:"500",placeholder:"分享您的交易体验...",class:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-slate-100 focus:ring-2 focus:ring-emerald-500 focus:border-transparent resize-none"},null,512),[[le,E.value]]),e("div",yr,[(s(),o(T,null,O(D,L=>e("button",{key:L,onClick:K=>S(L),class:"px-2 md:px-3 py-1 text-xs bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-slate-300 rounded-full hover:bg-gray-200 dark:hover:bg-slate-600 transition-colors cursor-pointer"},i(L),9,fr)),64))])]),e("div",kr,[X(e("input",{id:"anonymous","onUpdate:modelValue":M[2]||(M[2]=L=>j.value=L),type:"checkbox",class:"w-4 h-4 mt-0.5 md:mt-0 text-emerald-600 bg-gray-100 border-gray-300 rounded focus:ring-emerald-500 dark:focus:ring-emerald-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600 cursor-pointer"},null,512),[[oe,j.value]]),M[9]||(M[9]=e("label",{for:"anonymous",class:"ml-2 text-xs md:text-sm text-gray-700 dark:text-slate-300 cursor-pointer"},[g(" 匿名评价 "),e("span",{class:"text-xs text-gray-500 dark:text-slate-400 block md:inline"},"（其他用户将看不到您的身份信息）")],-1))]),M[10]||(M[10]=e("div",{class:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-2 md:p-3"},[e("div",{class:"flex items-start gap-1.5 md:gap-2"},[e("svg",{class:"w-4 h-4 md:w-5 md:h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),e("div",{class:"text-xs text-amber-800 dark:text-amber-200"},[e("p",null,"评价提交后将无法修改或删除，请慎重评价。"),e("p",{class:"mt-0.5 md:mt-1"},"您的评价将帮助其他用户更好地了解商家。")])])],-1))])]),e("div",pr,[_(A,{variant:"ghost",size:"sm",disabled:d.value,onClick:p,class:"md:!text-sm"},{default:w(()=>[...M[11]||(M[11]=[g(" 取消 ",-1)])]),_:1},8,["disabled"]),_(A,{variant:"primary",size:"sm",loading:d.value,disabled:!C.value||d.value,onClick:F,class:"md:!text-sm"},{default:w(()=>[g(i(d.value?"提交中...":"提交评价"),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["show"]))}};class hr{constructor(c={}){this.defaultOptions={maxWidth:1920,maxHeight:1920,quality:.85,mimeType:"image/jpeg",maxSizeMB:2,...c}}async compressImage(c,y={}){const b={...this.defaultOptions,...y};if(!c.type.startsWith("image/")||c.size/1024/1024<=b.maxSizeMB&&!this.needsResize(c,b))return c;try{const d=await this.loadImage(c),m=this.resizeImage(d,b),$=await this.canvasToBlob(m,b);return $.size>=c.size?c:new File([$],c.name,{type:$.type,lastModified:Date.now()})}catch(d){return console.error("Image compression failed:",d),c}}async compressMultiple(c,y={}){const x=Array.from(c).map(d=>this.compressImage(d,y));return Promise.all(x)}loadImage(c){return new Promise((y,b)=>{const x=new FileReader;x.onload=d=>{const m=new Image;m.onload=()=>y(m),m.onerror=b,m.src=d.target.result},x.onerror=b,x.readAsDataURL(c)})}async needsResize(c,y){return new Promise(b=>{const x=new FileReader;x.onload=d=>{const m=new Image;m.onload=()=>{b(m.width>y.maxWidth||m.height>y.maxHeight)},m.onerror=()=>b(!1),m.src=d.target.result},x.onerror=()=>b(!1),x.readAsDataURL(c)})}resizeImage(c,y){const b=document.createElement("canvas"),x=b.getContext("2d");let{width:d,height:m}=this.calculateDimensions(c.width,c.height,y.maxWidth,y.maxHeight);return b.width=d,b.height=m,x.imageSmoothingEnabled=!0,x.imageSmoothingQuality="high",x.drawImage(c,0,0,d,m),b}calculateDimensions(c,y,b,x){if(c<=b&&y<=x)return{width:c,height:y};const d=c/y;let m=b,$=b/d;return $>x&&($=x,m=x*d),{width:Math.round(m),height:Math.round($)}}async canvasToBlob(c,y){let b=y.quality,x=await this.createBlob(c,y.mimeType,b);const d=y.maxSizeMB*1024*1024;for(;x.size>d&&b>.3;)b-=.1,x=await this.createBlob(c,y.mimeType,b);return x}createBlob(c,y,b){return new Promise(x=>{c.toBlob(d=>x(d),y,b)})}async getImageDimensions(c){return new Promise((y,b)=>{const x=new FileReader;x.onload=d=>{const m=new Image;m.onload=()=>{y({width:m.width,height:m.height})},m.onerror=b,m.src=d.target.result},x.onerror=b,x.readAsDataURL(c)})}estimateCompressedSize(c,y={}){const b={...this.defaultOptions,...y},x=c.size/1024/1024,d=b.quality*.7,m=Math.min(x*d,b.maxSizeMB);return m<1?`~${Math.round(m*1024)} KB`:`~${m.toFixed(1)} MB`}formatFileSize(c){return c<1024?c+" B":c<1024*1024?(c/1024).toFixed(1)+" KB":(c/(1024*1024)).toFixed(1)+" MB"}}const _r=new hr,Cr={class:"flex items-center gap-2 flex-1"},$r={class:"flex -space-x-2"},zr=["src","alt"],Mr={class:"text-white text-xs font-bold"},jr={class:"flex-1 min-w-0"},Br={class:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate"},Fr={class:"text-xs text-gray-500 dark:text-gray-400"},Sr={class:"lg:min-h-screen lg:bg-gray-50 lg:dark:bg-gray-950 h-screen lg:h-auto overflow-hidden lg:overflow-visible fixed lg:relative inset-0"},Ar={key:0,class:"relative z-10 bg-red-50 dark:bg-red-900/20 border-b border-red-200 dark:border-red-800"},Lr={key:1,class:"relative z-10 bg-amber-50 dark:bg-amber-900/20 border-b border-amber-200 dark:border-amber-800"},Vr={class:"max-w-7xl mx-auto px-4 py-3 sm:px-6 lg:px-8"},Er={class:"flex flex-col sm:flex-row sm:items-center gap-3"},Tr={class:"flex items-start gap-3 flex-1"},Ir={class:"flex-1"},Ur={key:0,class:"text-xs text-amber-700 dark:text-amber-300 mt-2"},Pr={key:0,class:"sm:ml-auto"},Dr={key:2,class:"hidden md:block relative z-10 bg-blue-50 dark:bg-blue-900/20 border-b border-blue-200 dark:border-blue-800"},Rr={class:"max-w-7xl mx-auto px-4 py-3 sm:px-6 lg:px-8"},qr={class:"flex flex-col sm:flex-row sm:items-center gap-3"},Wr={class:"sm:ml-auto"},Hr={class:"p-4 space-y-4"},Or={class:"space-y-4"},Nr={class:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-800"},Kr={class:"flex items-center gap-2"},Xr={class:"text-sm font-semibold text-blue-700 dark:text-blue-300"},Jr={class:"text-xs text-blue-600 dark:text-blue-400"},Gr={class:"space-y-3"},Qr={class:"flex gap-3"},Zr={class:"flex-1 pb-3"},Yr={class:"text-xs text-gray-500 dark:text-gray-400"},es={key:0,class:"mt-2"},ts={class:"flex gap-3"},rs={class:"flex flex-col items-center"},ss={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},as={key:1,class:"text-white text-xs font-bold"},os={class:"flex-1 pb-3"},ls={class:"text-xs text-gray-500 dark:text-gray-400"},ds={class:"flex gap-3"},is={class:"flex flex-col items-center"},ns={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},us={key:1,class:"text-white text-xs font-bold"},cs={class:"flex-1 pb-3"},ms={class:"text-xs text-gray-500 dark:text-gray-400"},xs={key:0,class:"mt-2"},vs={class:"flex gap-3"},gs={class:"flex flex-col items-center"},bs={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ys={key:1,class:"text-white text-xs font-bold"},fs={class:"flex-1 pb-3"},ks={class:"text-xs text-gray-500 dark:text-gray-400"},ps={key:0,class:"mt-2 space-y-2"},ws={class:"flex gap-2"},hs={class:"flex gap-3"},_s={class:"flex flex-col items-center"},Cs={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},$s={key:1,class:"text-white text-xs font-bold"},zs={class:"flex-1 pb-3"},Ms={class:"text-xs text-gray-500 dark:text-gray-400"},js={key:0,class:"mt-2"},Bs={class:"flex gap-3"},Fs={class:"flex flex-col items-center"},Ss={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},As={key:1,class:"text-white text-xs font-bold"},Ls={class:"flex-1 pb-3"},Vs={class:"text-xs text-gray-500 dark:text-gray-400"},Es={key:0,class:"mt-2"},Ts={class:"flex gap-3"},Is={class:"flex flex-col items-center"},Us={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ps={key:1,class:"text-white text-xs font-bold"},Ds={class:"flex-1 pb-3"},Rs={class:"text-xs text-gray-500 dark:text-gray-400"},qs={key:0,class:"mt-2"},Ws={class:"flex gap-3"},Hs={class:"flex flex-col items-center"},Os={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ns={key:1,class:"text-white text-xs font-bold"},Ks={class:"flex-1"},Xs={class:"text-xs text-gray-500 dark:text-gray-400"},Js={class:"grid grid-cols-2 gap-3 text-sm"},Gs={class:"font-mono text-gray-900 dark:text-gray-200"},Qs={class:"font-medium text-gray-900 dark:text-gray-200"},Zs={class:"font-medium text-gray-900 dark:text-gray-200"},Ys={class:"font-medium text-gray-900 dark:text-gray-200"},ea={class:"font-medium text-gray-900 dark:text-gray-200"},ta={class:"font-medium text-gray-900 dark:text-gray-200"},ra={class:"font-medium text-gray-900 dark:text-gray-200"},sa={key:0,class:"text-xs text-amber-600 dark:text-amber-400 mt-0.5"},aa={class:"font-medium text-gray-900 dark:text-gray-200"},oa={class:"font-bold text-emerald-600 dark:text-emerald-400"},la={key:0,class:"mt-3 pt-3 border-t border-gray-100 dark:border-gray-800"},da={class:"font-mono text-sm text-gray-900 dark:text-gray-200 break-all"},ia={class:"mx-auto max-w-7xl"},na={class:"hidden md:grid md:grid-cols-3 gap-4 p-4"},ua={class:"md:col-span-1 space-y-4"},ca={class:"bg-white dark:bg-gray-900 rounded border border-gray-200 dark:border-gray-800 p-6"},ma={class:"flex items-center justify-between mb-4"},xa={key:0,class:"mb-4"},va={key:0,class:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded border border-amber-200 dark:border-amber-800"},ga={key:1,class:"p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded border border-emerald-200 dark:border-emerald-800"},ba={class:"mb-6"},ya={class:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-2"},fa={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"},ka={class:"space-y-4 mb-6"},pa={class:"flex items-center gap-3"},wa={class:"flex-1"},ha={class:"text-xs text-gray-500 dark:text-gray-400"},_a={class:"flex items-center gap-3"},Ca={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},$a={key:1,class:"text-white font-bold text-xs"},za={class:"flex-1"},Ma={key:0,class:"ml-11 mt-2"},ja={class:"flex items-center gap-3"},Ba={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Fa={key:1,class:"text-white font-bold text-xs"},Sa={class:"flex-1"},Aa={key:0,class:"text-xs text-blue-600 dark:text-blue-400 font-mono break-all mt-1"},La={key:0,class:"ml-11 mt-2"},Va={class:"flex items-center gap-3"},Ea={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ta={key:1,class:"text-white font-bold text-xs"},Ia={class:"flex-1"},Ua={key:0,class:"ml-11 mt-2 space-y-2"},Pa={class:"flex gap-2"},Da={class:"flex items-center gap-3"},Ra={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},qa={key:1,class:"text-white font-bold text-xs"},Wa={class:"flex-1"},Ha={key:0,class:"ml-11 mt-2"},Oa={class:"flex items-center gap-3"},Na={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ka={key:1,class:"text-white font-bold text-xs"},Xa={class:"flex-1"},Ja={class:"text-xs text-gray-500 dark:text-gray-400"},Ga={key:0,class:"ml-11 mt-2"},Qa={class:"flex items-center gap-3"},Za={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ya={key:1,class:"text-white font-bold text-xs"},eo={class:"flex-1"},to={key:0,class:"ml-11 mt-2"},ro={class:"flex items-center gap-3"},so={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ao={key:1,class:"text-white font-bold text-xs"},oo={class:"flex-1"},lo={class:"space-y-3 border-t border-gray-200 dark:border-gray-800 pt-4"},io={class:"flex justify-between"},no={class:"text-sm font-mono text-gray-900 dark:text-gray-200"},uo={class:"flex justify-between"},co={class:"text-sm font-medium text-gray-900 dark:text-gray-200"},mo={class:"flex justify-between"},xo={class:"text-sm font-medium text-gray-900 dark:text-gray-200"},vo={class:"flex justify-between"},go={class:"text-sm font-medium text-gray-900 dark:text-gray-200"},bo={class:"flex justify-between"},yo={class:"text-sm font-medium text-gray-900 dark:text-gray-200"},fo={class:"flex justify-between"},ko={class:"text-sm font-medium text-gray-900 dark:text-gray-200"},po={key:0,class:"flex justify-between"},wo={class:"text-sm text-amber-600 dark:text-amber-400"},ho={class:"flex justify-between"},_o={class:"text-sm font-medium text-gray-900 dark:text-gray-200"},Co={class:"flex justify-between"},$o={class:"text-lg font-bold text-emerald-600 dark:text-emerald-400"},zo={key:1,class:"flex justify-between items-start pt-3 border-t border-gray-100 dark:border-gray-800"},Mo={class:"text-sm font-medium text-gray-900 dark:text-gray-200 text-right break-all max-w-[180px]"},jo={class:"md:col-span-2"},Bo={class:"bg-white dark:bg-gray-900 rounded border border-gray-200 dark:border-gray-800 flex flex-col",style:{height:"650px","min-height":"600px"}},Fo={class:"border-b border-gray-200 dark:border-gray-800"},So={class:"px-6 py-4"},Ao={class:"flex items-center justify-between"},Lo={class:"flex items-center gap-3"},Vo={class:"flex -space-x-2"},Eo=["href"],To=["src","alt"],Io={key:1,class:"h-10 w-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center ring-2 ring-white dark:ring-gray-900"},Uo={class:"text-white font-bold"},Po={key:2,class:"absolute -bottom-0.5 -right-0.5 h-2.5 w-2.5 bg-emerald-500 rounded-full ring-2 ring-white dark:ring-gray-900"},Do={class:"flex-1"},Ro={class:"flex items-center gap-2"},qo={class:"font-semibold text-gray-900 dark:text-gray-100"},Wo={class:"text-xs text-gray-500 dark:text-gray-400 ml-2"},Ho={class:"text-xs text-gray-500 dark:text-gray-400"},Oo={key:0,class:"text-gray-400"},No={class:"flex flex-col items-center gap-1"},Ko={class:"text-xs text-gray-400 dark:text-gray-500"},Xo={key:0,class:"mb-4 mx-4"},Jo={class:"bg-blue-50 dark:bg-blue-900/20 rounded p-3 border border-blue-200 dark:border-blue-800"},Go={class:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},Qo={key:0,class:"mt-2 pt-2 border-t border-blue-200 dark:border-blue-700"},Zo={class:"flex items-center gap-2"},Yo={class:"text-xs text-gray-600 dark:text-gray-400"},el={class:"font-medium text-blue-600 dark:text-blue-400"},tl={key:1,class:"mb-4 mx-4"},rl={class:"bg-blue-50 dark:bg-blue-900/20 rounded p-3 border border-blue-200 dark:border-blue-800"},sl={class:"flex items-center gap-2"},al={class:"text-xs text-gray-600 dark:text-gray-400"},ol={class:"font-medium text-blue-600 dark:text-blue-400"},ll={key:0,class:"flex flex-col items-center gap-1"},dl={class:"text-xs text-gray-400 dark:text-gray-500"},il={key:0},nl=["href"],ul=["src","alt"],cl={key:1,class:"h-8 w-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center"},ml={class:"text-white text-sm font-bold"},xl={class:"max-w-md"},vl={class:"text-xs font-medium text-gray-600 dark:text-gray-400 mb-1 px-1"},gl={key:0,class:"text-purple-600 dark:text-purple-400 font-bold"},bl={class:"bg-gray-100 dark:bg-gray-800 rounded rounded-tl-none px-4 py-3"},yl={key:0,class:"mb-2"},fl={key:1,class:"text-sm text-gray-900 dark:text-gray-200"},kl={class:"text-xs text-gray-400 dark:text-gray-500 mt-1 px-1"},pl={class:"max-w-md"},wl={class:"text-xs font-medium text-gray-600 dark:text-gray-400 mb-1 px-1 text-right"},hl={key:0,class:"text-purple-600 dark:text-purple-400 font-bold"},_l={class:"bg-emerald-600 text-white rounded rounded-tr-none px-4 py-3"},Cl={key:0,class:"mb-2"},$l={key:1,class:"text-sm"},zl={class:"text-xs text-gray-400 dark:text-gray-500 mt-1 px-1 text-right"},Ml=["src","alt"],jl={key:1,class:"h-8 w-8 rounded-full bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center flex-shrink-0"},Bl={class:"text-white text-sm font-bold"},Fl={class:"border-t border-gray-200 dark:border-gray-800 p-4"},Sl={key:0,class:"mb-3 p-3 bg-gray-50 dark:bg-gray-800 rounded"},Al={key:0,class:"flex items-center gap-3"},Ll={key:1,class:"flex items-start gap-3"},Vl=["src","alt"],El={key:1,class:"w-16 h-20 bg-red-100 dark:bg-red-900/30 rounded flex items-center justify-center"},Tl={class:"flex-1"},Il={class:"text-sm font-medium text-gray-900 dark:text-gray-200"},Ul={class:"text-xs text-gray-500 dark:text-gray-400"},Pl=["disabled"],Dl=["placeholder","disabled"],Rl=["disabled"],ql={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},Wl={key:1},Hl={key:1,class:"flex mt-3 items-center justify-between"},Ol={class:"flex gap-2 items-center"},Nl={key:0,class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Kl={key:1,class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24"},Xl={class:"mt-3 p-2 bg-gray-50 dark:bg-gray-800/50 rounded border border-gray-200 dark:border-gray-700"},Jl={class:"flex items-center justify-between"},Gl={class:"flex items-center gap-2"},Ql={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},Zl={class:"flex items-center gap-3 text-xs text-gray-500 dark:text-gray-400"},Yl={class:"text-emerald-600 dark:text-emerald-400 font-medium"},ed={class:"space-y-4 mt-6"},td={key:0,class:"bg-white dark:bg-gray-900 rounded border border-gray-200 dark:border-gray-800 p-4"},rd={class:"p-3 bg-gray-50 dark:bg-gray-800/50 rounded max-h-40 overflow-y-auto"},sd={class:"text-xs text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},ad={class:"md:hidden fixed inset-x-0 bottom-0 flex flex-col bg-white dark:bg-gray-950",style:"top: calc(3.5rem + env(safe-area-inset-top))"},od={key:0,class:"bg-amber-50 dark:bg-amber-900/20 border-b border-amber-200 dark:border-amber-800 p-3"},ld={class:"flex items-center justify-between"},dd={key:0,class:"sticky top-0 z-10 bg-amber-50 dark:bg-amber-900/20 border-b border-amber-200 dark:border-amber-800 p-2"},id={class:"p-4 space-y-4"},nd={class:"flex flex-col items-center gap-1"},ud={class:"text-xs text-gray-400 dark:text-gray-500"},cd={key:0,class:"mb-4 mx-4"},md={class:"bg-blue-50 dark:bg-blue-900/20 rounded p-3 border border-blue-200 dark:border-blue-800"},xd={class:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},vd={key:0,class:"mt-2 pt-2 border-t border-blue-200 dark:border-blue-700"},gd={class:"flex items-center gap-2"},bd={class:"text-xs text-gray-600 dark:text-gray-400"},yd={class:"font-medium text-blue-600 dark:text-blue-400"},fd={key:1,class:"mb-4 mx-4"},kd={class:"bg-blue-50 dark:bg-blue-900/20 rounded p-3 border border-blue-200 dark:border-blue-800"},pd={class:"flex items-center gap-2"},wd={class:"text-xs text-gray-600 dark:text-gray-400"},hd={class:"font-medium text-blue-600 dark:text-blue-400"},_d={key:0,class:"flex flex-col items-center gap-1"},Cd={class:"text-xs text-gray-400 dark:text-gray-500"},$d={key:0},zd=["href"],Md=["src","alt"],jd={key:1,class:"h-7 w-7 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center"},Bd={class:"text-white text-xs font-bold"},Fd={class:"max-w-[70%]"},Sd={class:"text-xs font-medium text-gray-600 dark:text-gray-400 mb-0.5 px-1"},Ad={key:0,class:"text-purple-600 dark:text-purple-400 font-bold"},Ld={class:"bg-gray-100 dark:bg-gray-800 rounded rounded-tl-none px-3 py-2"},Vd={key:0,class:"mb-2"},Ed={key:1,class:"text-sm text-gray-900 dark:text-gray-200"},Td={class:"text-xs text-gray-400 dark:text-gray-500 mt-1 px-1"},Id={class:"max-w-[70%]"},Ud={class:"text-xs font-medium text-gray-600 dark:text-gray-400 mb-0.5 px-1 text-right"},Pd={key:0,class:"text-purple-600 dark:text-purple-400 font-bold"},Dd={class:"bg-emerald-600 text-white rounded rounded-tr-none px-3 py-2"},Rd={key:0,class:"mb-2"},qd={key:1,class:"text-sm"},Wd={class:"text-xs text-gray-400 dark:text-gray-500 mt-1 px-1 text-right"},Hd=["src","alt"],Od={key:1,class:"h-7 w-7 rounded-full bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center flex-shrink-0"},Nd={class:"text-white text-xs font-bold"},Kd={class:"bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 pb-safe"},Xd={class:"p-3"},Jd={key:0,class:"mb-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded"},Gd={key:0,class:"flex items-center gap-3"},Qd={key:1,class:"flex items-center gap-3"},Zd={class:"flex-shrink-0"},Yd=["src"],ei={key:1,class:"w-12 h-12 bg-gray-200 dark:bg-gray-600 rounded flex items-center justify-center"},ti={class:"flex-1 min-w-0"},ri={class:"text-sm font-medium text-gray-900 dark:text-gray-200 truncate"},si={class:"text-xs text-gray-500 dark:text-gray-400"},ai={class:"flex items-center"},oi=["disabled"],li=["placeholder","disabled"],di=["disabled"],ii={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},ni={key:1},ui={key:1,class:"flex mt-2 justify-between items-center"},ci={class:"flex gap-2 overflow-x-auto pb-1"},mi=["title"],xi={class:"flex items-center justify-between"},vi={class:"flex items-center gap-2"},gi={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},bi={class:"flex items-center gap-2"},yi={class:"text-xs text-gray-500 dark:text-gray-400"},fi={key:0,class:"text-gray-700 dark:text-gray-300"},ki={key:1,class:"mt-4"},pi={key:0,class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},wi=["placeholder","required"],hi={class:"bg-white dark:bg-gray-900 px-4 pt-4 pb-4 sm:p-5 sm:pb-4 max-h-[80vh] overflow-y-auto"},_i={class:"mt-2 text-center"},Ci={class:"mt-3 space-y-2.5 text-left"},$i={class:"p-2.5 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded"},zi={class:"space-y-2"},Mi={key:0},ji={class:"font-mono text-xs text-gray-900 dark:text-gray-100 break-all mt-0.5"},Bi={key:1},Fi={class:"font-mono text-xs text-gray-900 dark:text-gray-100 break-all mt-0.5"},Si={class:"text-base font-bold text-emerald-600 dark:text-emerald-400"},Ai={key:2},Li={class:"font-mono text-xs text-blue-600 dark:text-blue-400 break-all mt-0.5"},Vi={class:"space-y-2"},Ei={class:"space-y-1.5"},Ti={class:"flex items-start"},Ii=["disabled"],Ui={class:"flex items-start"},Pi=["disabled"],Di={class:"flex items-start"},Ri=["disabled"],qi={class:"ml-2 text-xs text-gray-700 dark:text-gray-300"},Wi={class:"block font-mono text-blue-600 dark:text-blue-400 break-all mt-0.5"},Hi={class:"flex items-start"},Oi=["disabled"],Ni={class:"ml-2 text-xs text-gray-700 dark:text-gray-300"},Ki={class:"block font-mono text-blue-600 dark:text-blue-400 break-all mt-0.5"},Xi={class:"flex items-start"},Ji=["disabled"],Gi={class:"ml-2 text-xs text-gray-700 dark:text-gray-300"},Qi={class:"font-bold text-emerald-600 dark:text-emerald-400"},Zi={class:"flex flex-row justify-end px-4 py-3 sm:px-5 sm:py-3 bg-gray-100 dark:bg-gray-800 text-end gap-2"},Yi={class:"bg-white dark:bg-gray-900 px-4 pt-4 pb-4 sm:p-5 sm:pb-4 max-h-[80vh] overflow-y-auto"},e0={class:"mt-2 text-center"},t0={class:"mt-3 space-y-2.5 text-left"},r0={key:0,class:"p-2.5 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded"},s0={class:"space-y-1.5"},a0={class:"font-mono text-xs text-gray-900 dark:text-gray-100 break-all mt-0.5"},o0={class:"text-base font-bold text-emerald-600 dark:text-emerald-400"},l0=["disabled"],d0={class:"flex items-start"},i0=["disabled"],n0={class:"ml-2 text-sm text-gray-700 dark:text-gray-300"},u0={class:"font-bold text-emerald-600 dark:text-emerald-400"},c0={class:"flex flex-row justify-end px-4 py-3 sm:px-5 sm:py-3 bg-gray-100 dark:bg-gray-800 text-end gap-2"},m0={class:"bg-white dark:bg-gray-900 px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},x0={class:"mt-3 text-center"},v0={class:"mt-4 space-y-3 text-left"},g0={class:"text-sm text-gray-600 dark:text-gray-400"},b0={class:"font-semibold text-emerald-600 dark:text-emerald-400"},y0={key:0},f0={key:1,class:"p-2.5 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-md"},k0={key:2,class:"p-2.5 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md"},p0={class:"flex flex-row justify-end px-6 py-4 bg-gray-100 dark:bg-gray-800 text-end gap-3"},w0={class:"bg-white dark:bg-gray-900 px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},h0={class:"mt-3 text-center"},_0={class:"mt-4 space-y-3 text-left"},C0={class:"text-sm text-gray-600 dark:text-gray-400"},$0={class:"font-semibold text-emerald-600 dark:text-emerald-400"},z0={key:0},M0={key:1,class:"p-2.5 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-md"},j0={key:2,class:"p-2.5 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md"},B0={class:"flex flex-row justify-end px-6 py-4 bg-gray-100 dark:bg-gray-800 text-end gap-3"},F0={class:"p-4"},S0={key:0,class:"bg-gray-50 dark:bg-gray-800/50 rounded p-4 max-h-80 overflow-y-auto"},A0={class:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},L0={key:1,class:"bg-gray-50 dark:bg-gray-800/50 rounded p-4"},R0={__name:"Chat",props:{userHas2FA:{type:Boolean,default:!1},order:{type:Object,required:!0},otherUser:{type:Object,default:null},messages:{type:Array,default:()=>[]},currentUserId:{type:Number,required:!0},userRole:{type:String,required:!0},availableActions:{type:Array,default:()=>[]}},setup(r){et();const c=r,y=z(!1),b=z(!1),x=z(!1),d=z({...c.order}),m=z(c.messages),$=z(""),E=z(null),j=z(null),D=z(null),N=z(null),f=z(null),C=z(!1),S=z(!1),F=z(null),p=z(!1),k=z(!0);let M=null,L=null,K=null,te=null;const U=z(!1),B=z([]),R=z([]),me=()=>{const l=[];d.value.vendor&&l.push({id:d.value.vendor.id,name:d.value.vendor.name,role:"商家",avatar:d.value.vendor.avatar,profile_photo_url:d.value.vendor.avatar,is_self:d.value.vendor.id===c.currentUserId,is_online:d.value.vendor.id===c.currentUserId,is_admin:!1}),d.value.client&&l.push({id:d.value.client.id,name:d.value.client.name,role:"客户",avatar:d.value.client.avatar,profile_photo_url:d.value.client.avatar,is_self:d.value.client.id===c.currentUserId,is_online:d.value.client.id===c.currentUserId,is_admin:!1}),R.value=l},n=z({show:!1,title:"",message:"",inputMode:!1,inputValue:"",inputLabel:"",inputPlaceholder:"",inputRequired:!1,danger:!1,confirmVariant:"primary",confirmText:"确认",cancelText:"取消",loading:!1,pendingAction:null,pendingData:{},require2FA:!1,twoFactorCode:"",twoFactorError:""}),ae=z(""),Z=z(""),de=z(!1),q=z({txExists:!1,confirmations:!1,fromAddress:!1,toAddress:!1,amount:!1}),Se=I(()=>q.value.txExists&&q.value.confirmations&&q.value.fromAddress&&q.value.toAddress&&q.value.amount),G=I(()=>d.value.status==="completed"||d.value.status==="cancelled"||d.value.escrow_status==="escrow_released"),xe=z({orderId:d.value.order_no,type:c.userRole==="buyer"?"buy":"sell",cryptocurrency:d.value.currency_key||d.value.crypto_currency,amount:d.value.crypto_amount,price:d.value.price,total:d.value.fiat_amount,status:d.value.escrow_status,progress:ve(d.value.escrow_status),timeRemaining:765});function ve(l){return{order_initiated:12.5,vendor_confirmed:25,seller_paid:37.5,escrow_received:50,buyer_confirmed_escrow:62.5,buyer_paid:75,seller_received:87.5,escrow_released:100}[l]||0}function We(l){return{order_initiated:"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400",vendor_confirmed:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400",seller_paid:"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400",escrow_received:"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400",buyer_paid:"bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-400",seller_received:"bg-teal-100 dark:bg-teal-900/30 text-teal-700 dark:text-teal-400",escrow_released:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400"}[l]||"bg-gray-100 dark:bg-gray-900/30 text-gray-700 dark:text-gray-400"}function Ae(l){return{order_initiated:"等待确认",vendor_confirmed:"等待转币",seller_paid:"托管确认中",escrow_received:"托管保护中",buyer_paid:"等待收款确认",seller_received:"释放中",escrow_released:"已完成"}[l]||"处理中"}function Le(l){return{order_initiated:"等待商家确认",vendor_confirmed:"等待卖家转币",seller_paid:"等待托管确认",escrow_received:"托管保护中",buyer_confirmed_escrow:"等待买家付款",buyer_paid:"等待卖家确认收款",seller_received:"准备释放托管",escrow_released:"交易完成"}[l]||"处理中"}function Ve(l){return{order_initiated:"bg-amber-500",vendor_confirmed:"bg-amber-500",seller_paid:"bg-blue-500",escrow_received:"bg-blue-500",buyer_confirmed_escrow:"bg-blue-500",buyer_paid:"bg-blue-500",seller_received:"bg-emerald-500",escrow_released:"bg-emerald-500"}[l]||"bg-gray-500"}const He=z("12:45");let ge=null;const Oe=()=>{ge=setInterval(()=>{if(xe.value.timeRemaining>0){xe.value.timeRemaining--;const l=Math.floor(xe.value.timeRemaining/60),t=xe.value.timeRemaining%60;He.value=`${l}:${t.toString().padStart(2,"0")}`}else clearInterval(ge)},1e3)},re=()=>{ie(()=>{const l=()=>{E.value&&(E.value.scrollTop=E.value.scrollHeight),F.value&&(F.value.scrollTop=F.value.scrollHeight)};l();const t=E.value||F.value;if(t){const a=t.querySelectorAll("img");if(a.length>0){let h=0;a.forEach(W=>{W.complete?h++:(W.addEventListener("load",()=>{l()},{once:!0}),W.addEventListener("error",()=>{l()},{once:!0}))}),h===a.length&&setTimeout(l,100)}}})},P=l=>new Date(l).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),Ne=l=>{d.value.has_review=!0,d.value.review=l,d.value.status="completed",b.value=!1,se.success("感谢您的评价！")},Ee=l=>{if(l===0)return"0 Bytes";const t=1024,a=["Bytes","KB","MB","GB"],h=Math.floor(Math.log(l)/Math.log(t));return Math.round(l/Math.pow(t,h)*100)/100+" "+a[h]},Te=async l=>{const t=l.target.files[0];if(!t)return;const a=2*1024*1024;let h=t;if(t.type.startsWith("image/")){S.value=!0;try{const W=(t.size/1024/1024).toFixed(2);console.log(`原始图片大小: ${W} MB`),h=await _r.compressImage(t,{maxWidth:1920,maxHeight:1920,maxSizeMB:2,quality:.85});const ze=(h.size/1024/1024).toFixed(2);if(console.log(`压缩后图片大小: ${ze} MB`),h.size<t.size*.8){const Me=Math.round((1-h.size/t.size)*100);console.log(`图片已压缩 ${Me}%`)}}catch(W){console.error("图片压缩失败:",W),h=t}finally{S.value=!1}}if(h.size>a){alert(`文件大小不能超过 ${a/1024/1024}MB，当前文件大小为 ${(h.size/1024/1024).toFixed(2)}MB`),l.target.value="";return}j.value=h,h.type.startsWith("image/")&&(D.value=URL.createObjectURL(h))},Ce=()=>{j.value=null,D.value&&(URL.revokeObjectURL(D.value),D.value=null),N.value&&(N.value.value=""),f.value&&(f.value.value="")},Ie=async()=>{if(!$.value.trim()&&!j.value||!p.value||C.value)return;const l=$.value,t=j.value;$.value="",C.value=!0;try{let a=null;if(t){const fe=new FormData;fe.append("file",t);const Pe=await Q.post(`/web/api/orders/${d.value.order_no}/chat/upload`,fe,{headers:{"Content-Type":"multipart/form-data"}});Pe.data.success&&(a=Pe.data.file)}const h=d.value.vendor_id===c.currentUserId?d.value.client_id:d.value.vendor_id,W=R.value.find(fe=>fe.id===h),ze=W?W.is_online:!1,Me=await Q.post(`/web/api/orders/${d.value.order_no}/chat/send`,{message:l,attachment:a,recipient_online:ze});m.value.push(Me.data),Ce(),ie(()=>{re()})}catch(a){console.error("发送消息失败:",a),$.value=l,alert("发送失败，请重试")}finally{C.value=!1}},V=l=>{console.log("handleEscrowAction called with:",l);const t={vendor_confirm:{title:"确认接单",message:"确认接受此订单吗？接单后需要等待卖家转币到托管。",confirmVariant:"primary",confirmText:"确认接单"},mark_seller_paid:{title:"标记已转币",message:"请确认您已将币转入托管地址，并提供交易哈希作为凭证",inputMode:!0,inputLabel:"交易哈希 (TX ID)",inputPlaceholder:"请输入区块链交易哈希...",inputRequired:!0,confirmVariant:"primary",confirmText:"确认已转币"},confirm_escrow:{},mark_buyer_paid:{title:"标记已付款",message:"请确认您已向卖家付款",inputMode:!0,inputLabel:"付款说明（可选）",inputPlaceholder:"请输入付款凭证或说明...",inputRequired:!1,confirmVariant:"primary",confirmText:"确认已付款",require2FA:!0},mark_seller_received:{title:"确认收款",message:"请确认您已收到买家的付款。确认后，托管的币将释放给买家。",confirmVariant:"success",confirmText:"确认已收款",require2FA:!0},cancel:{},create_dispute:{title:"发起争议",message:"发起争议后，订单将被冻结，暂停所有交易操作，等待平台客服介入处理。请详细说明问题。",inputMode:!0,inputLabel:"争议原因",inputPlaceholder:"请详细描述您遇到的问题...",inputRequired:!0,confirmVariant:"warning",confirmText:"确认发起争议"},resolve_dispute:{title:"解除争议",message:"确定要解除争议吗？解除后订单将恢复正常，可以继续进行交易。",inputMode:!0,inputLabel:"解除原因（可选）",inputPlaceholder:"请输入解除争议的原因...",inputRequired:!1,confirmVariant:"success",confirmText:"确认解除"}};if(l==="cancel"){const h=d.value.escrow_status;let W={title:"取消订单",inputMode:!0,inputLabel:"取消原因",inputPlaceholder:"请输入取消原因...",inputRequired:!0,danger:!0,confirmVariant:"danger",confirmText:"确认取消"};["seller_paid","escrow_received","buyer_confirmed_escrow"].includes(h)?W.message=`⚠️ 警告：当前已进入托管阶段，取消订单将扣除您的信誉分 -1

确定要取消此订单吗？`:W.message="确定要取消此订单吗？",t[l]=W}const a=t[l];!a&&l!=="confirm_escrow"||(Object.assign(n.value,{show:!0,...a||{},cancelText:"返回",pendingAction:l,pendingData:{},loading:!1}),console.log("dialogState after setting:",n.value))},Ke=async l=>{const t=n.value.pendingAction;if(t)try{let a="",h={};switch(t){case"vendor_confirm":a=`/web/api/orders/${d.value.id}/vendor-confirm`;break;case"mark_seller_paid":if(a=`/web/api/orders/${d.value.id}/seller-paid`,!l||!l.trim()){n.value.loading=!1,n.value.show=!1;return}h.tx_hash=l.trim();break;case"confirm_escrow":a=`/web/api/orders/${d.value.id}/buyer-confirm-escrow`;break;case"mark_buyer_paid":a=`/web/api/orders/${d.value.id}/buyer-paid`,l&&(h.payment_proof=l),n.value.require2FA&&n.value.twoFactorCode&&(h.two_factor_code=n.value.twoFactorCode);break;case"mark_seller_received":a=`/web/api/orders/${d.value.id}/seller-received`,n.value.require2FA&&n.value.twoFactorCode&&(h.two_factor_code=n.value.twoFactorCode);break;case"cancel":a=`/web/api/orders/${d.value.id}/cancel`,h.reason=l;break;case"create_dispute":a=`/web/api/orders/${d.value.id}/dispute`,h.reason=l;break;case"resolve_dispute":a=`/web/api/orders/${d.value.id}/resolve-dispute`,l&&(h.reason=l);break}n.value.loading=!0,(await Q.post(a,h)).data.success&&(n.value.show=!1,H.reload())}catch(a){console.error("操作失败:",a),n.value.loading=!1,n.value.show=!1}},Y=()=>{n.value={show:!1,title:"",message:"",inputMode:!1,inputValue:"",inputLabel:"",inputPlaceholder:"",inputRequired:!1,danger:!1,confirmVariant:"primary",confirmText:"确认",cancelText:"取消",loading:!1,pendingAction:null,pendingData:{},require2FA:!1,twoFactorCode:"",twoFactorError:""},ae.value="",Z.value="",de.value=!1,q.value={txExists:!1,confirmations:!1,fromAddress:!1,toAddress:!1,amount:!1}},Ue=l=>{n.value.twoFactorCode=l,n.value.twoFactorError=""},Xe=async()=>{if(!c.userHas2FA){alert("买家付款必须启用双重验证"),H.visit("/user/profile");return}if(!n.value.twoFactorCode||n.value.twoFactorCode.length!==6){n.value.twoFactorError="请输入6位验证码";return}n.value.loading=!0,n.value.twoFactorError="";try{const l={two_factor_code:n.value.twoFactorCode};ae.value&&ae.value.trim()&&(l.payment_proof=ae.value.trim()),(await Q.post(`/web/api/orders/${d.value.id}/buyer-paid`,l)).data.success&&(n.value.show=!1,ae.value="",n.value.twoFactorCode="",n.value.twoFactorError="",H.reload())}catch(l){n.value.loading=!1,l.response?.data?.errors?.two_factor_code?n.value.twoFactorError=l.response.data.errors.two_factor_code[0]:l.response?.data?.message?l.response.data.require_2fa?(n.value.show=!1,alert("为了您的资金安全，请先在个人设置中启用双重验证"),H.visit("/user/profile")):n.value.twoFactorError=l.response.data.message:n.value.twoFactorError="验证失败，请重试"}},Je=async()=>{if(!Se.value){se.error("请确认所有检查项");return}n.value.loading=!0;try{(await Q.post(`/web/api/orders/${d.value.id}/buyer-confirm-escrow`)).data.success&&(n.value.show=!1,q.value={txExists:!1,confirmations:!1,fromAddress:!1,toAddress:!1,amount:!1},H.reload())}catch(l){n.value.loading=!1,console.error("确认托管失败:",l)}},Ge=async()=>{if(!Z.value||!Z.value.trim()){se.error("请输入交易哈希");return}if(!de.value){se.error("请确认已核对地址和金额");return}n.value.loading=!0;try{(await Q.post(`/web/api/orders/${d.value.id}/seller-paid`,{tx_hash:Z.value.trim()})).data.success&&(n.value.show=!1,Z.value="",de.value=!1,H.reload())}catch(l){n.value.loading=!1,console.error("标记转币失败:",l)}},Qe=async()=>{if(!c.userHas2FA){alert("卖家确认收款必须启用双重验证"),H.visit("/user/profile");return}if(!n.value.twoFactorCode||n.value.twoFactorCode.length!==6){n.value.twoFactorError="请输入6位验证码";return}n.value.loading=!0,n.value.twoFactorError="";try{const l={two_factor_code:n.value.twoFactorCode};(await Q.post(`/web/api/orders/${d.value.id}/seller-received`,l)).data.success&&(n.value.show=!1,n.value.twoFactorCode="",n.value.twoFactorError="",H.reload())}catch(l){n.value.loading=!1,l.response?.data?.errors?.two_factor_code?n.value.twoFactorError=l.response.data.errors.two_factor_code[0]:l.response?.data?.message?l.response.data.require_2fa?(n.value.show=!1,alert("为了您的资金安全，请先在个人设置中启用双重验证"),H.visit("/user/profile")):n.value.twoFactorError=l.response.data.message:n.value.twoFactorError="验证失败，请重试"}},be=async l=>{try{if(l==="received"){if((await Q.post(`/web/api/orders/${c.order.id}/mock-escrow-received`)).data.success){const a=await Q.post(`/web/api/orders/${c.order.order_no}/chat/send`,{message:"✅ [测试模式] 托管已确认到账！买家现在可以付款了"});a.data&&(m.value.push({...a.data,type:"system"}),re()),setTimeout(()=>{H.reload()},1e3)}}else l==="not_received"&&(await Q.post(`/web/api/orders/${c.order.id}/mock-escrow-not-received`)).data.success&&setTimeout(()=>{H.reload()},1e3)}catch(t){console.error("模拟托管状态失败:",t)}},$e=()=>{console.log("[WebSocket] 断开连接"),L&&(L.stopListening(".MessageSent"),L.stopListening(".EscrowStatusUpdated"),L.stopListening(".OrderStatusUpdated"),L.stopListening(".dispute.resolved"),M.leave(`order.${d.value.id}`),L=null),p.value=!1,te=Date.now()},ne=()=>{typeof window.Echo<"u"&&!L?(M=window.Echo,console.log("[WebSocket] 建立连接"),L=M.join(`order.${d.value.id}`).here(l=>{console.log("当前在线用户:",l),B.value=l,R.value.forEach(t=>{t.is_online=l.some(a=>a.id===t.id)}),l.forEach(t=>{[3].includes(t.id)&&(R.value.find(W=>W.id===t.id)||R.value.push({id:t.id,name:t.name,role:"仲裁员",avatar:null,is_self:t.id===c.currentUserId,is_online:!0,is_admin:!0}))}),U.value=l.some(t=>t.id===c.otherUser?.id)}).joining(l=>{if(console.log("用户加入:",l),B.value.push(l),l.id!==c.currentUserId){const a=new Date;m.value.push({id:`join-${l.id}-${Date.now()}`,type:"system",content:`${l.name} 加入了聊天`,created_at:a.toISOString(),is_temporary:!0}),ie(()=>re())}const t=R.value.find(a=>a.id===l.id);t?t.is_online=!0:[3].includes(l.id)&&R.value.push({id:l.id,name:l.name,role:"仲裁员",avatar:null,is_self:l.id===c.currentUserId,is_online:!0,is_admin:!0}),l.id===c.otherUser?.id&&(U.value=!0)}).leaving(l=>{if(console.log("用户离开:",l),B.value=B.value.filter(a=>a.id!==l.id),l.id!==c.currentUserId){const a=new Date;m.value.push({id:`leave-${l.id}-${Date.now()}`,type:"system",content:`${l.name} 离开了聊天`,created_at:a.toISOString(),is_temporary:!0}),ie(()=>re())}const t=R.value.find(a=>a.id===l.id);t&&(t.is_online=!1),l.id===c.otherUser?.id&&(U.value=!1)}).error(l=>{console.error("Presence channel error:",l)}).listen("MessageSent",l=>{if(l.type==="admin"&&l.user){const t=R.value.find(a=>a.id===l.user.id);t?t&&!t.is_admin&&(t.role="仲裁员",t.is_admin=!0,t.is_online=!0):R.value.push({id:l.user.id,name:l.user.name,role:"仲裁员",avatar:null,is_self:l.user.id===c.currentUserId,is_online:!0,is_admin:!0})}(l.type==="system"||!l.user||l.user.id!==c.currentUserId)&&(m.value.push({id:l.id,message:l.message,type:l.type||"text",attachment:l.attachment,user:l.user,created_at:l.created_at}),re())}).listen("EscrowStatusUpdated",l=>{console.log("托管状态更新:",l),d.value.escrow_status=l.escrow_status||l.new_status,d.value.status=l.status||d.value.status,d.value.is_disputed=l.is_disputed,d.value.disputed_by=l.disputed_by,l.escrow_status==="buyer_confirmed_escrow"&&(d.value.buyer_confirmed_escrow_at=l.updated_at);const t=`托管状态更新: ${l.message}`;m.value.push({id:Date.now(),message:t,type:"system",user:null,created_at:new Date().toISOString()}),re(),setTimeout(()=>{H.reload()},2e3)}).listen("OrderStatusUpdated",l=>{console.log("订单状态更新:",l),l.status==="cancelled"&&setTimeout(()=>{H.reload()},1e3)}).listen(".dispute.resolved",l=>{console.log("争议已解除:",l),d.value.is_disputed=!1,d.value.disputed_by=null,l.escrow_status&&(d.value.escrow_status=l.escrow_status),l.status&&(d.value.status=l.status),setTimeout(()=>{H.reload({only:["availableActions","order"]})},1e3),showNotification("success",l.message||"争议已解除，订单恢复正常")}),p.value=!0,te&&(te=null,console.log("[WebSocket] 重连成功，重新加载消息"),Ze())):(console.warn("Echo not available, retrying..."),setTimeout(ne,1e3))},Ze=async()=>{try{console.log("[WebSocket] 重新加载所有消息");const l=await Q.get(`/web/api/orders/${d.value.order_no}/chat/messages`);l.data&&l.data.length>0?(console.log("[WebSocket] 加载消息成功:",l.data.length,"条"),m.value=l.data,re()):console.log("[WebSocket] 没有消息")}catch(l){console.error("[WebSocket] 加载消息失败:",l)}},ye=()=>{if(k.value=!document.hidden,document.hidden){console.log("[WebSocket] 页面隐藏，准备断开");const t=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?1e4:3e4;K=setTimeout(()=>{$e()},t)}else console.log("[WebSocket] 页面显示, 连接状态:",p.value,"频道:",!!L),K&&(clearTimeout(K),K=null),!p.value&&!L?(console.log("[WebSocket] 检测到断开状态，重新连接..."),ne()):!p.value||!L?(console.log("[WebSocket] 连接状态不一致，重新连接..."),ne()):console.log("[WebSocket] 已连接，无需重连")};return _e(()=>{me(),Oe(),re(),ne(),document.addEventListener("visibilitychange",ye),document.addEventListener("pause",()=>{console.log("[WebSocket] PWA进入后台"),$e()}),document.addEventListener("resume",()=>{console.log("[WebSocket] PWA恢复前台"),p.value||ne()})}),Fe(()=>{ge&&clearInterval(ge),K&&clearTimeout(K),$e(),document.removeEventListener("visibilitychange",ye),document.removeEventListener("pause",ye),document.removeEventListener("resume",ye)}),(l,t)=>(s(),o(T,null,[_(rt,{"hide-nav":!0,"hide-footer":!0,"show-mobile-bottom-nav":!1,"show-breadcrumbs":!0,breadcrumbs:[{label:"订单",url:"/orders"},{label:`订单 #${r.order.order_no}`,url:null},{label:"交易聊天"}]},{default:w(()=>[_(yt,{title:`订单 #${r.order.order_no}`,"back-url":"/orders"},{custom:w(()=>[e("div",Cr,[e("div",$r,[(s(!0),o(T,null,O(R.value,(a,h)=>(s(),o("div",{key:a.id,class:"relative",style:pe(`z-index: ${R.value.length-h}`)},[a.profile_photo_url?(s(),o("img",{key:0,src:a.profile_photo_url,alt:a.name,class:v(["h-8 w-8 rounded-full object-cover ring-2",a.is_online?"ring-emerald-500":"ring-gray-400 dark:ring-gray-600"])},null,10,zr)):(s(),o("div",{key:1,class:v(["h-8 w-8 rounded-full flex items-center justify-center ring-2 ring-white dark:ring-gray-950",a.is_online?"bg-gradient-to-br from-emerald-500 to-emerald-600":"bg-gray-400 dark:bg-gray-600"])},[e("span",Mr,i(a.name?.[0]?.toUpperCase()||"U"),1)],2))],4))),128))]),e("div",jr,[e("p",Br," 订单 #"+i(r.order.order_no),1),e("p",Fr,i(R.value.filter(a=>a.is_online).length)+"/"+i(R.value.length)+" 在房间 ",1)])])]),actions:w(()=>[e("button",{onClick:t[0]||(t[0]=a=>x.value=!x.value),class:"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},[...t[59]||(t[59]=[e("svg",{class:"w-5 h-5 text-gray-700 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)])]),e("button",{onClick:t[1]||(t[1]=a=>y.value=!y.value),class:"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},[...t[60]||(t[60]=[e("svg",{class:"w-5 h-5 text-gray-700 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])])]),_:1},8,["title"]),e("div",Sr,[r.order.status==="cancelled"?(s(),o("div",Ar,[...t[61]||(t[61]=[e("div",{class:"max-w-7xl mx-auto px-4 py-3 sm:px-6 lg:px-8"},[e("div",{class:"flex items-center gap-3"},[e("svg",{class:"w-5 h-5 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("p",{class:"text-sm font-medium text-red-800 dark:text-red-200"},"此订单已取消，无法进行任何操作")])],-1)])])):u("",!0),r.order.is_disputed&&r.order.status!=="cancelled"?(s(),o("div",Lr,[e("div",Vr,[e("div",Er,[e("div",Tr,[t[65]||(t[65]=e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("div",Ir,[t[63]||(t[63]=e("p",{class:"text-sm font-medium text-amber-800 dark:text-amber-200"},"该订单处于争议中",-1)),t[64]||(t[64]=e("p",{class:"text-xs text-amber-700 dark:text-amber-300 mt-1"},[g(" 请等待仲裁管理员加入聊天，管理员将在 "),e("span",{class:"font-semibold"},"24小时内"),g(" 加入处理。 在此期间，您可以与对方自行协商解决。 ")],-1)),r.order.dispute_reason?(s(),o("p",Ur,[t[62]||(t[62]=e("span",{class:"font-medium"},"争议原因：",-1)),g(i(r.order.dispute_reason),1)])):u("",!0)])]),r.availableActions.includes("resolve_dispute")?(s(),o("div",Pr,[_(A,{onClick:t[2]||(t[2]=a=>V("resolve_dispute")),variant:"outline",size:"sm"},{default:w(()=>[...t[66]||(t[66]=[g(" 解除争议 ",-1)])]),_:1})])):u("",!0)])])])):u("",!0),!l.$page.props.auth.user?.telegram_chat_id&&r.order.status!=="cancelled"&&r.order.status!=="completed"?(s(),o("div",Dr,[e("div",Rr,[e("div",qr,[t[68]||(t[68]=e("div",{class:"flex items-start gap-3 flex-1"},[e("svg",{class:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.56c-.21 2.27-1.13 7.75-1.6 10.29-.2 1.08-.59 1.44-.97 1.47-.82.07-1.45-.54-2.24-.99-1.24-.71-1.94-1.16-3.14-1.85-1.39-.8-.49-1.24.3-1.96.21-.19 3.85-3.52 3.91-3.82.01-.04.01-.19-.07-.27-.08-.08-.2-.05-.28-.03-.12.03-2.02.13-5.7 3.75-.54.54-1.03.8-1.48.78-.49-.02-1.42-.27-2.11-.5-.85-.28-1.53-.42-1.47-.89.03-.25.37-.51 1.02-.77 4-1.74 6.67-2.89 8.01-3.44 3.81-1.57 4.61-1.84 5.13-1.85.11 0 .37.03.53.18.14.12.18.28.2.45-.01.06-.01.24-.02.38z"})]),e("div",{class:"flex-1"},[e("p",{class:"text-sm font-medium text-blue-800 dark:text-blue-200"},"建议设置 Telegram 接收实时通知"),e("p",{class:"text-xs text-blue-700 dark:text-blue-300 mt-1"}," 连接 Telegram 后，您可以实时收到交易状态更新、对方消息提醒等重要通知，确保不错过任何关键信息。 ")])],-1)),e("div",Wr,[_(je(tt),{href:"/notifications/settings",class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm font-medium transition-colors"},{default:w(()=>[...t[67]||(t[67]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.56c-.21 2.27-1.13 7.75-1.6 10.29-.2 1.08-.59 1.44-.97 1.47-.82.07-1.45-.54-2.24-.99-1.24-.71-1.94-1.16-3.14-1.85-1.39-.8-.49-1.24.3-1.96.21-.19 3.85-3.52 3.91-3.82.01-.04.01-.19-.07-.27-.08-.08-.2-.05-.28-.03-.12.03-2.02.13-5.7 3.75-.54.54-1.03.8-1.48.78-.49-.02-1.42-.27-2.11-.5-.85-.28-1.53-.42-1.47-.89.03-.25.37-.51 1.02-.77 4-1.74 6.67-2.89 8.01-3.44 3.81-1.57 4.61-1.84 5.13-1.85.11 0 .37.03.53.18.14.12.18.28.2.45-.01.06-.01.24-.02.38z"})],-1),g(" 立即设置 ",-1)])]),_:1})])])])])):u("",!0),_(Be,{modelValue:y.value,"onUpdate:modelValue":t[10]||(t[10]=a=>y.value=a),title:"交易详情",subtitle:`订单 #${r.order.order_no}`,position:"bottom",size:"default","icon-color":"blue"},{"header-icon":w(()=>[...t[69]||(t[69]=[e("div",{class:"p-2 rounded bg-blue-100 dark:bg-blue-900/30"},[e("svg",{class:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})])],-1)])]),default:w(()=>[e("div",Hr,[e("div",Or,[e("div",Nr,[e("div",Kr,[t[70]||(t[70]=e("svg",{class:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z","clip-rule":"evenodd"})],-1)),e("div",null,[e("p",Xr,i(Ae(r.order.escrow_status)),1),e("p",Jr,"当前进度: "+i(ve(r.order.escrow_status))+"%",1)])])]),e("div",null,[t[94]||(t[94]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-3"},"交易流程",-1)),e("div",Gr,[e("div",Qr,[t[73]||(t[73]=e("div",{class:"flex flex-col items-center"},[e("div",{class:"w-8 h-8 rounded-full bg-emerald-600 text-white flex items-center justify-center"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])]),e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-gray-600"})],-1)),e("div",Zr,[t[72]||(t[72]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"订单创建",-1)),e("p",Yr,i(r.order.created_at?P(r.order.created_at):"已完成"),1),r.order.escrow_status==="order_initiated"&&r.availableActions.includes("vendor_confirm")?(s(),o("div",es,[_(A,{onClick:t[3]||(t[3]=a=>V("vendor_confirm")),variant:"primary",size:"sm"},{default:w(()=>[...t[71]||(t[71]=[g(" 确认接单 ",-1)])]),_:1})])):u("",!0)])]),e("div",ts,[e("div",rs,[e("div",{class:v(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="order_initiated"?"bg-amber-500 animate-pulse":["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-gray-700"])},[["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(s(),o("svg",ss,[...t[74]||(t[74]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),o("span",as,"2"))],2),t[75]||(t[75]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-gray-600"},null,-1))]),e("div",os,[e("p",{class:v(["text-sm font-medium",["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-600 dark:text-gray-300"])}," 商家确认 ",2),e("p",ls,i(r.order.vendor_confirmed_at?P(r.order.vendor_confirmed_at):"等待商家确认订单"),1)])]),e("div",ds,[e("div",is,[e("div",{class:v(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="vendor_confirmed"?"bg-amber-500 animate-pulse":["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-gray-700"])},[["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(s(),o("svg",ns,[...t[76]||(t[76]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),o("span",us,"3"))],2),t[77]||(t[77]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-gray-600"},null,-1))]),e("div",cs,[e("p",{class:v(["text-sm font-medium",["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-600 dark:text-gray-300"])}," 卖家转币到托管 ",2),e("p",ms,i(r.order.seller_paid_at?P(r.order.seller_paid_at):"等待卖家转币"),1),r.order.escrow_status==="vendor_confirmed"&&r.availableActions.includes("mark_seller_paid")?(s(),o("div",xs,[_(A,{onClick:t[4]||(t[4]=a=>V("mark_seller_paid")),variant:"primary",size:"sm"},{default:w(()=>[...t[78]||(t[78]=[g(" 我已转币 ",-1)])]),_:1})])):u("",!0)])]),e("div",vs,[e("div",gs,[e("div",{class:v(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="seller_paid"?"bg-amber-500 animate-pulse":["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-gray-700"])},[["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(s(),o("svg",bs,[...t[79]||(t[79]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),o("span",ys,"4"))],2),t[80]||(t[80]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-gray-600"},null,-1))]),e("div",fs,[e("p",{class:v(["text-sm font-medium",["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-600 dark:text-gray-300"])}," 托管确认到账 ",2),e("p",ks,i(r.order.escrow_received_at?P(r.order.escrow_received_at):"系统确认中"),1),r.order.escrow_status==="seller_paid"?(s(),o("div",ps,[e("div",ws,[_(A,{onClick:t[5]||(t[5]=a=>be("received")),variant:"success",size:"xs",fullWidth:""},{default:w(()=>[...t[81]||(t[81]=[g(" 模拟已收到 ",-1)])]),_:1}),_(A,{onClick:t[6]||(t[6]=a=>be("not_received")),variant:"danger",size:"xs",fullWidth:""},{default:w(()=>[...t[82]||(t[82]=[g(" 模拟未收到 ",-1)])]),_:1})]),t[83]||(t[83]=e("p",{class:"text-xs text-amber-600 dark:text-amber-400 text-center"}," 🧪 测试模式 ",-1))])):u("",!0)])]),e("div",hs,[e("div",_s,[e("div",{class:v(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="escrow_received"?"bg-amber-500 animate-pulse":["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-gray-700"])},[["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(s(),o("svg",Cs,[...t[84]||(t[84]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),o("span",$s,"5"))],2),t[85]||(t[85]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-gray-600"},null,-1))]),e("div",zs,[e("p",{class:v(["text-sm font-medium",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-600 dark:text-gray-300"])}," 买家确认托管到账 ",2),e("p",Ms,i(r.order.buyer_confirmed_escrow_at?P(r.order.buyer_confirmed_escrow_at):"等待买家确认"),1),r.order.escrow_status==="escrow_received"&&r.availableActions.includes("confirm_escrow")?(s(),o("div",js,[_(A,{onClick:t[7]||(t[7]=a=>V("confirm_escrow")),variant:"primary",size:"sm"},{default:w(()=>[...t[86]||(t[86]=[g(" 确认托管到账 ",-1)])]),_:1})])):u("",!0)])]),e("div",Bs,[e("div",Fs,[e("div",{class:v(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="buyer_confirmed_escrow"?"bg-amber-500 animate-pulse":["buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-gray-700"])},[["buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(s(),o("svg",Ss,[...t[87]||(t[87]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),o("span",As,"6"))],2),t[88]||(t[88]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-gray-600"},null,-1))]),e("div",Ls,[e("p",{class:v(["text-sm font-medium",["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-600 dark:text-gray-300"])}," 买家付款 ",2),e("p",Vs,i(r.order.buyer_paid_at?P(r.order.buyer_paid_at):"等待买家付款"),1),r.order.escrow_status==="buyer_confirmed_escrow"&&r.availableActions.includes("mark_buyer_paid")?(s(),o("div",Es,[_(A,{onClick:t[8]||(t[8]=a=>V("mark_buyer_paid")),variant:"primary",size:"sm"},{default:w(()=>[...t[89]||(t[89]=[g(" 我已付款 ",-1)])]),_:1})])):u("",!0)])]),e("div",Ts,[e("div",Is,[e("div",{class:v(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="buyer_paid"?"bg-amber-500 animate-pulse":["seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-gray-700"])},[["seller_received","escrow_released"].includes(r.order.escrow_status)?(s(),o("svg",Us,[...t[90]||(t[90]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),o("span",Ps,"7"))],2),t[91]||(t[91]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-gray-600"},null,-1))]),e("div",Ds,[e("p",{class:v(["text-sm font-medium",["buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-600 dark:text-gray-300"])}," 卖家确认收款 ",2),e("p",Rs,i(r.order.seller_received_at?P(r.order.seller_received_at):"等待卖家确认"),1),r.order.escrow_status==="buyer_paid"&&r.availableActions.includes("mark_seller_received")?(s(),o("div",qs,[_(A,{onClick:t[9]||(t[9]=a=>V("mark_seller_received")),variant:"success",size:"sm"},{default:w(()=>[...t[92]||(t[92]=[g(" 确认收款 ",-1)])]),_:1})])):u("",!0)])]),e("div",Ws,[e("div",Hs,[e("div",{class:v(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="seller_received"?"bg-amber-500 animate-pulse":r.order.escrow_status==="escrow_released"?"bg-emerald-600":"bg-gray-300 dark:bg-gray-700"])},[r.order.escrow_status==="escrow_released"?(s(),o("svg",Os,[...t[93]||(t[93]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),o("span",Ns,"8"))],2)]),e("div",Ks,[e("p",{class:v(["text-sm font-medium",["seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-600 dark:text-gray-300"])}," 托管释放 ",2),e("p",Xs,i(r.order.escrow_released_at?P(r.order.escrow_released_at):"平台释放币给买家"),1)])])])]),e("div",null,[t[105]||(t[105]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-2"},"交易信息",-1)),e("div",Js,[e("div",null,[t[95]||(t[95]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"订单编号",-1)),e("p",Gs,"#"+i(r.order.order_no),1)]),e("div",null,[t[96]||(t[96]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"商家",-1)),e("p",Qs,i(r.order.vendor?.name||"加载中..."),1)]),e("div",null,[t[97]||(t[97]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"客户",-1)),e("p",Zs,i(r.order.client?.name||"加载中..."),1)]),e("div",null,[t[98]||(t[98]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"买家",-1)),e("p",Ys,i(r.order.buyer?.name||"加载中..."),1)]),e("div",null,[t[99]||(t[99]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"卖家",-1)),e("p",ea,i(r.order.seller?.name||"加载中..."),1)]),e("div",null,[t[100]||(t[100]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"币种",-1)),e("p",ta,i(r.order.currency_label||r.order.currency_key||r.order.crypto_currency),1)]),e("div",null,[t[101]||(t[101]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"数量（含交易费）",-1)),e("p",ra,i(parseFloat(r.order.crypto_amount).toFixed(4))+" "+i(r.order.currency_label||r.order.currency_key||r.order.crypto_currency),1),r.order.fee&&r.order.fee>0?(s(),o("p",sa," 交易费（商家）: "+i(parseFloat(r.order.fee).toFixed(8))+" "+i(r.order.currency_label||r.order.currency_key||r.order.crypto_currency),1)):u("",!0)]),e("div",null,[t[102]||(t[102]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"单价",-1)),e("p",aa,"¥"+i(parseFloat(r.order.price).toFixed(2)),1)]),e("div",null,[t[103]||(t[103]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"总金额",-1)),e("p",oa,"¥"+i(parseFloat(r.order.fiat_amount).toFixed(2)),1)])]),r.order.seller_address?(s(),o("div",la,[t[104]||(t[104]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400 block mb-1"},"卖家地址",-1)),e("p",da,i(r.order.seller_address),1)])):u("",!0)])])])]),_:1},8,["modelValue","subtitle"]),e("div",ia,[e("div",na,[e("div",ua,[e("div",ca,[e("div",ma,[t[106]||(t[106]=e("h3",{class:"text-lg font-bold text-gray-900 dark:text-gray-100"},"交易详情",-1)),e("span",{class:v([We(r.order.escrow_status),"px-3 py-1 text-xs font-semibold rounded-full"])},i(Ae(r.order.escrow_status)),3)]),d.value.escrow_status==="escrow_released"&&r.currentUserId===d.value.client_id?(s(),o("div",xa,[d.value.has_review?(s(),o("div",ga,[...t[110]||(t[110]=[e("div",{class:"flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-emerald-600 dark:text-emerald-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})]),e("span",{class:"text-sm font-medium text-emerald-800 dark:text-emerald-200"},"您已评价此交易")],-1)])])):(s(),o("div",va,[t[109]||(t[109]=e("div",{class:"flex items-center justify-between"},[e("div",{class:"flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})]),e("span",{class:"text-sm font-medium text-amber-800 dark:text-amber-200"},"交易已完成，请评价")])],-1)),_(A,{onClick:t[11]||(t[11]=a=>b.value=!0),variant:"primary",size:"sm",fullWidth:"",class:"mt-2"},{icon:w(()=>[...t[107]||(t[107]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})],-1)])]),default:w(()=>[t[108]||(t[108]=g(" 立即评价商家 ",-1))]),_:1})]))])):u("",!0),e("div",ba,[e("div",ya,[t[111]||(t[111]=e("span",null,"交易进度",-1)),e("span",null,i(ve(r.order.escrow_status))+"%",1)]),e("div",fa,[e("div",{class:"bg-gradient-to-r from-emerald-500 to-emerald-600 h-2 rounded-full",style:pe(`width: ${ve(r.order.escrow_status)}%`)},null,4)])]),e("div",ka,[e("div",null,[e("div",pa,[t[113]||(t[113]=e("div",{class:"w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center"},[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)),e("div",wa,[t[112]||(t[112]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"订单创建",-1)),e("p",ha,i(r.order.created_at?P(r.order.created_at):"已完成"),1)])])]),e("div",null,[e("div",_a,[e("div",{class:v(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="order_initiated"?"bg-amber-500 animate-pulse":["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-gray-700"])},[["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(s(),o("svg",Ca,[...t[114]||(t[114]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),o("span",$a,"2"))],2),e("div",za,[e("p",{class:v(["text-sm font-medium",["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-400 dark:text-gray-500"])}," 商家确认 ",2),e("p",{class:v(["text-xs",["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-500 dark:text-gray-400":"text-gray-400 dark:text-gray-600"])},i(r.order.vendor_confirmed_at?P(r.order.vendor_confirmed_at):r.order.escrow_status==="order_initiated"?"等待中...":"待完成"),3)])]),r.order.escrow_status==="order_initiated"&&r.availableActions.includes("vendor_confirm")?(s(),o("div",Ma,[_(A,{onClick:t[12]||(t[12]=a=>V("vendor_confirm")),variant:"primary",size:"sm",fullWidth:""},{default:w(()=>[...t[115]||(t[115]=[g(" 确认接单 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",ja,[e("div",{class:v(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="vendor_confirmed"?"bg-amber-500 animate-pulse":["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-gray-700"])},[["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(s(),o("svg",Ba,[...t[116]||(t[116]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),o("span",Fa,"3"))],2),e("div",Sa,[e("p",{class:v(["text-sm font-medium",["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-400 dark:text-gray-500"])}," 卖家转币到托管 ",2),e("p",{class:v(["text-xs",["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-500 dark:text-gray-400":"text-gray-400 dark:text-gray-600"])},i(r.order.seller_paid_at?P(r.order.seller_paid_at):r.order.escrow_status==="vendor_confirmed"?"等待中...":"待完成"),3),r.order.escrow_tx_hash?(s(),o("p",Aa," TX: "+i(r.order.escrow_tx_hash),1)):u("",!0)])]),r.order.escrow_status==="vendor_confirmed"&&r.availableActions.includes("mark_seller_paid")?(s(),o("div",La,[_(A,{onClick:t[13]||(t[13]=a=>V("mark_seller_paid")),variant:"primary",size:"sm"},{default:w(()=>[...t[117]||(t[117]=[g(" 我已转币到托管 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",Va,[e("div",{class:v(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="seller_paid"?"bg-amber-500 animate-pulse":["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-gray-700"])},[["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(s(),o("svg",Ea,[...t[118]||(t[118]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),o("span",Ta,"4"))],2),e("div",Ia,[e("p",{class:v(["text-sm font-medium",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-400 dark:text-gray-500"])}," 托管确认到账 ",2),e("p",{class:v(["text-xs",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-500 dark:text-gray-400":"text-gray-400 dark:text-gray-600"])},i(r.order.escrow_received_at?P(r.order.escrow_received_at):r.order.escrow_status==="seller_paid"?"系统确认中...":"待完成"),3)])]),r.order.escrow_status==="seller_paid"?(s(),o("div",Ua,[e("div",Pa,[_(A,{onClick:t[14]||(t[14]=a=>be("received")),variant:"success",size:"sm",fullWidth:""},{default:w(()=>[...t[119]||(t[119]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),g(" 模拟已收到 ",-1)])]),_:1}),_(A,{onClick:t[15]||(t[15]=a=>be("not_received")),variant:"danger",size:"sm",fullWidth:""},{default:w(()=>[...t[120]||(t[120]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),g(" 模拟未收到 ",-1)])]),_:1})]),t[121]||(t[121]=e("p",{class:"text-xs text-amber-600 dark:text-amber-400 text-center"}," 🧪 测试模式：模拟区块链确认 ",-1))])):u("",!0)]),e("div",null,[e("div",Da,[e("div",{class:v(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="escrow_received"?"bg-amber-500 animate-pulse":["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-gray-700"])},[["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(s(),o("svg",Ra,[...t[122]||(t[122]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),o("span",qa,"5"))],2),e("div",Wa,[e("p",{class:v(["text-sm font-medium",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-400 dark:text-gray-500"])}," 买家确认托管到账 ",2),e("p",{class:v(["text-xs",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-500 dark:text-gray-400":"text-gray-400 dark:text-gray-600"])},i(r.order.buyer_confirmed_escrow_at?P(r.order.buyer_confirmed_escrow_at):r.order.escrow_status==="escrow_received"?"等待确认...":"待完成"),3)])]),r.order.escrow_status==="escrow_received"&&r.availableActions.includes("confirm_escrow")?(s(),o("div",Ha,[_(A,{onClick:t[16]||(t[16]=a=>V("confirm_escrow")),variant:"primary",size:"sm",fullWidth:""},{default:w(()=>[...t[123]||(t[123]=[g(" 确认托管到账 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",Oa,[e("div",{class:v(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="buyer_confirmed_escrow"?"bg-amber-500 animate-pulse":["buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-gray-700"])},[["buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?(s(),o("svg",Na,[...t[124]||(t[124]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),o("span",Ka,"6"))],2),e("div",Xa,[e("p",{class:v(["text-sm font-medium",["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-400 dark:text-gray-500"])}," 买家付款 ",2),e("p",Ja,i(r.order.buyer_paid_at?P(r.order.buyer_paid_at):r.order.escrow_status==="buyer_confirmed_escrow"?"等待中...":"待完成"),1)])]),r.order.escrow_status==="buyer_confirmed_escrow"&&r.availableActions.includes("mark_buyer_paid")?(s(),o("div",Ga,[_(A,{onClick:t[17]||(t[17]=a=>V("mark_buyer_paid")),variant:"primary",size:"sm",fullWidth:""},{default:w(()=>[...t[125]||(t[125]=[g(" 我已付款 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",Qa,[e("div",{class:v(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="buyer_paid"?"bg-amber-500 animate-pulse":["seller_received","escrow_released"].includes(r.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-gray-700"])},[["seller_received","escrow_released"].includes(r.order.escrow_status)?(s(),o("svg",Za,[...t[126]||(t[126]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),o("span",Ya,"7"))],2),e("div",eo,[e("p",{class:v(["text-sm font-medium",["buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-400 dark:text-gray-500"])}," 卖家确认收款 ",2),e("p",{class:v(["text-xs",["buyer_paid","seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-500 dark:text-gray-400":"text-gray-400 dark:text-gray-600"])},i(r.order.seller_received_at?P(r.order.seller_received_at):r.order.escrow_status==="buyer_paid"?"等待中...":"待完成"),3)])]),r.order.escrow_status==="buyer_paid"&&r.availableActions.includes("mark_seller_received")?(s(),o("div",to,[_(A,{onClick:t[18]||(t[18]=a=>V("mark_seller_received")),variant:"success",size:"sm",fullWidth:""},{default:w(()=>[...t[127]||(t[127]=[g(" 确认收款 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",ro,[e("div",{class:v(["w-8 h-8 rounded-full flex items-center justify-center",r.order.escrow_status==="seller_received"?"bg-amber-500 animate-pulse":r.order.escrow_status==="escrow_released"?"bg-emerald-500":"bg-gray-300 dark:bg-gray-700"])},[r.order.escrow_status==="escrow_released"?(s(),o("svg",so,[...t[128]||(t[128]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),o("span",ao,"8"))],2),e("div",oo,[e("p",{class:v(["text-sm font-medium",["seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-900 dark:text-gray-100":"text-gray-400 dark:text-gray-500"])}," 托管释放 ",2),e("p",{class:v(["text-xs",["seller_received","escrow_released"].includes(r.order.escrow_status)?"text-gray-500 dark:text-gray-400":"text-gray-400 dark:text-gray-600"])},i(r.order.escrow_released_at?P(r.order.escrow_released_at):r.order.escrow_status==="seller_received"?"处理中...":"待完成"),3)])])])]),e("div",lo,[e("div",io,[t[129]||(t[129]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"订单编号",-1)),e("span",no,"#"+i(r.order.order_no),1)]),e("div",uo,[t[130]||(t[130]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"商家",-1)),e("span",co,i(r.order.vendor?.name||"加载中..."),1)]),e("div",mo,[t[131]||(t[131]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"客户",-1)),e("span",xo,i(r.order.client?.name||"加载中..."),1)]),e("div",vo,[t[132]||(t[132]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"买家",-1)),e("span",go,i(r.order.buyer?.name||"加载中..."),1)]),e("div",bo,[t[133]||(t[133]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"卖家",-1)),e("span",yo,i(r.order.seller?.name||"加载中..."),1)]),e("div",fo,[t[134]||(t[134]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"数量（含交易费）",-1)),e("span",ko,i(parseFloat(r.order.crypto_amount).toFixed(4))+" "+i(r.order.currency_label||r.order.currency_key||r.order.crypto_currency),1)]),r.order.fee&&r.order.fee>0?(s(),o("div",po,[t[135]||(t[135]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"交易费（商家）",-1)),e("span",wo,i(parseFloat(r.order.fee).toFixed(8))+" "+i(r.order.currency_label||r.order.currency_key||r.order.crypto_currency),1)])):u("",!0),e("div",ho,[t[136]||(t[136]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"单价",-1)),e("span",_o,"¥"+i(parseFloat(r.order.price).toFixed(2)),1)]),e("div",Co,[t[137]||(t[137]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"总金额",-1)),e("span",$o,"¥"+i(parseFloat(r.order.fiat_amount).toFixed(2)),1)]),r.order.seller_address?(s(),o("div",zo,[t[138]||(t[138]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"卖家地址",-1)),e("span",Mo,i(r.order.seller_address),1)])):u("",!0)])])]),e("div",jo,[e("div",Bo,[e("div",Fo,[e("div",So,[e("div",Ao,[e("div",Lo,[e("div",Vo,[(s(!0),o(T,null,O(R.value,(a,h)=>(s(),o("a",{key:a.id,href:`/trader/profile/${a.id}`,target:"_blank",class:"relative hover:opacity-80 transition-opacity cursor-pointer",style:pe(`z-index: ${R.value.length-h}`)},[a.profile_photo_url?(s(),o("img",{key:0,src:a.profile_photo_url,alt:a.name,class:"h-10 w-10 rounded-full object-cover ring-2 ring-white dark:ring-gray-900"},null,8,To)):(s(),o("div",Io,[e("span",Uo,i(a.name?.[0]?.toUpperCase()||"U"),1)])),a.is_online?(s(),o("div",Po)):u("",!0)],12,Eo))),128))]),e("div",Do,[e("div",Ro,[e("p",qo,[g(" 订单 #"+i(r.order.order_no)+" 聊天室 ",1),e("span",Wo,"("+i(R.value.length)+"人)",1)])]),e("p",Ho,[(s(!0),o(T,null,O(R.value,(a,h)=>(s(),o("span",{key:a.id},[e("span",{class:v([a.is_online?"text-emerald-600 dark:text-emerald-400":"text-gray-400 dark:text-gray-500",a.is_admin?"font-medium":""])},i(a.name),3),h<R.value.length-1?(s(),o("span",Oo," · ")):u("",!0)]))),128))])])]),t[139]||(t[139]=e("div",{class:"flex items-center gap-2"},null,-1))])])]),e("div",{ref_key:"messageContainer",ref:E,class:"flex-1 overflow-y-auto p-6 space-y-4"},[e("div",No,[e("div",Ko,i(new Date(r.order.created_at).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})),1),t[140]||(t[140]=e("div",{class:"px-3 py-1 bg-gray-100 dark:bg-gray-800 rounded text-xs text-gray-500 dark:text-gray-400"}," 订单已创建，等待商家确认 ",-1))]),t[148]||(t[148]=e("div",{class:"mb-4 mx-4"},[e("div",{class:"bg-amber-50 dark:bg-amber-900/20 rounded p-3 border border-amber-200 dark:border-amber-800"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("div",{class:"text-xs"},[e("p",{class:"font-medium text-amber-700 dark:text-amber-300 mb-1"},"安全提醒"),e("p",{class:"text-amber-600 dark:text-amber-400"},"请勿相信任何平台外的交易邀请，谨防诈骗。任何平台以外的交流都无法作为争议材料。")])])])],-1)),r.order.ad_snapshot?.welcome_message?(s(),o("div",Xo,[e("div",Jo,[t[144]||(t[144]=e("div",{class:"flex items-center gap-2 mb-2"},[e("svg",{class:"w-4 h-4 text-blue-600 dark:text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 3a1 1 0 00-1.447-.894L8.763 6H5a3 3 0 000 6h.28l1.771 5.316A1 1 0 008 18h1a1 1 0 001-1v-4.382l6.553 3.276A1 1 0 0018 15V3z","clip-rule":"evenodd"})]),e("span",{class:"text-xs font-medium text-blue-700 dark:text-blue-300"},"商家公告")],-1)),e("p",Go,i(r.order.ad_snapshot.welcome_message),1),r.order.vendor?.response_time?(s(),o("div",Qo,[e("div",Zo,[t[143]||(t[143]=e("svg",{class:"w-3.5 h-3.5 text-blue-500 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",Yo,[t[141]||(t[141]=g(" 该商家的响应时间是 ",-1)),e("span",el,i(r.order.vendor.response_time)+" 分钟",1),t[142]||(t[142]=g("，请在该时间内等待商家加入聊天室。 ",-1))])])])):u("",!0)])])):u("",!0),r.order.vendor?.response_time&&!r.order.ad_snapshot?.welcome_message?(s(),o("div",tl,[e("div",rl,[e("div",sl,[t[147]||(t[147]=e("svg",{class:"w-3.5 h-3.5 text-blue-500 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",al,[t[145]||(t[145]=g(" 该商家的响应时间是 ",-1)),e("span",ol,i(r.order.vendor.response_time)+" 分钟",1),t[146]||(t[146]=g("，请在该时间内等待商家加入聊天室。 ",-1))])])])])):u("",!0),(s(!0),o(T,null,O(m.value,a=>(s(),o("div",{key:a.id,class:v(["flex",a.type==="system"?"justify-center":"gap-3",a.type!=="system"&&a.user?.id===l.$page.props.auth.user?.id?"justify-end":""])},[a.type==="system"?(s(),o("div",ll,[e("div",dl,i(P(a.created_at)),1),e("div",{class:v(["px-3 py-1 rounded text-xs max-w-md",a.is_temporary?"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400":"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400"])},[a.user?(s(),o("span",il,i(a.user.name),1)):u("",!0),g(" "+i(a.message||a.content),1)],2)])):a.user?.id!==l.$page.props.auth.user?.id?(s(),o(T,{key:1},[e("a",{href:`/trader/profile/${a.user.id}`,target:"_blank",class:"h-8 w-8 rounded-full flex-shrink-0 hover:opacity-80 transition-opacity cursor-pointer"},[a.user.profile_photo_url?(s(),o("img",{key:0,src:a.user.profile_photo_url,alt:a.user.name,class:"h-8 w-8 rounded-full object-cover border border-gray-200 dark:border-gray-700"},null,8,ul)):(s(),o("div",cl,[e("span",ml,i(a.user.name.charAt(0)),1)]))],8,nl),e("div",xl,[e("p",vl,[g(i(a.user.name)+" ",1),a.type==="admin"?(s(),o("span",gl,"(Admin)")):u("",!0)]),e("div",bl,[a.attachment?(s(),o("div",yl,[_(ke,{attachment:a.attachment,variant:"default","thumbnail-size":"md"},null,8,["attachment"])])):u("",!0),a.message?(s(),o("p",fl,i(a.message),1)):u("",!0)]),e("p",kl,i(P(a.created_at)),1)])],64)):(s(),o(T,{key:2},[e("div",pl,[e("p",wl,[g(i(a.user.name)+" ",1),a.type==="admin"?(s(),o("span",hl,"(Admin)")):u("",!0)]),e("div",_l,[a.attachment?(s(),o("div",Cl,[_(ke,{attachment:a.attachment,variant:"primary","thumbnail-size":"md"},null,8,["attachment"])])):u("",!0),a.message?(s(),o("p",$l,i(a.message),1)):u("",!0)]),e("p",zl,i(P(a.created_at)),1)]),l.$page.props.auth.user?.profile_photo_url?(s(),o("img",{key:0,src:l.$page.props.auth.user.profile_photo_url,alt:l.$page.props.auth.user.name,class:"h-8 w-8 rounded-full object-cover border border-gray-200 dark:border-gray-700 flex-shrink-0"},null,8,Ml)):(s(),o("div",jl,[e("span",Bl,i(l.$page.props.auth.user?.name?.charAt(0).toUpperCase()||"U"),1)]))],64))],2))),128))],512),e("div",Fl,[j.value||S.value?(s(),o("div",Sl,[S.value?(s(),o("div",Al,[...t[149]||(t[149]=[e("div",{class:"animate-spin h-8 w-8 border-4 border-blue-600 border-t-transparent rounded-full"},null,-1),e("div",null,[e("p",{class:"text-sm font-medium text-gray-900 dark:text-gray-200"},"正在压缩图片..."),e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"优化图片大小以快速上传")],-1)])])):j.value?(s(),o("div",Ll,[j.value.type.startsWith("image/")?(s(),o("img",{key:0,src:D.value,alt:j.value.name,class:"max-h-32 rounded"},null,8,Vl)):j.value.type==="application/pdf"?(s(),o("div",El,[...t[150]||(t[150]=[e("svg",{class:"w-8 h-8 text-red-600 dark:text-red-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-5L9 2H4z","clip-rule":"evenodd"})],-1)])])):u("",!0),e("div",Tl,[e("p",Il,i(j.value.name),1),e("p",Ul,i(Ee(j.value.size)),1)]),e("button",{onClick:Ce,type:"button",class:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"},[...t[151]||(t[151]=[e("svg",{class:"w-4 h-4 text-gray-500 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):u("",!0)])):u("",!0),e("form",{onSubmit:J(Ie,["prevent"]),class:"flex gap-2"},[e("input",{ref_key:"fileInput",ref:N,type:"file",onChange:Te,accept:".pdf,image/*","data-max-size":"2097152",class:"hidden"},null,544),e("button",{type:"button",onClick:t[19]||(t[19]=a=>!G.value&&!S.value&&l.$refs.fileInput.click()),disabled:G.value||S.value,class:"p-2 rounded text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent"},[...t[152]||(t[152]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)])],8,Pl),_(Re,{onSelect:t[20]||(t[20]=a=>$.value+=a),disabled:G.value,placement:"top"},null,8,["disabled"]),X(e("input",{"onUpdate:modelValue":t[21]||(t[21]=a=>$.value=a),type:"text",placeholder:G.value?"交易已结束，无法发送消息":"输入消息...",class:"flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-800 border-0 rounded text-base md:text-sm text-gray-900 dark:text-gray-200 placeholder-gray-500 dark:placeholder-gray-400 focus:bg-white dark:focus:bg-gray-700 focus:ring-2 focus:ring-emerald-500 focus:outline-none disabled:opacity-50 transition-colors",disabled:!p.value||G.value},null,8,Dl),[[le,$.value]]),e("button",{type:"submit",disabled:!$.value.trim()&&!j.value||!p.value||C.value||G.value,class:"px-4 py-2 bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded font-medium text-sm transition-colors flex items-center gap-2"},[C.value?(s(),o("svg",ql,[...t[153]||(t[153]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(s(),o("span",Wl,"发送"))],8,Rl)],32),r.availableActions.length>0&&r.order.status!=="completed"&&r.order.status!=="cancelled"&&r.order.escrow_status!=="escrow_released"||r.order.status!=="cancelled"&&r.order.status!=="completed"?(s(),o("div",Hl,[e("div",Ol,[(s(!0),o(T,null,O(r.availableActions,a=>(s(),o(T,{key:a},[a==="vendor_confirm"?(s(),o("button",{key:0,onClick:t[22]||(t[22]=h=>V("vendor_confirm")),class:"px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-medium rounded transition-colors cursor-pointer"}," 确认订单 ")):u("",!0),a==="mark_seller_paid"?(s(),o("button",{key:1,onClick:t[23]||(t[23]=h=>V("mark_seller_paid")),class:"px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-medium rounded transition-colors cursor-pointer"}," 我已转币 ")):u("",!0),a==="confirm_escrow"?(s(),o("button",{key:2,onClick:t[24]||(t[24]=h=>V("confirm_escrow")),class:"px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-medium rounded transition-colors cursor-pointer"}," 确认托管 ")):u("",!0),a==="mark_buyer_paid"?(s(),o("button",{key:3,onClick:t[25]||(t[25]=h=>V("mark_buyer_paid")),class:"px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-medium rounded transition-colors cursor-pointer"}," 我已付款 ")):u("",!0),a==="mark_seller_received"?(s(),o("button",{key:4,onClick:t[26]||(t[26]=h=>V("mark_seller_received")),class:"px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-xs font-medium rounded transition-colors cursor-pointer"}," 确认收款 ")):u("",!0),a==="cancel"?(s(),o("button",{key:5,onClick:t[27]||(t[27]=h=>V("cancel")),class:"px-3 py-1.5 bg-gray-600 hover:bg-gray-700 text-white text-xs font-medium rounded transition-colors cursor-pointer"}," 取消订单 ")):u("",!0)],64))),128)),r.availableActions.includes("create_dispute")?(s(),o("button",{key:0,onClick:t[28]||(t[28]=a=>V("create_dispute")),class:"px-3 py-1.5 bg-amber-600 hover:bg-amber-700 text-white text-xs font-medium rounded transition-colors cursor-pointer"}," 发起争议 ")):u("",!0),r.availableActions.includes("resolve_dispute")?(s(),o("button",{key:1,onClick:t[29]||(t[29]=a=>V("resolve_dispute")),class:"px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-xs font-medium rounded transition-colors cursor-pointer"}," 解除争议 ")):u("",!0)]),r.order.status!=="cancelled"&&r.order.status!=="completed"?(s(),o("a",{key:0,href:"/notifications/settings",target:"_blank",class:v(["inline-flex items-center gap-1 px-3 py-1 text-xs rounded transition-colors cursor-pointer",l.$page.props.auth.user?.telegram_chat_id?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 hover:bg-emerald-200 dark:hover:bg-emerald-900/50":"bg-blue-500 hover:bg-blue-600 text-white"])},[l.$page.props.auth.user?.telegram_chat_id?(s(),o("svg",Nl,[...t[154]||(t[154]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),o("svg",Kl,[...t[155]||(t[155]=[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.56c-.21 2.27-1.13 7.75-1.6 10.29-.2 1.08-.59 1.44-.97 1.47-.82.07-1.45-.54-2.24-.99-1.24-.71-1.94-1.16-3.14-1.85-1.39-.8-.49-1.24.3-1.96.21-.19 3.85-3.52 3.91-3.82.01-.04.01-.19-.07-.27-.08-.08-.2-.05-.28-.03-.12.03-2.02.13-5.7 3.75-.54.54-1.03.8-1.48.78-.49-.02-1.42-.27-2.11-.5-.85-.28-1.53-.42-1.47-.89.03-.25.37-.51 1.02-.77 4-1.74 6.67-2.89 8.01-3.44 3.81-1.57 4.61-1.84 5.13-1.85.11 0 .37.03.53.18.14.12.18.28.2.45-.01.06-.01.24-.02.38z"},null,-1)])])),g(" "+i(l.$page.props.auth.user?.telegram_chat_id?"已开启通知":"设置实时通知"),1)],2)):u("",!0)])):u("",!0),e("div",Xl,[e("div",Jl,[e("div",Gl,[e("div",{class:v([Ve(r.order.escrow_status),"w-2 h-2 rounded-full animate-pulse"])},null,2),e("span",Ql,i(Le(r.order.escrow_status)),1)]),e("div",Zl,[e("span",null,"订单 #"+i(r.order.trade_id),1),e("span",null,i(r.order.crypto_amount)+" "+i(r.order.currency_label||r.order.currency_key),1),e("span",Yl,"¥"+i(r.order.fiat_amount),1)])])])])]),e("div",ed,[r.order.ad_snapshot?.vendor_toc?(s(),o("div",td,[t[156]||(t[156]=e("div",{class:"flex items-center gap-2 mb-3"},[e("svg",{class:"w-5 h-5 text-purple-600 dark:text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),e("h3",{class:"text-sm font-bold text-gray-900 dark:text-gray-100"},"交易条款")],-1)),e("div",rd,[e("p",sd,i(r.order.ad_snapshot?.vendor_toc||"无交易条款"),1)]),t[157]||(t[157]=e("div",{class:"mt-3 p-2 bg-amber-50 dark:bg-amber-900/20 rounded border border-amber-200 dark:border-amber-800"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("p",{class:"text-xs text-amber-700 dark:text-amber-300"}," 请仔细阅读并遵守以上交易条款，违反条款可能导致交易取消 ")])],-1))])):u("",!0)])])]),e("div",ad,[d.value.escrow_status==="escrow_released"&&r.currentUserId===d.value.client_id&&!d.value.has_review?(s(),o("div",od,[e("div",ld,[t[159]||(t[159]=e("div",{class:"flex items-center gap-2 flex-1"},[e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})]),e("div",null,[e("p",{class:"text-sm font-medium text-amber-800 dark:text-amber-200"},"交易已完成"),e("p",{class:"text-xs text-amber-700 dark:text-amber-300"},"请对商家进行评价")])],-1)),_(A,{onClick:t[30]||(t[30]=a=>b.value=!0),variant:"primary",size:"sm"},{default:w(()=>[...t[158]||(t[158]=[g(" 立即评价 ",-1)])]),_:1})])])):u("",!0),e("div",{ref_key:"mobileMessageContainer",ref:F,class:"flex-1 overflow-y-auto overscroll-contain bg-white dark:bg-gray-950"},[!p.value&&k.value?(s(),o("div",dd,[...t[160]||(t[160]=[e("div",{class:"flex items-center justify-center gap-2"},[e("svg",{class:"animate-spin h-4 w-4 text-amber-600 dark:text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),e("span",{class:"text-xs text-amber-700 dark:text-amber-300"},"重新连接中...")],-1)])])):u("",!0),e("div",id,[e("div",nd,[e("div",ud,i(new Date(r.order.created_at).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})),1),t[161]||(t[161]=e("div",{class:"px-3 py-1 bg-gray-100 dark:bg-gray-800 rounded text-xs text-gray-500 dark:text-gray-400"}," 订单已创建，等待商家确认 ",-1))]),t[169]||(t[169]=e("div",{class:"mb-4 mx-4"},[e("div",{class:"bg-amber-50 dark:bg-amber-900/20 rounded p-3 border border-amber-200 dark:border-amber-800"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("div",{class:"text-xs"},[e("p",{class:"font-medium text-amber-700 dark:text-amber-300 mb-1"},"安全提醒"),e("p",{class:"text-amber-600 dark:text-amber-400"},"请勿相信任何平台外的交易邀请，谨防诈骗。任何平台以外的交流都无法作为争议材料。")])])])],-1)),r.order.ad_snapshot?.welcome_message?(s(),o("div",cd,[e("div",md,[t[165]||(t[165]=e("div",{class:"flex items-center gap-2 mb-2"},[e("svg",{class:"w-4 h-4 text-blue-600 dark:text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 3a1 1 0 00-1.447-.894L8.763 6H5a3 3 0 000 6h.28l1.771 5.316A1 1 0 008 18h1a1 1 0 001-1v-4.382l6.553 3.276A1 1 0 0018 15V3z","clip-rule":"evenodd"})]),e("span",{class:"text-xs font-medium text-blue-700 dark:text-blue-300"},"商家公告")],-1)),e("p",xd,i(r.order.ad_snapshot.welcome_message),1),r.order.vendor?.response_time?(s(),o("div",vd,[e("div",gd,[t[164]||(t[164]=e("svg",{class:"w-3.5 h-3.5 text-blue-500 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",bd,[t[162]||(t[162]=g(" 该商家的响应时间是 ",-1)),e("span",yd,i(r.order.vendor.response_time)+" 分钟",1),t[163]||(t[163]=g("，请在该时间内等待商家加入聊天室。 ",-1))])])])):u("",!0)])])):u("",!0),r.order.vendor?.response_time&&!r.order.ad_snapshot?.welcome_message?(s(),o("div",fd,[e("div",kd,[e("div",pd,[t[168]||(t[168]=e("svg",{class:"w-3.5 h-3.5 text-blue-500 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",wd,[t[166]||(t[166]=g(" 该商家的响应时间是 ",-1)),e("span",hd,i(r.order.vendor.response_time)+" 分钟",1),t[167]||(t[167]=g("，请在该时间内等待商家加入聊天室。 ",-1))])])])])):u("",!0),(s(!0),o(T,null,O(m.value,a=>(s(),o("div",{key:a.id,class:v(["flex",a.type==="system"?"justify-center":"gap-2",a.type!=="system"&&a.user?.id===l.$page.props.auth.user?.id?"justify-end":""])},[a.type==="system"?(s(),o("div",_d,[e("div",Cd,i(P(a.created_at)),1),e("div",{class:v(["px-3 py-1 rounded text-xs",a.is_temporary?"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400":"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400"])},[a.user?(s(),o("span",$d,i(a.user.name),1)):u("",!0),g(" "+i(a.message||a.content),1)],2)])):a.user?.id!==l.$page.props.auth.user?.id?(s(),o(T,{key:1},[e("a",{href:`/trader/profile/${a.user.id}`,target:"_blank",class:"h-7 w-7 rounded-full flex-shrink-0 hover:opacity-80 transition-opacity cursor-pointer"},[a.user.profile_photo_url?(s(),o("img",{key:0,src:a.user.profile_photo_url,alt:a.user.name,class:"h-7 w-7 rounded-full object-cover border border-gray-200 dark:border-gray-700"},null,8,Md)):(s(),o("div",jd,[e("span",Bd,i(a.user.name.charAt(0)),1)]))],8,zd),e("div",Fd,[e("p",Sd,[g(i(a.user.name)+" ",1),a.type==="admin"?(s(),o("span",Ad,"(Admin)")):u("",!0)]),e("div",Ld,[a.attachment?(s(),o("div",Vd,[_(ke,{attachment:a.attachment,variant:"default","thumbnail-size":"sm"},null,8,["attachment"])])):u("",!0),a.message?(s(),o("p",Ed,i(a.message),1)):u("",!0)]),e("p",Td,i(P(a.created_at)),1)])],64)):(s(),o(T,{key:2},[e("div",Id,[e("p",Ud,[g(i(a.user.name)+" ",1),a.type==="admin"?(s(),o("span",Pd,"(Admin)")):u("",!0)]),e("div",Dd,[a.attachment?(s(),o("div",Rd,[_(ke,{attachment:a.attachment,variant:"primary","thumbnail-size":"sm"},null,8,["attachment"])])):u("",!0),a.message?(s(),o("p",qd,i(a.message),1)):u("",!0)]),e("p",Wd,i(P(a.created_at)),1)]),l.$page.props.auth.user?.profile_photo_url?(s(),o("img",{key:0,src:l.$page.props.auth.user.profile_photo_url,alt:l.$page.props.auth.user.name,class:"h-7 w-7 rounded-full object-cover border border-gray-200 dark:border-gray-700 flex-shrink-0"},null,8,Hd)):(s(),o("div",Od,[e("span",Nd,i(l.$page.props.auth.user?.name?.charAt(0).toUpperCase()||"U"),1)]))],64))],2))),128))])],512),e("div",Kd,[e("div",Xd,[j.value||S.value?(s(),o("div",Jd,[S.value?(s(),o("div",Gd,[...t[170]||(t[170]=[e("div",{class:"flex-shrink-0"},[e("div",{class:"animate-spin h-12 w-12 border-4 border-blue-600 border-t-transparent rounded-full"})],-1),e("div",{class:"flex-1 min-w-0"},[e("p",{class:"text-sm font-medium text-gray-900 dark:text-gray-200"},"正在压缩图片..."),e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"优化中")],-1)])])):j.value?(s(),o("div",Qd,[e("div",Zd,[D.value&&j.value.type.startsWith("image/")?(s(),o("img",{key:0,src:D.value,class:"w-12 h-12 object-cover rounded border",alt:"预览"},null,8,Yd)):(s(),o("div",ei,[...t[171]||(t[171]=[e("svg",{class:"w-6 h-6 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-5L9 2H4z","clip-rule":"evenodd"})],-1)])]))]),e("div",ti,[e("p",ri,i(j.value.name),1),e("p",si,i(Ee(j.value.size)),1)]),e("button",{onClick:Ce,type:"button",class:"flex-shrink-0 p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors"},[...t[172]||(t[172]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):u("",!0)])):u("",!0),e("form",{onSubmit:J(Ie,["prevent"]),class:"flex items-center gap-1"},[e("input",{ref_key:"mobileFileInput",ref:f,type:"file",onChange:Te,accept:".pdf,image/*","data-max-size":"2097152",class:"hidden"},null,544),e("div",ai,[e("button",{type:"button",onClick:t[31]||(t[31]=a=>!G.value&&!S.value&&l.$refs.mobileFileInput.click()),disabled:G.value||S.value,class:"p-2 rounded text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[...t[173]||(t[173]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)])],8,oi),_(Re,{onSelect:t[32]||(t[32]=a=>$.value+=a),disabled:G.value,placement:"top"},null,8,["disabled"])]),X(e("input",{"onUpdate:modelValue":t[33]||(t[33]=a=>$.value=a),type:"text",placeholder:G.value?"交易已结束":"输入消息...",class:"flex-1 px-3 py-2 bg-gray-100 dark:bg-gray-800 border-0 rounded text-sm text-gray-900 dark:text-gray-200 placeholder-gray-500 dark:placeholder-gray-400 focus:bg-white dark:focus:bg-gray-700 focus:ring-2 focus:ring-emerald-500 focus:outline-none disabled:opacity-50 transition-colors",disabled:!p.value||G.value},null,8,li),[[le,$.value]]),e("button",{type:"submit",disabled:!$.value.trim()&&!j.value||!p.value||C.value||G.value,class:"px-3 py-2 bg-emerald-600 disabled:bg-gray-400 text-white rounded font-medium text-sm transition-colors"},[C.value?(s(),o("svg",ii,[...t[174]||(t[174]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(s(),o("span",ni,"发送"))],8,di)],32),r.availableActions.length>0&&r.order.status!=="completed"&&r.order.status!=="cancelled"&&r.order.escrow_status!=="escrow_released"||r.order.status!=="cancelled"&&r.order.status!=="completed"?(s(),o("div",ui,[e("div",ci,[(s(!0),o(T,null,O(r.availableActions,a=>(s(),o(T,{key:a},[a==="vendor_confirm"?(s(),o("button",{key:0,onClick:t[34]||(t[34]=h=>V("vendor_confirm")),class:"px-3 py-1.5 bg-emerald-600 text-white text-xs font-medium rounded whitespace-nowrap cursor-pointer"}," 确认订单 ")):u("",!0),a==="mark_seller_paid"?(s(),o("button",{key:1,onClick:t[35]||(t[35]=h=>V("mark_seller_paid")),class:"px-3 py-1.5 bg-emerald-600 text-white text-xs font-medium rounded whitespace-nowrap cursor-pointer"}," 我已转币 ")):u("",!0),a==="confirm_escrow"?(s(),o("button",{key:2,onClick:t[36]||(t[36]=h=>V("confirm_escrow")),class:"px-3 py-1.5 bg-emerald-600 text-white text-xs font-medium rounded whitespace-nowrap cursor-pointer"}," 确认托管 ")):u("",!0),a==="mark_buyer_paid"?(s(),o("button",{key:3,onClick:t[37]||(t[37]=h=>V("mark_buyer_paid")),class:"px-3 py-1.5 bg-emerald-600 text-white text-xs font-medium rounded whitespace-nowrap cursor-pointer"}," 我已付款 ")):u("",!0),a==="mark_seller_received"?(s(),o("button",{key:4,onClick:t[38]||(t[38]=h=>V("mark_seller_received")),class:"px-3 py-1.5 bg-green-600 text-white text-xs font-medium rounded whitespace-nowrap cursor-pointer"}," 确认收款 ")):u("",!0),a==="cancel"?(s(),o("button",{key:5,onClick:t[39]||(t[39]=h=>V("cancel")),class:"px-3 py-1.5 bg-gray-600 text-white text-xs font-medium rounded whitespace-nowrap cursor-pointer"}," 取消订单 ")):u("",!0)],64))),128)),r.availableActions.includes("create_dispute")?(s(),o("button",{key:0,onClick:t[40]||(t[40]=a=>V("create_dispute")),class:"px-3 py-1.5 bg-amber-600 text-white text-xs font-medium rounded whitespace-nowrap cursor-pointer"}," 发起争议 ")):u("",!0),r.availableActions.includes("resolve_dispute")?(s(),o("button",{key:1,onClick:t[41]||(t[41]=a=>V("resolve_dispute")),class:"px-3 py-1.5 bg-green-600 text-white text-xs font-medium rounded whitespace-nowrap cursor-pointer"}," 解除争议 ")):u("",!0)]),r.order.status!=="cancelled"&&r.order.status!=="completed"?(s(),o("a",{key:0,href:"/notifications/settings",target:"_blank",class:v(["px-3 py-1.5 rounded inline-flex items-center justify-center cursor-pointer",l.$page.props.auth.user?.telegram_chat_id?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"bg-blue-500 text-white"]),title:l.$page.props.auth.user?.telegram_chat_id?"Telegram 通知已开启":"设置 Telegram 通知"},[...t[175]||(t[175]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.56c-.21 2.27-1.13 7.75-1.6 10.29-.2 1.08-.59 1.44-.97 1.47-.82.07-1.45-.54-2.24-.99-1.24-.71-1.94-1.16-3.14-1.85-1.39-.8-.49-1.24.3-1.96.21-.19 3.85-3.52 3.91-3.82.01-.04.01-.19-.07-.27-.08-.08-.2-.05-.28-.03-.12.03-2.02.13-5.7 3.75-.54.54-1.03.8-1.48.78-.49-.02-1.42-.27-2.11-.5-.85-.28-1.53-.42-1.47-.89.03-.25.37-.51 1.02-.77 4-1.74 6.67-2.89 8.01-3.44 3.81-1.57 4.61-1.84 5.13-1.85.11 0 .37.03.53.18.14.12.18.28.2.45-.01.06-.01.24-.02.38z"})],-1)])],10,mi)):u("",!0)])):u("",!0),e("div",{onClick:t[42]||(t[42]=a=>y.value=!0),class:"mt-2 p-2 bg-gray-50 dark:bg-gray-800/50 rounded border border-gray-200 dark:border-gray-700 cursor-pointer active:bg-gray-100 dark:active:bg-gray-800 transition-colors"},[e("div",xi,[e("div",vi,[e("div",{class:v([Ve(r.order.escrow_status),"w-2 h-2 rounded-full animate-pulse"])},null,2),e("span",gi,i(Le(r.order.escrow_status)),1)]),e("div",bi,[e("span",yi,i(r.order.crypto_amount)+" "+i(r.order.currency_label||r.order.currency_key),1),t[176]||(t[176]=e("svg",{class:"w-4 h-4 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))])])])])])])])]),_(st,{show:n.value.show&&n.value.pendingAction!=="confirm_escrow"&&n.value.pendingAction!=="mark_buyer_paid"&&n.value.pendingAction!=="mark_seller_received"&&n.value.pendingAction!=="mark_seller_paid",title:n.value.title,"confirm-text":n.value.confirmText,"cancel-text":n.value.cancelText,onConfirm:t[44]||(t[44]=()=>Ke(n.value.inputValue)),onClose:Y},{default:w(()=>[n.value.message?(s(),o("div",fi,i(n.value.message),1)):u("",!0),n.value.inputMode?(s(),o("div",ki,[n.value.inputLabel?(s(),o("label",pi,i(n.value.inputLabel),1)):u("",!0),X(e("input",{"onUpdate:modelValue":t[43]||(t[43]=a=>n.value.inputValue=a),type:"text",placeholder:n.value.inputPlaceholder,required:n.value.inputRequired,class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"},null,8,wi),[[le,n.value.inputValue]])])):u("",!0)]),_:1},8,["show","title","confirm-text","cancel-text"]),_(ue,{show:n.value.pendingAction==="confirm_escrow"&&n.value.show,"max-width":"lg",closeable:!0,onClose:Y},{default:w(()=>[e("div",hi,[t[191]||(t[191]=e("div",{class:"mx-auto flex items-center justify-center size-10 rounded-full bg-amber-100 dark:bg-amber-900/30"},[e("svg",{class:"size-5 text-amber-600 dark:text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",_i,[t[190]||(t[190]=e("h3",{class:"text-base font-medium text-gray-900 dark:text-gray-100"}," 确认托管到账 ",-1)),e("div",Ci,[e("div",$i,[e("div",zi,[d.value.seller_address?(s(),o("div",Mi,[t[177]||(t[177]=e("label",{class:"text-xs text-gray-500 dark:text-gray-400"},"来源地址（卖家）",-1)),e("p",ji,i(d.value.seller_address),1)])):u("",!0),d.value.escrow_address?(s(),o("div",Bi,[t[178]||(t[178]=e("label",{class:"text-xs text-gray-500 dark:text-gray-400"},"托管地址",-1)),e("p",Fi,i(d.value.escrow_address),1)])):u("",!0),e("div",null,[t[179]||(t[179]=e("label",{class:"text-xs text-gray-500 dark:text-gray-400"},"交易金额",-1)),e("p",Si,i(parseFloat(d.value.crypto_amount).toFixed(4))+" "+i(d.value.currency_label||d.value.currency_key||d.value.crypto_currency),1)]),d.value.escrow_tx_hash?(s(),o("div",Ai,[t[180]||(t[180]=e("label",{class:"text-xs text-gray-500 dark:text-gray-400"},"交易哈希",-1)),e("p",Li,i(d.value.escrow_tx_hash),1)])):u("",!0)])]),t[188]||(t[188]=e("div",{class:"p-2.5 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-medium text-amber-800 dark:text-amber-300"},"请打开区块链浏览器仔细核对"),e("p",{class:"text-amber-700 dark:text-amber-400 mt-0.5"}," 确认前必须逐项检查以下所有信息 ")])])],-1)),e("div",Vi,[t[187]||(t[187]=e("p",{class:"text-xs font-medium text-gray-700 dark:text-gray-300"},"请确认以下所有项目：",-1)),e("div",Ei,[e("div",Ti,[X(e("input",{"onUpdate:modelValue":t[45]||(t[45]=a=>q.value.txExists=a),type:"checkbox",class:"mt-0.5 h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded",disabled:n.value.loading},null,8,Ii),[[oe,q.value.txExists]]),t[181]||(t[181]=e("label",{class:"ml-2 text-xs text-gray-700 dark:text-gray-300"}," 我已打开区块链浏览器，确认交易记录存在 ",-1))]),e("div",Ui,[X(e("input",{"onUpdate:modelValue":t[46]||(t[46]=a=>q.value.confirmations=a),type:"checkbox",class:"mt-0.5 h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded",disabled:n.value.loading},null,8,Pi),[[oe,q.value.confirmations]]),t[182]||(t[182]=e("label",{class:"ml-2 text-xs text-gray-700 dark:text-gray-300"}," 交易已有足够的确认数（建议至少6个确认） ",-1))]),e("div",Di,[X(e("input",{"onUpdate:modelValue":t[47]||(t[47]=a=>q.value.fromAddress=a),type:"checkbox",class:"mt-0.5 h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded",disabled:n.value.loading},null,8,Ri),[[oe,q.value.fromAddress]]),e("label",qi,[t[183]||(t[183]=g(" 来源地址与卖家地址完全一致 ",-1)),e("span",Wi,i(d.value.seller_address||"无卖家地址"),1)])]),e("div",Hi,[X(e("input",{"onUpdate:modelValue":t[48]||(t[48]=a=>q.value.toAddress=a),type:"checkbox",class:"mt-0.5 h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded",disabled:n.value.loading},null,8,Oi),[[oe,q.value.toAddress]]),e("label",Ni,[t[184]||(t[184]=g(" 目标地址与托管地址完全一致 ",-1)),e("span",Ki,i(d.value.escrow_address||"托管地址待分配"),1)])]),e("div",Xi,[X(e("input",{"onUpdate:modelValue":t[49]||(t[49]=a=>q.value.amount=a),type:"checkbox",class:"mt-0.5 h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded",disabled:n.value.loading},null,8,Ji),[[oe,q.value.amount]]),e("label",Gi,[t[185]||(t[185]=g(" 交易金额为 ",-1)),e("span",Qi,i(parseFloat(d.value.crypto_amount).toFixed(4))+" "+i(d.value.currency_label||d.value.currency_key||d.value.crypto_currency),1),t[186]||(t[186]=g("，完全正确 ",-1))])])])]),t[189]||(t[189]=e("div",{class:"p-2.5 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-bold text-red-800 dark:text-red-300"},"最终确认"),e("p",{class:"text-red-700 dark:text-red-400 mt-0.5"}," 确认后您将进入付款阶段，必须按时完成付款。如信息有误导致的损失，责任自负！ ")])])],-1))])])]),e("div",Zi,[_(A,{variant:"ghost",onClick:Y,disabled:n.value.loading},{default:w(()=>[...t[192]||(t[192]=[g(" 返回检查 ",-1)])]),_:1},8,["disabled"]),_(A,{variant:"warning",loading:n.value.loading,disabled:!Se.value,onClick:Je},{default:w(()=>[...t[193]||(t[193]=[g(" 确认托管到账 ",-1)])]),_:1},8,["loading","disabled"])])]),_:1},8,["show"]),_(ue,{show:n.value.pendingAction==="mark_seller_paid"&&n.value.show,"max-width":"lg",closeable:!0,onClose:Y},{default:w(()=>[e("div",Yi,[t[203]||(t[203]=e("div",{class:"mx-auto flex items-center justify-center size-10 rounded-full bg-blue-100 dark:bg-blue-900/30"},[e("svg",{class:"size-5 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})])],-1)),e("div",e0,[t[202]||(t[202]=e("h3",{class:"text-base font-medium text-gray-900 dark:text-gray-100"}," 标记已转币到托管 ",-1)),e("div",t0,[d.value.seller_address?(s(),o("div",r0,[e("div",s0,[e("div",null,[t[194]||(t[194]=e("label",{class:"text-xs text-gray-500 dark:text-gray-400"},"您的地址",-1)),e("p",a0,i(d.value.seller_address),1)]),e("div",null,[t[195]||(t[195]=e("label",{class:"text-xs text-gray-500 dark:text-gray-400"},"转币金额",-1)),e("p",o0,i(parseFloat(d.value.crypto_amount).toFixed(4))+" "+i(d.value.currency_label||d.value.currency_key||d.value.crypto_currency),1)])])])):u("",!0),t[200]||(t[200]=e("div",{class:"p-2.5 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-medium text-blue-800 dark:text-blue-300"},"托管地址提示"),e("p",{class:"text-blue-700 dark:text-blue-400 mt-0.5"}," 托管地址功能正在开发中，请先将币转到您自己的地址保管 ")])])],-1)),t[201]||(t[201]=e("div",{class:"p-2.5 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-bold text-red-800 dark:text-red-300 text-sm"},"极其重要！请仔细核对！"),e("ul",{class:"mt-1 space-y-0.5 text-red-700 dark:text-red-400"},[e("li",{class:"text-xs"},"• 请确保转币地址完全正确"),e("li",{class:"text-xs"},[g("• "),e("span",{class:"font-bold"},"请一定要确保金额是一次性从您的地址转入，否则系统无法确认")]),e("li",{class:"text-xs"},"• 请确保转币金额准确无误"),e("li",{class:"text-xs"},[g("• "),e("span",{class:"font-bold"},"如果地址或金额错误，托管将无法确认！")]),e("li",{class:"text-xs"},[g("• "),e("span",{class:"font-bold text-red-800 dark:text-red-200"},"任何损失概不负责！")])])])])],-1)),e("div",null,[t[196]||(t[196]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[g(" 交易哈希 (TX ID) "),e("span",{class:"text-red-500"},"*")],-1)),X(e("input",{"onUpdate:modelValue":t[50]||(t[50]=a=>Z.value=a),type:"text",placeholder:"请输入区块链交易哈希...",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:n.value.loading},null,8,l0),[[le,Z.value]]),t[197]||(t[197]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 转币后请提供交易哈希作为凭证 ",-1))]),e("div",d0,[X(e("input",{"onUpdate:modelValue":t[51]||(t[51]=a=>de.value=a),type:"checkbox",class:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",disabled:n.value.loading},null,8,i0),[[oe,de.value]]),e("label",n0,[t[198]||(t[198]=g(" 我已仔细核对金额，确认已准备好 ",-1)),e("span",u0,i(parseFloat(d.value.crypto_amount).toFixed(4))+" "+i(d.value.currency_label||d.value.currency_key||d.value.crypto_currency),1),t[199]||(t[199]=g(" 用于交易 ",-1))])])])])]),e("div",c0,[_(A,{variant:"ghost",onClick:Y,disabled:n.value.loading},{default:w(()=>[...t[204]||(t[204]=[g(" 返回 ",-1)])]),_:1},8,["disabled"]),_(A,{variant:"primary",loading:n.value.loading,disabled:!Z.value||!Z.value.trim()||!de.value,onClick:Ge},{default:w(()=>[...t[205]||(t[205]=[g(" 确认已转币 ",-1)])]),_:1},8,["loading","disabled"])])]),_:1},8,["show"]),_(ue,{show:n.value.pendingAction==="mark_buyer_paid"&&n.value.show,"max-width":"md",closeable:!0,onClose:Y},{default:w(()=>[e("div",m0,[t[211]||(t[211]=e("div",{class:"mx-auto flex items-center justify-center size-12 rounded-full bg-emerald-100 dark:bg-emerald-900/30"},[e("svg",{class:"size-6 text-emerald-600 dark:text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",x0,[t[210]||(t[210]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-gray-100"}," 标记已付款 ",-1)),e("div",v0,[e("p",g0,[t[206]||(t[206]=g(" 请确认您已向卖家付款 ",-1)),e("span",b0,"¥"+i(parseFloat(r.order.fiat_amount).toFixed(2)),1)]),e("div",null,[t[207]||(t[207]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 付款说明（可选） ",-1)),X(e("textarea",{"onUpdate:modelValue":t[52]||(t[52]=a=>ae.value=a),rows:"3",class:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors",placeholder:"请输入付款凭证或说明，如转账单号..."},null,512),[[le,ae.value]])]),r.userHas2FA?(s(),o("div",y0,[_(De,{modelValue:n.value.twoFactorCode,"onUpdate:modelValue":t[53]||(t[53]=a=>n.value.twoFactorCode=a),error:n.value.twoFactorError,disabled:n.value.loading,onComplete:Ue},null,8,["modelValue","error","disabled"])])):(s(),o("div",f0,[...t[208]||(t[208]=[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-sm"},[e("p",{class:"font-medium text-amber-800 dark:text-amber-300"},"需要双重验证"),e("p",{class:"text-amber-700 dark:text-amber-400 mt-0.5"},"为保护您的资金安全，买家付款必须启用双重验证")])],-1)])])),r.userHas2FA?(s(),o("div",k0,[...t[209]||(t[209]=[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})]),e("div",{class:"text-sm"},[e("p",{class:"font-medium text-red-800 dark:text-red-300"},"注意事项"),e("p",{class:"text-red-700 dark:text-red-400 mt-0.5"},"请确保已完成付款再点击确认，虚假付款将导致账户封禁")])],-1)])])):u("",!0)])])]),e("div",p0,[_(A,{variant:"ghost",onClick:Y,disabled:n.value.loading},{default:w(()=>[...t[212]||(t[212]=[g(" 返回 ",-1)])]),_:1},8,["disabled"]),r.userHas2FA?(s(),ee(A,{key:0,variant:"primary",loading:n.value.loading,disabled:!n.value.twoFactorCode||n.value.twoFactorCode.length!==6,onClick:Xe},{default:w(()=>[...t[213]||(t[213]=[g(" 确认已付款 ",-1)])]),_:1},8,["loading","disabled"])):(s(),ee(A,{key:1,variant:"warning",onClick:t[54]||(t[54]=()=>je(H).visit("/user/profile"))},{default:w(()=>[...t[214]||(t[214]=[g(" 前往启用双重验证 ",-1)])]),_:1}))])]),_:1},8,["show"]),_(ue,{show:n.value.pendingAction==="mark_seller_received"&&n.value.show,"max-width":"md",closeable:!0,onClose:Y},{default:w(()=>[e("div",w0,[t[219]||(t[219]=e("div",{class:"mx-auto flex items-center justify-center size-12 rounded-full bg-emerald-100 dark:bg-emerald-900/30"},[e("svg",{class:"size-6 text-emerald-600 dark:text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",h0,[t[218]||(t[218]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-gray-100"}," 确认收款 ",-1)),e("div",_0,[e("p",C0,[t[215]||(t[215]=g(" 请确认您已收到买家付款 ",-1)),e("span",$0,"¥"+i(parseFloat(r.order.fiat_amount).toFixed(2)),1)]),r.userHas2FA?(s(),o("div",z0,[_(De,{modelValue:n.value.twoFactorCode,"onUpdate:modelValue":t[55]||(t[55]=a=>n.value.twoFactorCode=a),error:n.value.twoFactorError,disabled:n.value.loading,onComplete:Ue},null,8,["modelValue","error","disabled"])])):(s(),o("div",M0,[...t[216]||(t[216]=[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-sm"},[e("p",{class:"font-medium text-amber-800 dark:text-amber-300"},"需要双重验证"),e("p",{class:"text-amber-700 dark:text-amber-400 mt-0.5"},"为保护您的资金安全，卖家确认收款必须启用双重验证")])],-1)])])),r.userHas2FA?(s(),o("div",j0,[...t[217]||(t[217]=[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})]),e("div",{class:"text-sm"},[e("p",{class:"font-medium text-red-800 dark:text-red-300"},"重要提醒"),e("p",{class:"text-red-700 dark:text-red-400 mt-0.5"},"确认收款后，托管的加密货币将立即释放给买家，此操作不可撤销")])],-1)])])):u("",!0)])])]),e("div",B0,[_(A,{variant:"ghost",onClick:Y,disabled:n.value.loading},{default:w(()=>[...t[220]||(t[220]=[g(" 返回 ",-1)])]),_:1},8,["disabled"]),r.userHas2FA?(s(),ee(A,{key:0,variant:"success",loading:n.value.loading,disabled:!n.value.twoFactorCode||n.value.twoFactorCode.length!==6,onClick:Qe},{default:w(()=>[...t[221]||(t[221]=[g(" 确认收款 ",-1)])]),_:1},8,["loading","disabled"])):(s(),ee(A,{key:1,variant:"warning",onClick:t[56]||(t[56]=()=>je(H).visit("/user/profile"))},{default:w(()=>[...t[222]||(t[222]=[g(" 前往启用双重验证 ",-1)])]),_:1}))])]),_:1},8,["show"]),_(Be,{modelValue:x.value,"onUpdate:modelValue":t[57]||(t[57]=a=>x.value=a),title:"商家交易条款",subtitle:`订单 #${r.order.order_no}`,position:"bottom",size:"default","icon-color":"purple"},{"header-icon":w(()=>[...t[223]||(t[223]=[e("div",{class:"p-2 rounded bg-purple-100 dark:bg-purple-900/30"},[e("svg",{class:"w-5 h-5 text-purple-600 dark:text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)])]),default:w(()=>[e("div",F0,[r.order.ad_snapshot?.vendor_toc?(s(),o("div",S0,[e("p",A0,i(r.order.ad_snapshot?.vendor_toc),1)])):(s(),o("div",L0,[...t[224]||(t[224]=[e("p",{class:"text-sm text-gray-500 dark:text-gray-400 text-center"},"商家未设置交易条款",-1)])])),t[225]||(t[225]=e("div",{class:"mt-4 p-3 bg-amber-50 dark:bg-amber-900/20 rounded border border-amber-200 dark:border-amber-800"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("p",{class:"text-xs text-amber-700 dark:text-amber-300"}," 请仔细阅读并遵守以上交易条款，违反条款可能导致交易取消 ")])],-1))])]),_:1},8,["modelValue","subtitle"])]),_:1},8,["breadcrumbs"]),_(wr,{modelValue:b.value,"onUpdate:modelValue":t[58]||(t[58]=a=>b.value=a),"order-id":d.value.id,"order-no":d.value.order_no,"vendor-name":d.value.vendor?.name||"商家","fiat-amount":d.value.fiat_amount,"fiat-currency":d.value.fiat_currency,"crypto-amount":d.value.crypto_amount,"crypto-currency":d.value.currency_key||d.value.crypto_currency,onSuccess:Ne},null,8,["modelValue","order-id","order-no","vendor-name","fiat-amount","fiat-currency","crypto-amount","crypto-currency"])],64))}};export{R0 as default};
