import{g as v,O as H,f as r,o,a as n,b as l,r as E,w as s,t as B,N as A,z as I,B as R,u as U,d as j,I as z,c as _,i as u,k as m,j as x,F as D,l as G,m as P}from"./app-C2D0370k.js";import{_ as O}from"./ActionSection-B0VfS01i.js";import{_ as Q}from"./P2PConfirmationBox-BS-V_PR9.js";import{_ as K}from"./InputError-DgtNb7um.js";import{_ as L}from"./P2PTextInput-RLLuNfN6.js";import{_ as J}from"./InputLabel-Dn572EbF.js";import{_ as w}from"./P2PButton-Dng1EAjU.js";import"./Modal-B0w-RHll.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"text-left"},X={class:"mb-4"},k={__name:"P2PConfirmsPassword",props:{title:{type:String,default:"确认密码"},content:{type:String,default:"为了您的安全，请确认您的密码以继续。"},button:{type:String,default:"确认"}},emits:["confirmed"],setup(h,{emit:S}){const b=S,i=v(!1),e=H({password:"",error:"",processing:!1}),d=v(null),g=()=>{axios.get(route("password.confirmation")).then(a=>{a.data.confirmed?b("confirmed"):(i.value=!0,setTimeout(()=>d.value?.focus(),250))})},p=()=>{e.processing=!0,axios.post(route("password.confirm"),{password:e.password}).then(()=>{e.processing=!1,f(),I().then(()=>b("confirmed"))}).catch(a=>{e.processing=!1,e.error=a.response.data.errors.password[0],d.value?.focus()})},f=()=>{i.value=!1,e.password="",e.error=""};return(a,c)=>(o(),r("span",null,[n("span",{onClick:g},[E(a.$slots,"default")]),l(Q,{show:i.value,title:h.title,"confirm-text":h.button,"cancel-text":"取消",loading:e.processing,onConfirm:p,onClose:f},{default:s(()=>[n("div",W,[n("p",X,B(h.content),1),l(L,{ref_key:"passwordInput",ref:d,modelValue:e.password,"onUpdate:modelValue":c[0]||(c[0]=F=>e.password=F),type:"password",placeholder:"密码",autocomplete:"current-password",onKeyup:A(p,["enter"]),variant:e.error?"error":"default"},null,8,["modelValue","variant"]),l(K,{message:e.error,class:"mt-2"},null,8,["message"])])]),_:1},8,["show","title","confirm-text","loading"])]))}},Y={key:0,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},Z={key:1,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},ee={key:2,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},te={key:3},oe={key:0},se={class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},ae={key:0,class:"font-semibold"},re={key:1},ne=["innerHTML"],le={key:0,class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},ie={class:"font-semibold"},de=["innerHTML"],ue={key:1,class:"mt-4"},ce={key:1},me={class:"grid gap-1 max-w-xl mt-4 px-4 py-4 font-mono text-sm bg-gray-100 dark:bg-gray-900 dark:text-gray-100 rounded-lg"},fe={class:"mt-5"},ve={key:0},pe={key:1},Se={__name:"TwoFactorAuthenticationForm",props:{requiresConfirmation:Boolean},setup(h){const S=h,b=R(),i=v(!1),e=v(!1),d=v(!1),g=v(null),p=v(null),f=v([]),a=U({code:""}),c=j(()=>!i.value&&b.props.auth.user?.two_factor_enabled);z(c,()=>{c.value||(a.reset(),a.clearErrors())});const F=()=>{i.value=!0,P.post(route("two-factor.enable"),{},{preserveScroll:!0,onSuccess:()=>Promise.all([M(),N(),T()]),onFinish:()=>{i.value=!1,e.value=S.requiresConfirmation}})},M=()=>axios.get(route("two-factor.qr-code")).then(y=>{g.value=y.data.svg}),N=()=>axios.get(route("two-factor.secret-key")).then(y=>{p.value=y.data.secretKey}),T=()=>axios.get(route("two-factor.recovery-codes")).then(y=>{f.value=y.data}),V=()=>{a.post(route("two-factor.confirm"),{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{e.value=!1,g.value=null,p.value=null}})},q=()=>{axios.post(route("two-factor.recovery-codes")).then(()=>T())},$=()=>{d.value=!0,P.delete(route("two-factor.disable"),{preserveScroll:!0,onSuccess:()=>{d.value=!1,e.value=!1}})};return(y,t)=>(o(),_(O,null,{title:s(()=>[...t[1]||(t[1]=[m(" 双重验证 ",-1)])]),description:s(()=>[...t[2]||(t[2]=[m(" 使用双重验证为您的账户增加额外的安全保护 ",-1)])]),content:s(()=>[c.value&&!e.value?(o(),r("h3",Y," 您已启用双重验证 ")):c.value&&e.value?(o(),r("h3",Z," 完成双重验证设置 ")):(o(),r("h3",ee," 您尚未启用双重验证 ")),t[11]||(t[11]=n("div",{class:"mt-3 max-w-xl text-sm text-gray-600 dark:text-gray-400"},[n("p",null," 启用双重验证后，登录时需要输入手机验证器应用生成的安全令牌。您可以使用 Google Authenticator 或其他验证器应用获取此令牌。 ")],-1)),c.value?(o(),r("div",te,[g.value?(o(),r("div",oe,[n("div",se,[e.value?(o(),r("p",ae," 要完成双重验证设置，请使用手机验证器应用扫描下方二维码，或手动输入设置密钥，然后提供生成的验证码。 ")):(o(),r("p",re," 双重验证已启用。请使用手机验证器应用扫描下方二维码，或手动输入设置密钥。 "))]),n("div",{class:"mt-4 p-2 inline-block bg-white",innerHTML:g.value},null,8,ne),p.value?(o(),r("div",le,[n("p",ie,[t[3]||(t[3]=m(" 设置密钥：",-1)),n("span",{innerHTML:p.value},null,8,de)])])):u("",!0),e.value?(o(),r("div",ue,[l(J,{for:"code",value:"验证码"}),l(L,{id:"code",modelValue:x(a).code,"onUpdate:modelValue":t[0]||(t[0]=C=>x(a).code=C),type:"text",name:"code",inputmode:"numeric",placeholder:"输入6位验证码",autofocus:"",autocomplete:"one-time-code",onKeyup:A(V,["enter"]),variant:x(a).errors.code?"error":"default"},null,8,["modelValue","variant"]),l(K,{message:x(a).errors.code,class:"mt-2"},null,8,["message"])])):u("",!0)])):u("",!0),f.value.length>0&&!e.value?(o(),r("div",ce,[t[4]||(t[4]=n("div",{class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},[n("p",{class:"font-semibold"}," 请将这些恢复代码保存在安全的密码管理器中。如果您的双重验证设备丢失，可以使用这些代码恢复账户访问权限。 ")],-1)),n("div",me,[(o(!0),r(D,null,G(f.value,C=>(o(),r("div",{key:C},B(C),1))),128))])])):u("",!0)])):u("",!0),n("div",fe,[c.value?(o(),r("div",pe,[l(k,{onConfirmed:V},{default:s(()=>[e.value?(o(),_(w,{key:0,variant:"primary",type:"button",class:"me-3",loading:i.value||x(a).processing,disabled:i.value||x(a).processing},{default:s(()=>[...t[6]||(t[6]=[m(" 确认 ",-1)])]),_:1},8,["loading","disabled"])):u("",!0)]),_:1}),l(k,{onConfirmed:q},{default:s(()=>[f.value.length>0&&!e.value?(o(),_(w,{key:0,variant:"secondary",class:"me-3"},{default:s(()=>[...t[7]||(t[7]=[m(" 重新生成恢复代码 ",-1)])]),_:1})):u("",!0)]),_:1}),l(k,{onConfirmed:T},{default:s(()=>[f.value.length===0&&!e.value?(o(),_(w,{key:0,variant:"secondary",class:"me-3"},{default:s(()=>[...t[8]||(t[8]=[m(" 显示恢复代码 ",-1)])]),_:1})):u("",!0)]),_:1}),l(k,{onConfirmed:$},{default:s(()=>[e.value?(o(),_(w,{key:0,variant:"ghost",loading:d.value,disabled:d.value},{default:s(()=>[...t[9]||(t[9]=[m(" 取消 ",-1)])]),_:1},8,["loading","disabled"])):u("",!0)]),_:1}),l(k,{onConfirmed:$},{default:s(()=>[e.value?u("",!0):(o(),_(w,{key:0,variant:"danger",loading:d.value,disabled:d.value},{default:s(()=>[...t[10]||(t[10]=[m(" 禁用 ",-1)])]),_:1},8,["loading","disabled"]))]),_:1})])):(o(),r("div",ve,[l(k,{onConfirmed:F},{default:s(()=>[l(w,{variant:"primary",type:"button",loading:i.value,disabled:i.value},{default:s(()=>[...t[5]||(t[5]=[m(" 启用 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]))])]),_:1}))}};export{Se as default};
