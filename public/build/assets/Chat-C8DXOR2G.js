import{d as I,I as we,h as je,D as De,c as te,o as a,b as w,w as y,f as l,i as u,T as $e,n as x,a as e,r as ce,J as Je,t as i,H as We,m as q,g as _,z as ie,F as H,l as Q,e as N,x as le,q as oe,L as ye,k as m,v as ae,M as se,K as X,B as Ye,j as Me,y as et}from"./app-R7qsyyHZ.js";import{P as tt}from"./P2PAppLayout-BxOwmRgf.js";import{_ as B}from"./P2PButton-BPEbht8s.js";import{_ as st}from"./P2PDialog-ChdberCL.js";import{_ as ue}from"./Modal-CLAq8MR9.js";import"./useConfig-h7LA2lE0.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const rt={class:"flex-shrink-0 bg-white dark:bg-slate-900 border-b border-gray-200 dark:border-slate-800 px-4 py-3"},at={class:"flex items-center justify-between"},lt={key:0,class:"absolute top-2 left-1/2 -translate-x-1/2 w-12 h-1 bg-gray-300 dark:bg-slate-600 rounded-full"},ot={class:"flex items-center gap-3"},dt={class:"text-lg font-bold text-gray-900 dark:text-slate-100"},it={key:0,class:"text-xs text-gray-500 dark:text-slate-400"},nt={key:0,class:"flex-shrink-0 bg-white dark:bg-slate-900 border-t border-gray-200 dark:border-slate-800 p-4"},Ee={__name:"P2PMobileDrawer",props:{modelValue:{type:Boolean,default:!1},title:{type:String,default:"详情"},subtitle:{type:String,default:""},position:{type:String,default:"bottom",validator:s=>["bottom","right","left"].includes(s)},size:{type:String,default:"default",validator:s=>["small","default","large","full"].includes(s)},icon:{type:[Object,String],default:null},iconColor:{type:String,default:"blue",validator:s=>["blue","emerald","amber","red","purple"].includes(s)},persistent:{type:Boolean,default:!1},scrollable:{type:Boolean,default:!0}},emits:["update:modelValue","open","close"],setup(s,{emit:c}){const g=s,b=c,f=I(()=>({bottom:"bottom-0 left-0 right-0 rounded-t-2xl",right:"top-0 right-0 bottom-0 rounded-l-2xl",left:"top-0 left-0 bottom-0 rounded-r-2xl"})[g.position]),d=I(()=>g.position==="bottom"?{small:"max-h-[40vh]",default:"max-h-[70vh]",large:"max-h-[85vh]",full:"h-full"}[g.size]:{small:"w-64",default:"w-80",large:"w-96",full:"w-full"}[g.size]),v=I(()=>{let k=["flex-1","min-h-0"];return g.scrollable&&k.push("overflow-y-auto"),k.join(" ")}),C=I(()=>({bottom:{from:"translate-y-full",to:"translate-y-0"},right:{from:"translate-x-full",to:"translate-x-0"},left:{from:"-translate-x-full",to:"translate-x-0"}})[g.position]),U=I(()=>({blue:"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400",emerald:"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400",amber:"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400",red:"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400",purple:"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"})[g.iconColor]),M=()=>{g.persistent||(b("update:modelValue",!1),b("close"))},D=k=>{k.key==="Escape"&&g.modelValue&&!g.persistent&&M()},K=k=>{k?document.body.style.overflow="hidden":document.body.style.overflow=""};return we(()=>g.modelValue,k=>{K(k),k&&b("open")}),je(()=>{document.addEventListener("keydown",D)}),De(()=>{document.removeEventListener("keydown",D),K(!1)}),(k,h)=>(a(),te(We,{to:"body"},[w($e,{"enter-active-class":"transition-opacity ease-out duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity ease-in duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:y(()=>[s.modelValue?(a(),l("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] lg:hidden",onClick:M})):u("",!0)]),_:1}),w($e,{"enter-active-class":"transition-transform ease-out duration-300","enter-from-class":C.value.from,"enter-to-class":C.value.to,"leave-active-class":"transition-transform ease-in duration-200","leave-from-class":C.value.to,"leave-to-class":C.value.from},{default:y(()=>[s.modelValue?(a(),l("div",{key:0,class:x(["fixed z-[70] bg-white dark:bg-slate-900 shadow-2xl lg:hidden flex flex-col",f.value,d.value])},[e("div",rt,[e("div",at,[s.position==="bottom"?(a(),l("div",lt)):u("",!0),e("div",ot,[ce(k.$slots,"header-icon",{},()=>[s.icon?(a(),l("div",{key:0,class:x(["p-2 rounded-lg",U.value])},[(a(),te(Je(s.icon),{class:"w-5 h-5"}))],2)):u("",!0)]),e("div",null,[e("h3",dt,i(s.title),1),s.subtitle?(a(),l("p",it,i(s.subtitle),1)):u("",!0)])]),e("button",{onClick:M,class:"p-2 rounded-lg text-gray-500 dark:text-slate-400 hover:text-gray-700 dark:hover:text-slate-200 hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors"},[...h[0]||(h[0]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",{class:x(v.value)},[ce(k.$slots,"default")],2),k.$slots.footer?(a(),l("div",nt,[ce(k.$slots,"footer")])):u("",!0)],2)):u("",!0)]),_:3},8,["enter-from-class","enter-to-class","leave-from-class","leave-to-class"])]))}},ut={class:"md:hidden sticky top-0 z-50 bg-white dark:bg-slate-900 border-b border-gray-200 dark:border-slate-800 pt-safe"},ct={class:"flex items-center justify-between h-14 px-4"},mt={class:"flex items-center gap-3 flex-1"},xt={class:"text-base font-semibold text-gray-900 dark:text-slate-100"},vt={key:0,class:"text-xs text-gray-500 dark:text-slate-400"},bt={class:"flex items-center gap-1"},ft={__name:"P2PMobileHeader",props:{title:{type:String,required:!0},subtitle:{type:String,default:""},backUrl:{type:String,default:null}},setup(s){const c=s,g=()=>{c.backUrl?q.visit(c.backUrl):window.history.back()};return(b,f)=>(a(),l("div",ut,[e("div",ct,[e("div",mt,[e("button",{onClick:g,class:"p-2 -ml-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors"},[...f[0]||(f[0]=[e("svg",{class:"w-5 h-5 text-gray-700 dark:text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),ce(b.$slots,"custom",{},()=>[e("div",null,[e("h1",xt,i(s.title),1),s.subtitle?(a(),l("p",vt,i(s.subtitle),1)):u("",!0)])])]),e("div",bt,[ce(b.$slots,"actions")])])]))}},gt={class:"space-y-3"},kt={class:"flex items-center gap-2"},pt={class:"text-sm font-medium text-gray-700 dark:text-slate-300"},yt={class:"flex gap-2 justify-center"},wt=["onUpdate:modelValue","onInput","onKeydown","disabled"],ht={key:0,class:"text-xs text-red-600 dark:text-red-400 text-center"},_t={key:1,class:"text-xs text-gray-500 dark:text-slate-400 text-center"},Ct={key:2,class:"text-center"},Pe={__name:"P2PTwoFactorInput",props:{modelValue:{type:String,default:""},label:{type:String,default:"双重验证码"},error:{type:String,default:""},helpText:{type:String,default:"请输入您的验证器应用中显示的6位数字"},disabled:{type:Boolean,default:!1},showRecoveryOption:{type:Boolean,default:!1},autoFocus:{type:Boolean,default:!0}},emits:["update:modelValue","complete","use-recovery"],setup(s,{expose:c,emit:g}){const b=s,f=g,d=_(["","","","","",""]),v=_([]);we(d,k=>{const h=k.join("");f("update:modelValue",h),h.length===6&&/^\d{6}$/.test(h)&&f("complete",h)},{deep:!0}),we(()=>b.modelValue,k=>{if(k==="")d.value=["","","","","",""];else if(k.length<=6){const h=k.split("");for(let A=0;A<6;A++)d.value[A]=h[A]||""}});const C=(k,h)=>{const A=h.target.value;if(!/^\d*$/.test(A)){h.target.value=d.value[k];return}A&&k<5&&ie(()=>{v.value[k+1]?.focus(),v.value[k+1]?.select()})},U=(k,h)=>{h.key==="Backspace"?!d.value[k]&&k>0&&(h.preventDefault(),d.value[k-1]="",v.value[k-1]?.focus()):h.key==="ArrowLeft"&&k>0?(h.preventDefault(),v.value[k-1]?.focus()):h.key==="ArrowRight"&&k<5&&(h.preventDefault(),v.value[k+1]?.focus())},M=k=>{k.preventDefault();const A=k.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(A){const P=A.split("");for(let L=0;L<6;L++)d.value[L]=P[L]||"";const $=Math.min(P.length,5);v.value[$]?.focus()}},D=()=>{d.value=["","","","","",""],v.value[0]?.focus()},K=()=>{v.value[0]?.focus()};return je(()=>{b.autoFocus&&ie(()=>{v.value[0]?.focus()})}),c({clear:D,focus:K}),(k,h)=>(a(),l("div",gt,[e("div",kt,[h[2]||(h[2]=e("svg",{class:"w-5 h-5 text-emerald-600 dark:text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})],-1)),e("label",pt,i(s.label||"双重验证码"),1)]),e("div",yt,[(a(!0),l(H,null,Q(d.value,(A,P)=>N((a(),l("input",{key:P,ref_for:!0,ref:$=>v.value[P]=$,"onUpdate:modelValue":$=>d.value[P]=$,type:"text",inputmode:"numeric",maxlength:"1",class:x(["w-12 h-12 text-center text-lg font-mono font-bold rounded-lg border-2 transition-all duration-200",[s.error?"border-red-500 bg-red-50 dark:bg-red-900/20 text-red-900 dark:text-red-200":"border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-900 dark:text-slate-100 focus:border-emerald-500 dark:focus:border-emerald-400"]]),onInput:$=>C(P,$),onKeydown:$=>U(P,$),onPaste:h[0]||(h[0]=$=>M($)),disabled:s.disabled},null,42,wt)),[[le,d.value[P]]])),128))]),s.error?(a(),l("p",ht,i(s.error),1)):u("",!0),s.helpText&&!s.error?(a(),l("p",_t,i(s.helpText),1)):u("",!0),s.showRecoveryOption?(a(),l("div",Ct,[e("button",{type:"button",onClick:h[1]||(h[1]=A=>k.$emit("use-recovery")),class:"text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors"}," 使用恢复代码 ")])):u("",!0)]))}},zt={class:"relative group"},Mt={key:0,class:"relative"},$t=["src","alt"],jt={class:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent md:opacity-0 md:group-hover:opacity-100 transition-opacity flex items-end justify-between p-2"},Bt={key:0,class:"mt-1"},Ft={class:"flex gap-1"},At={class:"flex-1 min-w-0"},St={class:"relative max-w-[90vw] max-h-[90vh] flex flex-col"},Lt=["src","alt"],Vt={class:"flex justify-center gap-4 mt-4 md:hidden"},Tt=["href"],pe={__name:"P2PAttachment",props:{attachment:{type:Object,required:!0,validator:s=>s.url&&s.name&&s.type},variant:{type:String,default:"default",validator:s=>["default","primary"].includes(s)},thumbnailSize:{type:String,default:"md",validator:s=>["sm","md","lg"].includes(s)},showInfo:{type:Boolean,default:!1}},setup(s){const c=s,g=_(!1);_(!1);const b=I(()=>/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)),f=I(()=>window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://")),d=I(()=>c.attachment.type&&c.attachment.type.startsWith("image/")),v=I(()=>c.attachment.type==="application/pdf"),C={sm:{width:"150px",height:"150px"},md:{width:"200px",height:"200px"},lg:{width:"250px",height:"250px"}},U=I(()=>C[c.thumbnailSize].width),M=I(()=>C[c.thumbnailSize].height),D=I(()=>c.variant==="primary"?"bg-emerald-500 hover:bg-emerald-400":"bg-white dark:bg-slate-700 hover:bg-gray-50 dark:hover:bg-slate-600"),K=I(()=>c.variant==="primary"?"text-white":"text-gray-900 dark:text-slate-200"),k=I(()=>c.variant==="primary"?"text-emerald-100":"text-gray-500 dark:text-slate-400"),h=I(()=>c.variant==="primary"?"text-white":"text-gray-600 dark:text-slate-400"),A=I(()=>c.variant==="primary"?"text-white/90":"text-gray-700 dark:text-slate-300"),P=I(()=>c.variant==="primary"?"text-white/70":"text-gray-500 dark:text-slate-400"),$=V=>{if(!V)return"0 B";const z=1024,E=["B","KB","MB","GB"],me=Math.floor(Math.log(V)/Math.log(z));return Math.round(V/Math.pow(z,me)*100)/100+" "+E[me]},L=V=>V&&{"application/zip":"ZIP","application/x-rar-compressed":"RAR","application/msword":"Word","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"Word","application/vnd.ms-excel":"Excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"Excel","text/plain":"文本","text/csv":"CSV"}[V]||"文件",j=()=>{d.value&&(g.value=!0)},F=()=>{g.value=!1},O=()=>{f.value&&b.value?alert("请长按图片保存或使用分享功能"):window.open(c.attachment.url,"_blank")},Y=()=>{if(f.value&&b.value)if(d.value)j();else{const V=document.createElement("iframe");V.style.display="none",V.src=c.attachment.url,document.body.appendChild(V),setTimeout(()=>{document.body.removeChild(V)},3e3),alert("文件下载已开始，请检查您的下载文件夹")}else{const V=document.createElement("a");V.href=c.attachment.url,V.download=c.attachment.name||"download",document.body.appendChild(V),V.click(),document.body.removeChild(V)}};return(V,z)=>(a(),l("div",zt,[d.value?(a(),l("div",Mt,[e("div",{onClick:j,class:"relative overflow-hidden rounded-lg cursor-pointer transition-all hover:opacity-90",style:ye(`width: ${U.value}; height: ${M.value};`)},[e("img",{src:s.attachment.url,alt:s.attachment.name,class:"w-full h-full object-cover"},null,8,$t),e("div",jt,[e("button",{onClick:oe(j,["stop"]),class:"p-1.5 md:p-2 bg-white/90 backdrop-blur-sm rounded-full text-gray-700 hover:bg-white transition-colors",title:"查看"},[...z[1]||(z[1]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])]),f.value?u("",!0):(a(),l("button",{key:0,onClick:oe(Y,["stop"]),class:"p-1.5 md:p-2 bg-white/90 backdrop-blur-sm rounded-full text-gray-700 hover:bg-white transition-colors",title:"下载"},[...z[2]||(z[2]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])]))])],4),s.showInfo?(a(),l("div",Bt,[e("p",{class:x(["text-xs truncate",A.value])},i(s.attachment.name),3),e("p",{class:x(["text-xs",P.value])},i($(s.attachment.size)),3)])):u("",!0)])):v.value?(a(),l("div",{key:1,class:x(["flex items-center gap-2 md:gap-3 p-2.5 md:p-3 rounded-lg transition-colors",D.value])},[e("div",{class:"flex-shrink-0",onClick:O},[...z[3]||(z[3]=[e("div",{class:"w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center cursor-pointer"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})])],-1)])]),e("div",{class:"flex-1 min-w-0",onClick:O},[e("p",{class:x(["text-xs md:text-sm font-medium truncate cursor-pointer",K.value])},i(s.attachment.name),3),e("p",{class:x(["text-xs",k.value])},"PDF · "+i($(s.attachment.size)),3)]),e("div",Ft,[e("button",{onClick:O,class:"p-1.5 rounded-lg bg-black/5 hover:bg-black/10 transition-colors md:hidden",title:"查看"},[(a(),l("svg",{class:x(["w-4 h-4",h.value]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...z[4]||(z[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])],2))]),f.value?u("",!0):(a(),l("button",{key:0,onClick:oe(Y,["stop"]),class:"p-1.5 rounded-lg bg-black/5 hover:bg-black/10 transition-colors",title:"下载"},[(a(),l("svg",{class:x(["w-4 h-4",h.value]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...z[5]||(z[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)])],2))]))])],2)):(a(),l("div",{key:2,class:x(["flex items-center gap-2 md:gap-3 p-2.5 md:p-3 rounded-lg transition-colors",D.value])},[z[7]||(z[7]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-10 h-10 bg-gray-500 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])])],-1)),e("div",At,[e("p",{class:x(["text-xs md:text-sm font-medium truncate",K.value])},i(s.attachment.name),3),e("p",{class:x(["text-xs",k.value])},i(L(s.attachment.type))+" · "+i($(s.attachment.size)),3)]),f.value?u("",!0):(a(),l("button",{key:0,onClick:oe(Y,["stop"]),class:"flex-shrink-0 p-1.5 rounded-lg bg-black/5 hover:bg-black/10 transition-colors",title:"下载"},[(a(),l("svg",{class:x(["w-4 h-4",h.value]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...z[6]||(z[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)])],2))]))],2)),(a(),te(We,{to:"body"},[w($e,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:y(()=>[g.value?(a(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm p-4",onClick:F},[e("div",St,[e("img",{src:s.attachment.url,alt:s.attachment.name,class:"max-w-full max-h-[80vh] md:max-h-[90vh] object-contain",onClick:z[0]||(z[0]=oe(()=>{},["stop"]))},null,8,Lt),e("div",Vt,[e("button",{onClick:F,class:"p-3 bg-white/90 backdrop-blur-sm rounded-full text-gray-700 active:bg-white transition-colors",title:"关闭"},[...z[8]||(z[8]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),f.value?u("",!0):(a(),l("button",{key:0,onClick:Y,class:"p-3 bg-white/90 backdrop-blur-sm rounded-full text-gray-700 active:bg-white transition-colors",title:"下载原图"},[...z[9]||(z[9]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])]))]),e("button",{onClick:F,class:"hidden md:block absolute top-4 right-4 p-2 bg-black/50 hover:bg-black/70 rounded-full text-white transition-colors"},[...z[10]||(z[10]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),f.value?u("",!0):(a(),l("a",{key:0,href:s.attachment.url,download:"",class:"hidden md:block absolute bottom-4 right-4 p-3 bg-white/90 hover:bg-white rounded-full text-gray-700 transition-colors",title:"下载原图"},[...z[11]||(z[11]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,Tt))])])):u("",!0)]),_:1})]))]))}},It={class:"p-4 md:p-6"},Ut={class:"flex items-center gap-3 mb-4 md:mb-6"},Et={class:"text-base md:text-lg font-semibold text-gray-900 dark:text-slate-100"},Pt={class:"space-y-4 md:space-y-6"},Dt={class:"bg-gray-50 dark:bg-slate-800/50 rounded-lg p-3"},Wt={class:"flex items-center justify-between"},Rt={class:"text-xs md:text-sm font-medium text-gray-900 dark:text-slate-100"},qt={class:"flex items-center gap-1 md:gap-2"},Ht=["onClick","onMouseenter"],Ot={class:"ml-1 md:ml-2 text-sm md:text-lg font-medium text-gray-900 dark:text-slate-100"},Nt={class:"block text-xs md:text-sm font-medium text-gray-700 dark:text-slate-300 mb-2"},Kt={class:"text-xs text-gray-500 dark:text-slate-400 ml-1 md:ml-2"},Xt={class:"mt-2 flex flex-wrap gap-1.5 md:gap-2"},Gt=["onClick"],Qt={class:"flex items-start md:items-center"},Zt={class:"px-4 py-3 md:px-6 md:py-4 bg-gray-50 dark:bg-slate-900/50 border-t border-gray-200 dark:border-slate-800 flex justify-end gap-2 md:gap-3"},Jt={__name:"ReviewModal",props:{modelValue:Boolean,orderId:{type:Number,required:!0},orderNo:{type:String,required:!0},vendorName:{type:String,required:!0},fiatAmount:{type:[Number,String],required:!0},fiatCurrency:{type:String,required:!0},cryptoAmount:{type:[Number,String],required:!0},cryptoCurrency:{type:String,required:!0}},emits:["update:modelValue","success"],setup(s,{emit:c}){const g=s,b=c,f=I({get:()=>g.modelValue,set:L=>b("update:modelValue",L)}),d=_(!1),v=_(5),C=_(0),U=_(""),M=_(!1),D=["交易迅速","信誉良好","沟通顺畅","价格合理","服务专业","值得信赖"],K={1:"非常差",2:"较差",3:"一般",4:"满意",5:"非常满意"},k=I(()=>K[v.value]||""),h=I(()=>v.value>0),A=L=>{U.value.length>0?U.value+="，"+L:U.value=L},P=async()=>{if(!h.value){se.error("请选择评分");return}d.value=!0;try{const L=await X.post(`/web/api/orders/${g.orderId}/review`,{rating:v.value,comment:U.value,is_anonymous:M.value});L.data.success?(se.success("评价提交成功"),b("success",L.data.data.review),$()):se.error(L.data.message||"评价提交失败")}catch(L){console.error("Submit review error:",L),se.error(L.response?.data?.message||"评价提交失败")}finally{d.value=!1}},$=()=>{f.value=!1,v.value=5,C.value=0,U.value="",M.value=!1};return we(f,L=>{L&&(v.value=5,C.value=0,U.value="",M.value=!1)}),(L,j)=>(a(),te(ue,{show:f.value,"max-width":"2xl",onClose:$},{default:y(()=>[e("div",It,[e("div",Ut,[j[4]||(j[4]=e("div",{class:"p-2 md:p-3 rounded-lg md:rounded-xl bg-amber-100 dark:bg-amber-900/30"},[e("svg",{class:"w-5 h-5 md:w-6 md:h-6 text-amber-600 dark:text-amber-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})])],-1)),e("div",null,[e("h3",Et," 评价"+i(s.vendorName),1),j[3]||(j[3]=e("p",{class:"text-xs md:text-sm text-gray-500 dark:text-slate-400"}," 请对本次交易进行评价 ",-1))])]),e("div",Pt,[e("div",Dt,[e("div",Wt,[j[5]||(j[5]=e("span",{class:"text-xs md:text-sm text-gray-500 dark:text-slate-400"},"订单编号",-1)),e("span",Rt,i(s.orderNo),1)])]),e("div",null,[j[7]||(j[7]=e("label",{class:"block text-xs md:text-sm font-medium text-gray-700 dark:text-slate-300 mb-2 md:mb-3"},[m(" 您的评分 "),e("span",{class:"text-red-500"},"*")],-1)),e("div",qt,[(a(),l(H,null,Q(5,F=>e("button",{key:F,onClick:O=>v.value=F,onMouseenter:O=>C.value=F,onMouseleave:j[0]||(j[0]=O=>C.value=0),class:"focus:outline-none transition-transform hover:scale-110 cursor-pointer"},[(a(),l("svg",{class:x(["w-8 h-8 md:w-10 md:h-10 transition-colors",(C.value||v.value)>=F?"text-amber-500":"text-gray-300 dark:text-slate-600"]),fill:"currentColor",viewBox:"0 0 20 20"},[...j[6]||(j[6]=[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"},null,-1)])],2))],40,Ht)),64)),e("span",Ot,i(k.value),1)])]),e("div",null,[e("label",Nt,[j[8]||(j[8]=m(" 评价内容 ",-1)),e("span",Kt," ("+i(U.value.length)+"/500) ",1)]),N(e("textarea",{"onUpdate:modelValue":j[1]||(j[1]=F=>U.value=F),rows:"3",maxlength:"500",placeholder:"分享您的交易体验...",class:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-slate-100 focus:ring-2 focus:ring-emerald-500 focus:border-transparent resize-none"},null,512),[[le,U.value]]),e("div",Xt,[(a(),l(H,null,Q(D,F=>e("button",{key:F,onClick:O=>A(F),class:"px-2 md:px-3 py-1 text-xs bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-slate-300 rounded-full hover:bg-gray-200 dark:hover:bg-slate-600 transition-colors cursor-pointer"},i(F),9,Gt)),64))])]),e("div",Qt,[N(e("input",{id:"anonymous","onUpdate:modelValue":j[2]||(j[2]=F=>M.value=F),type:"checkbox",class:"w-4 h-4 mt-0.5 md:mt-0 text-emerald-600 bg-gray-100 border-gray-300 rounded focus:ring-emerald-500 dark:focus:ring-emerald-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600 cursor-pointer"},null,512),[[ae,M.value]]),j[9]||(j[9]=e("label",{for:"anonymous",class:"ml-2 text-xs md:text-sm text-gray-700 dark:text-slate-300 cursor-pointer"},[m(" 匿名评价 "),e("span",{class:"text-xs text-gray-500 dark:text-slate-400 block md:inline"},"（其他用户将看不到您的身份信息）")],-1))]),j[10]||(j[10]=e("div",{class:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-2 md:p-3"},[e("div",{class:"flex items-start gap-1.5 md:gap-2"},[e("svg",{class:"w-4 h-4 md:w-5 md:h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),e("div",{class:"text-xs text-amber-800 dark:text-amber-200"},[e("p",null,"评价提交后将无法修改或删除，请慎重评价。"),e("p",{class:"mt-0.5 md:mt-1"},"您的评价将帮助其他用户更好地了解商家。")])])],-1))])]),e("div",Zt,[w(B,{variant:"ghost",size:"sm",disabled:d.value,onClick:$,class:"md:!text-sm"},{default:y(()=>[...j[11]||(j[11]=[m(" 取消 ",-1)])]),_:1},8,["disabled"]),w(B,{variant:"primary",size:"sm",loading:d.value,disabled:!h.value||d.value,onClick:P,class:"md:!text-sm"},{default:y(()=>[m(i(d.value?"提交中...":"提交评价"),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["show"]))}};class Yt{constructor(c={}){this.defaultOptions={maxWidth:1920,maxHeight:1920,quality:.85,mimeType:"image/jpeg",maxSizeMB:2,...c}}async compressImage(c,g={}){const b={...this.defaultOptions,...g};if(!c.type.startsWith("image/")||c.size/1024/1024<=b.maxSizeMB&&!this.needsResize(c,b))return c;try{const d=await this.loadImage(c),v=this.resizeImage(d,b),C=await this.canvasToBlob(v,b);return C.size>=c.size?c:new File([C],c.name,{type:C.type,lastModified:Date.now()})}catch(d){return console.error("Image compression failed:",d),c}}async compressMultiple(c,g={}){const f=Array.from(c).map(d=>this.compressImage(d,g));return Promise.all(f)}loadImage(c){return new Promise((g,b)=>{const f=new FileReader;f.onload=d=>{const v=new Image;v.onload=()=>g(v),v.onerror=b,v.src=d.target.result},f.onerror=b,f.readAsDataURL(c)})}async needsResize(c,g){return new Promise(b=>{const f=new FileReader;f.onload=d=>{const v=new Image;v.onload=()=>{b(v.width>g.maxWidth||v.height>g.maxHeight)},v.onerror=()=>b(!1),v.src=d.target.result},f.onerror=()=>b(!1),f.readAsDataURL(c)})}resizeImage(c,g){const b=document.createElement("canvas"),f=b.getContext("2d");let{width:d,height:v}=this.calculateDimensions(c.width,c.height,g.maxWidth,g.maxHeight);return b.width=d,b.height=v,f.imageSmoothingEnabled=!0,f.imageSmoothingQuality="high",f.drawImage(c,0,0,d,v),b}calculateDimensions(c,g,b,f){if(c<=b&&g<=f)return{width:c,height:g};const d=c/g;let v=b,C=b/d;return C>f&&(C=f,v=f*d),{width:Math.round(v),height:Math.round(C)}}async canvasToBlob(c,g){let b=g.quality,f=await this.createBlob(c,g.mimeType,b);const d=g.maxSizeMB*1024*1024;for(;f.size>d&&b>.3;)b-=.1,f=await this.createBlob(c,g.mimeType,b);return f}createBlob(c,g,b){return new Promise(f=>{c.toBlob(d=>f(d),g,b)})}async getImageDimensions(c){return new Promise((g,b)=>{const f=new FileReader;f.onload=d=>{const v=new Image;v.onload=()=>{g({width:v.width,height:v.height})},v.onerror=b,v.src=d.target.result},f.onerror=b,f.readAsDataURL(c)})}estimateCompressedSize(c,g={}){const b={...this.defaultOptions,...g},f=c.size/1024/1024,d=b.quality*.7,v=Math.min(f*d,b.maxSizeMB);return v<1?`~${Math.round(v*1024)} KB`:`~${v.toFixed(1)} MB`}formatFileSize(c){return c<1024?c+" B":c<1024*1024?(c/1024).toFixed(1)+" KB":(c/(1024*1024)).toFixed(1)+" MB"}}const es=new Yt,ts={class:"flex items-center gap-2 flex-1"},ss={class:"flex -space-x-2"},rs=["src","alt"],as={class:"text-white text-xs font-bold"},ls={class:"flex-1 min-w-0"},os={class:"text-sm font-semibold text-gray-900 dark:text-slate-100 truncate"},ds={class:"text-xs text-gray-500 dark:text-slate-400"},is={class:"lg:min-h-screen lg:bg-gray-50 lg:dark:bg-slate-950 h-screen lg:h-auto overflow-hidden lg:overflow-visible fixed lg:relative inset-0"},ns={key:0,class:"relative z-10 bg-red-50 dark:bg-red-900/20 border-b border-red-200 dark:border-red-800"},us={key:1,class:"relative z-10 bg-amber-50 dark:bg-amber-900/20 border-b border-amber-200 dark:border-amber-800"},cs={class:"max-w-7xl mx-auto px-4 py-3 sm:px-6 lg:px-8"},ms={class:"flex flex-col sm:flex-row sm:items-center gap-3"},xs={class:"flex items-start gap-3 flex-1"},vs={class:"flex-1"},bs={key:0,class:"text-xs text-amber-700 dark:text-amber-300 mt-2"},fs={key:0,class:"sm:ml-auto"},gs={key:2,class:"hidden md:block relative z-10 bg-blue-50 dark:bg-blue-900/20 border-b border-blue-200 dark:border-blue-800"},ks={class:"max-w-7xl mx-auto px-4 py-3 sm:px-6 lg:px-8"},ps={class:"flex flex-col sm:flex-row sm:items-center gap-3"},ys={class:"sm:ml-auto"},ws={class:"p-4 space-y-4"},hs={class:"space-y-4"},_s={class:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800"},Cs={class:"flex items-center gap-2"},zs={class:"text-sm font-semibold text-blue-700 dark:text-blue-300"},Ms={class:"text-xs text-blue-600 dark:text-blue-400"},$s={class:"space-y-3"},js={class:"flex gap-3"},Bs={class:"flex-1 pb-3"},Fs={class:"text-xs text-gray-500 dark:text-slate-400"},As={key:0,class:"mt-2"},Ss={class:"flex gap-3"},Ls={class:"flex flex-col items-center"},Vs={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ts={key:1,class:"text-white text-xs font-bold"},Is={class:"flex-1 pb-3"},Us={class:"text-xs text-gray-500 dark:text-slate-400"},Es={class:"flex gap-3"},Ps={class:"flex flex-col items-center"},Ds={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ws={key:1,class:"text-white text-xs font-bold"},Rs={class:"flex-1 pb-3"},qs={class:"text-xs text-gray-500 dark:text-slate-400"},Hs={key:0,class:"mt-2"},Os={class:"flex gap-3"},Ns={class:"flex flex-col items-center"},Ks={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Xs={key:1,class:"text-white text-xs font-bold"},Gs={class:"flex-1 pb-3"},Qs={class:"text-xs text-gray-500 dark:text-slate-400"},Zs={key:0,class:"mt-2 space-y-2"},Js={class:"flex gap-2"},Ys={class:"flex gap-3"},er={class:"flex flex-col items-center"},tr={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},sr={key:1,class:"text-white text-xs font-bold"},rr={class:"flex-1 pb-3"},ar={class:"text-xs text-gray-500 dark:text-slate-400"},lr={key:0,class:"mt-2"},or={class:"flex gap-3"},dr={class:"flex flex-col items-center"},ir={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},nr={key:1,class:"text-white text-xs font-bold"},ur={class:"flex-1 pb-3"},cr={class:"text-xs text-gray-500 dark:text-slate-400"},mr={key:0,class:"mt-2"},xr={class:"flex gap-3"},vr={class:"flex flex-col items-center"},br={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},fr={key:1,class:"text-white text-xs font-bold"},gr={class:"flex-1 pb-3"},kr={class:"text-xs text-gray-500 dark:text-slate-400"},pr={key:0,class:"mt-2"},yr={class:"flex gap-3"},wr={class:"flex flex-col items-center"},hr={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},_r={key:1,class:"text-white text-xs font-bold"},Cr={class:"flex-1"},zr={class:"text-xs text-gray-500 dark:text-slate-400"},Mr={class:"grid grid-cols-2 gap-3 text-sm"},$r={class:"font-mono text-gray-900 dark:text-slate-200"},jr={class:"font-medium text-gray-900 dark:text-slate-200"},Br={class:"font-medium text-gray-900 dark:text-slate-200"},Fr={class:"font-medium text-gray-900 dark:text-slate-200"},Ar={class:"font-medium text-gray-900 dark:text-slate-200"},Sr={class:"font-medium text-gray-900 dark:text-slate-200"},Lr={class:"font-medium text-gray-900 dark:text-slate-200"},Vr={key:0,class:"text-xs text-amber-600 dark:text-amber-400 mt-0.5"},Tr={class:"font-medium text-gray-900 dark:text-slate-200"},Ir={class:"font-bold text-emerald-600 dark:text-emerald-400"},Ur={key:0,class:"mt-3 pt-3 border-t border-gray-100 dark:border-slate-800"},Er={class:"font-mono text-sm text-gray-900 dark:text-slate-200 break-all"},Pr={class:"mx-auto max-w-7xl"},Dr={class:"hidden md:grid md:grid-cols-3 gap-4 p-4"},Wr={class:"md:col-span-1 space-y-4"},Rr={class:"bg-white dark:bg-slate-900 rounded-xl border border-gray-200 dark:border-slate-800 p-6"},qr={class:"flex items-center justify-between mb-4"},Hr={key:0,class:"mb-4"},Or={key:0,class:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800"},Nr={key:1,class:"p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg border border-emerald-200 dark:border-emerald-800"},Kr={class:"mb-6"},Xr={class:"flex items-center justify-between text-xs text-gray-500 dark:text-slate-400 mb-2"},Gr={class:"w-full bg-gray-200 dark:bg-slate-700 rounded-full h-2"},Qr={class:"space-y-4 mb-6"},Zr={class:"flex items-center gap-3"},Jr={class:"flex-1"},Yr={class:"text-xs text-gray-500 dark:text-slate-400"},ea={class:"flex items-center gap-3"},ta={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},sa={key:1,class:"text-white font-bold text-xs"},ra={class:"flex-1"},aa={key:0,class:"ml-11 mt-2"},la={class:"flex items-center gap-3"},oa={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},da={key:1,class:"text-white font-bold text-xs"},ia={class:"flex-1"},na={key:0,class:"text-xs text-blue-600 dark:text-blue-400 font-mono break-all mt-1"},ua={key:0,class:"ml-11 mt-2"},ca={class:"flex items-center gap-3"},ma={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},xa={key:1,class:"text-white font-bold text-xs"},va={class:"flex-1"},ba={key:0,class:"ml-11 mt-2 space-y-2"},fa={class:"flex gap-2"},ga={class:"flex items-center gap-3"},ka={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},pa={key:1,class:"text-white font-bold text-xs"},ya={class:"flex-1"},wa={key:0,class:"ml-11 mt-2"},ha={class:"flex items-center gap-3"},_a={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ca={key:1,class:"text-white font-bold text-xs"},za={class:"flex-1"},Ma={class:"text-xs text-gray-500 dark:text-slate-400"},$a={key:0,class:"ml-11 mt-2"},ja={class:"flex items-center gap-3"},Ba={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Fa={key:1,class:"text-white font-bold text-xs"},Aa={class:"flex-1"},Sa={key:0,class:"ml-11 mt-2"},La={class:"flex items-center gap-3"},Va={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ta={key:1,class:"text-white font-bold text-xs"},Ia={class:"flex-1"},Ua={class:"space-y-3 border-t border-gray-200 dark:border-slate-800 pt-4"},Ea={class:"flex justify-between"},Pa={class:"text-sm font-mono text-gray-900 dark:text-slate-200"},Da={class:"flex justify-between"},Wa={class:"text-sm font-medium text-gray-900 dark:text-slate-200"},Ra={class:"flex justify-between"},qa={class:"text-sm font-medium text-gray-900 dark:text-slate-200"},Ha={class:"flex justify-between"},Oa={class:"text-sm font-medium text-gray-900 dark:text-slate-200"},Na={class:"flex justify-between"},Ka={class:"text-sm font-medium text-gray-900 dark:text-slate-200"},Xa={class:"flex justify-between"},Ga={class:"text-sm font-medium text-gray-900 dark:text-slate-200"},Qa={key:0,class:"flex justify-between"},Za={class:"text-sm text-amber-600 dark:text-amber-400"},Ja={class:"flex justify-between"},Ya={class:"text-sm font-medium text-gray-900 dark:text-slate-200"},el={class:"flex justify-between"},tl={class:"text-lg font-bold text-emerald-600 dark:text-emerald-400"},sl={key:1,class:"flex justify-between items-start pt-3 border-t border-gray-100 dark:border-slate-800"},rl={class:"text-sm font-medium text-gray-900 dark:text-slate-200 text-right break-all max-w-[180px]"},al={class:"md:col-span-2"},ll={class:"bg-white dark:bg-slate-900 rounded-xl border border-gray-200 dark:border-slate-800 flex flex-col",style:{height:"650px","min-height":"600px"}},ol={class:"border-b border-gray-200 dark:border-slate-800"},dl={class:"px-6 py-4"},il={class:"flex items-center justify-between"},nl={class:"flex items-center gap-3"},ul={class:"flex -space-x-2"},cl=["href"],ml=["src","alt"],xl={key:1,class:"h-10 w-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center ring-2 ring-white dark:ring-slate-900"},vl={class:"text-white font-bold"},bl={key:2,class:"absolute -bottom-0.5 -right-0.5 h-2.5 w-2.5 bg-emerald-500 rounded-full ring-2 ring-white dark:ring-slate-900"},fl={class:"flex-1"},gl={class:"flex items-center gap-2"},kl={class:"font-semibold text-gray-900 dark:text-slate-100"},pl={class:"text-xs text-gray-500 dark:text-slate-400 ml-2"},yl={class:"text-xs text-gray-500 dark:text-slate-400"},wl={key:0,class:"text-gray-400"},hl={class:"flex flex-col items-center gap-1"},_l={class:"text-xs text-gray-400 dark:text-slate-500"},Cl={key:0,class:"mb-4 mx-4"},zl={class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 border border-blue-200 dark:border-blue-800"},Ml={class:"text-sm text-gray-700 dark:text-slate-300 whitespace-pre-wrap"},$l={key:0,class:"mt-2 pt-2 border-t border-blue-200 dark:border-blue-700"},jl={class:"flex items-center gap-2"},Bl={class:"text-xs text-gray-600 dark:text-slate-400"},Fl={class:"font-medium text-blue-600 dark:text-blue-400"},Al={key:1,class:"mb-4 mx-4"},Sl={class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 border border-blue-200 dark:border-blue-800"},Ll={class:"flex items-center gap-2"},Vl={class:"text-xs text-gray-600 dark:text-slate-400"},Tl={class:"font-medium text-blue-600 dark:text-blue-400"},Il={key:0,class:"flex flex-col items-center gap-1"},Ul={class:"text-xs text-gray-400 dark:text-slate-500"},El={key:0},Pl=["href"],Dl=["src","alt"],Wl={key:1,class:"h-8 w-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center"},Rl={class:"text-white text-sm font-bold"},ql={class:"max-w-md"},Hl={class:"text-xs font-medium text-gray-600 dark:text-slate-400 mb-1 px-1"},Ol={key:0,class:"text-purple-600 dark:text-purple-400 font-bold"},Nl={class:"bg-gray-100 dark:bg-slate-800 rounded-2xl rounded-tl-none px-4 py-3"},Kl={key:0,class:"mb-2"},Xl={key:1,class:"text-sm text-gray-900 dark:text-slate-200"},Gl={class:"text-xs text-gray-400 dark:text-slate-500 mt-1 px-1"},Ql={class:"max-w-md"},Zl={class:"text-xs font-medium text-gray-600 dark:text-slate-400 mb-1 px-1 text-right"},Jl={key:0,class:"text-purple-600 dark:text-purple-400 font-bold"},Yl={class:"bg-emerald-600 text-white rounded-2xl rounded-tr-none px-4 py-3"},eo={key:0,class:"mb-2"},to={key:1,class:"text-sm"},so={class:"text-xs text-gray-400 dark:text-slate-500 mt-1 px-1 text-right"},ro=["src","alt"],ao={key:1,class:"h-8 w-8 rounded-full bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center flex-shrink-0"},lo={class:"text-white text-sm font-bold"},oo={class:"border-t border-gray-200 dark:border-slate-800 p-4"},io={key:0,class:"mb-3 p-3 bg-gray-50 dark:bg-slate-800 rounded-lg"},no={key:0,class:"flex items-center gap-3"},uo={key:1,class:"flex items-start gap-3"},co=["src","alt"],mo={key:1,class:"w-16 h-20 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center"},xo={class:"flex-1"},vo={class:"text-sm font-medium text-gray-900 dark:text-slate-200"},bo={class:"text-xs text-gray-500 dark:text-slate-400"},fo=["disabled"],go=["placeholder","disabled"],ko=["disabled"],po={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},yo={key:1},wo={key:1,class:"flex mt-3 items-center justify-between"},ho={class:"flex gap-2 items-center"},_o={key:0,class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Co={key:1,class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24"},zo={class:"mt-3 p-2 bg-gray-50 dark:bg-slate-800/50 rounded-lg border border-gray-200 dark:border-slate-700"},Mo={class:"flex items-center justify-between"},$o={class:"flex items-center gap-2"},jo={class:"text-xs font-medium text-gray-700 dark:text-slate-300"},Bo={class:"flex items-center gap-3 text-xs text-gray-500 dark:text-slate-400"},Fo={class:"text-emerald-600 dark:text-emerald-400 font-medium"},Ao={class:"space-y-4 mt-6"},So={key:0,class:"bg-white dark:bg-slate-900 rounded-xl border border-gray-200 dark:border-slate-800 p-4"},Lo={class:"p-3 bg-gray-50 dark:bg-slate-800/50 rounded-lg max-h-40 overflow-y-auto"},Vo={class:"text-xs text-gray-700 dark:text-slate-300 whitespace-pre-wrap"},To={class:"md:hidden fixed inset-x-0 bottom-0 flex flex-col bg-white dark:bg-slate-950",style:"top: calc(3.5rem + env(safe-area-inset-top))"},Io={key:0,class:"bg-amber-50 dark:bg-amber-900/20 border-b border-amber-200 dark:border-amber-800 p-3"},Uo={class:"flex items-center justify-between"},Eo={key:0,class:"sticky top-0 z-10 bg-amber-50 dark:bg-amber-900/20 border-b border-amber-200 dark:border-amber-800 p-2"},Po={class:"p-4 space-y-4"},Do={class:"flex flex-col items-center gap-1"},Wo={class:"text-xs text-gray-400 dark:text-slate-500"},Ro={key:0,class:"mb-4 mx-4"},qo={class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 border border-blue-200 dark:border-blue-800"},Ho={class:"text-sm text-gray-700 dark:text-slate-300 whitespace-pre-wrap"},Oo={key:0,class:"mt-2 pt-2 border-t border-blue-200 dark:border-blue-700"},No={class:"flex items-center gap-2"},Ko={class:"text-xs text-gray-600 dark:text-slate-400"},Xo={class:"font-medium text-blue-600 dark:text-blue-400"},Go={key:1,class:"mb-4 mx-4"},Qo={class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 border border-blue-200 dark:border-blue-800"},Zo={class:"flex items-center gap-2"},Jo={class:"text-xs text-gray-600 dark:text-slate-400"},Yo={class:"font-medium text-blue-600 dark:text-blue-400"},ed={key:0,class:"flex flex-col items-center gap-1"},td={class:"text-xs text-gray-400 dark:text-slate-500"},sd={key:0},rd=["href"],ad=["src","alt"],ld={key:1,class:"h-7 w-7 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center"},od={class:"text-white text-xs font-bold"},dd={class:"max-w-[70%]"},id={class:"text-xs font-medium text-gray-600 dark:text-slate-400 mb-0.5 px-1"},nd={key:0,class:"text-purple-600 dark:text-purple-400 font-bold"},ud={class:"bg-gray-100 dark:bg-slate-800 rounded-2xl rounded-tl-none px-3 py-2"},cd={key:0,class:"mb-2"},md={key:1,class:"text-sm text-gray-900 dark:text-slate-200"},xd={class:"text-xs text-gray-400 dark:text-slate-500 mt-1 px-1"},vd={class:"max-w-[70%]"},bd={class:"text-xs font-medium text-gray-600 dark:text-slate-400 mb-0.5 px-1 text-right"},fd={key:0,class:"text-purple-600 dark:text-purple-400 font-bold"},gd={class:"bg-emerald-600 text-white rounded-2xl rounded-tr-none px-3 py-2"},kd={key:0,class:"mb-2"},pd={key:1,class:"text-sm"},yd={class:"text-xs text-gray-400 dark:text-slate-500 mt-1 px-1 text-right"},wd=["src","alt"],hd={key:1,class:"h-7 w-7 rounded-full bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center flex-shrink-0"},_d={class:"text-white text-xs font-bold"},Cd={class:"bg-white dark:bg-slate-900 border-t border-gray-200 dark:border-slate-800 pb-safe"},zd={class:"p-3"},Md={key:0,class:"mb-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg"},$d={key:0,class:"flex items-center gap-3"},jd={key:1,class:"flex items-center gap-3"},Bd={class:"flex-shrink-0"},Fd=["src"],Ad={key:1,class:"w-12 h-12 bg-gray-200 dark:bg-slate-600 rounded-lg flex items-center justify-center"},Sd={class:"flex-1 min-w-0"},Ld={class:"text-sm font-medium text-gray-900 dark:text-slate-200 truncate"},Vd={class:"text-xs text-gray-500 dark:text-slate-400"},Td=["disabled"],Id=["placeholder","disabled"],Ud=["disabled"],Ed={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},Pd={key:1},Dd={key:1,class:"flex mt-2 justify-between items-center"},Wd={class:"flex gap-2 overflow-x-auto pb-1"},Rd=["title"],qd={class:"flex items-center justify-between"},Hd={class:"flex items-center gap-2"},Od={class:"text-xs font-medium text-gray-700 dark:text-slate-300"},Nd={class:"flex items-center gap-2"},Kd={class:"text-xs text-gray-500 dark:text-slate-400"},Xd={key:0,class:"text-gray-700 dark:text-slate-300"},Gd={key:1,class:"mt-4"},Qd={key:0,class:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1"},Zd=["placeholder","required"],Jd={class:"bg-white dark:bg-slate-900 px-4 pt-4 pb-4 sm:p-5 sm:pb-4 max-h-[80vh] overflow-y-auto"},Yd={class:"mt-2 text-center"},ei={class:"mt-3 space-y-2.5 text-left"},ti={class:"p-2.5 bg-gray-50 dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg"},si={class:"space-y-2"},ri={key:0},ai={class:"font-mono text-xs text-gray-900 dark:text-slate-100 break-all mt-0.5"},li={key:1},oi={class:"font-mono text-xs text-gray-900 dark:text-slate-100 break-all mt-0.5"},di={class:"text-base font-bold text-emerald-600 dark:text-emerald-400"},ii={key:2},ni={class:"font-mono text-xs text-blue-600 dark:text-blue-400 break-all mt-0.5"},ui={class:"space-y-2"},ci={class:"space-y-1.5"},mi={class:"flex items-start"},xi=["disabled"],vi={class:"flex items-start"},bi=["disabled"],fi={class:"flex items-start"},gi=["disabled"],ki={class:"ml-2 text-xs text-gray-700 dark:text-slate-300"},pi={class:"block font-mono text-blue-600 dark:text-blue-400 break-all mt-0.5"},yi={class:"flex items-start"},wi=["disabled"],hi={class:"ml-2 text-xs text-gray-700 dark:text-slate-300"},_i={class:"block font-mono text-blue-600 dark:text-blue-400 break-all mt-0.5"},Ci={class:"flex items-start"},zi=["disabled"],Mi={class:"ml-2 text-xs text-gray-700 dark:text-slate-300"},$i={class:"font-bold text-emerald-600 dark:text-emerald-400"},ji={class:"flex flex-row justify-end px-4 py-3 sm:px-5 sm:py-3 bg-gray-100 dark:bg-slate-800 text-end gap-2"},Bi={class:"bg-white dark:bg-slate-900 px-4 pt-4 pb-4 sm:p-5 sm:pb-4 max-h-[80vh] overflow-y-auto"},Fi={class:"mt-2 text-center"},Ai={class:"mt-3 space-y-2.5 text-left"},Si={key:0,class:"p-2.5 bg-gray-50 dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg"},Li={class:"space-y-1.5"},Vi={class:"font-mono text-xs text-gray-900 dark:text-slate-100 break-all mt-0.5"},Ti={class:"text-base font-bold text-emerald-600 dark:text-emerald-400"},Ii=["disabled"],Ui={class:"flex items-start"},Ei=["disabled"],Pi={class:"ml-2 text-sm text-gray-700 dark:text-slate-300"},Di={class:"font-bold text-emerald-600 dark:text-emerald-400"},Wi={class:"flex flex-row justify-end px-4 py-3 sm:px-5 sm:py-3 bg-gray-100 dark:bg-slate-800 text-end gap-2"},Ri={class:"bg-white dark:bg-slate-900 px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},qi={class:"mt-3 text-center"},Hi={class:"mt-4 space-y-3 text-left"},Oi={class:"text-sm text-gray-600 dark:text-slate-400"},Ni={class:"font-semibold text-emerald-600 dark:text-emerald-400"},Ki={key:0},Xi={key:1,class:"p-2.5 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-md"},Gi={key:2,class:"p-2.5 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md"},Qi={class:"flex flex-row justify-end px-6 py-4 bg-gray-100 dark:bg-slate-800 text-end gap-3"},Zi={class:"bg-white dark:bg-slate-900 px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Ji={class:"mt-3 text-center"},Yi={class:"mt-4 space-y-3 text-left"},e0={class:"text-sm text-gray-600 dark:text-slate-400"},t0={class:"font-semibold text-emerald-600 dark:text-emerald-400"},s0={key:0},r0={key:1,class:"p-2.5 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-md"},a0={key:2,class:"p-2.5 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md"},l0={class:"flex flex-row justify-end px-6 py-4 bg-gray-100 dark:bg-slate-800 text-end gap-3"},o0={class:"p-4"},d0={key:0,class:"bg-gray-50 dark:bg-slate-800/50 rounded-lg p-4 max-h-80 overflow-y-auto"},i0={class:"text-sm text-gray-700 dark:text-slate-300 whitespace-pre-wrap"},n0={key:1,class:"bg-gray-50 dark:bg-slate-800/50 rounded-lg p-4"},g0={__name:"Chat",props:{userHas2FA:{type:Boolean,default:!1},order:{type:Object,required:!0},otherUser:{type:Object,default:null},messages:{type:Array,default:()=>[]},currentUserId:{type:Number,required:!0},userRole:{type:String,required:!0},availableActions:{type:Array,default:()=>[]}},setup(s){Ye();const c=s,g=_(!1),b=_(!1),f=_(!1),d=_({...c.order}),v=_(c.messages),C=_(""),U=_(null),M=_(null),D=_(null),K=_(null),k=_(null),h=_(!1),A=_(!1),P=_(null),$=_(!1),L=_(!0);let j=null,F=null,O=null,Y=null;const V=_(!1),z=_([]),E=_([]),me=()=>{const o=[];d.value.vendor&&o.push({id:d.value.vendor.id,name:d.value.vendor.name,role:"商家",avatar:d.value.vendor.avatar,profile_photo_url:d.value.vendor.avatar,is_self:d.value.vendor.id===c.currentUserId,is_online:d.value.vendor.id===c.currentUserId,is_admin:!1}),d.value.client&&o.push({id:d.value.client.id,name:d.value.client.name,role:"客户",avatar:d.value.client.avatar,profile_photo_url:d.value.client.avatar,is_self:d.value.client.id===c.currentUserId,is_online:d.value.client.id===c.currentUserId,is_admin:!1}),E.value=o},n=_({show:!1,title:"",message:"",inputMode:!1,inputValue:"",inputLabel:"",inputPlaceholder:"",inputRequired:!1,danger:!1,confirmVariant:"primary",confirmText:"确认",cancelText:"取消",loading:!1,pendingAction:null,pendingData:{},require2FA:!1,twoFactorCode:"",twoFactorError:""}),re=_(""),Z=_(""),de=_(!1),W=_({txExists:!1,confirmations:!1,fromAddress:!1,toAddress:!1,amount:!1}),Be=I(()=>W.value.txExists&&W.value.confirmations&&W.value.fromAddress&&W.value.toAddress&&W.value.amount),G=I(()=>d.value.status==="completed"||d.value.status==="cancelled"||d.value.escrow_status==="escrow_released"),xe=_({orderId:d.value.order_no,type:c.userRole==="buyer"?"buy":"sell",cryptocurrency:d.value.currency_key||d.value.crypto_currency,amount:d.value.crypto_amount,price:d.value.price,total:d.value.fiat_amount,status:d.value.escrow_status,progress:ve(d.value.escrow_status),timeRemaining:765});function ve(o){return{order_initiated:12.5,vendor_confirmed:25,seller_paid:37.5,escrow_received:50,buyer_confirmed_escrow:62.5,buyer_paid:75,seller_received:87.5,escrow_released:100}[o]||0}function Re(o){return{order_initiated:"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400",vendor_confirmed:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400",seller_paid:"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400",escrow_received:"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400",buyer_paid:"bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-400",seller_received:"bg-teal-100 dark:bg-teal-900/30 text-teal-700 dark:text-teal-400",escrow_released:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400"}[o]||"bg-gray-100 dark:bg-gray-900/30 text-gray-700 dark:text-gray-400"}function Fe(o){return{order_initiated:"等待确认",vendor_confirmed:"等待转币",seller_paid:"托管确认中",escrow_received:"托管保护中",buyer_paid:"等待收款确认",seller_received:"释放中",escrow_released:"已完成"}[o]||"处理中"}function Ae(o){return{order_initiated:"等待商家确认",vendor_confirmed:"等待卖家转币",seller_paid:"等待托管确认",escrow_received:"托管保护中",buyer_confirmed_escrow:"等待买家付款",buyer_paid:"等待卖家确认收款",seller_received:"准备释放托管",escrow_released:"交易完成"}[o]||"处理中"}function Se(o){return{order_initiated:"bg-amber-500",vendor_confirmed:"bg-amber-500",seller_paid:"bg-blue-500",escrow_received:"bg-blue-500",buyer_confirmed_escrow:"bg-blue-500",buyer_paid:"bg-blue-500",seller_received:"bg-emerald-500",escrow_released:"bg-emerald-500"}[o]||"bg-gray-500"}const qe=_("12:45");let be=null;const He=()=>{be=setInterval(()=>{if(xe.value.timeRemaining>0){xe.value.timeRemaining--;const o=Math.floor(xe.value.timeRemaining/60),t=xe.value.timeRemaining%60;qe.value=`${o}:${t.toString().padStart(2,"0")}`}else clearInterval(be)},1e3)},ee=()=>{ie(()=>{const o=()=>{U.value&&(U.value.scrollTop=U.value.scrollHeight),P.value&&(P.value.scrollTop=P.value.scrollHeight)};o();const t=U.value||P.value;if(t){const r=t.querySelectorAll("img");if(r.length>0){let p=0;r.forEach(R=>{R.complete?p++:(R.addEventListener("load",()=>{o()},{once:!0}),R.addEventListener("error",()=>{o()},{once:!0}))}),p===r.length&&setTimeout(o,100)}}})},T=o=>new Date(o).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),Oe=o=>{d.value.has_review=!0,d.value.review=o,d.value.status="completed",b.value=!1,se.success("感谢您的评价！")},Le=o=>{if(o===0)return"0 Bytes";const t=1024,r=["Bytes","KB","MB","GB"],p=Math.floor(Math.log(o)/Math.log(t));return Math.round(o/Math.pow(t,p)*100)/100+" "+r[p]},Ve=async o=>{const t=o.target.files[0];if(!t)return;const r=2*1024*1024;let p=t;if(t.type.startsWith("image/")){A.value=!0;try{const R=(t.size/1024/1024).toFixed(2);console.log(`原始图片大小: ${R} MB`),p=await es.compressImage(t,{maxWidth:1920,maxHeight:1920,maxSizeMB:2,quality:.85});const Ce=(p.size/1024/1024).toFixed(2);if(console.log(`压缩后图片大小: ${Ce} MB`),p.size<t.size*.8){const ze=Math.round((1-p.size/t.size)*100);console.log(`图片已压缩 ${ze}%`)}}catch(R){console.error("图片压缩失败:",R),p=t}finally{A.value=!1}}if(p.size>r){alert(`文件大小不能超过 ${r/1024/1024}MB，当前文件大小为 ${(p.size/1024/1024).toFixed(2)}MB`),o.target.value="";return}M.value=p,p.type.startsWith("image/")&&(D.value=URL.createObjectURL(p))},he=()=>{M.value=null,D.value&&(URL.revokeObjectURL(D.value),D.value=null),K.value&&(K.value.value=""),k.value&&(k.value.value="")},Te=async()=>{if(!C.value.trim()&&!M.value||!$.value||h.value)return;const o=C.value,t=M.value;C.value="",h.value=!0;try{let r=null;if(t){const ke=new FormData;ke.append("file",t);const Ue=await X.post(`/web/api/orders/${d.value.order_no}/chat/upload`,ke,{headers:{"Content-Type":"multipart/form-data"}});Ue.data.success&&(r=Ue.data.file)}const p=d.value.vendor_id===c.currentUserId?d.value.client_id:d.value.vendor_id,R=E.value.find(ke=>ke.id===p),Ce=R?R.is_online:!1,ze=await X.post(`/web/api/orders/${d.value.order_no}/chat/send`,{message:o,attachment:r,recipient_online:Ce});v.value.push(ze.data),he(),ie(()=>{ee()})}catch(r){console.error("发送消息失败:",r),C.value=o,alert("发送失败，请重试")}finally{h.value=!1}},S=o=>{console.log("handleEscrowAction called with:",o);const t={vendor_confirm:{title:"确认接单",message:"确认接受此订单吗？接单后需要等待卖家转币到托管。",confirmVariant:"primary",confirmText:"确认接单"},mark_seller_paid:{title:"标记已转币",message:"请确认您已将币转入托管地址，并提供交易哈希作为凭证",inputMode:!0,inputLabel:"交易哈希 (TX ID)",inputPlaceholder:"请输入区块链交易哈希...",inputRequired:!0,confirmVariant:"primary",confirmText:"确认已转币"},confirm_escrow:{},mark_buyer_paid:{title:"标记已付款",message:"请确认您已向卖家付款",inputMode:!0,inputLabel:"付款说明（可选）",inputPlaceholder:"请输入付款凭证或说明...",inputRequired:!1,confirmVariant:"primary",confirmText:"确认已付款",require2FA:!0},mark_seller_received:{title:"确认收款",message:"请确认您已收到买家的付款。确认后，托管的币将释放给买家。",confirmVariant:"success",confirmText:"确认已收款",require2FA:!0},cancel:{},create_dispute:{title:"发起争议",message:"发起争议后，订单将被冻结，暂停所有交易操作，等待平台客服介入处理。请详细说明问题。",inputMode:!0,inputLabel:"争议原因",inputPlaceholder:"请详细描述您遇到的问题...",inputRequired:!0,confirmVariant:"warning",confirmText:"确认发起争议"},resolve_dispute:{title:"解除争议",message:"确定要解除争议吗？解除后订单将恢复正常，可以继续进行交易。",inputMode:!0,inputLabel:"解除原因（可选）",inputPlaceholder:"请输入解除争议的原因...",inputRequired:!1,confirmVariant:"success",confirmText:"确认解除"}};if(o==="cancel"){const p=d.value.escrow_status;let R={title:"取消订单",inputMode:!0,inputLabel:"取消原因",inputPlaceholder:"请输入取消原因...",inputRequired:!0,danger:!0,confirmVariant:"danger",confirmText:"确认取消"};["seller_paid","escrow_received","buyer_confirmed_escrow"].includes(p)?R.message=`⚠️ 警告：当前已进入托管阶段，取消订单将扣除您的信誉分 -1

确定要取消此订单吗？`:R.message="确定要取消此订单吗？",t[o]=R}const r=t[o];!r&&o!=="confirm_escrow"||(Object.assign(n.value,{show:!0,...r||{},cancelText:"返回",pendingAction:o,pendingData:{},loading:!1}),console.log("dialogState after setting:",n.value))},Ne=async o=>{const t=n.value.pendingAction;if(t)try{let r="",p={};switch(t){case"vendor_confirm":r=`/web/api/orders/${d.value.id}/vendor-confirm`;break;case"mark_seller_paid":if(r=`/web/api/orders/${d.value.id}/seller-paid`,!o||!o.trim()){n.value.loading=!1,n.value.show=!1;return}p.tx_hash=o.trim();break;case"confirm_escrow":r=`/web/api/orders/${d.value.id}/buyer-confirm-escrow`;break;case"mark_buyer_paid":r=`/web/api/orders/${d.value.id}/buyer-paid`,o&&(p.payment_proof=o),n.value.require2FA&&n.value.twoFactorCode&&(p.two_factor_code=n.value.twoFactorCode);break;case"mark_seller_received":r=`/web/api/orders/${d.value.id}/seller-received`,n.value.require2FA&&n.value.twoFactorCode&&(p.two_factor_code=n.value.twoFactorCode);break;case"cancel":r=`/web/api/orders/${d.value.id}/cancel`,p.reason=o;break;case"create_dispute":r=`/web/api/orders/${d.value.id}/dispute`,p.reason=o;break;case"resolve_dispute":r=`/web/api/orders/${d.value.id}/resolve-dispute`,o&&(p.reason=o);break}n.value.loading=!0,(await X.post(r,p)).data.success&&(n.value.show=!1,q.reload())}catch(r){console.error("操作失败:",r),n.value.loading=!1,n.value.show=!1}},J=()=>{n.value={show:!1,title:"",message:"",inputMode:!1,inputValue:"",inputLabel:"",inputPlaceholder:"",inputRequired:!1,danger:!1,confirmVariant:"primary",confirmText:"确认",cancelText:"取消",loading:!1,pendingAction:null,pendingData:{},require2FA:!1,twoFactorCode:"",twoFactorError:""},re.value="",Z.value="",de.value=!1,W.value={txExists:!1,confirmations:!1,fromAddress:!1,toAddress:!1,amount:!1}},Ie=o=>{n.value.twoFactorCode=o,n.value.twoFactorError=""},Ke=async()=>{if(!c.userHas2FA){alert("买家付款必须启用双重验证"),q.visit("/user/profile");return}if(!n.value.twoFactorCode||n.value.twoFactorCode.length!==6){n.value.twoFactorError="请输入6位验证码";return}n.value.loading=!0,n.value.twoFactorError="";try{const o={two_factor_code:n.value.twoFactorCode};re.value&&re.value.trim()&&(o.payment_proof=re.value.trim()),(await X.post(`/web/api/orders/${d.value.id}/buyer-paid`,o)).data.success&&(n.value.show=!1,re.value="",n.value.twoFactorCode="",n.value.twoFactorError="",q.reload())}catch(o){n.value.loading=!1,o.response?.data?.errors?.two_factor_code?n.value.twoFactorError=o.response.data.errors.two_factor_code[0]:o.response?.data?.message?o.response.data.require_2fa?(n.value.show=!1,alert("为了您的资金安全，请先在个人设置中启用双重验证"),q.visit("/user/profile")):n.value.twoFactorError=o.response.data.message:n.value.twoFactorError="验证失败，请重试"}},Xe=async()=>{if(!Be.value){se.error("请确认所有检查项");return}n.value.loading=!0;try{(await X.post(`/web/api/orders/${d.value.id}/buyer-confirm-escrow`)).data.success&&(n.value.show=!1,W.value={txExists:!1,confirmations:!1,fromAddress:!1,toAddress:!1,amount:!1},q.reload())}catch(o){n.value.loading=!1,console.error("确认托管失败:",o)}},Ge=async()=>{if(!Z.value||!Z.value.trim()){se.error("请输入交易哈希");return}if(!de.value){se.error("请确认已核对地址和金额");return}n.value.loading=!0;try{(await X.post(`/web/api/orders/${d.value.id}/seller-paid`,{tx_hash:Z.value.trim()})).data.success&&(n.value.show=!1,Z.value="",de.value=!1,q.reload())}catch(o){n.value.loading=!1,console.error("标记转币失败:",o)}},Qe=async()=>{if(!c.userHas2FA){alert("卖家确认收款必须启用双重验证"),q.visit("/user/profile");return}if(!n.value.twoFactorCode||n.value.twoFactorCode.length!==6){n.value.twoFactorError="请输入6位验证码";return}n.value.loading=!0,n.value.twoFactorError="";try{const o={two_factor_code:n.value.twoFactorCode};(await X.post(`/web/api/orders/${d.value.id}/seller-received`,o)).data.success&&(n.value.show=!1,n.value.twoFactorCode="",n.value.twoFactorError="",q.reload())}catch(o){n.value.loading=!1,o.response?.data?.errors?.two_factor_code?n.value.twoFactorError=o.response.data.errors.two_factor_code[0]:o.response?.data?.message?o.response.data.require_2fa?(n.value.show=!1,alert("为了您的资金安全，请先在个人设置中启用双重验证"),q.visit("/user/profile")):n.value.twoFactorError=o.response.data.message:n.value.twoFactorError="验证失败，请重试"}},fe=async o=>{try{if(o==="received"){if((await X.post(`/web/api/orders/${c.order.id}/mock-escrow-received`)).data.success){const r=await X.post(`/web/api/orders/${c.order.order_no}/chat/send`,{message:"✅ [测试模式] 托管已确认到账！买家现在可以付款了"});r.data&&(v.value.push({...r.data,type:"system"}),ee()),setTimeout(()=>{q.reload()},1e3)}}else o==="not_received"&&(await X.post(`/web/api/orders/${c.order.id}/mock-escrow-not-received`)).data.success&&setTimeout(()=>{q.reload()},1e3)}catch(t){console.error("模拟托管状态失败:",t)}},_e=()=>{console.log("[WebSocket] 断开连接"),F&&(F.stopListening(".MessageSent"),F.stopListening(".EscrowStatusUpdated"),F.stopListening(".OrderStatusUpdated"),F.stopListening(".dispute.resolved"),j.leave(`order.${d.value.id}`),F=null),$.value=!1,Y=Date.now()},ne=()=>{typeof window.Echo<"u"&&!F?(j=window.Echo,console.log("[WebSocket] 建立连接"),F=j.join(`order.${d.value.id}`).here(o=>{console.log("当前在线用户:",o),z.value=o,E.value.forEach(t=>{t.is_online=o.some(r=>r.id===t.id)}),o.forEach(t=>{[3].includes(t.id)&&(E.value.find(R=>R.id===t.id)||E.value.push({id:t.id,name:t.name,role:"仲裁员",avatar:null,is_self:t.id===c.currentUserId,is_online:!0,is_admin:!0}))}),V.value=o.some(t=>t.id===c.otherUser?.id)}).joining(o=>{if(console.log("用户加入:",o),z.value.push(o),o.id!==c.currentUserId){const r=new Date;v.value.push({id:`join-${o.id}-${Date.now()}`,type:"system",content:`${o.name} 加入了聊天`,created_at:r.toISOString(),is_temporary:!0}),ie(()=>ee())}const t=E.value.find(r=>r.id===o.id);t?t.is_online=!0:[3].includes(o.id)&&E.value.push({id:o.id,name:o.name,role:"仲裁员",avatar:null,is_self:o.id===c.currentUserId,is_online:!0,is_admin:!0}),o.id===c.otherUser?.id&&(V.value=!0)}).leaving(o=>{if(console.log("用户离开:",o),z.value=z.value.filter(r=>r.id!==o.id),o.id!==c.currentUserId){const r=new Date;v.value.push({id:`leave-${o.id}-${Date.now()}`,type:"system",content:`${o.name} 离开了聊天`,created_at:r.toISOString(),is_temporary:!0}),ie(()=>ee())}const t=E.value.find(r=>r.id===o.id);t&&(t.is_online=!1),o.id===c.otherUser?.id&&(V.value=!1)}).error(o=>{console.error("Presence channel error:",o)}).listen("MessageSent",o=>{if(o.type==="admin"&&o.user){const t=E.value.find(r=>r.id===o.user.id);t?t&&!t.is_admin&&(t.role="仲裁员",t.is_admin=!0,t.is_online=!0):E.value.push({id:o.user.id,name:o.user.name,role:"仲裁员",avatar:null,is_self:o.user.id===c.currentUserId,is_online:!0,is_admin:!0})}(o.type==="system"||!o.user||o.user.id!==c.currentUserId)&&(v.value.push({id:o.id,message:o.message,type:o.type||"text",attachment:o.attachment,user:o.user,created_at:o.created_at}),ee())}).listen("EscrowStatusUpdated",o=>{console.log("托管状态更新:",o),d.value.escrow_status=o.escrow_status||o.new_status,d.value.status=o.status||d.value.status,d.value.is_disputed=o.is_disputed,d.value.disputed_by=o.disputed_by,o.escrow_status==="buyer_confirmed_escrow"&&(d.value.buyer_confirmed_escrow_at=o.updated_at);const t=`托管状态更新: ${o.message}`;v.value.push({id:Date.now(),message:t,type:"system",user:null,created_at:new Date().toISOString()}),ee(),setTimeout(()=>{q.reload()},2e3)}).listen("OrderStatusUpdated",o=>{console.log("订单状态更新:",o),o.status==="cancelled"&&setTimeout(()=>{q.reload()},1e3)}).listen(".dispute.resolved",o=>{console.log("争议已解除:",o),d.value.is_disputed=!1,d.value.disputed_by=null,o.escrow_status&&(d.value.escrow_status=o.escrow_status),o.status&&(d.value.status=o.status),setTimeout(()=>{q.reload({only:["availableActions","order"]})},1e3),showNotification("success",o.message||"争议已解除，订单恢复正常")}),$.value=!0,Y&&(Y=null,console.log("[WebSocket] 重连成功，重新加载消息"),Ze())):(console.warn("Echo not available, retrying..."),setTimeout(ne,1e3))},Ze=async()=>{try{console.log("[WebSocket] 重新加载所有消息");const o=await X.get(`/web/api/orders/${d.value.order_no}/chat/messages`);o.data&&o.data.length>0?(console.log("[WebSocket] 加载消息成功:",o.data.length,"条"),v.value=o.data,ee()):console.log("[WebSocket] 没有消息")}catch(o){console.error("[WebSocket] 加载消息失败:",o)}},ge=()=>{if(L.value=!document.hidden,document.hidden){console.log("[WebSocket] 页面隐藏，准备断开");const t=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?1e4:3e4;O=setTimeout(()=>{_e()},t)}else console.log("[WebSocket] 页面显示, 连接状态:",$.value,"频道:",!!F),O&&(clearTimeout(O),O=null),!$.value&&!F?(console.log("[WebSocket] 检测到断开状态，重新连接..."),ne()):!$.value||!F?(console.log("[WebSocket] 连接状态不一致，重新连接..."),ne()):console.log("[WebSocket] 已连接，无需重连")};return je(()=>{me(),He(),ee(),ne(),document.addEventListener("visibilitychange",ge),document.addEventListener("pause",()=>{console.log("[WebSocket] PWA进入后台"),_e()}),document.addEventListener("resume",()=>{console.log("[WebSocket] PWA恢复前台"),$.value||ne()})}),De(()=>{be&&clearInterval(be),O&&clearTimeout(O),_e(),document.removeEventListener("visibilitychange",ge),document.removeEventListener("pause",ge),document.removeEventListener("resume",ge)}),(o,t)=>(a(),l(H,null,[w(tt,{"hide-nav":!0,"hide-footer":!0,"show-mobile-bottom-nav":!1,"show-breadcrumbs":!0,breadcrumbs:[{label:"订单",url:"/orders"},{label:`订单 #${s.order.order_no}`,url:null},{label:"交易聊天"}]},{default:y(()=>[w(ft,{title:`订单 #${s.order.order_no}`,"back-url":"/orders"},{custom:y(()=>[e("div",ts,[e("div",ss,[(a(!0),l(H,null,Q(E.value,(r,p)=>(a(),l("div",{key:r.id,class:"relative",style:ye(`z-index: ${E.value.length-p}`)},[r.profile_photo_url?(a(),l("img",{key:0,src:r.profile_photo_url,alt:r.name,class:x(["h-8 w-8 rounded-full object-cover ring-2",r.is_online?"ring-emerald-500":"ring-gray-400 dark:ring-slate-600"])},null,10,rs)):(a(),l("div",{key:1,class:x(["h-8 w-8 rounded-full flex items-center justify-center ring-2 ring-white dark:ring-slate-950",r.is_online?"bg-gradient-to-br from-emerald-500 to-emerald-600":"bg-gray-400 dark:bg-slate-600"])},[e("span",as,i(r.name?.[0]?.toUpperCase()||"U"),1)],2))],4))),128))]),e("div",ls,[e("p",os," 订单 #"+i(s.order.order_no),1),e("p",ds,i(E.value.filter(r=>r.is_online).length)+"/"+i(E.value.length)+" 在房间 ",1)])])]),actions:y(()=>[e("button",{onClick:t[0]||(t[0]=r=>f.value=!f.value),class:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors"},[...t[57]||(t[57]=[e("svg",{class:"w-5 h-5 text-gray-700 dark:text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)])]),e("button",{onClick:t[1]||(t[1]=r=>g.value=!g.value),class:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors"},[...t[58]||(t[58]=[e("svg",{class:"w-5 h-5 text-gray-700 dark:text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])])]),_:1},8,["title"]),e("div",is,[s.order.status==="cancelled"?(a(),l("div",ns,[...t[59]||(t[59]=[e("div",{class:"max-w-7xl mx-auto px-4 py-3 sm:px-6 lg:px-8"},[e("div",{class:"flex items-center gap-3"},[e("svg",{class:"w-5 h-5 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("p",{class:"text-sm font-medium text-red-800 dark:text-red-200"},"此订单已取消，无法进行任何操作")])],-1)])])):u("",!0),s.order.is_disputed&&s.order.status!=="cancelled"?(a(),l("div",us,[e("div",cs,[e("div",ms,[e("div",xs,[t[63]||(t[63]=e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("div",vs,[t[61]||(t[61]=e("p",{class:"text-sm font-medium text-amber-800 dark:text-amber-200"},"该订单处于争议中",-1)),t[62]||(t[62]=e("p",{class:"text-xs text-amber-700 dark:text-amber-300 mt-1"},[m(" 请等待仲裁管理员加入聊天，管理员将在 "),e("span",{class:"font-semibold"},"24小时内"),m(" 加入处理。 在此期间，您可以与对方自行协商解决。 ")],-1)),s.order.dispute_reason?(a(),l("p",bs,[t[60]||(t[60]=e("span",{class:"font-medium"},"争议原因：",-1)),m(i(s.order.dispute_reason),1)])):u("",!0)])]),s.availableActions.includes("resolve_dispute")?(a(),l("div",fs,[w(B,{onClick:t[2]||(t[2]=r=>S("resolve_dispute")),variant:"outline",size:"sm"},{default:y(()=>[...t[64]||(t[64]=[m(" 解除争议 ",-1)])]),_:1})])):u("",!0)])])])):u("",!0),!o.$page.props.auth.user?.telegram_chat_id&&s.order.status!=="cancelled"&&s.order.status!=="completed"?(a(),l("div",gs,[e("div",ks,[e("div",ps,[t[66]||(t[66]=e("div",{class:"flex items-start gap-3 flex-1"},[e("svg",{class:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.56c-.21 2.27-1.13 7.75-1.6 10.29-.2 1.08-.59 1.44-.97 1.47-.82.07-1.45-.54-2.24-.99-1.24-.71-1.94-1.16-3.14-1.85-1.39-.8-.49-1.24.3-1.96.21-.19 3.85-3.52 3.91-3.82.01-.04.01-.19-.07-.27-.08-.08-.2-.05-.28-.03-.12.03-2.02.13-5.7 3.75-.54.54-1.03.8-1.48.78-.49-.02-1.42-.27-2.11-.5-.85-.28-1.53-.42-1.47-.89.03-.25.37-.51 1.02-.77 4-1.74 6.67-2.89 8.01-3.44 3.81-1.57 4.61-1.84 5.13-1.85.11 0 .37.03.53.18.14.12.18.28.2.45-.01.06-.01.24-.02.38z"})]),e("div",{class:"flex-1"},[e("p",{class:"text-sm font-medium text-blue-800 dark:text-blue-200"},"建议设置 Telegram 接收实时通知"),e("p",{class:"text-xs text-blue-700 dark:text-blue-300 mt-1"}," 连接 Telegram 后，您可以实时收到交易状态更新、对方消息提醒等重要通知，确保不错过任何关键信息。 ")])],-1)),e("div",ys,[w(Me(et),{href:"/notifications/settings",class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors"},{default:y(()=>[...t[65]||(t[65]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.56c-.21 2.27-1.13 7.75-1.6 10.29-.2 1.08-.59 1.44-.97 1.47-.82.07-1.45-.54-2.24-.99-1.24-.71-1.94-1.16-3.14-1.85-1.39-.8-.49-1.24.3-1.96.21-.19 3.85-3.52 3.91-3.82.01-.04.01-.19-.07-.27-.08-.08-.2-.05-.28-.03-.12.03-2.02.13-5.7 3.75-.54.54-1.03.8-1.48.78-.49-.02-1.42-.27-2.11-.5-.85-.28-1.53-.42-1.47-.89.03-.25.37-.51 1.02-.77 4-1.74 6.67-2.89 8.01-3.44 3.81-1.57 4.61-1.84 5.13-1.85.11 0 .37.03.53.18.14.12.18.28.2.45-.01.06-.01.24-.02.38z"})],-1),m(" 立即设置 ",-1)])]),_:1})])])])])):u("",!0),w(Ee,{modelValue:g.value,"onUpdate:modelValue":t[10]||(t[10]=r=>g.value=r),title:"交易详情",subtitle:`订单 #${s.order.order_no}`,position:"bottom",size:"default","icon-color":"blue"},{"header-icon":y(()=>[...t[67]||(t[67]=[e("div",{class:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30"},[e("svg",{class:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})])],-1)])]),default:y(()=>[e("div",ws,[e("div",hs,[e("div",_s,[e("div",Cs,[t[68]||(t[68]=e("svg",{class:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z","clip-rule":"evenodd"})],-1)),e("div",null,[e("p",zs,i(Fe(s.order.escrow_status)),1),e("p",Ms,"当前进度: "+i(ve(s.order.escrow_status))+"%",1)])])]),e("div",null,[t[92]||(t[92]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-slate-100 mb-3"},"交易流程",-1)),e("div",$s,[e("div",js,[t[71]||(t[71]=e("div",{class:"flex flex-col items-center"},[e("div",{class:"w-8 h-8 rounded-full bg-emerald-600 text-white flex items-center justify-center"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])]),e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-slate-600"})],-1)),e("div",Bs,[t[70]||(t[70]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-slate-100"},"订单创建",-1)),e("p",Fs,i(s.order.created_at?T(s.order.created_at):"已完成"),1),s.order.escrow_status==="order_initiated"&&s.availableActions.includes("vendor_confirm")?(a(),l("div",As,[w(B,{onClick:t[3]||(t[3]=r=>S("vendor_confirm")),variant:"primary",size:"md",fullWidth:""},{default:y(()=>[...t[69]||(t[69]=[m(" 确认接单 ",-1)])]),_:1})])):u("",!0)])]),e("div",Ss,[e("div",Ls,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="order_initiated"?"bg-amber-500 animate-pulse":["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-slate-700"])},[["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),l("svg",Vs,[...t[72]||(t[72]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),l("span",Ts,"2"))],2),t[73]||(t[73]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-slate-600"},null,-1))]),e("div",Is,[e("p",{class:x(["text-sm font-medium",["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-600 dark:text-slate-300"])}," 商家确认 ",2),e("p",Us,i(s.order.vendor_confirmed_at?T(s.order.vendor_confirmed_at):"等待商家确认订单"),1)])]),e("div",Es,[e("div",Ps,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="vendor_confirmed"?"bg-amber-500 animate-pulse":["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-slate-700"])},[["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),l("svg",Ds,[...t[74]||(t[74]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),l("span",Ws,"3"))],2),t[75]||(t[75]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-slate-600"},null,-1))]),e("div",Rs,[e("p",{class:x(["text-sm font-medium",["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-600 dark:text-slate-300"])}," 卖家转币到托管 ",2),e("p",qs,i(s.order.seller_paid_at?T(s.order.seller_paid_at):"等待卖家转币"),1),s.order.escrow_status==="vendor_confirmed"&&s.availableActions.includes("mark_seller_paid")?(a(),l("div",Hs,[w(B,{onClick:t[4]||(t[4]=r=>S("mark_seller_paid")),variant:"primary",size:"md",fullWidth:""},{default:y(()=>[...t[76]||(t[76]=[m(" 我已转币 ",-1)])]),_:1})])):u("",!0)])]),e("div",Os,[e("div",Ns,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="seller_paid"?"bg-amber-500 animate-pulse":["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-slate-700"])},[["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),l("svg",Ks,[...t[77]||(t[77]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),l("span",Xs,"4"))],2),t[78]||(t[78]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-slate-600"},null,-1))]),e("div",Gs,[e("p",{class:x(["text-sm font-medium",["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-600 dark:text-slate-300"])}," 托管确认到账 ",2),e("p",Qs,i(s.order.escrow_received_at?T(s.order.escrow_received_at):"系统确认中"),1),s.order.escrow_status==="seller_paid"?(a(),l("div",Zs,[e("div",Js,[w(B,{onClick:t[5]||(t[5]=r=>fe("received")),variant:"success",size:"xs",fullWidth:""},{default:y(()=>[...t[79]||(t[79]=[m(" 模拟已收到 ",-1)])]),_:1}),w(B,{onClick:t[6]||(t[6]=r=>fe("not_received")),variant:"danger",size:"xs",fullWidth:""},{default:y(()=>[...t[80]||(t[80]=[m(" 模拟未收到 ",-1)])]),_:1})]),t[81]||(t[81]=e("p",{class:"text-xs text-amber-600 dark:text-amber-400 text-center"}," 🧪 测试模式 ",-1))])):u("",!0)])]),e("div",Ys,[e("div",er,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="escrow_received"?"bg-amber-500 animate-pulse":["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-slate-700"])},[["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),l("svg",tr,[...t[82]||(t[82]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),l("span",sr,"5"))],2),t[83]||(t[83]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-slate-600"},null,-1))]),e("div",rr,[e("p",{class:x(["text-sm font-medium",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-600 dark:text-slate-300"])}," 买家确认托管到账 ",2),e("p",ar,i(s.order.buyer_confirmed_escrow_at?T(s.order.buyer_confirmed_escrow_at):"等待买家确认"),1),s.order.escrow_status==="escrow_received"&&s.availableActions.includes("confirm_escrow")?(a(),l("div",lr,[w(B,{onClick:t[7]||(t[7]=r=>S("confirm_escrow")),variant:"primary",size:"md",fullWidth:""},{default:y(()=>[...t[84]||(t[84]=[m(" 确认托管到账 ",-1)])]),_:1})])):u("",!0)])]),e("div",or,[e("div",dr,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="buyer_confirmed_escrow"?"bg-amber-500 animate-pulse":["buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-slate-700"])},[["buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),l("svg",ir,[...t[85]||(t[85]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),l("span",nr,"6"))],2),t[86]||(t[86]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-slate-600"},null,-1))]),e("div",ur,[e("p",{class:x(["text-sm font-medium",["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-600 dark:text-slate-300"])}," 买家付款 ",2),e("p",cr,i(s.order.buyer_paid_at?T(s.order.buyer_paid_at):"等待买家付款"),1),s.order.escrow_status==="buyer_confirmed_escrow"&&s.availableActions.includes("mark_buyer_paid")?(a(),l("div",mr,[w(B,{onClick:t[8]||(t[8]=r=>S("mark_buyer_paid")),variant:"primary",size:"md",fullWidth:""},{default:y(()=>[...t[87]||(t[87]=[m(" 我已付款 ",-1)])]),_:1})])):u("",!0)])]),e("div",xr,[e("div",vr,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="buyer_paid"?"bg-amber-500 animate-pulse":["seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-600":"bg-gray-300 dark:bg-slate-700"])},[["seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),l("svg",br,[...t[88]||(t[88]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),l("span",fr,"7"))],2),t[89]||(t[89]=e("div",{class:"w-0.5 h-16 bg-gray-300 dark:bg-slate-600"},null,-1))]),e("div",gr,[e("p",{class:x(["text-sm font-medium",["buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-600 dark:text-slate-300"])}," 卖家确认收款 ",2),e("p",kr,i(s.order.seller_received_at?T(s.order.seller_received_at):"等待卖家确认"),1),s.order.escrow_status==="buyer_paid"&&s.availableActions.includes("mark_seller_received")?(a(),l("div",pr,[w(B,{onClick:t[9]||(t[9]=r=>S("mark_seller_received")),variant:"success",size:"md",fullWidth:""},{default:y(()=>[...t[90]||(t[90]=[m(" 确认收款 ",-1)])]),_:1})])):u("",!0)])]),e("div",yr,[e("div",wr,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="seller_received"?"bg-amber-500 animate-pulse":s.order.escrow_status==="escrow_released"?"bg-emerald-600":"bg-gray-300 dark:bg-slate-700"])},[s.order.escrow_status==="escrow_released"?(a(),l("svg",hr,[...t[91]||(t[91]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),l("span",_r,"8"))],2)]),e("div",Cr,[e("p",{class:x(["text-sm font-medium",["seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-600 dark:text-slate-300"])}," 托管释放 ",2),e("p",zr,i(s.order.escrow_released_at?T(s.order.escrow_released_at):"平台释放币给买家"),1)])])])]),e("div",null,[t[103]||(t[103]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-slate-100 mb-2"},"交易信息",-1)),e("div",Mr,[e("div",null,[t[93]||(t[93]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400"},"订单编号",-1)),e("p",$r,"#"+i(s.order.order_no),1)]),e("div",null,[t[94]||(t[94]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400"},"商家",-1)),e("p",jr,i(s.order.vendor?.name||"加载中..."),1)]),e("div",null,[t[95]||(t[95]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400"},"客户",-1)),e("p",Br,i(s.order.client?.name||"加载中..."),1)]),e("div",null,[t[96]||(t[96]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400"},"买家",-1)),e("p",Fr,i(s.order.buyer?.name||"加载中..."),1)]),e("div",null,[t[97]||(t[97]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400"},"卖家",-1)),e("p",Ar,i(s.order.seller?.name||"加载中..."),1)]),e("div",null,[t[98]||(t[98]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400"},"币种",-1)),e("p",Sr,i(s.order.currency_label||s.order.currency_key||s.order.crypto_currency),1)]),e("div",null,[t[99]||(t[99]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400"},"数量（含交易费）",-1)),e("p",Lr,i(parseFloat(s.order.crypto_amount).toFixed(4))+" "+i(s.order.currency_label||s.order.currency_key||s.order.crypto_currency),1),s.order.fee&&s.order.fee>0?(a(),l("p",Vr," 交易费（商家）: "+i(parseFloat(s.order.fee).toFixed(8))+" "+i(s.order.currency_label||s.order.currency_key||s.order.crypto_currency),1)):u("",!0)]),e("div",null,[t[100]||(t[100]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400"},"单价",-1)),e("p",Tr,"¥"+i(parseFloat(s.order.price).toFixed(2)),1)]),e("div",null,[t[101]||(t[101]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400"},"总金额",-1)),e("p",Ir,"¥"+i(parseFloat(s.order.fiat_amount).toFixed(2)),1)])]),s.order.seller_address?(a(),l("div",Ur,[t[102]||(t[102]=e("span",{class:"text-xs text-gray-500 dark:text-slate-400 block mb-1"},"卖家地址",-1)),e("p",Er,i(s.order.seller_address),1)])):u("",!0)])])])]),_:1},8,["modelValue","subtitle"]),e("div",Pr,[e("div",Dr,[e("div",Wr,[e("div",Rr,[e("div",qr,[t[104]||(t[104]=e("h3",{class:"text-lg font-bold text-gray-900 dark:text-slate-100"},"交易详情",-1)),e("span",{class:x([Re(s.order.escrow_status),"px-3 py-1 text-xs font-semibold rounded-full"])},i(Fe(s.order.escrow_status)),3)]),d.value.escrow_status==="escrow_released"&&s.currentUserId===d.value.client_id?(a(),l("div",Hr,[d.value.has_review?(a(),l("div",Nr,[...t[108]||(t[108]=[e("div",{class:"flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-emerald-600 dark:text-emerald-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})]),e("span",{class:"text-sm font-medium text-emerald-800 dark:text-emerald-200"},"您已评价此交易")],-1)])])):(a(),l("div",Or,[t[107]||(t[107]=e("div",{class:"flex items-center justify-between"},[e("div",{class:"flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})]),e("span",{class:"text-sm font-medium text-amber-800 dark:text-amber-200"},"交易已完成，请评价")])],-1)),w(B,{onClick:t[11]||(t[11]=r=>b.value=!0),variant:"primary",size:"sm",fullWidth:"",class:"mt-2"},{icon:y(()=>[...t[105]||(t[105]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})],-1)])]),default:y(()=>[t[106]||(t[106]=m(" 立即评价商家 ",-1))]),_:1})]))])):u("",!0),e("div",Kr,[e("div",Xr,[t[109]||(t[109]=e("span",null,"交易进度",-1)),e("span",null,i(ve(s.order.escrow_status))+"%",1)]),e("div",Gr,[e("div",{class:"bg-gradient-to-r from-emerald-500 to-emerald-600 h-2 rounded-full",style:ye(`width: ${ve(s.order.escrow_status)}%`)},null,4)])]),e("div",Qr,[e("div",null,[e("div",Zr,[t[111]||(t[111]=e("div",{class:"w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center"},[e("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)),e("div",Jr,[t[110]||(t[110]=e("p",{class:"text-sm font-medium text-gray-900 dark:text-slate-100"},"订单创建",-1)),e("p",Yr,i(s.order.created_at?T(s.order.created_at):"已完成"),1)])])]),e("div",null,[e("div",ea,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="order_initiated"?"bg-amber-500 animate-pulse":["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-slate-700"])},[["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),l("svg",ta,[...t[112]||(t[112]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),l("span",sa,"2"))],2),e("div",ra,[e("p",{class:x(["text-sm font-medium",["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-400 dark:text-slate-500"])}," 商家确认 ",2),e("p",{class:x(["text-xs",["vendor_confirmed","seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-500 dark:text-slate-400":"text-gray-400 dark:text-slate-600"])},i(s.order.vendor_confirmed_at?T(s.order.vendor_confirmed_at):s.order.escrow_status==="order_initiated"?"等待中...":"待完成"),3)])]),s.order.escrow_status==="order_initiated"&&s.availableActions.includes("vendor_confirm")?(a(),l("div",aa,[w(B,{onClick:t[12]||(t[12]=r=>S("vendor_confirm")),variant:"primary",size:"sm",fullWidth:""},{default:y(()=>[...t[113]||(t[113]=[m(" 确认接单 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",la,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="vendor_confirmed"?"bg-amber-500 animate-pulse":["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-slate-700"])},[["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),l("svg",oa,[...t[114]||(t[114]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),l("span",da,"3"))],2),e("div",ia,[e("p",{class:x(["text-sm font-medium",["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-400 dark:text-slate-500"])}," 卖家转币到托管 ",2),e("p",{class:x(["text-xs",["seller_paid","escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-500 dark:text-slate-400":"text-gray-400 dark:text-slate-600"])},i(s.order.seller_paid_at?T(s.order.seller_paid_at):s.order.escrow_status==="vendor_confirmed"?"等待中...":"待完成"),3),s.order.escrow_tx_hash?(a(),l("p",na," TX: "+i(s.order.escrow_tx_hash),1)):u("",!0)])]),s.order.escrow_status==="vendor_confirmed"&&s.availableActions.includes("mark_seller_paid")?(a(),l("div",ua,[w(B,{onClick:t[13]||(t[13]=r=>S("mark_seller_paid")),variant:"primary",size:"sm",fullWidth:""},{default:y(()=>[...t[115]||(t[115]=[m(" 我已转币到托管 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",ca,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="seller_paid"?"bg-amber-500 animate-pulse":["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-slate-700"])},[["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),l("svg",ma,[...t[116]||(t[116]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),l("span",xa,"4"))],2),e("div",va,[e("p",{class:x(["text-sm font-medium",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-400 dark:text-slate-500"])}," 托管确认到账 ",2),e("p",{class:x(["text-xs",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-500 dark:text-slate-400":"text-gray-400 dark:text-slate-600"])},i(s.order.escrow_received_at?T(s.order.escrow_received_at):s.order.escrow_status==="seller_paid"?"系统确认中...":"待完成"),3)])]),s.order.escrow_status==="seller_paid"?(a(),l("div",ba,[e("div",fa,[w(B,{onClick:t[14]||(t[14]=r=>fe("received")),variant:"success",size:"sm",fullWidth:""},{default:y(()=>[...t[117]||(t[117]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),m(" 模拟已收到 ",-1)])]),_:1}),w(B,{onClick:t[15]||(t[15]=r=>fe("not_received")),variant:"danger",size:"sm",fullWidth:""},{default:y(()=>[...t[118]||(t[118]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),m(" 模拟未收到 ",-1)])]),_:1})]),t[119]||(t[119]=e("p",{class:"text-xs text-amber-600 dark:text-amber-400 text-center"}," 🧪 测试模式：模拟区块链确认 ",-1))])):u("",!0)]),e("div",null,[e("div",ga,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="escrow_received"?"bg-amber-500 animate-pulse":["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-slate-700"])},[["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),l("svg",ka,[...t[120]||(t[120]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),l("span",pa,"5"))],2),e("div",ya,[e("p",{class:x(["text-sm font-medium",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-400 dark:text-slate-500"])}," 买家确认托管到账 ",2),e("p",{class:x(["text-xs",["escrow_received","buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-500 dark:text-slate-400":"text-gray-400 dark:text-slate-600"])},i(s.order.buyer_confirmed_escrow_at?T(s.order.buyer_confirmed_escrow_at):s.order.escrow_status==="escrow_received"?"等待确认...":"待完成"),3)])]),s.order.escrow_status==="escrow_received"&&s.availableActions.includes("confirm_escrow")?(a(),l("div",wa,[w(B,{onClick:t[16]||(t[16]=r=>S("confirm_escrow")),variant:"primary",size:"sm",fullWidth:""},{default:y(()=>[...t[121]||(t[121]=[m(" 确认托管到账 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",ha,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="buyer_confirmed_escrow"?"bg-amber-500 animate-pulse":["buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-slate-700"])},[["buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),l("svg",_a,[...t[122]||(t[122]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),l("span",Ca,"6"))],2),e("div",za,[e("p",{class:x(["text-sm font-medium",["buyer_confirmed_escrow","buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-400 dark:text-slate-500"])}," 买家付款 ",2),e("p",Ma,i(s.order.buyer_paid_at?T(s.order.buyer_paid_at):s.order.escrow_status==="buyer_confirmed_escrow"?"等待中...":"待完成"),1)])]),s.order.escrow_status==="buyer_confirmed_escrow"&&s.availableActions.includes("mark_buyer_paid")?(a(),l("div",$a,[w(B,{onClick:t[17]||(t[17]=r=>S("mark_buyer_paid")),variant:"primary",size:"sm",fullWidth:""},{default:y(()=>[...t[123]||(t[123]=[m(" 我已付款 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",ja,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="buyer_paid"?"bg-amber-500 animate-pulse":["seller_received","escrow_released"].includes(s.order.escrow_status)?"bg-emerald-500":"bg-gray-300 dark:bg-slate-700"])},[["seller_received","escrow_released"].includes(s.order.escrow_status)?(a(),l("svg",Ba,[...t[124]||(t[124]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),l("span",Fa,"7"))],2),e("div",Aa,[e("p",{class:x(["text-sm font-medium",["buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-400 dark:text-slate-500"])}," 卖家确认收款 ",2),e("p",{class:x(["text-xs",["buyer_paid","seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-500 dark:text-slate-400":"text-gray-400 dark:text-slate-600"])},i(s.order.seller_received_at?T(s.order.seller_received_at):s.order.escrow_status==="buyer_paid"?"等待中...":"待完成"),3)])]),s.order.escrow_status==="buyer_paid"&&s.availableActions.includes("mark_seller_received")?(a(),l("div",Sa,[w(B,{onClick:t[18]||(t[18]=r=>S("mark_seller_received")),variant:"success",size:"sm",fullWidth:""},{default:y(()=>[...t[125]||(t[125]=[m(" 确认收款 ",-1)])]),_:1})])):u("",!0)]),e("div",null,[e("div",La,[e("div",{class:x(["w-8 h-8 rounded-full flex items-center justify-center",s.order.escrow_status==="seller_received"?"bg-amber-500 animate-pulse":s.order.escrow_status==="escrow_released"?"bg-emerald-500":"bg-gray-300 dark:bg-slate-700"])},[s.order.escrow_status==="escrow_released"?(a(),l("svg",Va,[...t[126]||(t[126]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),l("span",Ta,"8"))],2),e("div",Ia,[e("p",{class:x(["text-sm font-medium",["seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-900 dark:text-slate-100":"text-gray-400 dark:text-slate-500"])}," 托管释放 ",2),e("p",{class:x(["text-xs",["seller_received","escrow_released"].includes(s.order.escrow_status)?"text-gray-500 dark:text-slate-400":"text-gray-400 dark:text-slate-600"])},i(s.order.escrow_released_at?T(s.order.escrow_released_at):s.order.escrow_status==="seller_received"?"处理中...":"待完成"),3)])])])]),e("div",Ua,[e("div",Ea,[t[127]||(t[127]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"订单编号",-1)),e("span",Pa,"#"+i(s.order.order_no),1)]),e("div",Da,[t[128]||(t[128]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"商家",-1)),e("span",Wa,i(s.order.vendor?.name||"加载中..."),1)]),e("div",Ra,[t[129]||(t[129]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"客户",-1)),e("span",qa,i(s.order.client?.name||"加载中..."),1)]),e("div",Ha,[t[130]||(t[130]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"买家",-1)),e("span",Oa,i(s.order.buyer?.name||"加载中..."),1)]),e("div",Na,[t[131]||(t[131]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"卖家",-1)),e("span",Ka,i(s.order.seller?.name||"加载中..."),1)]),e("div",Xa,[t[132]||(t[132]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"数量（含交易费）",-1)),e("span",Ga,i(parseFloat(s.order.crypto_amount).toFixed(4))+" "+i(s.order.currency_label||s.order.currency_key||s.order.crypto_currency),1)]),s.order.fee&&s.order.fee>0?(a(),l("div",Qa,[t[133]||(t[133]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"交易费（商家）",-1)),e("span",Za,i(parseFloat(s.order.fee).toFixed(8))+" "+i(s.order.currency_label||s.order.currency_key||s.order.crypto_currency),1)])):u("",!0),e("div",Ja,[t[134]||(t[134]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"单价",-1)),e("span",Ya,"¥"+i(parseFloat(s.order.price).toFixed(2)),1)]),e("div",el,[t[135]||(t[135]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"总金额",-1)),e("span",tl,"¥"+i(parseFloat(s.order.fiat_amount).toFixed(2)),1)]),s.order.seller_address?(a(),l("div",sl,[t[136]||(t[136]=e("span",{class:"text-sm text-gray-500 dark:text-slate-400"},"卖家地址",-1)),e("span",rl,i(s.order.seller_address),1)])):u("",!0)])])]),e("div",al,[e("div",ll,[e("div",ol,[e("div",dl,[e("div",il,[e("div",nl,[e("div",ul,[(a(!0),l(H,null,Q(E.value,(r,p)=>(a(),l("a",{key:r.id,href:`/trader/profile/${r.id}`,target:"_blank",class:"relative hover:opacity-80 transition-opacity cursor-pointer",style:ye(`z-index: ${E.value.length-p}`)},[r.profile_photo_url?(a(),l("img",{key:0,src:r.profile_photo_url,alt:r.name,class:"h-10 w-10 rounded-full object-cover ring-2 ring-white dark:ring-slate-900"},null,8,ml)):(a(),l("div",xl,[e("span",vl,i(r.name?.[0]?.toUpperCase()||"U"),1)])),r.is_online?(a(),l("div",bl)):u("",!0)],12,cl))),128))]),e("div",fl,[e("div",gl,[e("p",kl,[m(" 订单 #"+i(s.order.order_no)+" 聊天室 ",1),e("span",pl,"("+i(E.value.length)+"人)",1)])]),e("p",yl,[(a(!0),l(H,null,Q(E.value,(r,p)=>(a(),l("span",{key:r.id},[e("span",{class:x([r.is_online?"text-emerald-600 dark:text-emerald-400":"text-gray-400 dark:text-gray-500",r.is_admin?"font-medium":""])},i(r.name),3),p<E.value.length-1?(a(),l("span",wl," · ")):u("",!0)]))),128))])])]),t[137]||(t[137]=e("div",{class:"flex items-center gap-2"},null,-1))])])]),e("div",{ref_key:"messageContainer",ref:U,class:"flex-1 overflow-y-auto p-6 space-y-4"},[e("div",hl,[e("div",_l,i(new Date(s.order.created_at).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})),1),t[138]||(t[138]=e("div",{class:"px-3 py-1 bg-gray-100 dark:bg-slate-800 rounded-full text-xs text-gray-500 dark:text-slate-400"}," 订单已创建，等待商家确认 ",-1))]),t[146]||(t[146]=e("div",{class:"mb-4 mx-4"},[e("div",{class:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-3 border border-amber-200 dark:border-amber-800"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("div",{class:"text-xs"},[e("p",{class:"font-medium text-amber-700 dark:text-amber-300 mb-1"},"安全提醒"),e("p",{class:"text-amber-600 dark:text-amber-400"},"请勿相信任何平台外的交易邀请，谨防诈骗。任何平台以外的交流都无法作为争议材料。")])])])],-1)),s.order.ad_snapshot?.welcome_message?(a(),l("div",Cl,[e("div",zl,[t[142]||(t[142]=e("div",{class:"flex items-center gap-2 mb-2"},[e("svg",{class:"w-4 h-4 text-blue-600 dark:text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 3a1 1 0 00-1.447-.894L8.763 6H5a3 3 0 000 6h.28l1.771 5.316A1 1 0 008 18h1a1 1 0 001-1v-4.382l6.553 3.276A1 1 0 0018 15V3z","clip-rule":"evenodd"})]),e("span",{class:"text-xs font-medium text-blue-700 dark:text-blue-300"},"商家公告")],-1)),e("p",Ml,i(s.order.ad_snapshot.welcome_message),1),s.order.vendor?.response_time?(a(),l("div",$l,[e("div",jl,[t[141]||(t[141]=e("svg",{class:"w-3.5 h-3.5 text-blue-500 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",Bl,[t[139]||(t[139]=m(" 该商家的响应时间是 ",-1)),e("span",Fl,i(s.order.vendor.response_time)+" 分钟",1),t[140]||(t[140]=m("，请在该时间内等待商家加入聊天室。 ",-1))])])])):u("",!0)])])):u("",!0),s.order.vendor?.response_time&&!s.order.ad_snapshot?.welcome_message?(a(),l("div",Al,[e("div",Sl,[e("div",Ll,[t[145]||(t[145]=e("svg",{class:"w-3.5 h-3.5 text-blue-500 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",Vl,[t[143]||(t[143]=m(" 该商家的响应时间是 ",-1)),e("span",Tl,i(s.order.vendor.response_time)+" 分钟",1),t[144]||(t[144]=m("，请在该时间内等待商家加入聊天室。 ",-1))])])])])):u("",!0),(a(!0),l(H,null,Q(v.value,r=>(a(),l("div",{key:r.id,class:x(["flex",r.type==="system"?"justify-center":"gap-3",r.type!=="system"&&r.user?.id===o.$page.props.auth.user?.id?"justify-end":""])},[r.type==="system"?(a(),l("div",Il,[e("div",Ul,i(T(r.created_at)),1),e("div",{class:x(["px-3 py-1 rounded-full text-xs max-w-md",r.is_temporary?"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400":"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400"])},[r.user?(a(),l("span",El,i(r.user.name),1)):u("",!0),m(" "+i(r.message||r.content),1)],2)])):r.user?.id!==o.$page.props.auth.user?.id?(a(),l(H,{key:1},[e("a",{href:`/trader/profile/${r.user.id}`,target:"_blank",class:"h-8 w-8 rounded-full flex-shrink-0 hover:opacity-80 transition-opacity cursor-pointer"},[r.user.profile_photo_url?(a(),l("img",{key:0,src:r.user.profile_photo_url,alt:r.user.name,class:"h-8 w-8 rounded-full object-cover border border-gray-200 dark:border-slate-700"},null,8,Dl)):(a(),l("div",Wl,[e("span",Rl,i(r.user.name.charAt(0)),1)]))],8,Pl),e("div",ql,[e("p",Hl,[m(i(r.user.name)+" ",1),r.type==="admin"?(a(),l("span",Ol,"(Admin)")):u("",!0)]),e("div",Nl,[r.attachment?(a(),l("div",Kl,[w(pe,{attachment:r.attachment,variant:"default","thumbnail-size":"md"},null,8,["attachment"])])):u("",!0),r.message?(a(),l("p",Xl,i(r.message),1)):u("",!0)]),e("p",Gl,i(T(r.created_at)),1)])],64)):(a(),l(H,{key:2},[e("div",Ql,[e("p",Zl,[m(i(r.user.name)+" ",1),r.type==="admin"?(a(),l("span",Jl,"(Admin)")):u("",!0)]),e("div",Yl,[r.attachment?(a(),l("div",eo,[w(pe,{attachment:r.attachment,variant:"primary","thumbnail-size":"md"},null,8,["attachment"])])):u("",!0),r.message?(a(),l("p",to,i(r.message),1)):u("",!0)]),e("p",so,i(T(r.created_at)),1)]),o.$page.props.auth.user?.profile_photo_url?(a(),l("img",{key:0,src:o.$page.props.auth.user.profile_photo_url,alt:o.$page.props.auth.user.name,class:"h-8 w-8 rounded-full object-cover border border-gray-200 dark:border-slate-700 flex-shrink-0"},null,8,ro)):(a(),l("div",ao,[e("span",lo,i(o.$page.props.auth.user?.name?.charAt(0).toUpperCase()||"U"),1)]))],64))],2))),128))],512),e("div",oo,[M.value||A.value?(a(),l("div",io,[A.value?(a(),l("div",no,[...t[147]||(t[147]=[e("div",{class:"animate-spin h-8 w-8 border-4 border-blue-600 border-t-transparent rounded-full"},null,-1),e("div",null,[e("p",{class:"text-sm font-medium text-gray-900 dark:text-slate-200"},"正在压缩图片..."),e("p",{class:"text-xs text-gray-500 dark:text-slate-400"},"优化图片大小以快速上传")],-1)])])):M.value?(a(),l("div",uo,[M.value.type.startsWith("image/")?(a(),l("img",{key:0,src:D.value,alt:M.value.name,class:"max-h-32 rounded-lg"},null,8,co)):M.value.type==="application/pdf"?(a(),l("div",mo,[...t[148]||(t[148]=[e("svg",{class:"w-8 h-8 text-red-600 dark:text-red-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-5L9 2H4z","clip-rule":"evenodd"})],-1)])])):u("",!0),e("div",xo,[e("p",vo,i(M.value.name),1),e("p",bo,i(Le(M.value.size)),1)]),e("button",{onClick:he,type:"button",class:"p-1 rounded hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors"},[...t[149]||(t[149]=[e("svg",{class:"w-4 h-4 text-gray-500 dark:text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):u("",!0)])):u("",!0),e("form",{onSubmit:oe(Te,["prevent"]),class:"flex gap-2"},[e("input",{ref_key:"fileInput",ref:K,type:"file",onChange:Ve,accept:".pdf,image/*","data-max-size":"2097152",class:"hidden"},null,544),e("button",{type:"button",onClick:t[19]||(t[19]=r=>!G.value&&!A.value&&o.$refs.fileInput.click()),disabled:G.value||A.value,class:"p-2 rounded-lg text-gray-500 hover:text-gray-700 dark:text-slate-400 dark:hover:text-slate-200 hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent"},[...t[150]||(t[150]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)])],8,fo),N(e("input",{"onUpdate:modelValue":t[20]||(t[20]=r=>C.value=r),type:"text",placeholder:G.value?"交易已结束，无法发送消息":"输入消息...",class:"flex-1 px-4 py-2 bg-gray-100 dark:bg-slate-800 border-0 rounded-lg text-base md:text-sm text-gray-900 dark:text-slate-200 placeholder-gray-500 dark:placeholder-slate-400 focus:ring-2 focus:ring-emerald-500 disabled:opacity-50",disabled:!$.value||G.value},null,8,go),[[le,C.value]]),e("button",{type:"submit",disabled:!C.value.trim()&&!M.value||!$.value||h.value||G.value,class:"px-4 py-2 bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg font-medium text-sm transition-colors flex items-center gap-2"},[h.value?(a(),l("svg",po,[...t[151]||(t[151]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(a(),l("span",yo,"发送"))],8,ko)],32),s.availableActions.length>0&&s.order.status!=="completed"&&s.order.status!=="cancelled"&&s.order.escrow_status!=="escrow_released"||s.order.status!=="cancelled"&&s.order.status!=="completed"?(a(),l("div",wo,[e("div",ho,[(a(!0),l(H,null,Q(s.availableActions,r=>(a(),l(H,{key:r},[r==="vendor_confirm"?(a(),l("button",{key:0,onClick:t[21]||(t[21]=p=>S("vendor_confirm")),class:"px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-medium rounded-full transition-colors cursor-pointer"}," 确认订单 ")):u("",!0),r==="mark_seller_paid"?(a(),l("button",{key:1,onClick:t[22]||(t[22]=p=>S("mark_seller_paid")),class:"px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-medium rounded-full transition-colors cursor-pointer"}," 我已转币 ")):u("",!0),r==="confirm_escrow"?(a(),l("button",{key:2,onClick:t[23]||(t[23]=p=>S("confirm_escrow")),class:"px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-medium rounded-full transition-colors cursor-pointer"}," 确认托管 ")):u("",!0),r==="mark_buyer_paid"?(a(),l("button",{key:3,onClick:t[24]||(t[24]=p=>S("mark_buyer_paid")),class:"px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-medium rounded-full transition-colors cursor-pointer"}," 我已付款 ")):u("",!0),r==="mark_seller_received"?(a(),l("button",{key:4,onClick:t[25]||(t[25]=p=>S("mark_seller_received")),class:"px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-xs font-medium rounded-full transition-colors cursor-pointer"}," 确认收款 ")):u("",!0),r==="cancel"?(a(),l("button",{key:5,onClick:t[26]||(t[26]=p=>S("cancel")),class:"px-3 py-1.5 bg-gray-600 hover:bg-gray-700 text-white text-xs font-medium rounded-full transition-colors cursor-pointer"}," 取消订单 ")):u("",!0)],64))),128)),s.availableActions.includes("create_dispute")?(a(),l("button",{key:0,onClick:t[27]||(t[27]=r=>S("create_dispute")),class:"px-3 py-1.5 bg-amber-600 hover:bg-amber-700 text-white text-xs font-medium rounded-full transition-colors cursor-pointer"}," 发起争议 ")):u("",!0),s.availableActions.includes("resolve_dispute")?(a(),l("button",{key:1,onClick:t[28]||(t[28]=r=>S("resolve_dispute")),class:"px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-xs font-medium rounded-full transition-colors cursor-pointer"}," 解除争议 ")):u("",!0)]),s.order.status!=="cancelled"&&s.order.status!=="completed"?(a(),l("a",{key:0,href:"/notifications/settings",target:"_blank",class:x(["inline-flex items-center gap-1 px-3 py-1 text-xs rounded-full transition-colors cursor-pointer",o.$page.props.auth.user?.telegram_chat_id?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 hover:bg-emerald-200 dark:hover:bg-emerald-900/50":"bg-blue-500 hover:bg-blue-600 text-white"])},[o.$page.props.auth.user?.telegram_chat_id?(a(),l("svg",_o,[...t[152]||(t[152]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),l("svg",Co,[...t[153]||(t[153]=[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.56c-.21 2.27-1.13 7.75-1.6 10.29-.2 1.08-.59 1.44-.97 1.47-.82.07-1.45-.54-2.24-.99-1.24-.71-1.94-1.16-3.14-1.85-1.39-.8-.49-1.24.3-1.96.21-.19 3.85-3.52 3.91-3.82.01-.04.01-.19-.07-.27-.08-.08-.2-.05-.28-.03-.12.03-2.02.13-5.7 3.75-.54.54-1.03.8-1.48.78-.49-.02-1.42-.27-2.11-.5-.85-.28-1.53-.42-1.47-.89.03-.25.37-.51 1.02-.77 4-1.74 6.67-2.89 8.01-3.44 3.81-1.57 4.61-1.84 5.13-1.85.11 0 .37.03.53.18.14.12.18.28.2.45-.01.06-.01.24-.02.38z"},null,-1)])])),m(" "+i(o.$page.props.auth.user?.telegram_chat_id?"已开启通知":"设置实时通知"),1)],2)):u("",!0)])):u("",!0),e("div",zo,[e("div",Mo,[e("div",$o,[e("div",{class:x([Se(s.order.escrow_status),"w-2 h-2 rounded-full animate-pulse"])},null,2),e("span",jo,i(Ae(s.order.escrow_status)),1)]),e("div",Bo,[e("span",null,"订单 #"+i(s.order.trade_id),1),e("span",null,i(s.order.crypto_amount)+" "+i(s.order.currency_label||s.order.currency_key),1),e("span",Fo,"¥"+i(s.order.fiat_amount),1)])])])])]),e("div",Ao,[s.order.ad_snapshot?.vendor_toc?(a(),l("div",So,[t[154]||(t[154]=e("div",{class:"flex items-center gap-2 mb-3"},[e("svg",{class:"w-5 h-5 text-purple-600 dark:text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),e("h3",{class:"text-sm font-bold text-gray-900 dark:text-slate-100"},"交易条款")],-1)),e("div",Lo,[e("p",Vo,i(s.order.ad_snapshot?.vendor_toc||"无交易条款"),1)]),t[155]||(t[155]=e("div",{class:"mt-3 p-2 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("p",{class:"text-xs text-amber-700 dark:text-amber-300"}," 请仔细阅读并遵守以上交易条款，违反条款可能导致交易取消 ")])],-1))])):u("",!0)])])]),e("div",To,[d.value.escrow_status==="escrow_released"&&s.currentUserId===d.value.client_id&&!d.value.has_review?(a(),l("div",Io,[e("div",Uo,[t[157]||(t[157]=e("div",{class:"flex items-center gap-2 flex-1"},[e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})]),e("div",null,[e("p",{class:"text-sm font-medium text-amber-800 dark:text-amber-200"},"交易已完成"),e("p",{class:"text-xs text-amber-700 dark:text-amber-300"},"请对商家进行评价")])],-1)),w(B,{onClick:t[29]||(t[29]=r=>b.value=!0),variant:"primary",size:"sm"},{default:y(()=>[...t[156]||(t[156]=[m(" 立即评价 ",-1)])]),_:1})])])):u("",!0),e("div",{ref_key:"mobileMessageContainer",ref:P,class:"flex-1 overflow-y-auto overscroll-contain bg-white dark:bg-slate-950"},[!$.value&&L.value?(a(),l("div",Eo,[...t[158]||(t[158]=[e("div",{class:"flex items-center justify-center gap-2"},[e("svg",{class:"animate-spin h-4 w-4 text-amber-600 dark:text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),e("span",{class:"text-xs text-amber-700 dark:text-amber-300"},"重新连接中...")],-1)])])):u("",!0),e("div",Po,[e("div",Do,[e("div",Wo,i(new Date(s.order.created_at).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})),1),t[159]||(t[159]=e("div",{class:"px-3 py-1 bg-gray-100 dark:bg-slate-800 rounded-full text-xs text-gray-500 dark:text-slate-400"}," 订单已创建，等待商家确认 ",-1))]),t[167]||(t[167]=e("div",{class:"mb-4 mx-4"},[e("div",{class:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-3 border border-amber-200 dark:border-amber-800"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("div",{class:"text-xs"},[e("p",{class:"font-medium text-amber-700 dark:text-amber-300 mb-1"},"安全提醒"),e("p",{class:"text-amber-600 dark:text-amber-400"},"请勿相信任何平台外的交易邀请，谨防诈骗。任何平台以外的交流都无法作为争议材料。")])])])],-1)),s.order.ad_snapshot?.welcome_message?(a(),l("div",Ro,[e("div",qo,[t[163]||(t[163]=e("div",{class:"flex items-center gap-2 mb-2"},[e("svg",{class:"w-4 h-4 text-blue-600 dark:text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 3a1 1 0 00-1.447-.894L8.763 6H5a3 3 0 000 6h.28l1.771 5.316A1 1 0 008 18h1a1 1 0 001-1v-4.382l6.553 3.276A1 1 0 0018 15V3z","clip-rule":"evenodd"})]),e("span",{class:"text-xs font-medium text-blue-700 dark:text-blue-300"},"商家公告")],-1)),e("p",Ho,i(s.order.ad_snapshot.welcome_message),1),s.order.vendor?.response_time?(a(),l("div",Oo,[e("div",No,[t[162]||(t[162]=e("svg",{class:"w-3.5 h-3.5 text-blue-500 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",Ko,[t[160]||(t[160]=m(" 该商家的响应时间是 ",-1)),e("span",Xo,i(s.order.vendor.response_time)+" 分钟",1),t[161]||(t[161]=m("，请在该时间内等待商家加入聊天室。 ",-1))])])])):u("",!0)])])):u("",!0),s.order.vendor?.response_time&&!s.order.ad_snapshot?.welcome_message?(a(),l("div",Go,[e("div",Qo,[e("div",Zo,[t[166]||(t[166]=e("svg",{class:"w-3.5 h-3.5 text-blue-500 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",Jo,[t[164]||(t[164]=m(" 该商家的响应时间是 ",-1)),e("span",Yo,i(s.order.vendor.response_time)+" 分钟",1),t[165]||(t[165]=m("，请在该时间内等待商家加入聊天室。 ",-1))])])])])):u("",!0),(a(!0),l(H,null,Q(v.value,r=>(a(),l("div",{key:r.id,class:x(["flex",r.type==="system"?"justify-center":"gap-2",r.type!=="system"&&r.user?.id===o.$page.props.auth.user?.id?"justify-end":""])},[r.type==="system"?(a(),l("div",ed,[e("div",td,i(T(r.created_at)),1),e("div",{class:x(["px-3 py-1 rounded-full text-xs",r.is_temporary?"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400":"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400"])},[r.user?(a(),l("span",sd,i(r.user.name),1)):u("",!0),m(" "+i(r.message||r.content),1)],2)])):r.user?.id!==o.$page.props.auth.user?.id?(a(),l(H,{key:1},[e("a",{href:`/trader/profile/${r.user.id}`,target:"_blank",class:"h-7 w-7 rounded-full flex-shrink-0 hover:opacity-80 transition-opacity cursor-pointer"},[r.user.profile_photo_url?(a(),l("img",{key:0,src:r.user.profile_photo_url,alt:r.user.name,class:"h-7 w-7 rounded-full object-cover border border-gray-200 dark:border-slate-700"},null,8,ad)):(a(),l("div",ld,[e("span",od,i(r.user.name.charAt(0)),1)]))],8,rd),e("div",dd,[e("p",id,[m(i(r.user.name)+" ",1),r.type==="admin"?(a(),l("span",nd,"(Admin)")):u("",!0)]),e("div",ud,[r.attachment?(a(),l("div",cd,[w(pe,{attachment:r.attachment,variant:"default","thumbnail-size":"sm"},null,8,["attachment"])])):u("",!0),r.message?(a(),l("p",md,i(r.message),1)):u("",!0)]),e("p",xd,i(T(r.created_at)),1)])],64)):(a(),l(H,{key:2},[e("div",vd,[e("p",bd,[m(i(r.user.name)+" ",1),r.type==="admin"?(a(),l("span",fd,"(Admin)")):u("",!0)]),e("div",gd,[r.attachment?(a(),l("div",kd,[w(pe,{attachment:r.attachment,variant:"primary","thumbnail-size":"sm"},null,8,["attachment"])])):u("",!0),r.message?(a(),l("p",pd,i(r.message),1)):u("",!0)]),e("p",yd,i(T(r.created_at)),1)]),o.$page.props.auth.user?.profile_photo_url?(a(),l("img",{key:0,src:o.$page.props.auth.user.profile_photo_url,alt:o.$page.props.auth.user.name,class:"h-7 w-7 rounded-full object-cover border border-gray-200 dark:border-slate-700 flex-shrink-0"},null,8,wd)):(a(),l("div",hd,[e("span",_d,i(o.$page.props.auth.user?.name?.charAt(0).toUpperCase()||"U"),1)]))],64))],2))),128))])],512),e("div",Cd,[e("div",zd,[M.value||A.value?(a(),l("div",Md,[A.value?(a(),l("div",$d,[...t[168]||(t[168]=[e("div",{class:"flex-shrink-0"},[e("div",{class:"animate-spin h-12 w-12 border-4 border-blue-600 border-t-transparent rounded-full"})],-1),e("div",{class:"flex-1 min-w-0"},[e("p",{class:"text-sm font-medium text-gray-900 dark:text-slate-200"},"正在压缩图片..."),e("p",{class:"text-xs text-gray-500 dark:text-slate-400"},"优化中")],-1)])])):M.value?(a(),l("div",jd,[e("div",Bd,[D.value&&M.value.type.startsWith("image/")?(a(),l("img",{key:0,src:D.value,class:"w-12 h-12 object-cover rounded-lg border",alt:"预览"},null,8,Fd)):(a(),l("div",Ad,[...t[169]||(t[169]=[e("svg",{class:"w-6 h-6 text-gray-500 dark:text-slate-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-5L9 2H4z","clip-rule":"evenodd"})],-1)])]))]),e("div",Sd,[e("p",Ld,i(M.value.name),1),e("p",Vd,i(Le(M.value.size)),1)]),e("button",{onClick:he,type:"button",class:"flex-shrink-0 p-1 text-gray-400 hover:text-gray-600 dark:hover:text-slate-300 transition-colors"},[...t[170]||(t[170]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):u("",!0)])):u("",!0),e("form",{onSubmit:oe(Te,["prevent"]),class:"flex gap-2"},[e("input",{ref_key:"mobileFileInput",ref:k,type:"file",onChange:Ve,accept:".pdf,image/*","data-max-size":"2097152",class:"hidden"},null,544),e("button",{type:"button",onClick:t[30]||(t[30]=r=>!G.value&&!A.value&&o.$refs.mobileFileInput.click()),disabled:G.value||A.value,class:"p-2 rounded-lg text-gray-500 hover:text-gray-700 dark:text-slate-400 dark:hover:text-slate-200 hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent"},[...t[171]||(t[171]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)])],8,Td),N(e("input",{"onUpdate:modelValue":t[31]||(t[31]=r=>C.value=r),type:"text",placeholder:G.value?"交易已结束，无法发送消息":"输入消息...",class:"flex-1 px-3 py-2 bg-gray-100 dark:bg-slate-800 border-0 rounded-lg text-base text-gray-900 dark:text-slate-200 placeholder-gray-500 dark:placeholder-slate-400 disabled:opacity-50",disabled:!$.value||G.value},null,8,Id),[[le,C.value]]),e("button",{type:"submit",disabled:!C.value.trim()&&!M.value||!$.value||h.value||G.value,class:"px-4 py-2 bg-emerald-600 disabled:bg-gray-400 text-white rounded-lg font-medium text-sm transition-colors flex items-center gap-2"},[h.value?(a(),l("svg",Ed,[...t[172]||(t[172]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(a(),l("span",Pd,"发送"))],8,Ud)],32),s.availableActions.length>0&&s.order.status!=="completed"&&s.order.status!=="cancelled"&&s.order.escrow_status!=="escrow_released"||s.order.status!=="cancelled"&&s.order.status!=="completed"?(a(),l("div",Dd,[e("div",Wd,[(a(!0),l(H,null,Q(s.availableActions,r=>(a(),l(H,{key:r},[r==="vendor_confirm"?(a(),l("button",{key:0,onClick:t[32]||(t[32]=p=>S("vendor_confirm")),class:"px-3 py-1.5 bg-emerald-600 text-white text-xs font-medium rounded-full whitespace-nowrap cursor-pointer"}," 确认订单 ")):u("",!0),r==="mark_seller_paid"?(a(),l("button",{key:1,onClick:t[33]||(t[33]=p=>S("mark_seller_paid")),class:"px-3 py-1.5 bg-emerald-600 text-white text-xs font-medium rounded-full whitespace-nowrap cursor-pointer"}," 我已转币 ")):u("",!0),r==="confirm_escrow"?(a(),l("button",{key:2,onClick:t[34]||(t[34]=p=>S("confirm_escrow")),class:"px-3 py-1.5 bg-emerald-600 text-white text-xs font-medium rounded-full whitespace-nowrap cursor-pointer"}," 确认托管 ")):u("",!0),r==="mark_buyer_paid"?(a(),l("button",{key:3,onClick:t[35]||(t[35]=p=>S("mark_buyer_paid")),class:"px-3 py-1.5 bg-emerald-600 text-white text-xs font-medium rounded-full whitespace-nowrap cursor-pointer"}," 我已付款 ")):u("",!0),r==="mark_seller_received"?(a(),l("button",{key:4,onClick:t[36]||(t[36]=p=>S("mark_seller_received")),class:"px-3 py-1.5 bg-green-600 text-white text-xs font-medium rounded-full whitespace-nowrap cursor-pointer"}," 确认收款 ")):u("",!0),r==="cancel"?(a(),l("button",{key:5,onClick:t[37]||(t[37]=p=>S("cancel")),class:"px-3 py-1.5 bg-gray-600 text-white text-xs font-medium rounded-full whitespace-nowrap cursor-pointer"}," 取消 ")):u("",!0)],64))),128)),s.availableActions.includes("create_dispute")?(a(),l("button",{key:0,onClick:t[38]||(t[38]=r=>S("create_dispute")),class:"px-3 py-1.5 bg-amber-600 text-white text-xs font-medium rounded-full whitespace-nowrap cursor-pointer"}," 发起争议 ")):u("",!0),s.availableActions.includes("resolve_dispute")?(a(),l("button",{key:1,onClick:t[39]||(t[39]=r=>S("resolve_dispute")),class:"px-3 py-1.5 bg-green-600 text-white text-xs font-medium rounded-full whitespace-nowrap cursor-pointer"}," 解除争议 ")):u("",!0)]),s.order.status!=="cancelled"&&s.order.status!=="completed"?(a(),l("a",{key:0,href:"/notifications/settings",target:"_blank",class:x(["px-3 py-1.5 rounded-full inline-flex items-center justify-center cursor-pointer",o.$page.props.auth.user?.telegram_chat_id?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"bg-blue-500 text-white"]),title:o.$page.props.auth.user?.telegram_chat_id?"Telegram 通知已开启":"设置 Telegram 通知"},[...t[173]||(t[173]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.56c-.21 2.27-1.13 7.75-1.6 10.29-.2 1.08-.59 1.44-.97 1.47-.82.07-1.45-.54-2.24-.99-1.24-.71-1.94-1.16-3.14-1.85-1.39-.8-.49-1.24.3-1.96.21-.19 3.85-3.52 3.91-3.82.01-.04.01-.19-.07-.27-.08-.08-.2-.05-.28-.03-.12.03-2.02.13-5.7 3.75-.54.54-1.03.8-1.48.78-.49-.02-1.42-.27-2.11-.5-.85-.28-1.53-.42-1.47-.89.03-.25.37-.51 1.02-.77 4-1.74 6.67-2.89 8.01-3.44 3.81-1.57 4.61-1.84 5.13-1.85.11 0 .37.03.53.18.14.12.18.28.2.45-.01.06-.01.24-.02.38z"})],-1)])],10,Rd)):u("",!0)])):u("",!0),e("div",{onClick:t[40]||(t[40]=r=>g.value=!0),class:"mt-2 p-2 bg-gray-50 dark:bg-slate-800/50 rounded-lg border border-gray-200 dark:border-slate-700 cursor-pointer active:bg-gray-100 dark:active:bg-slate-800 transition-colors"},[e("div",qd,[e("div",Hd,[e("div",{class:x([Se(s.order.escrow_status),"w-2 h-2 rounded-full animate-pulse"])},null,2),e("span",Od,i(Ae(s.order.escrow_status)),1)]),e("div",Nd,[e("span",Kd,i(s.order.crypto_amount)+" "+i(s.order.currency_label||s.order.currency_key),1),t[174]||(t[174]=e("svg",{class:"w-4 h-4 text-gray-400 dark:text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))])])])])])])])]),w(st,{show:n.value.show&&n.value.pendingAction!=="confirm_escrow"&&n.value.pendingAction!=="mark_buyer_paid"&&n.value.pendingAction!=="mark_seller_received"&&n.value.pendingAction!=="mark_seller_paid",title:n.value.title,"confirm-text":n.value.confirmText,"cancel-text":n.value.cancelText,onConfirm:t[42]||(t[42]=()=>Ne(n.value.inputValue)),onClose:J},{default:y(()=>[n.value.message?(a(),l("div",Xd,i(n.value.message),1)):u("",!0),n.value.inputMode?(a(),l("div",Gd,[n.value.inputLabel?(a(),l("label",Qd,i(n.value.inputLabel),1)):u("",!0),N(e("input",{"onUpdate:modelValue":t[41]||(t[41]=r=>n.value.inputValue=r),type:"text",placeholder:n.value.inputPlaceholder,required:n.value.inputRequired,class:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-slate-100 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"},null,8,Zd),[[le,n.value.inputValue]])])):u("",!0)]),_:1},8,["show","title","confirm-text","cancel-text"]),w(ue,{show:n.value.pendingAction==="confirm_escrow"&&n.value.show,"max-width":"lg",closeable:!0,onClose:J},{default:y(()=>[e("div",Jd,[t[189]||(t[189]=e("div",{class:"mx-auto flex items-center justify-center size-10 rounded-full bg-amber-100 dark:bg-amber-900/30"},[e("svg",{class:"size-5 text-amber-600 dark:text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",Yd,[t[188]||(t[188]=e("h3",{class:"text-base font-medium text-gray-900 dark:text-slate-100"}," 确认托管到账 ",-1)),e("div",ei,[e("div",ti,[e("div",si,[d.value.seller_address?(a(),l("div",ri,[t[175]||(t[175]=e("label",{class:"text-xs text-gray-500 dark:text-slate-400"},"来源地址（卖家）",-1)),e("p",ai,i(d.value.seller_address),1)])):u("",!0),d.value.escrow_address?(a(),l("div",li,[t[176]||(t[176]=e("label",{class:"text-xs text-gray-500 dark:text-slate-400"},"托管地址",-1)),e("p",oi,i(d.value.escrow_address),1)])):u("",!0),e("div",null,[t[177]||(t[177]=e("label",{class:"text-xs text-gray-500 dark:text-slate-400"},"交易金额",-1)),e("p",di,i(parseFloat(d.value.crypto_amount).toFixed(4))+" "+i(d.value.currency_label||d.value.currency_key||d.value.crypto_currency),1)]),d.value.escrow_tx_hash?(a(),l("div",ii,[t[178]||(t[178]=e("label",{class:"text-xs text-gray-500 dark:text-slate-400"},"交易哈希",-1)),e("p",ni,i(d.value.escrow_tx_hash),1)])):u("",!0)])]),t[186]||(t[186]=e("div",{class:"p-2.5 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-medium text-amber-800 dark:text-amber-300"},"请打开区块链浏览器仔细核对"),e("p",{class:"text-amber-700 dark:text-amber-400 mt-0.5"}," 确认前必须逐项检查以下所有信息 ")])])],-1)),e("div",ui,[t[185]||(t[185]=e("p",{class:"text-xs font-medium text-gray-700 dark:text-slate-300"},"请确认以下所有项目：",-1)),e("div",ci,[e("div",mi,[N(e("input",{"onUpdate:modelValue":t[43]||(t[43]=r=>W.value.txExists=r),type:"checkbox",class:"mt-0.5 h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded",disabled:n.value.loading},null,8,xi),[[ae,W.value.txExists]]),t[179]||(t[179]=e("label",{class:"ml-2 text-xs text-gray-700 dark:text-slate-300"}," 我已打开区块链浏览器，确认交易记录存在 ",-1))]),e("div",vi,[N(e("input",{"onUpdate:modelValue":t[44]||(t[44]=r=>W.value.confirmations=r),type:"checkbox",class:"mt-0.5 h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded",disabled:n.value.loading},null,8,bi),[[ae,W.value.confirmations]]),t[180]||(t[180]=e("label",{class:"ml-2 text-xs text-gray-700 dark:text-slate-300"}," 交易已有足够的确认数（建议至少6个确认） ",-1))]),e("div",fi,[N(e("input",{"onUpdate:modelValue":t[45]||(t[45]=r=>W.value.fromAddress=r),type:"checkbox",class:"mt-0.5 h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded",disabled:n.value.loading},null,8,gi),[[ae,W.value.fromAddress]]),e("label",ki,[t[181]||(t[181]=m(" 来源地址与卖家地址完全一致 ",-1)),e("span",pi,i(d.value.seller_address||"无卖家地址"),1)])]),e("div",yi,[N(e("input",{"onUpdate:modelValue":t[46]||(t[46]=r=>W.value.toAddress=r),type:"checkbox",class:"mt-0.5 h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded",disabled:n.value.loading},null,8,wi),[[ae,W.value.toAddress]]),e("label",hi,[t[182]||(t[182]=m(" 目标地址与托管地址完全一致 ",-1)),e("span",_i,i(d.value.escrow_address||"托管地址待分配"),1)])]),e("div",Ci,[N(e("input",{"onUpdate:modelValue":t[47]||(t[47]=r=>W.value.amount=r),type:"checkbox",class:"mt-0.5 h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded",disabled:n.value.loading},null,8,zi),[[ae,W.value.amount]]),e("label",Mi,[t[183]||(t[183]=m(" 交易金额为 ",-1)),e("span",$i,i(parseFloat(d.value.crypto_amount).toFixed(4))+" "+i(d.value.currency_label||d.value.currency_key||d.value.crypto_currency),1),t[184]||(t[184]=m("，完全正确 ",-1))])])])]),t[187]||(t[187]=e("div",{class:"p-2.5 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-bold text-red-800 dark:text-red-300"},"最终确认"),e("p",{class:"text-red-700 dark:text-red-400 mt-0.5"}," 确认后您将进入付款阶段，必须按时完成付款。如信息有误导致的损失，责任自负！ ")])])],-1))])])]),e("div",ji,[w(B,{variant:"ghost",onClick:J,disabled:n.value.loading},{default:y(()=>[...t[190]||(t[190]=[m(" 返回检查 ",-1)])]),_:1},8,["disabled"]),w(B,{variant:"warning",loading:n.value.loading,disabled:!Be.value,onClick:Xe},{default:y(()=>[...t[191]||(t[191]=[m(" 确认托管到账 ",-1)])]),_:1},8,["loading","disabled"])])]),_:1},8,["show"]),w(ue,{show:n.value.pendingAction==="mark_seller_paid"&&n.value.show,"max-width":"lg",closeable:!0,onClose:J},{default:y(()=>[e("div",Bi,[t[201]||(t[201]=e("div",{class:"mx-auto flex items-center justify-center size-10 rounded-full bg-blue-100 dark:bg-blue-900/30"},[e("svg",{class:"size-5 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})])],-1)),e("div",Fi,[t[200]||(t[200]=e("h3",{class:"text-base font-medium text-gray-900 dark:text-slate-100"}," 标记已转币到托管 ",-1)),e("div",Ai,[d.value.seller_address?(a(),l("div",Si,[e("div",Li,[e("div",null,[t[192]||(t[192]=e("label",{class:"text-xs text-gray-500 dark:text-slate-400"},"您的地址",-1)),e("p",Vi,i(d.value.seller_address),1)]),e("div",null,[t[193]||(t[193]=e("label",{class:"text-xs text-gray-500 dark:text-slate-400"},"转币金额",-1)),e("p",Ti,i(parseFloat(d.value.crypto_amount).toFixed(4))+" "+i(d.value.currency_label||d.value.currency_key||d.value.crypto_currency),1)])])])):u("",!0),t[198]||(t[198]=e("div",{class:"p-2.5 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-medium text-blue-800 dark:text-blue-300"},"托管地址提示"),e("p",{class:"text-blue-700 dark:text-blue-400 mt-0.5"}," 托管地址功能正在开发中，请先将币转到您自己的地址保管 ")])])],-1)),t[199]||(t[199]=e("div",{class:"p-2.5 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-xs"},[e("p",{class:"font-bold text-red-800 dark:text-red-300 text-sm"},"极其重要！请仔细核对！"),e("ul",{class:"mt-1 space-y-0.5 text-red-700 dark:text-red-400"},[e("li",{class:"text-xs"},"• 请确保转币地址完全正确"),e("li",{class:"text-xs"},[m("• "),e("span",{class:"font-bold"},"请一定要确保金额是一次性从您的地址转入，否则系统无法确认")]),e("li",{class:"text-xs"},"• 请确保转币金额准确无误"),e("li",{class:"text-xs"},[m("• "),e("span",{class:"font-bold"},"如果地址或金额错误，托管将无法确认！")]),e("li",{class:"text-xs"},[m("• "),e("span",{class:"font-bold text-red-800 dark:text-red-200"},"任何损失概不负责！")])])])])],-1)),e("div",null,[t[194]||(t[194]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2"},[m(" 交易哈希 (TX ID) "),e("span",{class:"text-red-500"},"*")],-1)),N(e("input",{"onUpdate:modelValue":t[48]||(t[48]=r=>Z.value=r),type:"text",placeholder:"请输入区块链交易哈希...",class:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:n.value.loading},null,8,Ii),[[le,Z.value]]),t[195]||(t[195]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-slate-400"}," 转币后请提供交易哈希作为凭证 ",-1))]),e("div",Ui,[N(e("input",{"onUpdate:modelValue":t[49]||(t[49]=r=>de.value=r),type:"checkbox",class:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",disabled:n.value.loading},null,8,Ei),[[ae,de.value]]),e("label",Pi,[t[196]||(t[196]=m(" 我已仔细核对金额，确认已准备好 ",-1)),e("span",Di,i(parseFloat(d.value.crypto_amount).toFixed(4))+" "+i(d.value.currency_label||d.value.currency_key||d.value.crypto_currency),1),t[197]||(t[197]=m(" 用于交易 ",-1))])])])])]),e("div",Wi,[w(B,{variant:"ghost",onClick:J,disabled:n.value.loading},{default:y(()=>[...t[202]||(t[202]=[m(" 返回 ",-1)])]),_:1},8,["disabled"]),w(B,{variant:"primary",loading:n.value.loading,disabled:!Z.value||!Z.value.trim()||!de.value,onClick:Ge},{default:y(()=>[...t[203]||(t[203]=[m(" 确认已转币 ",-1)])]),_:1},8,["loading","disabled"])])]),_:1},8,["show"]),w(ue,{show:n.value.pendingAction==="mark_buyer_paid"&&n.value.show,"max-width":"md",closeable:!0,onClose:J},{default:y(()=>[e("div",Ri,[t[209]||(t[209]=e("div",{class:"mx-auto flex items-center justify-center size-12 rounded-full bg-emerald-100 dark:bg-emerald-900/30"},[e("svg",{class:"size-6 text-emerald-600 dark:text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",qi,[t[208]||(t[208]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-slate-100"}," 标记已付款 ",-1)),e("div",Hi,[e("p",Oi,[t[204]||(t[204]=m(" 请确认您已向卖家付款 ",-1)),e("span",Ni,"¥"+i(parseFloat(s.order.fiat_amount).toFixed(2)),1)]),e("div",null,[t[205]||(t[205]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2"}," 付款说明（可选） ",-1)),N(e("textarea",{"onUpdate:modelValue":t[50]||(t[50]=r=>re.value=r),rows:"3",class:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-slate-100 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors",placeholder:"请输入付款凭证或说明，如转账单号..."},null,512),[[le,re.value]])]),s.userHas2FA?(a(),l("div",Ki,[w(Pe,{modelValue:n.value.twoFactorCode,"onUpdate:modelValue":t[51]||(t[51]=r=>n.value.twoFactorCode=r),error:n.value.twoFactorError,disabled:n.value.loading,onComplete:Ie},null,8,["modelValue","error","disabled"])])):(a(),l("div",Xi,[...t[206]||(t[206]=[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-sm"},[e("p",{class:"font-medium text-amber-800 dark:text-amber-300"},"需要双重验证"),e("p",{class:"text-amber-700 dark:text-amber-400 mt-0.5"},"为保护您的资金安全，买家付款必须启用双重验证")])],-1)])])),s.userHas2FA?(a(),l("div",Gi,[...t[207]||(t[207]=[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})]),e("div",{class:"text-sm"},[e("p",{class:"font-medium text-red-800 dark:text-red-300"},"注意事项"),e("p",{class:"text-red-700 dark:text-red-400 mt-0.5"},"请确保已完成付款再点击确认，虚假付款将导致账户封禁")])],-1)])])):u("",!0)])])]),e("div",Qi,[w(B,{variant:"ghost",onClick:J,disabled:n.value.loading},{default:y(()=>[...t[210]||(t[210]=[m(" 返回 ",-1)])]),_:1},8,["disabled"]),s.userHas2FA?(a(),te(B,{key:0,variant:"primary",loading:n.value.loading,disabled:!n.value.twoFactorCode||n.value.twoFactorCode.length!==6,onClick:Ke},{default:y(()=>[...t[211]||(t[211]=[m(" 确认已付款 ",-1)])]),_:1},8,["loading","disabled"])):(a(),te(B,{key:1,variant:"warning",onClick:t[52]||(t[52]=()=>Me(q).visit("/user/profile"))},{default:y(()=>[...t[212]||(t[212]=[m(" 前往启用双重验证 ",-1)])]),_:1}))])]),_:1},8,["show"]),w(ue,{show:n.value.pendingAction==="mark_seller_received"&&n.value.show,"max-width":"md",closeable:!0,onClose:J},{default:y(()=>[e("div",Zi,[t[217]||(t[217]=e("div",{class:"mx-auto flex items-center justify-center size-12 rounded-full bg-emerald-100 dark:bg-emerald-900/30"},[e("svg",{class:"size-6 text-emerald-600 dark:text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",Ji,[t[216]||(t[216]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-slate-100"}," 确认收款 ",-1)),e("div",Yi,[e("p",e0,[t[213]||(t[213]=m(" 请确认您已收到买家付款 ",-1)),e("span",t0,"¥"+i(parseFloat(s.order.fiat_amount).toFixed(2)),1)]),s.userHas2FA?(a(),l("div",s0,[w(Pe,{modelValue:n.value.twoFactorCode,"onUpdate:modelValue":t[53]||(t[53]=r=>n.value.twoFactorCode=r),error:n.value.twoFactorError,disabled:n.value.loading,onComplete:Ie},null,8,["modelValue","error","disabled"])])):(a(),l("div",r0,[...t[214]||(t[214]=[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"text-sm"},[e("p",{class:"font-medium text-amber-800 dark:text-amber-300"},"需要双重验证"),e("p",{class:"text-amber-700 dark:text-amber-400 mt-0.5"},"为保护您的资金安全，卖家确认收款必须启用双重验证")])],-1)])])),s.userHas2FA?(a(),l("div",a0,[...t[215]||(t[215]=[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})]),e("div",{class:"text-sm"},[e("p",{class:"font-medium text-red-800 dark:text-red-300"},"重要提醒"),e("p",{class:"text-red-700 dark:text-red-400 mt-0.5"},"确认收款后，托管的加密货币将立即释放给买家，此操作不可撤销")])],-1)])])):u("",!0)])])]),e("div",l0,[w(B,{variant:"ghost",onClick:J,disabled:n.value.loading},{default:y(()=>[...t[218]||(t[218]=[m(" 返回 ",-1)])]),_:1},8,["disabled"]),s.userHas2FA?(a(),te(B,{key:0,variant:"success",loading:n.value.loading,disabled:!n.value.twoFactorCode||n.value.twoFactorCode.length!==6,onClick:Qe},{default:y(()=>[...t[219]||(t[219]=[m(" 确认收款 ",-1)])]),_:1},8,["loading","disabled"])):(a(),te(B,{key:1,variant:"warning",onClick:t[54]||(t[54]=()=>Me(q).visit("/user/profile"))},{default:y(()=>[...t[220]||(t[220]=[m(" 前往启用双重验证 ",-1)])]),_:1}))])]),_:1},8,["show"]),w(Ee,{modelValue:f.value,"onUpdate:modelValue":t[55]||(t[55]=r=>f.value=r),title:"商家交易条款",subtitle:`订单 #${s.order.order_no}`,position:"bottom",size:"default","icon-color":"purple"},{"header-icon":y(()=>[...t[221]||(t[221]=[e("div",{class:"p-2 rounded-lg bg-purple-100 dark:bg-purple-900/30"},[e("svg",{class:"w-5 h-5 text-purple-600 dark:text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)])]),default:y(()=>[e("div",o0,[s.order.ad_snapshot?.vendor_toc?(a(),l("div",d0,[e("p",i0,i(s.order.ad_snapshot?.vendor_toc),1)])):(a(),l("div",n0,[...t[222]||(t[222]=[e("p",{class:"text-sm text-gray-500 dark:text-slate-400 text-center"},"商家未设置交易条款",-1)])])),t[223]||(t[223]=e("div",{class:"mt-4 p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800"},[e("div",{class:"flex items-start gap-2"},[e("svg",{class:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("p",{class:"text-xs text-amber-700 dark:text-amber-300"}," 请仔细阅读并遵守以上交易条款，违反条款可能导致交易取消 ")])],-1))])]),_:1},8,["modelValue","subtitle"])]),_:1},8,["breadcrumbs"]),w(Jt,{modelValue:b.value,"onUpdate:modelValue":t[56]||(t[56]=r=>b.value=r),"order-id":d.value.id,"order-no":d.value.order_no,"vendor-name":d.value.vendor?.name||"商家","fiat-amount":d.value.fiat_amount,"fiat-currency":d.value.fiat_currency,"crypto-amount":d.value.crypto_amount,"crypto-currency":d.value.currency_key||d.value.crypto_currency,onSuccess:Oe},null,8,["modelValue","order-id","order-no","vendor-name","fiat-amount","fiat-currency","crypto-amount","crypto-currency"])],64))}};export{g0 as default};
